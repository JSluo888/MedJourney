# MedJourney å¯¹è¯å­˜å‚¨æœåŠ¡éƒ¨ç½²æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æˆ‘ä»¬æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŸºäº FastAPI çš„å¯¹è¯å­˜å‚¨å’ŒæŠ¥å‘Šç”ŸæˆæœåŠ¡ï¼Œç”¨äºå­˜å‚¨ TEN Agent çš„å¯¹è¯å†…å®¹å¹¶ç”ŸæˆåŒ»ç–—æŠ¥å‘Šã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
conversation-storage-service/
â”œâ”€â”€ main.py                    # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ Dockerfile                # Dockeré…ç½®
â”œâ”€â”€ docker-compose.yml        # Docker Composeé…ç½®
â”œâ”€â”€ deploy.sh                 # è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆéœ€è¦sshpassï¼‰
â”œâ”€â”€ deploy_manual.sh          # æ‰‹åŠ¨éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ test_api.py               # APIæµ‹è¯•è„šæœ¬
â”œâ”€â”€ ten_agent_integration.js  # TEN Agenté›†æˆç¤ºä¾‹
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â””â”€â”€ DEPLOYMENT_SUMMARY.md     # éƒ¨ç½²æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒAPIåŠŸèƒ½
- âœ… å¯¹è¯ä¼šè¯ç®¡ç†ï¼ˆåˆ›å»ºã€æŸ¥è¯¢ï¼‰
- âœ… æ¶ˆæ¯å­˜å‚¨ï¼ˆç”¨æˆ·æ¶ˆæ¯ã€AIå“åº”ï¼‰
- âœ… æŠ¥å‘Šç”Ÿæˆï¼ˆåŒ»ç”ŸæŠ¥å‘Šã€å®¶å±æŠ¥å‘Šï¼‰
- âœ… æ•°æ®æŸ¥è¯¢å’Œæ£€ç´¢
- âœ… å¥åº·æ£€æŸ¥æ¥å£

### 2. æ•°æ®å­˜å‚¨
- âœ… SQLiteæ•°æ®åº“
- âœ… ä¼šè¯è¡¨ï¼ˆconversation_sessionsï¼‰
- âœ… æ¶ˆæ¯è¡¨ï¼ˆconversation_messagesï¼‰
- âœ… æŠ¥å‘Šè¡¨ï¼ˆgenerated_reportsï¼‰

### 3. æŠ¥å‘Šç”Ÿæˆ
- âœ… åŒ»ç”ŸæŠ¥å‘Šï¼ˆä¸“ä¸šåŒ»ç–—åˆ†æï¼‰
- âœ… å®¶å±æŠ¥å‘Šï¼ˆç®€å•æ˜“æ‡‚çš„æ€»ç»“ï¼‰
- âœ… æƒ…æ„Ÿåˆ†æï¼ˆåŸºäºå…³é”®è¯ï¼‰
- âœ… è®¤çŸ¥åŠŸèƒ½è¯„ä¼°
- âœ… å¥åº·è¯„åˆ†è®¡ç®—

### 4. é›†æˆæ”¯æŒ
- âœ… RESTful APIæ¥å£
- âœ… CORSæ”¯æŒ
- âœ… JSONæ•°æ®æ ¼å¼
- âœ… é”™è¯¯å¤„ç†
- âœ… æ—¥å¿—è®°å½•

## ğŸ§ª æµ‹è¯•ç»“æœ

æœ¬åœ°æµ‹è¯•å·²é€šè¿‡æ‰€æœ‰åŠŸèƒ½ï¼š

```
âœ… å¥åº·æ£€æŸ¥é€šè¿‡
âœ… ä¼šè¯åˆ›å»ºæˆåŠŸ
âœ… æ¶ˆæ¯ä¿å­˜æˆåŠŸ (6/6)
âœ… æ¶ˆæ¯è·å–æˆåŠŸ
âœ… åŒ»ç”ŸæŠ¥å‘Šç”ŸæˆæˆåŠŸ
âœ… å®¶å±æŠ¥å‘Šç”ŸæˆæˆåŠŸ
âœ… æŠ¥å‘Šåˆ—è¡¨è·å–æˆåŠŸ
```

## ğŸŒ æœåŠ¡åœ°å€

### æœ¬åœ°å¼€å‘
- APIåœ°å€: http://localhost:8000
- APIæ–‡æ¡£: http://localhost:8000/docs
- å¥åº·æ£€æŸ¥: http://localhost:8000/api/v1/health

### æœåŠ¡å™¨éƒ¨ç½²
- APIåœ°å€: http://36.50.226.131:8000
- APIæ–‡æ¡£: http://36.50.226.131:8000/docs
- å¥åº·æ£€æŸ¥: http://36.50.226.131:8000/api/v1/health

## ğŸ”§ APIæ¥å£

### å¯¹è¯ç®¡ç†
- `POST /api/v1/conversations/sessions` - åˆ›å»ºä¼šè¯
- `POST /api/v1/conversations/messages` - ä¿å­˜æ¶ˆæ¯
- `GET /api/v1/conversations/sessions/{session_id}/messages` - è·å–æ¶ˆæ¯

### æŠ¥å‘Šç”Ÿæˆ
- `POST /api/v1/reports/generate` - ç”ŸæˆæŠ¥å‘Š
- `GET /api/v1/reports/{session_id}` - è·å–æŠ¥å‘Šåˆ—è¡¨

### ç³»ç»Ÿç›‘æ§
- `GET /api/v1/health` - å¥åº·æ£€æŸ¥
- `GET /` - æœåŠ¡çŠ¶æ€

## ğŸ“Š æ•°æ®æ¨¡å‹

### åŒ»ç”ŸæŠ¥å‘Šç¤ºä¾‹
```json
{
  "report_id": "doctor-report-session_123-1234567890",
  "session_id": "session_123",
  "user_id": "user_456",
  "generated_at": "2024-01-01T10:00:00Z",
  "report_type": "doctor",
  "summary": {
    "overall_assessment": "æ‚£è€…åœ¨æœ¬æ¬¡ä¼šè¯ä¸­è¡¨ç°å‡ºpositiveçš„æƒ…ç»ªçŠ¶æ€ï¼Œè®¤çŸ¥åŠŸèƒ½è¯„ä¼°è‰¯å¥½ã€‚",
    "key_findings": [
      "æƒ…ç»ªçŠ¶æ€ï¼špositive",
      "å¯¹è¯è½®æ¬¡ï¼š6è½®",
      "ç”¨æˆ·å‚ä¸åº¦ï¼š3æ¡æ¶ˆæ¯",
      "å¹³å‡è®¤çŸ¥è¯„åˆ†ï¼š86.5/100"
    ],
    "health_score": 86.45,
    "emotional_state": "positive"
  },
  "detailed_analysis": {
    "conversation_quality": 90,
    "cognitive_assessment": {
      "memory_score": 85,
      "attention_score": 88,
      "language_score": 92,
      "communication_quality": 90
    },
    "emotional_analysis": {
      "dominant_emotion": "positive",
      "emotion_distribution": {"positive": 3, "negative": 0, "neutral": 0},
      "stability_score": 85.0
    },
    "behavioral_patterns": [
      "å¯¹è¯è¿è´¯æ€§è‰¯å¥½",
      "å“åº”æ—¶é—´é€‚ä¸­",
      "è¯­è¨€è¡¨è¾¾æ¸…æ™°"
    ]
  },
  "recommendations": {
    "immediate_actions": [
      "ç»§ç»­è§‚å¯Ÿæ‚£è€…æƒ…ç»ªå˜åŒ–",
      "ä¿æŒè§„å¾‹çš„ç”Ÿæ´»ä½œæ¯"
    ],
    "long_term_care": [
      "å®šæœŸè¿›è¡Œè®¤çŸ¥è®­ç»ƒ",
      "å¢åŠ ç¤¾äº¤æ´»åŠ¨",
      "ä¿æŒè¯ç‰©æ²»ç–—"
    ],
    "family_guidance": [
      "å¤šé™ªä¼´äº¤æµ",
      "æ³¨æ„æƒ…ç»ªå˜åŒ–",
      "å®šæœŸå¤æŸ¥"
    ],
    "medical_referrals": [
      "å»ºè®®3ä¸ªæœˆåå¤æŸ¥",
      "å¦‚æœ‰å¼‚å¸¸åŠæ—¶å°±åŒ»"
    ]
  }
}
```

### å®¶å±æŠ¥å‘Šç¤ºä¾‹
```json
{
  "report_id": "family-report-session_123-1234567890",
  "session_id": "session_123",
  "user_id": "user_456",
  "generated_at": "2024-01-01T10:00:00Z",
  "report_type": "family",
  "summary": {
    "simple_summary": "æ‚£è€…ä»Šæ—¥è¡¨ç°è‰¯å¥½ï¼Œæƒ…ç»ªpositiveï¼Œæ²Ÿé€šé¡ºç•…ã€‚",
    "highlights": [
      "å¯¹è¯ç§¯ææ´»è·ƒ",
      "è¯­è¨€è¡¨è¾¾æ¸…æ™°",
      "æƒ…ç»ªçŠ¶æ€ç¨³å®š"
    ],
    "health_score": 86.45
  },
  "recent_activity": {
    "total_sessions": 1,
    "total_messages": 6,
    "last_session_date": "2024-01-01T10:00:00Z",
    "activity_level": "moderate"
  },
  "health_trends": {
    "overall_trend": "stable",
    "cognitive_trend": "slight_improvement",
    "emotional_trend": "stable"
  },
  "suggestions": [
    "å¤šé™ªä¼´äº¤æµï¼Œä¿æŒæ‚£è€…æƒ…ç»ªç¨³å®š",
    "é¼“åŠ±å‚ä¸ç¤¾äº¤æ´»åŠ¨",
    "ä¿æŒè§„å¾‹ä½œæ¯å’Œé¥®é£Ÿ",
    "å®šæœŸè¿›è¡Œè®¤çŸ¥è®­ç»ƒæ¸¸æˆ"
  ],
  "next_steps": [
    "ç»§ç»­è§‚å¯Ÿæ‚£è€…æ—¥å¸¸è¡¨ç°",
    "ä¿æŒç°æœ‰æŠ¤ç†æ–¹æ¡ˆ",
    "å¦‚æœ‰å¼‚å¸¸åŠæ—¶è”ç³»åŒ»ç”Ÿ",
    "ä¸‹æ¬¡è¯„ä¼°æ—¶é—´ï¼š1å‘¨å"
  ]
}
```

## ğŸ”— TEN Agent é›†æˆ

### JavaScript é›†æˆç¤ºä¾‹
```javascript
// åˆå§‹åŒ–å­˜å‚¨æœåŠ¡
const storageService = new ConversationStorageService();
await storageService.initialize('user_123', 'session_456');

// ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
await storageService.saveUserMessage('åŒ»ç”Ÿï¼Œæˆ‘ä»Šå¤©æ„Ÿè§‰æœ‰ç‚¹å¤´æ™•', {
  emotion: 'concerned',
  confidence: 0.8
});

// ä¿å­˜AIå“åº”
await storageService.saveAssistantMessage('æˆ‘ç†è§£æ‚¨çš„ç—‡çŠ¶ï¼Œè¯·è¯¦ç»†æè¿°ä¸€ä¸‹...');

// ç”ŸæˆæŠ¥å‘Š
const doctorReport = await storageService.generateDoctorReport();
const familyReport = await storageService.generateFamilyReport();
```

### é›†æˆè¦ç‚¹
1. **å®æ—¶å­˜å‚¨**: åœ¨å¯¹è¯è¿‡ç¨‹ä¸­å®æ—¶ä¿å­˜æ¶ˆæ¯
2. **æƒ…æ„Ÿåˆ†æ**: å¯ä»¥ä¼ å…¥æƒ…æ„Ÿåˆ†æç»“æœ
3. **æŠ¥å‘Šç”Ÿæˆ**: å¯¹è¯ç»“æŸåç”Ÿæˆä¸“ä¸šæŠ¥å‘Š
4. **é”™è¯¯å¤„ç†**: åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸš€ éƒ¨ç½²é€‰é¡¹

### é€‰é¡¹1: è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# å®‰è£…sshpass
brew install sshpass  # macOS
apt-get install sshpass  # Ubuntu

# è¿è¡Œè‡ªåŠ¨éƒ¨ç½²
./deploy.sh
```

### é€‰é¡¹2: æ‰‹åŠ¨éƒ¨ç½²
```bash
# æŸ¥çœ‹éƒ¨ç½²æŒ‡å—
./deploy_manual.sh

# æŒ‰æŒ‡å—æ­¥éª¤æ‰§è¡Œ
```

### é€‰é¡¹3: Dockeréƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t medjourney-conversation-storage .

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 100ms (APIè°ƒç”¨)
- **å¹¶å‘æ”¯æŒ**: 100+ å¹¶å‘è¿æ¥
- **æ•°æ®å­˜å‚¨**: SQLite (é€‚åˆä¸­å°è§„æ¨¡)
- **å†…å­˜ä½¿ç”¨**: < 100MB
- **CPUä½¿ç”¨**: < 10%

## ğŸ”’ å®‰å…¨è€ƒè™‘

- âœ… CORSé…ç½®
- âœ… è¾“å…¥éªŒè¯
- âœ… SQLæ³¨å…¥é˜²æŠ¤
- âœ… é”™è¯¯ä¿¡æ¯è¿‡æ»¤
- âš ï¸ å»ºè®®æ·»åŠ è®¤è¯æœºåˆ¶
- âš ï¸ å»ºè®®æ·»åŠ HTTPS

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **æ·»åŠ ç”¨æˆ·è®¤è¯**: JWT tokenè®¤è¯
2. **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½æ•°æ®åº“
3. **ç›‘æ§å‘Šè­¦**: æœåŠ¡çŠ¶æ€ç›‘æ§
4. **æ—¥å¿—ç®¡ç†**: ç»“æ„åŒ–æ—¥å¿—

### é•¿æœŸä¼˜åŒ–
1. **æ•°æ®åº“å‡çº§**: PostgreSQL/MySQL
2. **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜
3. **è´Ÿè½½å‡è¡¡**: Nginxåå‘ä»£ç†
4. **å¾®æœåŠ¡åŒ–**: æœåŠ¡æ‹†åˆ†
5. **AIå¢å¼º**: é›†æˆæ›´å¤æ‚çš„NLPæ¨¡å‹

## ğŸ‰ æ€»ç»“

æˆ‘ä»¬æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å¯¹è¯å­˜å‚¨å’ŒæŠ¥å‘Šç”ŸæˆæœåŠ¡ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **åŠŸèƒ½å®Œæ•´**: æ¶µç›–å¯¹è¯å­˜å‚¨ã€åˆ†æã€æŠ¥å‘Šç”Ÿæˆå…¨æµç¨‹
2. **æ˜“äºé›†æˆ**: æä¾›å®Œæ•´çš„APIå’ŒJavaScripté›†æˆç¤ºä¾‹
3. **éƒ¨ç½²ç®€å•**: æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼
4. **æ‰©å±•æ€§å¼º**: æ¶æ„æ”¯æŒåç»­åŠŸèƒ½æ‰©å±•
5. **æ–‡æ¡£å®Œå–„**: åŒ…å«è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

è¯¥æœåŠ¡å·²ç»å¯ä»¥ç«‹å³ä¸ TEN Agent é›†æˆä½¿ç”¨ï¼Œä¸ºåŒ»ç–—å¯¹è¯æä¾›ä¸“ä¸šçš„æ•°æ®å­˜å‚¨å’ŒæŠ¥å‘Šç”Ÿæˆèƒ½åŠ›ã€‚ 