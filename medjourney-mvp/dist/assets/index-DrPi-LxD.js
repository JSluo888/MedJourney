var Yue=Object.defineProperty;var Xue=(i,n,o)=>n in i?Yue(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o;var bn=(i,n,o)=>Xue(i,typeof n!="symbol"?n+"":n,o);function Jue(i,n){for(var o=0;o<n.length;o++){const s=n[o];if(typeof s!="string"&&!Array.isArray(s)){for(const u in s)if(u!=="default"&&!(u in i)){const f=Object.getOwnPropertyDescriptor(s,u);f&&Object.defineProperty(i,u,f.get?f:{enumerable:!0,get:()=>s[u]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function o(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(u){if(u.ep)return;u.ep=!0;const f=o(u);fetch(u.href,f)}})();var Lp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var tD={exports:{}},AE={},rD={exports:{}},Cr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $8;function Que(){if($8)return Cr;$8=1;var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),_=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),A=Symbol.iterator;function P(fe){return fe===null||typeof fe!="object"?null:(fe=A&&fe[A]||fe["@@iterator"],typeof fe=="function"?fe:null)}var j={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,F={};function M(fe,Ce,ot){this.props=fe,this.context=Ce,this.refs=F,this.updater=ot||j}M.prototype.isReactComponent={},M.prototype.setState=function(fe,Ce){if(typeof fe!="object"&&typeof fe!="function"&&fe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,fe,Ce,"setState")},M.prototype.forceUpdate=function(fe){this.updater.enqueueForceUpdate(this,fe,"forceUpdate")};function X(){}X.prototype=M.prototype;function Y(fe,Ce,ot){this.props=fe,this.context=Ce,this.refs=F,this.updater=ot||j}var J=Y.prototype=new X;J.constructor=Y,W(J,M.prototype),J.isPureReactComponent=!0;var re=Array.isArray,z=Object.prototype.hasOwnProperty,Z={current:null},ie={key:!0,ref:!0,__self:!0,__source:!0};function de(fe,Ce,ot){var _t,Lt={},Yt=null,br=null;if(Ce!=null)for(_t in Ce.ref!==void 0&&(br=Ce.ref),Ce.key!==void 0&&(Yt=""+Ce.key),Ce)z.call(Ce,_t)&&!ie.hasOwnProperty(_t)&&(Lt[_t]=Ce[_t]);var Qt=arguments.length-2;if(Qt===1)Lt.children=ot;else if(1<Qt){for(var nt=Array(Qt),It=0;It<Qt;It++)nt[It]=arguments[It+2];Lt.children=nt}if(fe&&fe.defaultProps)for(_t in Qt=fe.defaultProps,Qt)Lt[_t]===void 0&&(Lt[_t]=Qt[_t]);return{$$typeof:i,type:fe,key:Yt,ref:br,props:Lt,_owner:Z.current}}function ge(fe,Ce){return{$$typeof:i,type:fe.type,key:Ce,ref:fe.ref,props:fe.props,_owner:fe._owner}}function Oe(fe){return typeof fe=="object"&&fe!==null&&fe.$$typeof===i}function me(fe){var Ce={"=":"=0",":":"=2"};return"$"+fe.replace(/[=:]/g,function(ot){return Ce[ot]})}var ye=/\/+/g;function Ae(fe,Ce){return typeof fe=="object"&&fe!==null&&fe.key!=null?me(""+fe.key):Ce.toString(36)}function be(fe,Ce,ot,_t,Lt){var Yt=typeof fe;(Yt==="undefined"||Yt==="boolean")&&(fe=null);var br=!1;if(fe===null)br=!0;else switch(Yt){case"string":case"number":br=!0;break;case"object":switch(fe.$$typeof){case i:case n:br=!0}}if(br)return br=fe,Lt=Lt(br),fe=_t===""?"."+Ae(br,0):_t,re(Lt)?(ot="",fe!=null&&(ot=fe.replace(ye,"$&/")+"/"),be(Lt,Ce,ot,"",function(It){return It})):Lt!=null&&(Oe(Lt)&&(Lt=ge(Lt,ot+(!Lt.key||br&&br.key===Lt.key?"":(""+Lt.key).replace(ye,"$&/")+"/")+fe)),Ce.push(Lt)),1;if(br=0,_t=_t===""?".":_t+":",re(fe))for(var Qt=0;Qt<fe.length;Qt++){Yt=fe[Qt];var nt=_t+Ae(Yt,Qt);br+=be(Yt,Ce,ot,nt,Lt)}else if(nt=P(fe),typeof nt=="function")for(fe=nt.call(fe),Qt=0;!(Yt=fe.next()).done;)Yt=Yt.value,nt=_t+Ae(Yt,Qt++),br+=be(Yt,Ce,ot,nt,Lt);else if(Yt==="object")throw Ce=String(fe),Error("Objects are not valid as a React child (found: "+(Ce==="[object Object]"?"object with keys {"+Object.keys(fe).join(", ")+"}":Ce)+"). If you meant to render a collection of children, use an array instead.");return br}function ke(fe,Ce,ot){if(fe==null)return fe;var _t=[],Lt=0;return be(fe,_t,"","",function(Yt){return Ce.call(ot,Yt,Lt++)}),_t}function Me(fe){if(fe._status===-1){var Ce=fe._result;Ce=Ce(),Ce.then(function(ot){(fe._status===0||fe._status===-1)&&(fe._status=1,fe._result=ot)},function(ot){(fe._status===0||fe._status===-1)&&(fe._status=2,fe._result=ot)}),fe._status===-1&&(fe._status=0,fe._result=Ce)}if(fe._status===1)return fe._result.default;throw fe._result}var Ue={current:null},Pe={transition:null},We={ReactCurrentDispatcher:Ue,ReactCurrentBatchConfig:Pe,ReactCurrentOwner:Z};function He(){throw Error("act(...) is not supported in production builds of React.")}return Cr.Children={map:ke,forEach:function(fe,Ce,ot){ke(fe,function(){Ce.apply(this,arguments)},ot)},count:function(fe){var Ce=0;return ke(fe,function(){Ce++}),Ce},toArray:function(fe){return ke(fe,function(Ce){return Ce})||[]},only:function(fe){if(!Oe(fe))throw Error("React.Children.only expected to receive a single React element child.");return fe}},Cr.Component=M,Cr.Fragment=o,Cr.Profiler=u,Cr.PureComponent=Y,Cr.StrictMode=s,Cr.Suspense=T,Cr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=We,Cr.act=He,Cr.cloneElement=function(fe,Ce,ot){if(fe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+fe+".");var _t=W({},fe.props),Lt=fe.key,Yt=fe.ref,br=fe._owner;if(Ce!=null){if(Ce.ref!==void 0&&(Yt=Ce.ref,br=Z.current),Ce.key!==void 0&&(Lt=""+Ce.key),fe.type&&fe.type.defaultProps)var Qt=fe.type.defaultProps;for(nt in Ce)z.call(Ce,nt)&&!ie.hasOwnProperty(nt)&&(_t[nt]=Ce[nt]===void 0&&Qt!==void 0?Qt[nt]:Ce[nt])}var nt=arguments.length-2;if(nt===1)_t.children=ot;else if(1<nt){Qt=Array(nt);for(var It=0;It<nt;It++)Qt[It]=arguments[It+2];_t.children=Qt}return{$$typeof:i,type:fe.type,key:Lt,ref:Yt,props:_t,_owner:br}},Cr.createContext=function(fe){return fe={$$typeof:_,_currentValue:fe,_currentValue2:fe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},fe.Provider={$$typeof:f,_context:fe},fe.Consumer=fe},Cr.createElement=de,Cr.createFactory=function(fe){var Ce=de.bind(null,fe);return Ce.type=fe,Ce},Cr.createRef=function(){return{current:null}},Cr.forwardRef=function(fe){return{$$typeof:E,render:fe}},Cr.isValidElement=Oe,Cr.lazy=function(fe){return{$$typeof:I,_payload:{_status:-1,_result:fe},_init:Me}},Cr.memo=function(fe,Ce){return{$$typeof:w,type:fe,compare:Ce===void 0?null:Ce}},Cr.startTransition=function(fe){var Ce=Pe.transition;Pe.transition={};try{fe()}finally{Pe.transition=Ce}},Cr.unstable_act=He,Cr.useCallback=function(fe,Ce){return Ue.current.useCallback(fe,Ce)},Cr.useContext=function(fe){return Ue.current.useContext(fe)},Cr.useDebugValue=function(){},Cr.useDeferredValue=function(fe){return Ue.current.useDeferredValue(fe)},Cr.useEffect=function(fe,Ce){return Ue.current.useEffect(fe,Ce)},Cr.useId=function(){return Ue.current.useId()},Cr.useImperativeHandle=function(fe,Ce,ot){return Ue.current.useImperativeHandle(fe,Ce,ot)},Cr.useInsertionEffect=function(fe,Ce){return Ue.current.useInsertionEffect(fe,Ce)},Cr.useLayoutEffect=function(fe,Ce){return Ue.current.useLayoutEffect(fe,Ce)},Cr.useMemo=function(fe,Ce){return Ue.current.useMemo(fe,Ce)},Cr.useReducer=function(fe,Ce,ot){return Ue.current.useReducer(fe,Ce,ot)},Cr.useRef=function(fe){return Ue.current.useRef(fe)},Cr.useState=function(fe){return Ue.current.useState(fe)},Cr.useSyncExternalStore=function(fe,Ce,ot){return Ue.current.useSyncExternalStore(fe,Ce,ot)},Cr.useTransition=function(){return Ue.current.useTransition()},Cr.version="18.3.1",Cr}var Y8;function GM(){return Y8||(Y8=1,rD.exports=Que()),rD.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X8;function Zue(){if(X8)return AE;X8=1;var i=GM(),n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,u=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function _(E,T,w){var I,A={},P=null,j=null;w!==void 0&&(P=""+w),T.key!==void 0&&(P=""+T.key),T.ref!==void 0&&(j=T.ref);for(I in T)s.call(T,I)&&!f.hasOwnProperty(I)&&(A[I]=T[I]);if(E&&E.defaultProps)for(I in T=E.defaultProps,T)A[I]===void 0&&(A[I]=T[I]);return{$$typeof:n,type:E,key:P,ref:j,props:A,_owner:u.current}}return AE.Fragment=o,AE.jsx=_,AE.jsxs=_,AE}var J8;function ede(){return J8||(J8=1,tD.exports=Zue()),tD.exports}var U=ede(),Ee=GM();const ue=Yr(Ee),tde=Jue({__proto__:null,default:ue},[Ee]);var Jw={},nD={exports:{}},io={},iD={exports:{}},aD={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q8;function rde(){return Q8||(Q8=1,function(i){function n(Pe,We){var He=Pe.length;Pe.push(We);e:for(;0<He;){var fe=He-1>>>1,Ce=Pe[fe];if(0<u(Ce,We))Pe[fe]=We,Pe[He]=Ce,He=fe;else break e}}function o(Pe){return Pe.length===0?null:Pe[0]}function s(Pe){if(Pe.length===0)return null;var We=Pe[0],He=Pe.pop();if(He!==We){Pe[0]=He;e:for(var fe=0,Ce=Pe.length,ot=Ce>>>1;fe<ot;){var _t=2*(fe+1)-1,Lt=Pe[_t],Yt=_t+1,br=Pe[Yt];if(0>u(Lt,He))Yt<Ce&&0>u(br,Lt)?(Pe[fe]=br,Pe[Yt]=He,fe=Yt):(Pe[fe]=Lt,Pe[_t]=He,fe=_t);else if(Yt<Ce&&0>u(br,He))Pe[fe]=br,Pe[Yt]=He,fe=Yt;else break e}}return We}function u(Pe,We){var He=Pe.sortIndex-We.sortIndex;return He!==0?He:Pe.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;i.unstable_now=function(){return f.now()}}else{var _=Date,E=_.now();i.unstable_now=function(){return _.now()-E}}var T=[],w=[],I=1,A=null,P=3,j=!1,W=!1,F=!1,M=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(Pe){for(var We=o(w);We!==null;){if(We.callback===null)s(w);else if(We.startTime<=Pe)s(w),We.sortIndex=We.expirationTime,n(T,We);else break;We=o(w)}}function re(Pe){if(F=!1,J(Pe),!W)if(o(T)!==null)W=!0,Me(z);else{var We=o(w);We!==null&&Ue(re,We.startTime-Pe)}}function z(Pe,We){W=!1,F&&(F=!1,X(de),de=-1),j=!0;var He=P;try{for(J(We),A=o(T);A!==null&&(!(A.expirationTime>We)||Pe&&!me());){var fe=A.callback;if(typeof fe=="function"){A.callback=null,P=A.priorityLevel;var Ce=fe(A.expirationTime<=We);We=i.unstable_now(),typeof Ce=="function"?A.callback=Ce:A===o(T)&&s(T),J(We)}else s(T);A=o(T)}if(A!==null)var ot=!0;else{var _t=o(w);_t!==null&&Ue(re,_t.startTime-We),ot=!1}return ot}finally{A=null,P=He,j=!1}}var Z=!1,ie=null,de=-1,ge=5,Oe=-1;function me(){return!(i.unstable_now()-Oe<ge)}function ye(){if(ie!==null){var Pe=i.unstable_now();Oe=Pe;var We=!0;try{We=ie(!0,Pe)}finally{We?Ae():(Z=!1,ie=null)}}else Z=!1}var Ae;if(typeof Y=="function")Ae=function(){Y(ye)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,ke=be.port2;be.port1.onmessage=ye,Ae=function(){ke.postMessage(null)}}else Ae=function(){M(ye,0)};function Me(Pe){ie=Pe,Z||(Z=!0,Ae())}function Ue(Pe,We){de=M(function(){Pe(i.unstable_now())},We)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Pe){Pe.callback=null},i.unstable_continueExecution=function(){W||j||(W=!0,Me(z))},i.unstable_forceFrameRate=function(Pe){0>Pe||125<Pe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<Pe?Math.floor(1e3/Pe):5},i.unstable_getCurrentPriorityLevel=function(){return P},i.unstable_getFirstCallbackNode=function(){return o(T)},i.unstable_next=function(Pe){switch(P){case 1:case 2:case 3:var We=3;break;default:We=P}var He=P;P=We;try{return Pe()}finally{P=He}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Pe,We){switch(Pe){case 1:case 2:case 3:case 4:case 5:break;default:Pe=3}var He=P;P=Pe;try{return We()}finally{P=He}},i.unstable_scheduleCallback=function(Pe,We,He){var fe=i.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?fe+He:fe):He=fe,Pe){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=He+Ce,Pe={id:I++,callback:We,priorityLevel:Pe,startTime:He,expirationTime:Ce,sortIndex:-1},He>fe?(Pe.sortIndex=He,n(w,Pe),o(T)===null&&Pe===o(w)&&(F?(X(de),de=-1):F=!0,Ue(re,He-fe))):(Pe.sortIndex=Ce,n(T,Pe),W||j||(W=!0,Me(z))),Pe},i.unstable_shouldYield=me,i.unstable_wrapCallback=function(Pe){var We=P;return function(){var He=P;P=We;try{return Pe.apply(this,arguments)}finally{P=He}}}}(aD)),aD}var Z8;function nde(){return Z8||(Z8=1,iD.exports=rde()),iD.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eH;function ide(){if(eH)return io;eH=1;var i=GM(),n=nde();function o(h){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+h,S=1;S<arguments.length;S++)m+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,u={};function f(h,m){_(h,m),_(h+"Capture",m)}function _(h,m){for(u[h]=m,h=0;h<m.length;h++)s.add(m[h])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),T=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I={},A={};function P(h){return T.call(A,h)?!0:T.call(I,h)?!1:w.test(h)?A[h]=!0:(I[h]=!0,!1)}function j(h,m,S,C){if(S!==null&&S.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return C?!1:S!==null?!S.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function W(h,m,S,C){if(m===null||typeof m>"u"||j(h,m,S,C))return!0;if(C)return!1;if(S!==null)switch(S.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function F(h,m,S,C,x,B,ee){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=C,this.attributeNamespace=x,this.mustUseProperty=S,this.propertyName=h,this.type=m,this.sanitizeURL=B,this.removeEmptyString=ee}var M={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){M[h]=new F(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var m=h[0];M[m]=new F(m,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){M[h]=new F(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){M[h]=new F(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){M[h]=new F(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){M[h]=new F(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){M[h]=new F(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){M[h]=new F(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){M[h]=new F(h,5,!1,h.toLowerCase(),null,!1,!1)});var X=/[\-:]([a-z])/g;function Y(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var m=h.replace(X,Y);M[m]=new F(m,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var m=h.replace(X,Y);M[m]=new F(m,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var m=h.replace(X,Y);M[m]=new F(m,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){M[h]=new F(h,1,!1,h.toLowerCase(),null,!1,!1)}),M.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){M[h]=new F(h,1,!1,h.toLowerCase(),null,!0,!0)});function J(h,m,S,C){var x=M.hasOwnProperty(m)?M[m]:null;(x!==null?x.type!==0:C||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(W(m,S,x,C)&&(S=null),C||x===null?P(m)&&(S===null?h.removeAttribute(m):h.setAttribute(m,""+S)):x.mustUseProperty?h[x.propertyName]=S===null?x.type===3?!1:"":S:(m=x.attributeName,C=x.attributeNamespace,S===null?h.removeAttribute(m):(x=x.type,S=x===3||x===4&&S===!0?"":""+S,C?h.setAttributeNS(C,m,S):h.setAttribute(m,S))))}var re=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,z=Symbol.for("react.element"),Z=Symbol.for("react.portal"),ie=Symbol.for("react.fragment"),de=Symbol.for("react.strict_mode"),ge=Symbol.for("react.profiler"),Oe=Symbol.for("react.provider"),me=Symbol.for("react.context"),ye=Symbol.for("react.forward_ref"),Ae=Symbol.for("react.suspense"),be=Symbol.for("react.suspense_list"),ke=Symbol.for("react.memo"),Me=Symbol.for("react.lazy"),Ue=Symbol.for("react.offscreen"),Pe=Symbol.iterator;function We(h){return h===null||typeof h!="object"?null:(h=Pe&&h[Pe]||h["@@iterator"],typeof h=="function"?h:null)}var He=Object.assign,fe;function Ce(h){if(fe===void 0)try{throw Error()}catch(S){var m=S.stack.trim().match(/\n( *(at )?)/);fe=m&&m[1]||""}return`
`+fe+h}var ot=!1;function _t(h,m){if(!h||ot)return"";ot=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(je){var C=je}Reflect.construct(h,[],m)}else{try{m.call()}catch(je){C=je}h.call(m.prototype)}else{try{throw Error()}catch(je){C=je}h()}}catch(je){if(je&&C&&typeof je.stack=="string"){for(var x=je.stack.split(`
`),B=C.stack.split(`
`),ee=x.length-1,le=B.length-1;1<=ee&&0<=le&&x[ee]!==B[le];)le--;for(;1<=ee&&0<=le;ee--,le--)if(x[ee]!==B[le]){if(ee!==1||le!==1)do if(ee--,le--,0>le||x[ee]!==B[le]){var ve=`
`+x[ee].replace(" at new "," at ");return h.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",h.displayName)),ve}while(1<=ee&&0<=le);break}}}finally{ot=!1,Error.prepareStackTrace=S}return(h=h?h.displayName||h.name:"")?Ce(h):""}function Lt(h){switch(h.tag){case 5:return Ce(h.type);case 16:return Ce("Lazy");case 13:return Ce("Suspense");case 19:return Ce("SuspenseList");case 0:case 2:case 15:return h=_t(h.type,!1),h;case 11:return h=_t(h.type.render,!1),h;case 1:return h=_t(h.type,!0),h;default:return""}}function Yt(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case ie:return"Fragment";case Z:return"Portal";case ge:return"Profiler";case de:return"StrictMode";case Ae:return"Suspense";case be:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case me:return(h.displayName||"Context")+".Consumer";case Oe:return(h._context.displayName||"Context")+".Provider";case ye:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case ke:return m=h.displayName||null,m!==null?m:Yt(h.type)||"Memo";case Me:m=h._payload,h=h._init;try{return Yt(h(m))}catch{}}return null}function br(h){var m=h.type;switch(h.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=m.render,h=h.displayName||h.name||"",m.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Yt(m);case 8:return m===de?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Qt(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function nt(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function It(h){var m=nt(h)?"checked":"value",S=Object.getOwnPropertyDescriptor(h.constructor.prototype,m),C=""+h[m];if(!h.hasOwnProperty(m)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var x=S.get,B=S.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return x.call(this)},set:function(ee){C=""+ee,B.call(this,ee)}}),Object.defineProperty(h,m,{enumerable:S.enumerable}),{getValue:function(){return C},setValue:function(ee){C=""+ee},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function Zt(h){h._valueTracker||(h._valueTracker=It(h))}function rt(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var S=m.getValue(),C="";return h&&(C=nt(h)?h.checked?"true":"false":h.value),h=C,h!==S?(m.setValue(h),!0):!1}function Or(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function vr(h,m){var S=m.checked;return He({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??h._wrapperState.initialChecked})}function Dn(h,m){var S=m.defaultValue==null?"":m.defaultValue,C=m.checked!=null?m.checked:m.defaultChecked;S=Qt(m.value!=null?m.value:S),h._wrapperState={initialChecked:C,initialValue:S,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function qr(h,m){m=m.checked,m!=null&&J(h,"checked",m,!1)}function pi(h,m){qr(h,m);var S=Qt(m.value),C=m.type;if(S!=null)C==="number"?(S===0&&h.value===""||h.value!=S)&&(h.value=""+S):h.value!==""+S&&(h.value=""+S);else if(C==="submit"||C==="reset"){h.removeAttribute("value");return}m.hasOwnProperty("value")?xn(h,m.type,S):m.hasOwnProperty("defaultValue")&&xn(h,m.type,Qt(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(h.defaultChecked=!!m.defaultChecked)}function en(h,m,S){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var C=m.type;if(!(C!=="submit"&&C!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+h._wrapperState.initialValue,S||m===h.value||(h.value=m),h.defaultValue=m}S=h.name,S!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,S!==""&&(h.name=S)}function xn(h,m,S){(m!=="number"||Or(h.ownerDocument)!==h)&&(S==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+S&&(h.defaultValue=""+S))}var ja=Array.isArray;function Ni(h,m,S,C){if(h=h.options,m){m={};for(var x=0;x<S.length;x++)m["$"+S[x]]=!0;for(S=0;S<h.length;S++)x=m.hasOwnProperty("$"+h[S].value),h[S].selected!==x&&(h[S].selected=x),x&&C&&(h[S].defaultSelected=!0)}else{for(S=""+Qt(S),m=null,x=0;x<h.length;x++){if(h[x].value===S){h[x].selected=!0,C&&(h[x].defaultSelected=!0);return}m!==null||h[x].disabled||(m=h[x])}m!==null&&(m.selected=!0)}}function co(h,m){if(m.dangerouslySetInnerHTML!=null)throw Error(o(91));return He({},m,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function ml(h,m){var S=m.value;if(S==null){if(S=m.children,m=m.defaultValue,S!=null){if(m!=null)throw Error(o(92));if(ja(S)){if(1<S.length)throw Error(o(93));S=S[0]}m=S}m==null&&(m=""),S=m}h._wrapperState={initialValue:Qt(S)}}function Fn(h,m){var S=Qt(m.value),C=Qt(m.defaultValue);S!=null&&(S=""+S,S!==h.value&&(h.value=S),m.defaultValue==null&&h.defaultValue!==S&&(h.defaultValue=S)),C!=null&&(h.defaultValue=""+C)}function Eu(h){var m=h.textContent;m===h._wrapperState.initialValue&&m!==""&&m!==null&&(h.value=m)}function __(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lo(h,m){return h==null||h==="http://www.w3.org/1999/xhtml"?__(m):h==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var Yd,Qp=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,S,C,x){MSApp.execUnsafeLocalFunction(function(){return h(m,S,C,x)})}:h}(function(h,m){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=m;else{for(Yd=Yd||document.createElement("div"),Yd.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=Yd.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)h.appendChild(m.firstChild)}});function Su(h,m){if(m){var S=h.firstChild;if(S&&S===h.lastChild&&S.nodeType===3){S.nodeValue=m;return}}h.textContent=m}var bu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qS=["Webkit","ms","Moz","O"];Object.keys(bu).forEach(function(h){qS.forEach(function(m){m=m+h.charAt(0).toUpperCase()+h.substring(1),bu[m]=bu[h]})});function v_(h,m,S){return m==null||typeof m=="boolean"||m===""?"":S||typeof m!="number"||m===0||bu.hasOwnProperty(h)&&bu[h]?(""+m).trim():m+"px"}function lc(h,m){h=h.style;for(var S in m)if(m.hasOwnProperty(S)){var C=S.indexOf("--")===0,x=v_(S,m[S],C);S==="float"&&(S="cssFloat"),C?h.setProperty(S,x):h[S]=x}}var KS=He({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function y_(h,m){if(m){if(KS[h]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(o(137,h));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(o(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(o(61))}if(m.style!=null&&typeof m.style!="object")throw Error(o(62))}}function E_(h,m){if(h.indexOf("-")===-1)return typeof m.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uc=null;function Zp(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var S_=null,Tu=null,wu=null;function zS(h){if(h=vh(h)){if(typeof S_!="function")throw Error(o(280));var m=h.stateNode;m&&(m=bf(m),S_(h.stateNode,h.type,m))}}function Ru(h){Tu?wu?wu.push(h):wu=[h]:Tu=h}function $S(){if(Tu){var h=Tu,m=wu;if(wu=Tu=null,zS(h),m)for(h=0;h<m.length;h++)zS(m[h])}}function gl(h,m){return h(m)}function YS(){}var b_=!1;function XS(h,m,S){if(b_)return h(m,S);b_=!0;try{return gl(h,m,S)}finally{b_=!1,(Tu!==null||wu!==null)&&(YS(),$S())}}function fi(h,m){var S=h.stateNode;if(S===null)return null;var C=bf(S);if(C===null)return null;S=C[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(h=h.type,C=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!C;break e;default:h=!1}if(h)return null;if(S&&typeof S!="function")throw Error(o(231,m,typeof S));return S}var T_=!1;if(E)try{var Xd={};Object.defineProperty(Xd,"passive",{get:function(){T_=!0}}),window.addEventListener("test",Xd,Xd),window.removeEventListener("test",Xd,Xd)}catch{T_=!1}function ef(h,m,S,C,x,B,ee,le,ve){var je=Array.prototype.slice.call(arguments,3);try{m.apply(S,je)}catch(tt){this.onError(tt)}}var Cu=!1,Jd=null,Qd=!1,w_=null,JS={onError:function(h){Cu=!0,Jd=h}};function QS(h,m,S,C,x,B,ee,le,ve){Cu=!1,Jd=null,ef.apply(JS,arguments)}function iA(h,m,S,C,x,B,ee,le,ve){if(QS.apply(this,arguments),Cu){if(Cu){var je=Jd;Cu=!1,Jd=null}else throw Error(o(198));Qd||(Qd=!0,w_=je)}}function _l(h){var m=h,S=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(S=m.return),h=m.return;while(h)}return m.tag===3?S:null}function ZS(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function R_(h){if(_l(h)!==h)throw Error(o(188))}function e0(h){var m=h.alternate;if(!m){if(m=_l(h),m===null)throw Error(o(188));return m!==h?null:h}for(var S=h,C=m;;){var x=S.return;if(x===null)break;var B=x.alternate;if(B===null){if(C=x.return,C!==null){S=C;continue}break}if(x.child===B.child){for(B=x.child;B;){if(B===S)return R_(x),h;if(B===C)return R_(x),m;B=B.sibling}throw Error(o(188))}if(S.return!==C.return)S=x,C=B;else{for(var ee=!1,le=x.child;le;){if(le===S){ee=!0,S=x,C=B;break}if(le===C){ee=!0,C=x,S=B;break}le=le.sibling}if(!ee){for(le=B.child;le;){if(le===S){ee=!0,S=B,C=x;break}if(le===C){ee=!0,C=B,S=x;break}le=le.sibling}if(!ee)throw Error(o(189))}}if(S.alternate!==C)throw Error(o(190))}if(S.tag!==3)throw Error(o(188));return S.stateNode.current===S?h:m}function tf(h){return h=e0(h),h!==null?C_(h):null}function C_(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var m=C_(h);if(m!==null)return m;h=h.sibling}return null}var vl=n.unstable_scheduleCallback,t0=n.unstable_cancelCallback,aA=n.unstable_shouldYield,Uo=n.unstable_requestPaint,Bn=n.unstable_now,oA=n.unstable_getCurrentPriorityLevel,kn=n.unstable_ImmediatePriority,r0=n.unstable_UserBlockingPriority,rf=n.unstable_NormalPriority,sA=n.unstable_LowPriority,n0=n.unstable_IdlePriority,Au=null,jo=null;function i0(h){if(jo&&typeof jo.onCommitFiberRoot=="function")try{jo.onCommitFiberRoot(Au,h,void 0,(h.current.flags&128)===128)}catch{}}var uo=Math.clz32?Math.clz32:Ou,cA=Math.log,lA=Math.LN2;function Ou(h){return h>>>=0,h===0?32:31-(cA(h)/lA|0)|0}var Iu=64,nf=4194304;function Ur(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function af(h,m){var S=h.pendingLanes;if(S===0)return 0;var C=0,x=h.suspendedLanes,B=h.pingedLanes,ee=S&268435455;if(ee!==0){var le=ee&~x;le!==0?C=Ur(le):(B&=ee,B!==0&&(C=Ur(B)))}else ee=S&~x,ee!==0?C=Ur(ee):B!==0&&(C=Ur(B));if(C===0)return 0;if(m!==0&&m!==C&&(m&x)===0&&(x=C&-C,B=m&-m,x>=B||x===16&&(B&4194240)!==0))return m;if((C&4)!==0&&(C|=S&16),m=h.entangledLanes,m!==0)for(h=h.entanglements,m&=C;0<m;)S=31-uo(m),x=1<<S,C|=h[S],m&=~x;return C}function a0(h,m){switch(h){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function o0(h,m){for(var S=h.suspendedLanes,C=h.pingedLanes,x=h.expirationTimes,B=h.pendingLanes;0<B;){var ee=31-uo(B),le=1<<ee,ve=x[ee];ve===-1?((le&S)===0||(le&C)!==0)&&(x[ee]=a0(le,m)):ve<=m&&(h.expiredLanes|=le),B&=~le}}function A_(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function s0(){var h=Iu;return Iu<<=1,(Iu&4194240)===0&&(Iu=64),h}function O_(h){for(var m=[],S=0;31>S;S++)m.push(h);return m}function Zd(h,m,S){h.pendingLanes|=m,m!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,m=31-uo(m),h[m]=S}function uA(h,m){var S=h.pendingLanes&~m;h.pendingLanes=m,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=m,h.mutableReadLanes&=m,h.entangledLanes&=m,m=h.entanglements;var C=h.eventTimes;for(h=h.expirationTimes;0<S;){var x=31-uo(S),B=1<<x;m[x]=0,C[x]=-1,h[x]=-1,S&=~B}}function I_(h,m){var S=h.entangledLanes|=m;for(h=h.entanglements;S;){var C=31-uo(S),x=1<<C;x&m|h[C]&m&&(h[C]|=m),S&=~x}}var jr=0;function N_(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var of,P_,sf,c0,D_,x_=!1,cf=[],dc=null,hc=null,pc=null,eh=new Map,th=new Map,fc=[],l0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function u0(h,m){switch(h){case"focusin":case"focusout":dc=null;break;case"dragenter":case"dragleave":hc=null;break;case"mouseover":case"mouseout":pc=null;break;case"pointerover":case"pointerout":eh.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":th.delete(m.pointerId)}}function rh(h,m,S,C,x,B){return h===null||h.nativeEvent!==B?(h={blockedOn:m,domEventName:S,eventSystemFlags:C,nativeEvent:B,targetContainers:[x]},m!==null&&(m=vh(m),m!==null&&P_(m)),h):(h.eventSystemFlags|=C,m=h.targetContainers,x!==null&&m.indexOf(x)===-1&&m.push(x),h)}function dA(h,m,S,C,x){switch(m){case"focusin":return dc=rh(dc,h,m,S,C,x),!0;case"dragenter":return hc=rh(hc,h,m,S,C,x),!0;case"mouseover":return pc=rh(pc,h,m,S,C,x),!0;case"pointerover":var B=x.pointerId;return eh.set(B,rh(eh.get(B)||null,h,m,S,C,x)),!0;case"gotpointercapture":return B=x.pointerId,th.set(B,rh(th.get(B)||null,h,m,S,C,x)),!0}return!1}function Nu(h){var m=Sl(h.target);if(m!==null){var S=_l(m);if(S!==null){if(m=S.tag,m===13){if(m=ZS(S),m!==null){h.blockedOn=m,D_(h.priority,function(){sf(S)});return}}else if(m===3&&S.stateNode.current.memoizedState.isDehydrated){h.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}h.blockedOn=null}function lf(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var S=k_(h.domEventName,h.eventSystemFlags,m[0],h.nativeEvent);if(S===null){S=h.nativeEvent;var C=new S.constructor(S.type,S);uc=C,S.target.dispatchEvent(C),uc=null}else return m=vh(S),m!==null&&P_(m),h.blockedOn=S,!1;m.shift()}return!0}function d0(h,m,S){lf(h)&&S.delete(m)}function hA(){x_=!1,dc!==null&&lf(dc)&&(dc=null),hc!==null&&lf(hc)&&(hc=null),pc!==null&&lf(pc)&&(pc=null),eh.forEach(d0),th.forEach(d0)}function nh(h,m){h.blockedOn===m&&(h.blockedOn=null,x_||(x_=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,hA)))}function Pu(h){function m(x){return nh(x,h)}if(0<cf.length){nh(cf[0],h);for(var S=1;S<cf.length;S++){var C=cf[S];C.blockedOn===h&&(C.blockedOn=null)}}for(dc!==null&&nh(dc,h),hc!==null&&nh(hc,h),pc!==null&&nh(pc,h),eh.forEach(m),th.forEach(m),S=0;S<fc.length;S++)C=fc[S],C.blockedOn===h&&(C.blockedOn=null);for(;0<fc.length&&(S=fc[0],S.blockedOn===null);)Nu(S),S.blockedOn===null&&fc.shift()}var Du=re.ReactCurrentBatchConfig,uf=!0;function pA(h,m,S,C){var x=jr,B=Du.transition;Du.transition=null;try{jr=1,aa(h,m,S,C)}finally{jr=x,Du.transition=B}}function mc(h,m,S,C){var x=jr,B=Du.transition;Du.transition=null;try{jr=4,aa(h,m,S,C)}finally{jr=x,Du.transition=B}}function aa(h,m,S,C){if(uf){var x=k_(h,m,S,C);if(x===null)ev(h,m,C,ih,S),u0(h,C);else if(dA(x,h,m,S,C))C.stopPropagation();else if(u0(h,C),m&4&&-1<l0.indexOf(h)){for(;x!==null;){var B=vh(x);if(B!==null&&of(B),B=k_(h,m,S,C),B===null&&ev(h,m,C,ih,S),B===x)break;x=B}x!==null&&C.stopPropagation()}else ev(h,m,C,null,S)}}var ih=null;function k_(h,m,S,C){if(ih=null,h=Zp(C),h=Sl(h),h!==null)if(m=_l(h),m===null)h=null;else if(S=m.tag,S===13){if(h=ZS(m),h!==null)return h;h=null}else if(S===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null);return ih=h,null}function h0(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oA()){case kn:return 1;case r0:return 4;case rf:case sA:return 16;case n0:return 536870912;default:return 16}default:return 16}}var gc=null,yi=null,df=null;function p0(){if(df)return df;var h,m=yi,S=m.length,C,x="value"in gc?gc.value:gc.textContent,B=x.length;for(h=0;h<S&&m[h]===x[h];h++);var ee=S-h;for(C=1;C<=ee&&m[S-C]===x[B-C];C++);return df=x.slice(h,1<C?1-C:void 0)}function hf(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function yl(){return!0}function L_(){return!1}function Ea(h){function m(S,C,x,B,ee){this._reactName=S,this._targetInst=x,this.type=C,this.nativeEvent=B,this.target=ee,this.currentTarget=null;for(var le in h)h.hasOwnProperty(le)&&(S=h[le],this[le]=S?S(B):B[le]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?yl:L_,this.isPropagationStopped=L_,this}return He(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=yl)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=yl)},persist:function(){},isPersistent:yl}),m}var _c={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},M_=Ea(_c),El=He({},_c,{view:0,detail:0}),U_=Ea(El),ah,j_,oh,Vo=He({},El,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:F_,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==oh&&(oh&&h.type==="mousemove"?(ah=h.screenX-oh.screenX,j_=h.screenY-oh.screenY):j_=ah=0,oh=h),ah)},movementY:function(h){return"movementY"in h?h.movementY:j_}}),xu=Ea(Vo),fA=He({},Vo,{dataTransfer:0}),mA=Ea(fA),gA=He({},El,{relatedTarget:0}),V_=Ea(gA),_A=He({},_c,{animationName:0,elapsedTime:0,pseudoElement:0}),ku=Ea(_A),vA=He({},_c,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Lu=Ea(vA),f0=He({},_c,{data:0}),m0=Ea(f0),er={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},EA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function SA(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=EA[h])?!!m[h]:!1}function F_(){return SA}var B_=He({},El,{key:function(h){if(h.key){var m=er[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=hf(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?yA[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:F_,charCode:function(h){return h.type==="keypress"?hf(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?hf(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),bA=Ea(B_),TA=He({},Vo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g0=Ea(TA),W_=He({},El,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:F_}),wA=Ea(W_),RA=He({},_c,{propertyName:0,elapsedTime:0,pseudoElement:0}),_0=Ea(RA),CA=He({},Vo,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),vc=Ea(CA),AA=[9,13,27,32],G_=E&&"CompositionEvent"in window,sh=null;E&&"documentMode"in document&&(sh=document.documentMode);var v0=E&&"TextEvent"in window&&!sh,pf=E&&(!G_||sh&&8<sh&&11>=sh),y0=" ",E0=!1;function S0(h,m){switch(h){case"keyup":return AA.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sa(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var Mu=!1;function OA(h,m){switch(h){case"compositionend":return Sa(m);case"keypress":return m.which!==32?null:(E0=!0,y0);case"textInput":return h=m.data,h===y0&&E0?null:h;default:return null}}function IA(h,m){if(Mu)return h==="compositionend"||!G_&&S0(h,m)?(h=p0(),df=yi=gc=null,Mu=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return pf&&m.locale!=="ko"?null:m.data;default:return null}}var NA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function H_(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!NA[h.type]:m==="textarea"}function b0(h,m,S,C){Ru(C),m=fh(m,"onChange"),0<m.length&&(S=new M_("onChange","change",null,S,C),h.push({event:S,listeners:m}))}var ch=null,Uu=null;function q_(h){x0(h,0)}function ff(h){var m=Hu(h);if(rt(m))return h}function PA(h,m){if(h==="change")return m}var lh=!1;if(E){var K_;if(E){var z_="oninput"in document;if(!z_){var T0=document.createElement("div");T0.setAttribute("oninput","return;"),z_=typeof T0.oninput=="function"}K_=z_}else K_=!1;lh=K_&&(!document.documentMode||9<document.documentMode)}function bs(){ch&&(ch.detachEvent("onpropertychange",w0),Uu=ch=null)}function w0(h){if(h.propertyName==="value"&&ff(Uu)){var m=[];b0(m,Uu,h,Zp(h)),XS(q_,m)}}function DA(h,m,S){h==="focusin"?(bs(),ch=m,Uu=S,ch.attachEvent("onpropertychange",w0)):h==="focusout"&&bs()}function oa(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return ff(Uu)}function xA(h,m){if(h==="click")return ff(m)}function kA(h,m){if(h==="input"||h==="change")return ff(m)}function LA(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var ho=typeof Object.is=="function"?Object.is:LA;function ju(h,m){if(ho(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var S=Object.keys(h),C=Object.keys(m);if(S.length!==C.length)return!1;for(C=0;C<S.length;C++){var x=S[C];if(!T.call(m,x)||!ho(h[x],m[x]))return!1}return!0}function R0(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function C0(h,m){var S=R0(h);h=0;for(var C;S;){if(S.nodeType===3){if(C=h+S.textContent.length,h<=m&&C>=m)return{node:S,offset:m-h};h=C}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=R0(S)}}function A0(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?A0(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function $_(){for(var h=window,m=Or();m instanceof h.HTMLIFrameElement;){try{var S=typeof m.contentWindow.location.href=="string"}catch{S=!1}if(S)h=m.contentWindow;else break;m=Or(h.document)}return m}function Y_(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}function MA(h){var m=$_(),S=h.focusedElem,C=h.selectionRange;if(m!==S&&S&&S.ownerDocument&&A0(S.ownerDocument.documentElement,S)){if(C!==null&&Y_(S)){if(m=C.start,h=C.end,h===void 0&&(h=m),"selectionStart"in S)S.selectionStart=m,S.selectionEnd=Math.min(h,S.value.length);else if(h=(m=S.ownerDocument||document)&&m.defaultView||window,h.getSelection){h=h.getSelection();var x=S.textContent.length,B=Math.min(C.start,x);C=C.end===void 0?B:Math.min(C.end,x),!h.extend&&B>C&&(x=C,C=B,B=x),x=C0(S,B);var ee=C0(S,C);x&&ee&&(h.rangeCount!==1||h.anchorNode!==x.node||h.anchorOffset!==x.offset||h.focusNode!==ee.node||h.focusOffset!==ee.offset)&&(m=m.createRange(),m.setStart(x.node,x.offset),h.removeAllRanges(),B>C?(h.addRange(m),h.extend(ee.node,ee.offset)):(m.setEnd(ee.node,ee.offset),h.addRange(m)))}}for(m=[],h=S;h=h.parentNode;)h.nodeType===1&&m.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<m.length;S++)h=m[S],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var X_=E&&"documentMode"in document&&11>=document.documentMode,yc=null,J_=null,Ve=null,Q_=!1;function O0(h,m,S){var C=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;Q_||yc==null||yc!==Or(C)||(C=yc,"selectionStart"in C&&Y_(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),Ve&&ju(Ve,C)||(Ve=C,C=fh(J_,"onSelect"),0<C.length&&(m=new M_("onSelect","select",null,m,S),h.push({event:m,listeners:C}),m.target=yc)))}function mf(h,m){var S={};return S[h.toLowerCase()]=m.toLowerCase(),S["Webkit"+h]="webkit"+m,S["Moz"+h]="moz"+m,S}var Vu={animationend:mf("Animation","AnimationEnd"),animationiteration:mf("Animation","AnimationIteration"),animationstart:mf("Animation","AnimationStart"),transitionend:mf("Transition","TransitionEnd")},gf={},Z_={};E&&(Z_=document.createElement("div").style,"AnimationEvent"in window||(delete Vu.animationend.animation,delete Vu.animationiteration.animation,delete Vu.animationstart.animation),"TransitionEvent"in window||delete Vu.transitionend.transition);function _f(h){if(gf[h])return gf[h];if(!Vu[h])return h;var m=Vu[h],S;for(S in m)if(m.hasOwnProperty(S)&&S in Z_)return gf[h]=m[S];return h}var I0=_f("animationend"),N0=_f("animationiteration"),uh=_f("animationstart"),Fu=_f("transitionend"),P0=new Map,D0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function po(h,m){P0.set(h,m),f(m,[h])}for(var dh=0;dh<D0.length;dh++){var Bu=D0[dh],UA=Bu.toLowerCase(),jA=Bu[0].toUpperCase()+Bu.slice(1);po(UA,"on"+jA)}po(I0,"onAnimationEnd"),po(N0,"onAnimationIteration"),po(uh,"onAnimationStart"),po("dblclick","onDoubleClick"),po("focusin","onFocus"),po("focusout","onBlur"),po(Fu,"onTransitionEnd"),_("onMouseEnter",["mouseout","mouseover"]),_("onMouseLeave",["mouseout","mouseover"]),_("onPointerEnter",["pointerout","pointerover"]),_("onPointerLeave",["pointerout","pointerover"]),f("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),f("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),f("onBeforeInput",["compositionend","keypress","textInput","paste"]),f("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VA=new Set("cancel close invalid load scroll toggle".split(" ").concat(hh));function vf(h,m,S){var C=h.type||"unknown-event";h.currentTarget=S,iA(C,m,void 0,h),h.currentTarget=null}function x0(h,m){m=(m&4)!==0;for(var S=0;S<h.length;S++){var C=h[S],x=C.event;C=C.listeners;e:{var B=void 0;if(m)for(var ee=C.length-1;0<=ee;ee--){var le=C[ee],ve=le.instance,je=le.currentTarget;if(le=le.listener,ve!==B&&x.isPropagationStopped())break e;vf(x,le,je),B=ve}else for(ee=0;ee<C.length;ee++){if(le=C[ee],ve=le.instance,je=le.currentTarget,le=le.listener,ve!==B&&x.isPropagationStopped())break e;vf(x,le,je),B=ve}}}if(Qd)throw h=w_,Qd=!1,w_=null,h}function cn(h,m){var S=m[iv];S===void 0&&(S=m[iv]=new Set);var C=h+"__bubble";S.has(C)||(k0(m,h,2,!1),S.add(C))}function sa(h,m,S){var C=0;m&&(C|=4),k0(S,h,C,m)}var yf="_reactListening"+Math.random().toString(36).slice(2);function Ts(h){if(!h[yf]){h[yf]=!0,s.forEach(function(S){S!=="selectionchange"&&(VA.has(S)||sa(S,!1,h),sa(S,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[yf]||(m[yf]=!0,sa("selectionchange",!1,m))}}function k0(h,m,S,C){switch(h0(m)){case 1:var x=pA;break;case 4:x=mc;break;default:x=aa}S=x.bind(null,m,S,h),x=void 0,!T_||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(x=!0),C?x!==void 0?h.addEventListener(m,S,{capture:!0,passive:x}):h.addEventListener(m,S,!0):x!==void 0?h.addEventListener(m,S,{passive:x}):h.addEventListener(m,S,!1)}function ev(h,m,S,C,x){var B=C;if((m&1)===0&&(m&2)===0&&C!==null)e:for(;;){if(C===null)return;var ee=C.tag;if(ee===3||ee===4){var le=C.stateNode.containerInfo;if(le===x||le.nodeType===8&&le.parentNode===x)break;if(ee===4)for(ee=C.return;ee!==null;){var ve=ee.tag;if((ve===3||ve===4)&&(ve=ee.stateNode.containerInfo,ve===x||ve.nodeType===8&&ve.parentNode===x))return;ee=ee.return}for(;le!==null;){if(ee=Sl(le),ee===null)return;if(ve=ee.tag,ve===5||ve===6){C=B=ee;continue e}le=le.parentNode}}C=C.return}XS(function(){var je=B,tt=Zp(S),it=[];e:{var et=P0.get(h);if(et!==void 0){var vt=M_,Tt=h;switch(h){case"keypress":if(hf(S)===0)break e;case"keydown":case"keyup":vt=bA;break;case"focusin":Tt="focus",vt=V_;break;case"focusout":Tt="blur",vt=V_;break;case"beforeblur":case"afterblur":vt=V_;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":vt=xu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":vt=mA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":vt=wA;break;case I0:case N0:case uh:vt=ku;break;case Fu:vt=_0;break;case"scroll":vt=U_;break;case"wheel":vt=vc;break;case"copy":case"cut":case"paste":vt=Lu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":vt=g0}var Ct=(m&4)!==0,An=!Ct&&h==="scroll",Ne=Ct?et!==null?et+"Capture":null:et;Ct=[];for(var Se=je,xe;Se!==null;){xe=Se;var st=xe.stateNode;if(xe.tag===5&&st!==null&&(xe=st,Ne!==null&&(st=fi(Se,Ne),st!=null&&Ct.push(ph(Se,st,xe)))),An)break;Se=Se.return}0<Ct.length&&(et=new vt(et,Tt,null,S,tt),it.push({event:et,listeners:Ct}))}}if((m&7)===0){e:{if(et=h==="mouseover"||h==="pointerover",vt=h==="mouseout"||h==="pointerout",et&&S!==uc&&(Tt=S.relatedTarget||S.fromElement)&&(Sl(Tt)||Tt[ws]))break e;if((vt||et)&&(et=tt.window===tt?tt:(et=tt.ownerDocument)?et.defaultView||et.parentWindow:window,vt?(Tt=S.relatedTarget||S.toElement,vt=je,Tt=Tt?Sl(Tt):null,Tt!==null&&(An=_l(Tt),Tt!==An||Tt.tag!==5&&Tt.tag!==6)&&(Tt=null)):(vt=null,Tt=je),vt!==Tt)){if(Ct=xu,st="onMouseLeave",Ne="onMouseEnter",Se="mouse",(h==="pointerout"||h==="pointerover")&&(Ct=g0,st="onPointerLeave",Ne="onPointerEnter",Se="pointer"),An=vt==null?et:Hu(vt),xe=Tt==null?et:Hu(Tt),et=new Ct(st,Se+"leave",vt,S,tt),et.target=An,et.relatedTarget=xe,st=null,Sl(tt)===je&&(Ct=new Ct(Ne,Se+"enter",Tt,S,tt),Ct.target=xe,Ct.relatedTarget=An,st=Ct),An=st,vt&&Tt)t:{for(Ct=vt,Ne=Tt,Se=0,xe=Ct;xe;xe=Wu(xe))Se++;for(xe=0,st=Ne;st;st=Wu(st))xe++;for(;0<Se-xe;)Ct=Wu(Ct),Se--;for(;0<xe-Se;)Ne=Wu(Ne),xe--;for(;Se--;){if(Ct===Ne||Ne!==null&&Ct===Ne.alternate)break t;Ct=Wu(Ct),Ne=Wu(Ne)}Ct=null}else Ct=null;vt!==null&&L0(it,et,vt,Ct,!1),Tt!==null&&An!==null&&L0(it,An,Tt,Ct,!0)}}e:{if(et=je?Hu(je):window,vt=et.nodeName&&et.nodeName.toLowerCase(),vt==="select"||vt==="input"&&et.type==="file")var Ot=PA;else if(H_(et))if(lh)Ot=kA;else{Ot=oa;var Mt=DA}else(vt=et.nodeName)&&vt.toLowerCase()==="input"&&(et.type==="checkbox"||et.type==="radio")&&(Ot=xA);if(Ot&&(Ot=Ot(h,je))){b0(it,Ot,S,tt);break e}Mt&&Mt(h,et,je),h==="focusout"&&(Mt=et._wrapperState)&&Mt.controlled&&et.type==="number"&&xn(et,"number",et.value)}switch(Mt=je?Hu(je):window,h){case"focusin":(H_(Mt)||Mt.contentEditable==="true")&&(yc=Mt,J_=je,Ve=null);break;case"focusout":Ve=J_=yc=null;break;case"mousedown":Q_=!0;break;case"contextmenu":case"mouseup":case"dragend":Q_=!1,O0(it,S,tt);break;case"selectionchange":if(X_)break;case"keydown":case"keyup":O0(it,S,tt)}var Ut;if(G_)e:{switch(h){case"compositionstart":var Wt="onCompositionStart";break e;case"compositionend":Wt="onCompositionEnd";break e;case"compositionupdate":Wt="onCompositionUpdate";break e}Wt=void 0}else Mu?S0(h,S)&&(Wt="onCompositionEnd"):h==="keydown"&&S.keyCode===229&&(Wt="onCompositionStart");Wt&&(pf&&S.locale!=="ko"&&(Mu||Wt!=="onCompositionStart"?Wt==="onCompositionEnd"&&Mu&&(Ut=p0()):(gc=tt,yi="value"in gc?gc.value:gc.textContent,Mu=!0)),Mt=fh(je,Wt),0<Mt.length&&(Wt=new m0(Wt,h,null,S,tt),it.push({event:Wt,listeners:Mt}),Ut?Wt.data=Ut:(Ut=Sa(S),Ut!==null&&(Wt.data=Ut)))),(Ut=v0?OA(h,S):IA(h,S))&&(je=fh(je,"onBeforeInput"),0<je.length&&(tt=new m0("onBeforeInput","beforeinput",null,S,tt),it.push({event:tt,listeners:je}),tt.data=Ut))}x0(it,m)})}function ph(h,m,S){return{instance:h,listener:m,currentTarget:S}}function fh(h,m){for(var S=m+"Capture",C=[];h!==null;){var x=h,B=x.stateNode;x.tag===5&&B!==null&&(x=B,B=fi(h,S),B!=null&&C.unshift(ph(h,B,x)),B=fi(h,m),B!=null&&C.push(ph(h,B,x))),h=h.return}return C}function Wu(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function L0(h,m,S,C,x){for(var B=m._reactName,ee=[];S!==null&&S!==C;){var le=S,ve=le.alternate,je=le.stateNode;if(ve!==null&&ve===C)break;le.tag===5&&je!==null&&(le=je,x?(ve=fi(S,B),ve!=null&&ee.unshift(ph(S,ve,le))):x||(ve=fi(S,B),ve!=null&&ee.push(ph(S,ve,le)))),S=S.return}ee.length!==0&&h.push({event:m,listeners:ee})}var FA=/\r\n?/g,tv=/\u0000|\uFFFD/g;function M0(h){return(typeof h=="string"?h:""+h).replace(FA,`
`).replace(tv,"")}function mh(h,m,S){if(m=M0(m),M0(h)!==m&&S)throw Error(o(425))}function gh(){}var rv=null,Ef=null;function Gu(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var nv=typeof setTimeout=="function"?setTimeout:void 0,BA=typeof clearTimeout=="function"?clearTimeout:void 0,U0=typeof Promise=="function"?Promise:void 0,WA=typeof queueMicrotask=="function"?queueMicrotask:typeof U0<"u"?function(h){return U0.resolve(null).then(h).catch(GA)}:nv;function GA(h){setTimeout(function(){throw h})}function Sf(h,m){var S=m,C=0;do{var x=S.nextSibling;if(h.removeChild(S),x&&x.nodeType===8)if(S=x.data,S==="/$"){if(C===0){h.removeChild(x),Pu(m);return}C--}else S!=="$"&&S!=="$?"&&S!=="$!"||C++;S=x}while(S);Pu(m)}function Fo(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return h}function j0(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var S=h.data;if(S==="$"||S==="$!"||S==="$?"){if(m===0)return h;m--}else S==="/$"&&m++}h=h.previousSibling}return null}var Ec=Math.random().toString(36).slice(2),Bo="__reactFiber$"+Ec,_h="__reactProps$"+Ec,ws="__reactContainer$"+Ec,iv="__reactEvents$"+Ec,HA="__reactListeners$"+Ec,qA="__reactHandles$"+Ec;function Sl(h){var m=h[Bo];if(m)return m;for(var S=h.parentNode;S;){if(m=S[ws]||S[Bo]){if(S=m.alternate,m.child!==null||S!==null&&S.child!==null)for(h=j0(h);h!==null;){if(S=h[Bo])return S;h=j0(h)}return m}h=S,S=h.parentNode}return null}function vh(h){return h=h[Bo]||h[ws],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function Hu(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(o(33))}function bf(h){return h[_h]||null}var av=[],Rs=-1;function fo(h){return{current:h}}function tn(h){0>Rs||(h.current=av[Rs],av[Rs]=null,Rs--)}function ln(h,m){Rs++,av[Rs]=h.current,h.current=m}var Sc={},Pi=fo(Sc),zi=fo(!1),bc=Sc;function Tc(h,m){var S=h.type.contextTypes;if(!S)return Sc;var C=h.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===m)return C.__reactInternalMemoizedMaskedChildContext;var x={},B;for(B in S)x[B]=m[B];return C&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=m,h.__reactInternalMemoizedMaskedChildContext=x),x}function ca(h){return h=h.childContextTypes,h!=null}function Tf(){tn(zi),tn(Pi)}function qu(h,m,S){if(Pi.current!==Sc)throw Error(o(168));ln(Pi,m),ln(zi,S)}function V0(h,m,S){var C=h.stateNode;if(m=m.childContextTypes,typeof C.getChildContext!="function")return S;C=C.getChildContext();for(var x in C)if(!(x in m))throw Error(o(108,br(h)||"Unknown",x));return He({},S,C)}function wf(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Sc,bc=Pi.current,ln(Pi,h),ln(zi,zi.current),!0}function F0(h,m,S){var C=h.stateNode;if(!C)throw Error(o(169));S?(h=V0(h,m,bc),C.__reactInternalMemoizedMergedChildContext=h,tn(zi),tn(Pi),ln(Pi,h)):tn(zi),ln(zi,S)}var Cs=null,Rf=!1,ov=!1;function sv(h){Cs===null?Cs=[h]:Cs.push(h)}function KA(h){Rf=!0,sv(h)}function wc(){if(!ov&&Cs!==null){ov=!0;var h=0,m=jr;try{var S=Cs;for(jr=1;h<S.length;h++){var C=S[h];do C=C(!0);while(C!==null)}Cs=null,Rf=!1}catch(x){throw Cs!==null&&(Cs=Cs.slice(h+1)),vl(kn,wc),x}finally{jr=m,ov=!1}}return null}var Ku=[],Rc=0,Cf=null,Af=0,$i=[],Va=0,bl=null,As=1,Os="";function Tl(h,m){Ku[Rc++]=Af,Ku[Rc++]=Cf,Cf=h,Af=m}function B0(h,m,S){$i[Va++]=As,$i[Va++]=Os,$i[Va++]=bl,bl=h;var C=As;h=Os;var x=32-uo(C)-1;C&=~(1<<x),S+=1;var B=32-uo(m)+x;if(30<B){var ee=x-x%5;B=(C&(1<<ee)-1).toString(32),C>>=ee,x-=ee,As=1<<32-uo(m)+x|S<<x|C,Os=B+h}else As=1<<B|S<<x|C,Os=h}function zu(h){h.return!==null&&(Tl(h,1),B0(h,1,0))}function Of(h){for(;h===Cf;)Cf=Ku[--Rc],Ku[Rc]=null,Af=Ku[--Rc],Ku[Rc]=null;for(;h===bl;)bl=$i[--Va],$i[Va]=null,Os=$i[--Va],$i[Va]=null,As=$i[--Va],$i[Va]=null}var ba=null,Ta=null,fn=!1,mo=null;function W0(h,m){var S=Ha(5,null,null,0);S.elementType="DELETED",S.stateNode=m,S.return=h,m=h.deletions,m===null?(h.deletions=[S],h.flags|=16):m.push(S)}function G0(h,m){switch(h.tag){case 5:var S=h.type;return m=m.nodeType!==1||S.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(h.stateNode=m,ba=h,Ta=Fo(m.firstChild),!0):!1;case 6:return m=h.pendingProps===""||m.nodeType!==3?null:m,m!==null?(h.stateNode=m,ba=h,Ta=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(S=bl!==null?{id:As,overflow:Os}:null,h.memoizedState={dehydrated:m,treeContext:S,retryLane:1073741824},S=Ha(18,null,null,0),S.stateNode=m,S.return=h,h.child=S,ba=h,Ta=null,!0):!1;default:return!1}}function yh(h){return(h.mode&1)!==0&&(h.flags&128)===0}function Eh(h){if(fn){var m=Ta;if(m){var S=m;if(!G0(h,m)){if(yh(h))throw Error(o(418));m=Fo(S.nextSibling);var C=ba;m&&G0(h,m)?W0(C,S):(h.flags=h.flags&-4097|2,fn=!1,ba=h)}}else{if(yh(h))throw Error(o(418));h.flags=h.flags&-4097|2,fn=!1,ba=h}}}function cv(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;ba=h}function $u(h){if(h!==ba)return!1;if(!fn)return cv(h),fn=!0,!1;var m;if((m=h.tag!==3)&&!(m=h.tag!==5)&&(m=h.type,m=m!=="head"&&m!=="body"&&!Gu(h.type,h.memoizedProps)),m&&(m=Ta)){if(yh(h))throw lv(),Error(o(418));for(;m;)W0(h,m),m=Fo(m.nextSibling)}if(cv(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(o(317));e:{for(h=h.nextSibling,m=0;h;){if(h.nodeType===8){var S=h.data;if(S==="/$"){if(m===0){Ta=Fo(h.nextSibling);break e}m--}else S!=="$"&&S!=="$!"&&S!=="$?"||m++}h=h.nextSibling}Ta=null}}else Ta=ba?Fo(h.stateNode.nextSibling):null;return!0}function lv(){for(var h=Ta;h;)h=Fo(h.nextSibling)}function wl(){Ta=ba=null,fn=!1}function Yu(h){mo===null?mo=[h]:mo.push(h)}var Sh=re.ReactCurrentBatchConfig;function bh(h,m,S){if(h=S.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(o(309));var C=S.stateNode}if(!C)throw Error(o(147,h));var x=C,B=""+h;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===B?m.ref:(m=function(ee){var le=x.refs;ee===null?delete le[B]:le[B]=ee},m._stringRef=B,m)}if(typeof h!="string")throw Error(o(284));if(!S._owner)throw Error(o(290,h))}return h}function If(h,m){throw h=Object.prototype.toString.call(m),Error(o(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h))}function uv(h){var m=h._init;return m(h._payload)}function H0(h){function m(Ne,Se){if(h){var xe=Ne.deletions;xe===null?(Ne.deletions=[Se],Ne.flags|=16):xe.push(Se)}}function S(Ne,Se){if(!h)return null;for(;Se!==null;)m(Ne,Se),Se=Se.sibling;return null}function C(Ne,Se){for(Ne=new Map;Se!==null;)Se.key!==null?Ne.set(Se.key,Se):Ne.set(Se.index,Se),Se=Se.sibling;return Ne}function x(Ne,Se){return Ne=Uc(Ne,Se),Ne.index=0,Ne.sibling=null,Ne}function B(Ne,Se,xe){return Ne.index=xe,h?(xe=Ne.alternate,xe!==null?(xe=xe.index,xe<Se?(Ne.flags|=2,Se):xe):(Ne.flags|=2,Se)):(Ne.flags|=1048576,Se)}function ee(Ne){return h&&Ne.alternate===null&&(Ne.flags|=2),Ne}function le(Ne,Se,xe,st){return Se===null||Se.tag!==6?(Se=am(xe,Ne.mode,st),Se.return=Ne,Se):(Se=x(Se,xe),Se.return=Ne,Se)}function ve(Ne,Se,xe,st){var Ot=xe.type;return Ot===ie?tt(Ne,Se,xe.props.children,st,xe.key):Se!==null&&(Se.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===Me&&uv(Ot)===Se.type)?(st=x(Se,xe.props),st.ref=bh(Ne,Se,xe),st.return=Ne,st):(st=sd(xe.type,xe.key,xe.props,null,Ne.mode,st),st.ref=bh(Ne,Se,xe),st.return=Ne,st)}function je(Ne,Se,xe,st){return Se===null||Se.tag!==4||Se.stateNode.containerInfo!==xe.containerInfo||Se.stateNode.implementation!==xe.implementation?(Se=cd(xe,Ne.mode,st),Se.return=Ne,Se):(Se=x(Se,xe.children||[]),Se.return=Ne,Se)}function tt(Ne,Se,xe,st,Ot){return Se===null||Se.tag!==7?(Se=jc(xe,Ne.mode,st,Ot),Se.return=Ne,Se):(Se=x(Se,xe),Se.return=Ne,Se)}function it(Ne,Se,xe){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return Se=am(""+Se,Ne.mode,xe),Se.return=Ne,Se;if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case z:return xe=sd(Se.type,Se.key,Se.props,null,Ne.mode,xe),xe.ref=bh(Ne,null,Se),xe.return=Ne,xe;case Z:return Se=cd(Se,Ne.mode,xe),Se.return=Ne,Se;case Me:var st=Se._init;return it(Ne,st(Se._payload),xe)}if(ja(Se)||We(Se))return Se=jc(Se,Ne.mode,xe,null),Se.return=Ne,Se;If(Ne,Se)}return null}function et(Ne,Se,xe,st){var Ot=Se!==null?Se.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number")return Ot!==null?null:le(Ne,Se,""+xe,st);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case z:return xe.key===Ot?ve(Ne,Se,xe,st):null;case Z:return xe.key===Ot?je(Ne,Se,xe,st):null;case Me:return Ot=xe._init,et(Ne,Se,Ot(xe._payload),st)}if(ja(xe)||We(xe))return Ot!==null?null:tt(Ne,Se,xe,st,null);If(Ne,xe)}return null}function vt(Ne,Se,xe,st,Ot){if(typeof st=="string"&&st!==""||typeof st=="number")return Ne=Ne.get(xe)||null,le(Se,Ne,""+st,Ot);if(typeof st=="object"&&st!==null){switch(st.$$typeof){case z:return Ne=Ne.get(st.key===null?xe:st.key)||null,ve(Se,Ne,st,Ot);case Z:return Ne=Ne.get(st.key===null?xe:st.key)||null,je(Se,Ne,st,Ot);case Me:var Mt=st._init;return vt(Ne,Se,xe,Mt(st._payload),Ot)}if(ja(st)||We(st))return Ne=Ne.get(xe)||null,tt(Se,Ne,st,Ot,null);If(Se,st)}return null}function Tt(Ne,Se,xe,st){for(var Ot=null,Mt=null,Ut=Se,Wt=Se=0,si=null;Ut!==null&&Wt<xe.length;Wt++){Ut.index>Wt?(si=Ut,Ut=null):si=Ut.sibling;var xr=et(Ne,Ut,xe[Wt],st);if(xr===null){Ut===null&&(Ut=si);break}h&&Ut&&xr.alternate===null&&m(Ne,Ut),Se=B(xr,Se,Wt),Mt===null?Ot=xr:Mt.sibling=xr,Mt=xr,Ut=si}if(Wt===xe.length)return S(Ne,Ut),fn&&Tl(Ne,Wt),Ot;if(Ut===null){for(;Wt<xe.length;Wt++)Ut=it(Ne,xe[Wt],st),Ut!==null&&(Se=B(Ut,Se,Wt),Mt===null?Ot=Ut:Mt.sibling=Ut,Mt=Ut);return fn&&Tl(Ne,Wt),Ot}for(Ut=C(Ne,Ut);Wt<xe.length;Wt++)si=vt(Ut,Ne,Wt,xe[Wt],st),si!==null&&(h&&si.alternate!==null&&Ut.delete(si.key===null?Wt:si.key),Se=B(si,Se,Wt),Mt===null?Ot=si:Mt.sibling=si,Mt=si);return h&&Ut.forEach(function(zo){return m(Ne,zo)}),fn&&Tl(Ne,Wt),Ot}function Ct(Ne,Se,xe,st){var Ot=We(xe);if(typeof Ot!="function")throw Error(o(150));if(xe=Ot.call(xe),xe==null)throw Error(o(151));for(var Mt=Ot=null,Ut=Se,Wt=Se=0,si=null,xr=xe.next();Ut!==null&&!xr.done;Wt++,xr=xe.next()){Ut.index>Wt?(si=Ut,Ut=null):si=Ut.sibling;var zo=et(Ne,Ut,xr.value,st);if(zo===null){Ut===null&&(Ut=si);break}h&&Ut&&zo.alternate===null&&m(Ne,Ut),Se=B(zo,Se,Wt),Mt===null?Ot=zo:Mt.sibling=zo,Mt=zo,Ut=si}if(xr.done)return S(Ne,Ut),fn&&Tl(Ne,Wt),Ot;if(Ut===null){for(;!xr.done;Wt++,xr=xe.next())xr=it(Ne,xr.value,st),xr!==null&&(Se=B(xr,Se,Wt),Mt===null?Ot=xr:Mt.sibling=xr,Mt=xr);return fn&&Tl(Ne,Wt),Ot}for(Ut=C(Ne,Ut);!xr.done;Wt++,xr=xe.next())xr=vt(Ut,Ne,Wt,xr.value,st),xr!==null&&(h&&xr.alternate!==null&&Ut.delete(xr.key===null?Wt:xr.key),Se=B(xr,Se,Wt),Mt===null?Ot=xr:Mt.sibling=xr,Mt=xr);return h&&Ut.forEach(function(lO){return m(Ne,lO)}),fn&&Tl(Ne,Wt),Ot}function An(Ne,Se,xe,st){if(typeof xe=="object"&&xe!==null&&xe.type===ie&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case z:e:{for(var Ot=xe.key,Mt=Se;Mt!==null;){if(Mt.key===Ot){if(Ot=xe.type,Ot===ie){if(Mt.tag===7){S(Ne,Mt.sibling),Se=x(Mt,xe.props.children),Se.return=Ne,Ne=Se;break e}}else if(Mt.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===Me&&uv(Ot)===Mt.type){S(Ne,Mt.sibling),Se=x(Mt,xe.props),Se.ref=bh(Ne,Mt,xe),Se.return=Ne,Ne=Se;break e}S(Ne,Mt);break}else m(Ne,Mt);Mt=Mt.sibling}xe.type===ie?(Se=jc(xe.props.children,Ne.mode,st,xe.key),Se.return=Ne,Ne=Se):(st=sd(xe.type,xe.key,xe.props,null,Ne.mode,st),st.ref=bh(Ne,Se,xe),st.return=Ne,Ne=st)}return ee(Ne);case Z:e:{for(Mt=xe.key;Se!==null;){if(Se.key===Mt)if(Se.tag===4&&Se.stateNode.containerInfo===xe.containerInfo&&Se.stateNode.implementation===xe.implementation){S(Ne,Se.sibling),Se=x(Se,xe.children||[]),Se.return=Ne,Ne=Se;break e}else{S(Ne,Se);break}else m(Ne,Se);Se=Se.sibling}Se=cd(xe,Ne.mode,st),Se.return=Ne,Ne=Se}return ee(Ne);case Me:return Mt=xe._init,An(Ne,Se,Mt(xe._payload),st)}if(ja(xe))return Tt(Ne,Se,xe,st);if(We(xe))return Ct(Ne,Se,xe,st);If(Ne,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"?(xe=""+xe,Se!==null&&Se.tag===6?(S(Ne,Se.sibling),Se=x(Se,xe),Se.return=Ne,Ne=Se):(S(Ne,Se),Se=am(xe,Ne.mode,st),Se.return=Ne,Ne=Se),ee(Ne)):S(Ne,Se)}return An}var Xu=H0(!0),dv=H0(!1),Nf=fo(null),Pf=null,Ju=null,hv=null;function pv(){hv=Ju=Pf=null}function fv(h){var m=Nf.current;tn(Nf),h._currentValue=m}function Df(h,m,S){for(;h!==null;){var C=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,C!==null&&(C.childLanes|=m)):C!==null&&(C.childLanes&m)!==m&&(C.childLanes|=m),h===S)break;h=h.return}}function go(h,m){Pf=h,hv=Ju=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&m)!==0&&(ua=!0),h.firstContext=null)}function Fa(h){var m=h._currentValue;if(hv!==h)if(h={context:h,memoizedValue:m,next:null},Ju===null){if(Pf===null)throw Error(o(308));Ju=h,Pf.dependencies={lanes:0,firstContext:h}}else Ju=Ju.next=h;return m}var Rl=null;function mv(h){Rl===null?Rl=[h]:Rl.push(h)}function gv(h,m,S,C){var x=m.interleaved;return x===null?(S.next=S,mv(m)):(S.next=x.next,x.next=S),m.interleaved=S,Is(h,C)}function Is(h,m){h.lanes|=m;var S=h.alternate;for(S!==null&&(S.lanes|=m),S=h,h=h.return;h!==null;)h.childLanes|=m,S=h.alternate,S!==null&&(S.childLanes|=m),S=h,h=h.return;return S.tag===3?S.stateNode:null}var Ns=!1;function _v(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function q0(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function Ps(h,m){return{eventTime:h,lane:m,tag:0,payload:null,callback:null,next:null}}function _o(h,m,S){var C=h.updateQueue;if(C===null)return null;if(C=C.shared,(mr&2)!==0){var x=C.pending;return x===null?m.next=m:(m.next=x.next,x.next=m),C.pending=m,Is(h,S)}return x=C.interleaved,x===null?(m.next=m,mv(C)):(m.next=x.next,x.next=m),C.interleaved=m,Is(h,S)}function xf(h,m,S){if(m=m.updateQueue,m!==null&&(m=m.shared,(S&4194240)!==0)){var C=m.lanes;C&=h.pendingLanes,S|=C,m.lanes=S,I_(h,S)}}function K0(h,m){var S=h.updateQueue,C=h.alternate;if(C!==null&&(C=C.updateQueue,S===C)){var x=null,B=null;if(S=S.firstBaseUpdate,S!==null){do{var ee={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};B===null?x=B=ee:B=B.next=ee,S=S.next}while(S!==null);B===null?x=B=m:B=B.next=m}else x=B=m;S={baseState:C.baseState,firstBaseUpdate:x,lastBaseUpdate:B,shared:C.shared,effects:C.effects},h.updateQueue=S;return}h=S.lastBaseUpdate,h===null?S.firstBaseUpdate=m:h.next=m,S.lastBaseUpdate=m}function kf(h,m,S,C){var x=h.updateQueue;Ns=!1;var B=x.firstBaseUpdate,ee=x.lastBaseUpdate,le=x.shared.pending;if(le!==null){x.shared.pending=null;var ve=le,je=ve.next;ve.next=null,ee===null?B=je:ee.next=je,ee=ve;var tt=h.alternate;tt!==null&&(tt=tt.updateQueue,le=tt.lastBaseUpdate,le!==ee&&(le===null?tt.firstBaseUpdate=je:le.next=je,tt.lastBaseUpdate=ve))}if(B!==null){var it=x.baseState;ee=0,tt=je=ve=null,le=B;do{var et=le.lane,vt=le.eventTime;if((C&et)===et){tt!==null&&(tt=tt.next={eventTime:vt,lane:0,tag:le.tag,payload:le.payload,callback:le.callback,next:null});e:{var Tt=h,Ct=le;switch(et=m,vt=S,Ct.tag){case 1:if(Tt=Ct.payload,typeof Tt=="function"){it=Tt.call(vt,it,et);break e}it=Tt;break e;case 3:Tt.flags=Tt.flags&-65537|128;case 0:if(Tt=Ct.payload,et=typeof Tt=="function"?Tt.call(vt,it,et):Tt,et==null)break e;it=He({},it,et);break e;case 2:Ns=!0}}le.callback!==null&&le.lane!==0&&(h.flags|=64,et=x.effects,et===null?x.effects=[le]:et.push(le))}else vt={eventTime:vt,lane:et,tag:le.tag,payload:le.payload,callback:le.callback,next:null},tt===null?(je=tt=vt,ve=it):tt=tt.next=vt,ee|=et;if(le=le.next,le===null){if(le=x.shared.pending,le===null)break;et=le,le=et.next,et.next=null,x.lastBaseUpdate=et,x.shared.pending=null}}while(!0);if(tt===null&&(ve=it),x.baseState=ve,x.firstBaseUpdate=je,x.lastBaseUpdate=tt,m=x.shared.interleaved,m!==null){x=m;do ee|=x.lane,x=x.next;while(x!==m)}else B===null&&(x.shared.lanes=0);xl|=ee,h.lanes=ee,h.memoizedState=it}}function z0(h,m,S){if(h=m.effects,m.effects=null,h!==null)for(m=0;m<h.length;m++){var C=h[m],x=C.callback;if(x!==null){if(C.callback=null,C=S,typeof x!="function")throw Error(o(191,x));x.call(C)}}}var Th={},Wo=fo(Th),Cl=fo(Th),wh=fo(Th);function Cc(h){if(h===Th)throw Error(o(174));return h}function vv(h,m){switch(ln(wh,m),ln(Cl,h),ln(Wo,Th),h=m.nodeType,h){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:lo(null,"");break;default:h=h===8?m.parentNode:m,m=h.namespaceURI||null,h=h.tagName,m=lo(m,h)}tn(Wo),ln(Wo,m)}function Al(){tn(Wo),tn(Cl),tn(wh)}function $0(h){Cc(wh.current);var m=Cc(Wo.current),S=lo(m,h.type);m!==S&&(ln(Cl,h),ln(Wo,S))}function yv(h){Cl.current===h&&(tn(Wo),tn(Cl))}var Rn=fo(0);function Lf(h){for(var m=h;m!==null;){if(m.tag===13){var S=m.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Ev=[];function Sv(){for(var h=0;h<Ev.length;h++)Ev[h]._workInProgressVersionPrimary=null;Ev.length=0}var Rh=re.ReactCurrentDispatcher,bv=re.ReactCurrentBatchConfig,Ol=0,En=null,ii=null,Wn=null,Ch=!1,Ds=!1,Ah=0,zA=0;function Di(){throw Error(o(321))}function Tv(h,m){if(m===null)return!1;for(var S=0;S<m.length&&S<h.length;S++)if(!ho(h[S],m[S]))return!1;return!0}function Qu(h,m,S,C,x,B){if(Ol=B,En=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Rh.current=h===null||h.memoizedState===null?YA:nb,h=S(C,x),Ds){B=0;do{if(Ds=!1,Ah=0,25<=B)throw Error(o(301));B+=1,Wn=ii=null,m.updateQueue=null,Rh.current=XA,h=S(C,x)}while(Ds)}if(Rh.current=ed,m=ii!==null&&ii.next!==null,Ol=0,Wn=ii=En=null,Ch=!1,m)throw Error(o(300));return h}function wv(){var h=Ah!==0;return Ah=0,h}function vo(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?En.memoizedState=Wn=h:Wn=Wn.next=h,Wn}function la(){if(ii===null){var h=En.alternate;h=h!==null?h.memoizedState:null}else h=ii.next;var m=Wn===null?En.memoizedState:Wn.next;if(m!==null)Wn=m,ii=h;else{if(h===null)throw Error(o(310));ii=h,h={memoizedState:ii.memoizedState,baseState:ii.baseState,baseQueue:ii.baseQueue,queue:ii.queue,next:null},Wn===null?En.memoizedState=Wn=h:Wn=Wn.next=h}return Wn}function Il(h,m){return typeof m=="function"?m(h):m}function Rv(h){var m=la(),S=m.queue;if(S===null)throw Error(o(311));S.lastRenderedReducer=h;var C=ii,x=C.baseQueue,B=S.pending;if(B!==null){if(x!==null){var ee=x.next;x.next=B.next,B.next=ee}C.baseQueue=x=B,S.pending=null}if(x!==null){B=x.next,C=C.baseState;var le=ee=null,ve=null,je=B;do{var tt=je.lane;if((Ol&tt)===tt)ve!==null&&(ve=ve.next={lane:0,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null}),C=je.hasEagerState?je.eagerState:h(C,je.action);else{var it={lane:tt,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null};ve===null?(le=ve=it,ee=C):ve=ve.next=it,En.lanes|=tt,xl|=tt}je=je.next}while(je!==null&&je!==B);ve===null?ee=C:ve.next=le,ho(C,m.memoizedState)||(ua=!0),m.memoizedState=C,m.baseState=ee,m.baseQueue=ve,S.lastRenderedState=C}if(h=S.interleaved,h!==null){x=h;do B=x.lane,En.lanes|=B,xl|=B,x=x.next;while(x!==h)}else x===null&&(S.lanes=0);return[m.memoizedState,S.dispatch]}function Cv(h){var m=la(),S=m.queue;if(S===null)throw Error(o(311));S.lastRenderedReducer=h;var C=S.dispatch,x=S.pending,B=m.memoizedState;if(x!==null){S.pending=null;var ee=x=x.next;do B=h(B,ee.action),ee=ee.next;while(ee!==x);ho(B,m.memoizedState)||(ua=!0),m.memoizedState=B,m.baseQueue===null&&(m.baseState=B),S.lastRenderedState=B}return[B,C]}function Y0(){}function X0(h,m){var S=En,C=la(),x=m(),B=!ho(C.memoizedState,x);if(B&&(C.memoizedState=x,ua=!0),C=C.queue,jf(Q0.bind(null,S,C,h),[h]),C.getSnapshot!==m||B||Wn!==null&&Wn.memoizedState.tag&1){if(S.flags|=2048,xs(9,Oh.bind(null,S,C,x,m),void 0,null),ai===null)throw Error(o(349));(Ol&30)!==0||J0(S,m,x)}return x}function J0(h,m,S){h.flags|=16384,h={getSnapshot:m,value:S},m=En.updateQueue,m===null?(m={lastEffect:null,stores:null},En.updateQueue=m,m.stores=[h]):(S=m.stores,S===null?m.stores=[h]:S.push(h))}function Oh(h,m,S,C){m.value=S,m.getSnapshot=C,Nl(m)&&Mf(h)}function Q0(h,m,S){return S(function(){Nl(m)&&Mf(h)})}function Nl(h){var m=h.getSnapshot;h=h.value;try{var S=m();return!ho(h,S)}catch{return!0}}function Mf(h){var m=Is(h,1);m!==null&&Ca(m,h,1,-1)}function Ih(h){var m=vo();return typeof h=="function"&&(h=h()),m.memoizedState=m.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:h},m.queue=h,h=h.dispatch=Pl.bind(null,En,h),[m.memoizedState,h]}function xs(h,m,S,C){return h={tag:h,create:m,destroy:S,deps:C,next:null},m=En.updateQueue,m===null?(m={lastEffect:null,stores:null},En.updateQueue=m,m.lastEffect=h.next=h):(S=m.lastEffect,S===null?m.lastEffect=h.next=h:(C=S.next,S.next=h,h.next=C,m.lastEffect=h)),h}function Nh(){return la().memoizedState}function Uf(h,m,S,C){var x=vo();En.flags|=h,x.memoizedState=xs(1|m,S,void 0,C===void 0?null:C)}function Ph(h,m,S,C){var x=la();C=C===void 0?null:C;var B=void 0;if(ii!==null){var ee=ii.memoizedState;if(B=ee.destroy,C!==null&&Tv(C,ee.deps)){x.memoizedState=xs(m,S,B,C);return}}En.flags|=h,x.memoizedState=xs(1|m,S,B,C)}function Z0(h,m){return Uf(8390656,8,h,m)}function jf(h,m){return Ph(2048,8,h,m)}function eb(h,m){return Ph(4,2,h,m)}function tb(h,m){return Ph(4,4,h,m)}function Vf(h,m){if(typeof m=="function")return h=h(),m(h),function(){m(null)};if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function Ff(h,m,S){return S=S!=null?S.concat([h]):null,Ph(4,4,Vf.bind(null,m,h),S)}function Av(){}function rb(h,m){var S=la();m=m===void 0?null:m;var C=S.memoizedState;return C!==null&&m!==null&&Tv(m,C[1])?C[0]:(S.memoizedState=[h,m],h)}function Ov(h,m){var S=la();m=m===void 0?null:m;var C=S.memoizedState;return C!==null&&m!==null&&Tv(m,C[1])?C[0]:(h=h(),S.memoizedState=[h,m],h)}function Bf(h,m,S){return(Ol&21)===0?(h.baseState&&(h.baseState=!1,ua=!0),h.memoizedState=S):(ho(S,m)||(S=s0(),En.lanes|=S,xl|=S,h.baseState=!0),m)}function $A(h,m){var S=jr;jr=S!==0&&4>S?S:4,h(!0);var C=bv.transition;bv.transition={};try{h(!1),m()}finally{jr=S,bv.transition=C}}function yo(){return la().memoizedState}function Zu(h,m,S){var C=xc(h);if(S={lane:C,action:S,hasEagerState:!1,eagerState:null,next:null},Iv(h))Nv(m,S);else if(S=gv(h,m,S,C),S!==null){var x=Xi();Ca(S,h,C,x),Ac(S,m,C)}}function Pl(h,m,S){var C=xc(h),x={lane:C,action:S,hasEagerState:!1,eagerState:null,next:null};if(Iv(h))Nv(m,x);else{var B=h.alternate;if(h.lanes===0&&(B===null||B.lanes===0)&&(B=m.lastRenderedReducer,B!==null))try{var ee=m.lastRenderedState,le=B(ee,S);if(x.hasEagerState=!0,x.eagerState=le,ho(le,ee)){var ve=m.interleaved;ve===null?(x.next=x,mv(m)):(x.next=ve.next,ve.next=x),m.interleaved=x;return}}catch{}finally{}S=gv(h,m,x,C),S!==null&&(x=Xi(),Ca(S,h,C,x),Ac(S,m,C))}}function Iv(h){var m=h.alternate;return h===En||m!==null&&m===En}function Nv(h,m){Ds=Ch=!0;var S=h.pending;S===null?m.next=m:(m.next=S.next,S.next=m),h.pending=m}function Ac(h,m,S){if((S&4194240)!==0){var C=m.lanes;C&=h.pendingLanes,S|=C,m.lanes=S,I_(h,S)}}var ed={readContext:Fa,useCallback:Di,useContext:Di,useEffect:Di,useImperativeHandle:Di,useInsertionEffect:Di,useLayoutEffect:Di,useMemo:Di,useReducer:Di,useRef:Di,useState:Di,useDebugValue:Di,useDeferredValue:Di,useTransition:Di,useMutableSource:Di,useSyncExternalStore:Di,useId:Di,unstable_isNewReconciler:!1},YA={readContext:Fa,useCallback:function(h,m){return vo().memoizedState=[h,m===void 0?null:m],h},useContext:Fa,useEffect:Z0,useImperativeHandle:function(h,m,S){return S=S!=null?S.concat([h]):null,Uf(4194308,4,Vf.bind(null,m,h),S)},useLayoutEffect:function(h,m){return Uf(4194308,4,h,m)},useInsertionEffect:function(h,m){return Uf(4,2,h,m)},useMemo:function(h,m){var S=vo();return m=m===void 0?null:m,h=h(),S.memoizedState=[h,m],h},useReducer:function(h,m,S){var C=vo();return m=S!==void 0?S(m):m,C.memoizedState=C.baseState=m,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:m},C.queue=h,h=h.dispatch=Zu.bind(null,En,h),[C.memoizedState,h]},useRef:function(h){var m=vo();return h={current:h},m.memoizedState=h},useState:Ih,useDebugValue:Av,useDeferredValue:function(h){return vo().memoizedState=h},useTransition:function(){var h=Ih(!1),m=h[0];return h=$A.bind(null,h[1]),vo().memoizedState=h,[m,h]},useMutableSource:function(){},useSyncExternalStore:function(h,m,S){var C=En,x=vo();if(fn){if(S===void 0)throw Error(o(407));S=S()}else{if(S=m(),ai===null)throw Error(o(349));(Ol&30)!==0||J0(C,m,S)}x.memoizedState=S;var B={value:S,getSnapshot:m};return x.queue=B,Z0(Q0.bind(null,C,B,h),[h]),C.flags|=2048,xs(9,Oh.bind(null,C,B,S,m),void 0,null),S},useId:function(){var h=vo(),m=ai.identifierPrefix;if(fn){var S=Os,C=As;S=(C&~(1<<32-uo(C)-1)).toString(32)+S,m=":"+m+"R"+S,S=Ah++,0<S&&(m+="H"+S.toString(32)),m+=":"}else S=zA++,m=":"+m+"r"+S.toString(32)+":";return h.memoizedState=m},unstable_isNewReconciler:!1},nb={readContext:Fa,useCallback:rb,useContext:Fa,useEffect:jf,useImperativeHandle:Ff,useInsertionEffect:eb,useLayoutEffect:tb,useMemo:Ov,useReducer:Rv,useRef:Nh,useState:function(){return Rv(Il)},useDebugValue:Av,useDeferredValue:function(h){var m=la();return Bf(m,ii.memoizedState,h)},useTransition:function(){var h=Rv(Il)[0],m=la().memoizedState;return[h,m]},useMutableSource:Y0,useSyncExternalStore:X0,useId:yo,unstable_isNewReconciler:!1},XA={readContext:Fa,useCallback:rb,useContext:Fa,useEffect:jf,useImperativeHandle:Ff,useInsertionEffect:eb,useLayoutEffect:tb,useMemo:Ov,useReducer:Cv,useRef:Nh,useState:function(){return Cv(Il)},useDebugValue:Av,useDeferredValue:function(h){var m=la();return ii===null?m.memoizedState=h:Bf(m,ii.memoizedState,h)},useTransition:function(){var h=Cv(Il)[0],m=la().memoizedState;return[h,m]},useMutableSource:Y0,useSyncExternalStore:X0,useId:yo,unstable_isNewReconciler:!1};function Ba(h,m){if(h&&h.defaultProps){m=He({},m),h=h.defaultProps;for(var S in h)m[S]===void 0&&(m[S]=h[S]);return m}return m}function Wf(h,m,S,C){m=h.memoizedState,S=S(C,m),S=S==null?m:He({},m,S),h.memoizedState=S,h.lanes===0&&(h.updateQueue.baseState=S)}var Gf={isMounted:function(h){return(h=h._reactInternals)?_l(h)===h:!1},enqueueSetState:function(h,m,S){h=h._reactInternals;var C=Xi(),x=xc(h),B=Ps(C,x);B.payload=m,S!=null&&(B.callback=S),m=_o(h,B,x),m!==null&&(Ca(m,h,x,C),xf(m,h,x))},enqueueReplaceState:function(h,m,S){h=h._reactInternals;var C=Xi(),x=xc(h),B=Ps(C,x);B.tag=1,B.payload=m,S!=null&&(B.callback=S),m=_o(h,B,x),m!==null&&(Ca(m,h,x,C),xf(m,h,x))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var S=Xi(),C=xc(h),x=Ps(S,C);x.tag=2,m!=null&&(x.callback=m),m=_o(h,x,C),m!==null&&(Ca(m,h,C,S),xf(m,h,C))}};function ks(h,m,S,C,x,B,ee){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(C,B,ee):m.prototype&&m.prototype.isPureReactComponent?!ju(S,C)||!ju(x,B):!0}function ib(h,m,S){var C=!1,x=Sc,B=m.contextType;return typeof B=="object"&&B!==null?B=Fa(B):(x=ca(m)?bc:Pi.current,C=m.contextTypes,B=(C=C!=null)?Tc(h,x):Sc),m=new m(S,B),h.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Gf,h.stateNode=m,m._reactInternals=h,C&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=x,h.__reactInternalMemoizedMaskedChildContext=B),m}function ab(h,m,S,C){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(S,C),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(S,C),m.state!==h&&Gf.enqueueReplaceState(m,m.state,null)}function Pv(h,m,S,C){var x=h.stateNode;x.props=S,x.state=h.memoizedState,x.refs={},_v(h);var B=m.contextType;typeof B=="object"&&B!==null?x.context=Fa(B):(B=ca(m)?bc:Pi.current,x.context=Tc(h,B)),x.state=h.memoizedState,B=m.getDerivedStateFromProps,typeof B=="function"&&(Wf(h,m,B,S),x.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(m=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),m!==x.state&&Gf.enqueueReplaceState(x,x.state,null),kf(h,S,x,C),x.state=h.memoizedState),typeof x.componentDidMount=="function"&&(h.flags|=4194308)}function td(h,m){try{var S="",C=m;do S+=Lt(C),C=C.return;while(C);var x=S}catch(B){x=`
Error generating stack: `+B.message+`
`+B.stack}return{value:h,source:m,stack:x,digest:null}}function Hf(h,m,S){return{value:h,source:null,stack:S??null,digest:m??null}}function Dv(h,m){try{console.error(m.value)}catch(S){setTimeout(function(){throw S})}}var xv=typeof WeakMap=="function"?WeakMap:Map;function kv(h,m,S){S=Ps(-1,S),S.tag=3,S.payload={element:null};var C=m.value;return S.callback=function(){ki||(ki=!0,Zv=C),Dv(h,m)},S}function ob(h,m,S){S=Ps(-1,S),S.tag=3;var C=h.type.getDerivedStateFromError;if(typeof C=="function"){var x=m.value;S.payload=function(){return C(x)},S.callback=function(){Dv(h,m)}}var B=h.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(S.callback=function(){Dv(h,m),typeof C!="function"&&(Pc===null?Pc=new Set([this]):Pc.add(this));var ee=m.stack;this.componentDidCatch(m.value,{componentStack:ee!==null?ee:""})}),S}function Lv(h,m,S){var C=h.pingCache;if(C===null){C=h.pingCache=new xv;var x=new Set;C.set(m,x)}else x=C.get(m),x===void 0&&(x=new Set,C.set(m,x));x.has(S)||(x.add(S),h=wb.bind(null,h,m,S),m.then(h,h))}function sb(h){do{var m;if((m=h.tag===13)&&(m=h.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return h;h=h.return}while(h!==null);return null}function cb(h,m,S,C,x){return(h.mode&1)===0?(h===m?h.flags|=65536:(h.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(m=Ps(-1,1),m.tag=2,_o(S,m,1))),S.lanes|=1),h):(h.flags|=65536,h.lanes=x,h)}var JA=re.ReactCurrentOwner,ua=!1;function Yi(h,m,S,C){m.child=h===null?dv(m,null,S,C):Xu(m,h.child,S,C)}function lb(h,m,S,C,x){S=S.render;var B=m.ref;return go(m,x),C=Qu(h,m,S,C,B,x),S=wv(),h!==null&&!ua?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~x,Ls(h,m,x)):(fn&&S&&zu(m),m.flags|=1,Yi(h,m,C,x),m.child)}function ub(h,m,S,C,x){if(h===null){var B=S.type;return typeof B=="function"&&!ly(B)&&B.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(m.tag=15,m.type=B,Mv(h,m,B,C,x)):(h=sd(S.type,null,C,m,m.mode,x),h.ref=m.ref,h.return=m,m.child=h)}if(B=h.child,(h.lanes&x)===0){var ee=B.memoizedProps;if(S=S.compare,S=S!==null?S:ju,S(ee,C)&&h.ref===m.ref)return Ls(h,m,x)}return m.flags|=1,h=Uc(B,C),h.ref=m.ref,h.return=m,m.child=h}function Mv(h,m,S,C,x){if(h!==null){var B=h.memoizedProps;if(ju(B,C)&&h.ref===m.ref)if(ua=!1,m.pendingProps=C=B,(h.lanes&x)!==0)(h.flags&131072)!==0&&(ua=!0);else return m.lanes=h.lanes,Ls(h,m,x)}return Uv(h,m,S,C,x)}function Go(h,m,S){var C=m.pendingProps,x=C.children,B=h!==null?h.memoizedState:null;if(C.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},ln(rd,Ra),Ra|=S;else{if((S&1073741824)===0)return h=B!==null?B.baseLanes|S:S,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:h,cachePool:null,transitions:null},m.updateQueue=null,ln(rd,Ra),Ra|=h,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=B!==null?B.baseLanes:S,ln(rd,Ra),Ra|=C}else B!==null?(C=B.baseLanes|S,m.memoizedState=null):C=S,ln(rd,Ra),Ra|=C;return Yi(h,m,x,S),m.child}function db(h,m){var S=m.ref;(h===null&&S!==null||h!==null&&h.ref!==S)&&(m.flags|=512,m.flags|=2097152)}function Uv(h,m,S,C,x){var B=ca(S)?bc:Pi.current;return B=Tc(m,B),go(m,x),S=Qu(h,m,S,C,B,x),C=wv(),h!==null&&!ua?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~x,Ls(h,m,x)):(fn&&C&&zu(m),m.flags|=1,Yi(h,m,S,x),m.child)}function hb(h,m,S,C,x){if(ca(S)){var B=!0;wf(m)}else B=!1;if(go(m,x),m.stateNode===null)zf(h,m),ib(m,S,C),Pv(m,S,C,x),C=!0;else if(h===null){var ee=m.stateNode,le=m.memoizedProps;ee.props=le;var ve=ee.context,je=S.contextType;typeof je=="object"&&je!==null?je=Fa(je):(je=ca(S)?bc:Pi.current,je=Tc(m,je));var tt=S.getDerivedStateFromProps,it=typeof tt=="function"||typeof ee.getSnapshotBeforeUpdate=="function";it||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(le!==C||ve!==je)&&ab(m,ee,C,je),Ns=!1;var et=m.memoizedState;ee.state=et,kf(m,C,ee,x),ve=m.memoizedState,le!==C||et!==ve||zi.current||Ns?(typeof tt=="function"&&(Wf(m,S,tt,C),ve=m.memoizedState),(le=Ns||ks(m,S,le,C,et,ve,je))?(it||typeof ee.UNSAFE_componentWillMount!="function"&&typeof ee.componentWillMount!="function"||(typeof ee.componentWillMount=="function"&&ee.componentWillMount(),typeof ee.UNSAFE_componentWillMount=="function"&&ee.UNSAFE_componentWillMount()),typeof ee.componentDidMount=="function"&&(m.flags|=4194308)):(typeof ee.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=C,m.memoizedState=ve),ee.props=C,ee.state=ve,ee.context=je,C=le):(typeof ee.componentDidMount=="function"&&(m.flags|=4194308),C=!1)}else{ee=m.stateNode,q0(h,m),le=m.memoizedProps,je=m.type===m.elementType?le:Ba(m.type,le),ee.props=je,it=m.pendingProps,et=ee.context,ve=S.contextType,typeof ve=="object"&&ve!==null?ve=Fa(ve):(ve=ca(S)?bc:Pi.current,ve=Tc(m,ve));var vt=S.getDerivedStateFromProps;(tt=typeof vt=="function"||typeof ee.getSnapshotBeforeUpdate=="function")||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(le!==it||et!==ve)&&ab(m,ee,C,ve),Ns=!1,et=m.memoizedState,ee.state=et,kf(m,C,ee,x);var Tt=m.memoizedState;le!==it||et!==Tt||zi.current||Ns?(typeof vt=="function"&&(Wf(m,S,vt,C),Tt=m.memoizedState),(je=Ns||ks(m,S,je,C,et,Tt,ve)||!1)?(tt||typeof ee.UNSAFE_componentWillUpdate!="function"&&typeof ee.componentWillUpdate!="function"||(typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate(C,Tt,ve),typeof ee.UNSAFE_componentWillUpdate=="function"&&ee.UNSAFE_componentWillUpdate(C,Tt,ve)),typeof ee.componentDidUpdate=="function"&&(m.flags|=4),typeof ee.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof ee.componentDidUpdate!="function"||le===h.memoizedProps&&et===h.memoizedState||(m.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||le===h.memoizedProps&&et===h.memoizedState||(m.flags|=1024),m.memoizedProps=C,m.memoizedState=Tt),ee.props=C,ee.state=Tt,ee.context=ve,C=je):(typeof ee.componentDidUpdate!="function"||le===h.memoizedProps&&et===h.memoizedState||(m.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||le===h.memoizedProps&&et===h.memoizedState||(m.flags|=1024),C=!1)}return jv(h,m,S,C,B,x)}function jv(h,m,S,C,x,B){db(h,m);var ee=(m.flags&128)!==0;if(!C&&!ee)return x&&F0(m,S,!1),Ls(h,m,B);C=m.stateNode,JA.current=m;var le=ee&&typeof S.getDerivedStateFromError!="function"?null:C.render();return m.flags|=1,h!==null&&ee?(m.child=Xu(m,h.child,null,B),m.child=Xu(m,null,le,B)):Yi(h,m,le,B),m.memoizedState=C.state,x&&F0(m,S,!0),m.child}function pb(h){var m=h.stateNode;m.pendingContext?qu(h,m.pendingContext,m.pendingContext!==m.context):m.context&&qu(h,m.context,!1),vv(h,m.containerInfo)}function fb(h,m,S,C,x){return wl(),Yu(x),m.flags|=256,Yi(h,m,S,C),m.child}var Dh={dehydrated:null,treeContext:null,retryLane:0};function Vv(h){return{baseLanes:h,cachePool:null,transitions:null}}function mb(h,m,S){var C=m.pendingProps,x=Rn.current,B=!1,ee=(m.flags&128)!==0,le;if((le=ee)||(le=h!==null&&h.memoizedState===null?!1:(x&2)!==0),le?(B=!0,m.flags&=-129):(h===null||h.memoizedState!==null)&&(x|=1),ln(Rn,x&1),h===null)return Eh(m),h=m.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((m.mode&1)===0?m.lanes=1:h.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(ee=C.children,h=C.fallback,B?(C=m.mode,B=m.child,ee={mode:"hidden",children:ee},(C&1)===0&&B!==null?(B.childLanes=0,B.pendingProps=ee):B=Gh(ee,C,0,null),h=jc(h,C,S,null),B.return=m,h.return=m,B.sibling=h,m.child=B,m.child.memoizedState=Vv(S),m.memoizedState=Dh,h):Fv(m,ee));if(x=h.memoizedState,x!==null&&(le=x.dehydrated,le!==null))return QA(h,m,ee,C,le,x,S);if(B){B=C.fallback,ee=m.mode,x=h.child,le=x.sibling;var ve={mode:"hidden",children:C.children};return(ee&1)===0&&m.child!==x?(C=m.child,C.childLanes=0,C.pendingProps=ve,m.deletions=null):(C=Uc(x,ve),C.subtreeFlags=x.subtreeFlags&14680064),le!==null?B=Uc(le,B):(B=jc(B,ee,S,null),B.flags|=2),B.return=m,C.return=m,C.sibling=B,m.child=C,C=B,B=m.child,ee=h.child.memoizedState,ee=ee===null?Vv(S):{baseLanes:ee.baseLanes|S,cachePool:null,transitions:ee.transitions},B.memoizedState=ee,B.childLanes=h.childLanes&~S,m.memoizedState=Dh,C}return B=h.child,h=B.sibling,C=Uc(B,{mode:"visible",children:C.children}),(m.mode&1)===0&&(C.lanes=S),C.return=m,C.sibling=null,h!==null&&(S=m.deletions,S===null?(m.deletions=[h],m.flags|=16):S.push(h)),m.child=C,m.memoizedState=null,C}function Fv(h,m){return m=Gh({mode:"visible",children:m},h.mode,0,null),m.return=h,h.child=m}function qf(h,m,S,C){return C!==null&&Yu(C),Xu(m,h.child,null,S),h=Fv(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function QA(h,m,S,C,x,B,ee){if(S)return m.flags&256?(m.flags&=-257,C=Hf(Error(o(422))),qf(h,m,ee,C)):m.memoizedState!==null?(m.child=h.child,m.flags|=128,null):(B=C.fallback,x=m.mode,C=Gh({mode:"visible",children:C.children},x,0,null),B=jc(B,x,ee,null),B.flags|=2,C.return=m,B.return=m,C.sibling=B,m.child=C,(m.mode&1)!==0&&Xu(m,h.child,null,ee),m.child.memoizedState=Vv(ee),m.memoizedState=Dh,B);if((m.mode&1)===0)return qf(h,m,ee,null);if(x.data==="$!"){if(C=x.nextSibling&&x.nextSibling.dataset,C)var le=C.dgst;return C=le,B=Error(o(419)),C=Hf(B,C,void 0),qf(h,m,ee,C)}if(le=(ee&h.childLanes)!==0,ua||le){if(C=ai,C!==null){switch(ee&-ee){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(C.suspendedLanes|ee))!==0?0:x,x!==0&&x!==B.retryLane&&(B.retryLane=x,Is(h,x),Ca(C,h,x,-1))}return ad(),C=Hf(Error(o(421))),qf(h,m,ee,C)}return x.data==="$?"?(m.flags|=128,m.child=h.child,m=oO.bind(null,h),x._reactRetry=m,null):(h=B.treeContext,Ta=Fo(x.nextSibling),ba=m,fn=!0,mo=null,h!==null&&($i[Va++]=As,$i[Va++]=Os,$i[Va++]=bl,As=h.id,Os=h.overflow,bl=m),m=Fv(m,C.children),m.flags|=4096,m)}function gb(h,m,S){h.lanes|=m;var C=h.alternate;C!==null&&(C.lanes|=m),Df(h.return,m,S)}function Kf(h,m,S,C,x){var B=h.memoizedState;B===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:C,tail:S,tailMode:x}:(B.isBackwards=m,B.rendering=null,B.renderingStartTime=0,B.last=C,B.tail=S,B.tailMode=x)}function Bv(h,m,S){var C=m.pendingProps,x=C.revealOrder,B=C.tail;if(Yi(h,m,C.children,S),C=Rn.current,(C&2)!==0)C=C&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&gb(h,S,m);else if(h.tag===19)gb(h,S,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}C&=1}if(ln(Rn,C),(m.mode&1)===0)m.memoizedState=null;else switch(x){case"forwards":for(S=m.child,x=null;S!==null;)h=S.alternate,h!==null&&Lf(h)===null&&(x=S),S=S.sibling;S=x,S===null?(x=m.child,m.child=null):(x=S.sibling,S.sibling=null),Kf(m,!1,x,S,B);break;case"backwards":for(S=null,x=m.child,m.child=null;x!==null;){if(h=x.alternate,h!==null&&Lf(h)===null){m.child=x;break}h=x.sibling,x.sibling=S,S=x,x=h}Kf(m,!0,S,null,B);break;case"together":Kf(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function zf(h,m){(m.mode&1)===0&&h!==null&&(h.alternate=null,m.alternate=null,m.flags|=2)}function Ls(h,m,S){if(h!==null&&(m.dependencies=h.dependencies),xl|=m.lanes,(S&m.childLanes)===0)return null;if(h!==null&&m.child!==h.child)throw Error(o(153));if(m.child!==null){for(h=m.child,S=Uc(h,h.pendingProps),m.child=S,S.return=m;h.sibling!==null;)h=h.sibling,S=S.sibling=Uc(h,h.pendingProps),S.return=m;S.sibling=null}return m.child}function $f(h,m,S){switch(m.tag){case 3:pb(m),wl();break;case 5:$0(m);break;case 1:ca(m.type)&&wf(m);break;case 4:vv(m,m.stateNode.containerInfo);break;case 10:var C=m.type._context,x=m.memoizedProps.value;ln(Nf,C._currentValue),C._currentValue=x;break;case 13:if(C=m.memoizedState,C!==null)return C.dehydrated!==null?(ln(Rn,Rn.current&1),m.flags|=128,null):(S&m.child.childLanes)!==0?mb(h,m,S):(ln(Rn,Rn.current&1),h=Ls(h,m,S),h!==null?h.sibling:null);ln(Rn,Rn.current&1);break;case 19:if(C=(S&m.childLanes)!==0,(h.flags&128)!==0){if(C)return Bv(h,m,S);m.flags|=128}if(x=m.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),ln(Rn,Rn.current),C)break;return null;case 22:case 23:return m.lanes=0,Go(h,m,S)}return Ls(h,m,S)}var Yf,Xf,xh,Wv;Yf=function(h,m){for(var S=m.child;S!==null;){if(S.tag===5||S.tag===6)h.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===m)break;for(;S.sibling===null;){if(S.return===null||S.return===m)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},Xf=function(){},xh=function(h,m,S,C){var x=h.memoizedProps;if(x!==C){h=m.stateNode,Cc(Wo.current);var B=null;switch(S){case"input":x=vr(h,x),C=vr(h,C),B=[];break;case"select":x=He({},x,{value:void 0}),C=He({},C,{value:void 0}),B=[];break;case"textarea":x=co(h,x),C=co(h,C),B=[];break;default:typeof x.onClick!="function"&&typeof C.onClick=="function"&&(h.onclick=gh)}y_(S,C);var ee;S=null;for(je in x)if(!C.hasOwnProperty(je)&&x.hasOwnProperty(je)&&x[je]!=null)if(je==="style"){var le=x[je];for(ee in le)le.hasOwnProperty(ee)&&(S||(S={}),S[ee]="")}else je!=="dangerouslySetInnerHTML"&&je!=="children"&&je!=="suppressContentEditableWarning"&&je!=="suppressHydrationWarning"&&je!=="autoFocus"&&(u.hasOwnProperty(je)?B||(B=[]):(B=B||[]).push(je,null));for(je in C){var ve=C[je];if(le=x!=null?x[je]:void 0,C.hasOwnProperty(je)&&ve!==le&&(ve!=null||le!=null))if(je==="style")if(le){for(ee in le)!le.hasOwnProperty(ee)||ve&&ve.hasOwnProperty(ee)||(S||(S={}),S[ee]="");for(ee in ve)ve.hasOwnProperty(ee)&&le[ee]!==ve[ee]&&(S||(S={}),S[ee]=ve[ee])}else S||(B||(B=[]),B.push(je,S)),S=ve;else je==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,le=le?le.__html:void 0,ve!=null&&le!==ve&&(B=B||[]).push(je,ve)):je==="children"?typeof ve!="string"&&typeof ve!="number"||(B=B||[]).push(je,""+ve):je!=="suppressContentEditableWarning"&&je!=="suppressHydrationWarning"&&(u.hasOwnProperty(je)?(ve!=null&&je==="onScroll"&&cn("scroll",h),B||le===ve||(B=[])):(B=B||[]).push(je,ve))}S&&(B=B||[]).push("style",S);var je=B;(m.updateQueue=je)&&(m.flags|=4)}},Wv=function(h,m,S,C){S!==C&&(m.flags|=4)};function kh(h,m){if(!fn)switch(h.tailMode){case"hidden":m=h.tail;for(var S=null;m!==null;)m.alternate!==null&&(S=m),m=m.sibling;S===null?h.tail=null:S.sibling=null;break;case"collapsed":S=h.tail;for(var C=null;S!==null;)S.alternate!==null&&(C=S),S=S.sibling;C===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:C.sibling=null}}function Ei(h){var m=h.alternate!==null&&h.alternate.child===h.child,S=0,C=0;if(m)for(var x=h.child;x!==null;)S|=x.lanes|x.childLanes,C|=x.subtreeFlags&14680064,C|=x.flags&14680064,x.return=h,x=x.sibling;else for(x=h.child;x!==null;)S|=x.lanes|x.childLanes,C|=x.subtreeFlags,C|=x.flags,x.return=h,x=x.sibling;return h.subtreeFlags|=C,h.childLanes=S,m}function Jf(h,m,S){var C=m.pendingProps;switch(Of(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ei(m),null;case 1:return ca(m.type)&&Tf(),Ei(m),null;case 3:return C=m.stateNode,Al(),tn(zi),tn(Pi),Sv(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(h===null||h.child===null)&&($u(m)?m.flags|=4:h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,mo!==null&&(ty(mo),mo=null))),Xf(h,m),Ei(m),null;case 5:yv(m);var x=Cc(wh.current);if(S=m.type,h!==null&&m.stateNode!=null)xh(h,m,S,C,x),h.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!C){if(m.stateNode===null)throw Error(o(166));return Ei(m),null}if(h=Cc(Wo.current),$u(m)){C=m.stateNode,S=m.type;var B=m.memoizedProps;switch(C[Bo]=m,C[_h]=B,h=(m.mode&1)!==0,S){case"dialog":cn("cancel",C),cn("close",C);break;case"iframe":case"object":case"embed":cn("load",C);break;case"video":case"audio":for(x=0;x<hh.length;x++)cn(hh[x],C);break;case"source":cn("error",C);break;case"img":case"image":case"link":cn("error",C),cn("load",C);break;case"details":cn("toggle",C);break;case"input":Dn(C,B),cn("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!B.multiple},cn("invalid",C);break;case"textarea":ml(C,B),cn("invalid",C)}y_(S,B),x=null;for(var ee in B)if(B.hasOwnProperty(ee)){var le=B[ee];ee==="children"?typeof le=="string"?C.textContent!==le&&(B.suppressHydrationWarning!==!0&&mh(C.textContent,le,h),x=["children",le]):typeof le=="number"&&C.textContent!==""+le&&(B.suppressHydrationWarning!==!0&&mh(C.textContent,le,h),x=["children",""+le]):u.hasOwnProperty(ee)&&le!=null&&ee==="onScroll"&&cn("scroll",C)}switch(S){case"input":Zt(C),en(C,B,!0);break;case"textarea":Zt(C),Eu(C);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(C.onclick=gh)}C=x,m.updateQueue=C,C!==null&&(m.flags|=4)}else{ee=x.nodeType===9?x:x.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=__(S)),h==="http://www.w3.org/1999/xhtml"?S==="script"?(h=ee.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof C.is=="string"?h=ee.createElement(S,{is:C.is}):(h=ee.createElement(S),S==="select"&&(ee=h,C.multiple?ee.multiple=!0:C.size&&(ee.size=C.size))):h=ee.createElementNS(h,S),h[Bo]=m,h[_h]=C,Yf(h,m,!1,!1),m.stateNode=h;e:{switch(ee=E_(S,C),S){case"dialog":cn("cancel",h),cn("close",h),x=C;break;case"iframe":case"object":case"embed":cn("load",h),x=C;break;case"video":case"audio":for(x=0;x<hh.length;x++)cn(hh[x],h);x=C;break;case"source":cn("error",h),x=C;break;case"img":case"image":case"link":cn("error",h),cn("load",h),x=C;break;case"details":cn("toggle",h),x=C;break;case"input":Dn(h,C),x=vr(h,C),cn("invalid",h);break;case"option":x=C;break;case"select":h._wrapperState={wasMultiple:!!C.multiple},x=He({},C,{value:void 0}),cn("invalid",h);break;case"textarea":ml(h,C),x=co(h,C),cn("invalid",h);break;default:x=C}y_(S,x),le=x;for(B in le)if(le.hasOwnProperty(B)){var ve=le[B];B==="style"?lc(h,ve):B==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,ve!=null&&Qp(h,ve)):B==="children"?typeof ve=="string"?(S!=="textarea"||ve!=="")&&Su(h,ve):typeof ve=="number"&&Su(h,""+ve):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(u.hasOwnProperty(B)?ve!=null&&B==="onScroll"&&cn("scroll",h):ve!=null&&J(h,B,ve,ee))}switch(S){case"input":Zt(h),en(h,C,!1);break;case"textarea":Zt(h),Eu(h);break;case"option":C.value!=null&&h.setAttribute("value",""+Qt(C.value));break;case"select":h.multiple=!!C.multiple,B=C.value,B!=null?Ni(h,!!C.multiple,B,!1):C.defaultValue!=null&&Ni(h,!!C.multiple,C.defaultValue,!0);break;default:typeof x.onClick=="function"&&(h.onclick=gh)}switch(S){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return Ei(m),null;case 6:if(h&&m.stateNode!=null)Wv(h,m,h.memoizedProps,C);else{if(typeof C!="string"&&m.stateNode===null)throw Error(o(166));if(S=Cc(wh.current),Cc(Wo.current),$u(m)){if(C=m.stateNode,S=m.memoizedProps,C[Bo]=m,(B=C.nodeValue!==S)&&(h=ba,h!==null))switch(h.tag){case 3:mh(C.nodeValue,S,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&mh(C.nodeValue,S,(h.mode&1)!==0)}B&&(m.flags|=4)}else C=(S.nodeType===9?S:S.ownerDocument).createTextNode(C),C[Bo]=m,m.stateNode=C}return Ei(m),null;case 13:if(tn(Rn),C=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(fn&&Ta!==null&&(m.mode&1)!==0&&(m.flags&128)===0)lv(),wl(),m.flags|=98560,B=!1;else if(B=$u(m),C!==null&&C.dehydrated!==null){if(h===null){if(!B)throw Error(o(318));if(B=m.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(o(317));B[Bo]=m}else wl(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Ei(m),B=!1}else mo!==null&&(ty(mo),mo=null),B=!0;if(!B)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=S,m):(C=C!==null,C!==(h!==null&&h.memoizedState!==null)&&C&&(m.child.flags|=8192,(m.mode&1)!==0&&(h===null||(Rn.current&1)!==0?oi===0&&(oi=3):ad())),m.updateQueue!==null&&(m.flags|=4),Ei(m),null);case 4:return Al(),Xf(h,m),h===null&&Ts(m.stateNode.containerInfo),Ei(m),null;case 10:return fv(m.type._context),Ei(m),null;case 17:return ca(m.type)&&Tf(),Ei(m),null;case 19:if(tn(Rn),B=m.memoizedState,B===null)return Ei(m),null;if(C=(m.flags&128)!==0,ee=B.rendering,ee===null)if(C)kh(B,!1);else{if(oi!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(ee=Lf(h),ee!==null){for(m.flags|=128,kh(B,!1),C=ee.updateQueue,C!==null&&(m.updateQueue=C,m.flags|=4),m.subtreeFlags=0,C=S,S=m.child;S!==null;)B=S,h=C,B.flags&=14680066,ee=B.alternate,ee===null?(B.childLanes=0,B.lanes=h,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=ee.childLanes,B.lanes=ee.lanes,B.child=ee.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=ee.memoizedProps,B.memoizedState=ee.memoizedState,B.updateQueue=ee.updateQueue,B.type=ee.type,h=ee.dependencies,B.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),S=S.sibling;return ln(Rn,Rn.current&1|2),m.child}h=h.sibling}B.tail!==null&&Bn()>Wa&&(m.flags|=128,C=!0,kh(B,!1),m.lanes=4194304)}else{if(!C)if(h=Lf(ee),h!==null){if(m.flags|=128,C=!0,S=h.updateQueue,S!==null&&(m.updateQueue=S,m.flags|=4),kh(B,!0),B.tail===null&&B.tailMode==="hidden"&&!ee.alternate&&!fn)return Ei(m),null}else 2*Bn()-B.renderingStartTime>Wa&&S!==1073741824&&(m.flags|=128,C=!0,kh(B,!1),m.lanes=4194304);B.isBackwards?(ee.sibling=m.child,m.child=ee):(S=B.last,S!==null?S.sibling=ee:m.child=ee,B.last=ee)}return B.tail!==null?(m=B.tail,B.rendering=m,B.tail=m.sibling,B.renderingStartTime=Bn(),m.sibling=null,S=Rn.current,ln(Rn,C?S&1|2:S&1),m):(Ei(m),null);case 22:case 23:return Bh(),C=m.memoizedState!==null,h!==null&&h.memoizedState!==null!==C&&(m.flags|=8192),C&&(m.mode&1)!==0?(Ra&1073741824)!==0&&(Ei(m),m.subtreeFlags&6&&(m.flags|=8192)):Ei(m),null;case 24:return null;case 25:return null}throw Error(o(156,m.tag))}function ZA(h,m){switch(Of(m),m.tag){case 1:return ca(m.type)&&Tf(),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return Al(),tn(zi),tn(Pi),Sv(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 5:return yv(m),null;case 13:if(tn(Rn),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(o(340));wl()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return tn(Rn),null;case 4:return Al(),null;case 10:return fv(m.type._context),null;case 22:case 23:return Bh(),null;case 24:return null;default:return null}}var Lh=!1,Si=!1,eO=typeof WeakSet=="function"?WeakSet:Set,Et=null;function Dl(h,m){var S=h.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(C){Cn(h,m,C)}else S.current=null}function Gv(h,m,S){try{S()}catch(C){Cn(h,m,C)}}var _b=!1;function tO(h,m){if(rv=uf,h=$_(),Y_(h)){if("selectionStart"in h)var S={start:h.selectionStart,end:h.selectionEnd};else e:{S=(S=h.ownerDocument)&&S.defaultView||window;var C=S.getSelection&&S.getSelection();if(C&&C.rangeCount!==0){S=C.anchorNode;var x=C.anchorOffset,B=C.focusNode;C=C.focusOffset;try{S.nodeType,B.nodeType}catch{S=null;break e}var ee=0,le=-1,ve=-1,je=0,tt=0,it=h,et=null;t:for(;;){for(var vt;it!==S||x!==0&&it.nodeType!==3||(le=ee+x),it!==B||C!==0&&it.nodeType!==3||(ve=ee+C),it.nodeType===3&&(ee+=it.nodeValue.length),(vt=it.firstChild)!==null;)et=it,it=vt;for(;;){if(it===h)break t;if(et===S&&++je===x&&(le=ee),et===B&&++tt===C&&(ve=ee),(vt=it.nextSibling)!==null)break;it=et,et=it.parentNode}it=vt}S=le===-1||ve===-1?null:{start:le,end:ve}}else S=null}S=S||{start:0,end:0}}else S=null;for(Ef={focusedElem:h,selectionRange:S},uf=!1,Et=m;Et!==null;)if(m=Et,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,Et=h;else for(;Et!==null;){m=Et;try{var Tt=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Tt!==null){var Ct=Tt.memoizedProps,An=Tt.memoizedState,Ne=m.stateNode,Se=Ne.getSnapshotBeforeUpdate(m.elementType===m.type?Ct:Ba(m.type,Ct),An);Ne.__reactInternalSnapshotBeforeUpdate=Se}break;case 3:var xe=m.stateNode.containerInfo;xe.nodeType===1?xe.textContent="":xe.nodeType===9&&xe.documentElement&&xe.removeChild(xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(st){Cn(m,m.return,st)}if(h=m.sibling,h!==null){h.return=m.return,Et=h;break}Et=m.return}return Tt=_b,_b=!1,Tt}function Oc(h,m,S){var C=m.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var x=C=C.next;do{if((x.tag&h)===h){var B=x.destroy;x.destroy=void 0,B!==void 0&&Gv(m,S,B)}x=x.next}while(x!==C)}}function Qf(h,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var S=m=m.next;do{if((S.tag&h)===h){var C=S.create;S.destroy=C()}S=S.next}while(S!==m)}}function Hv(h){var m=h.ref;if(m!==null){var S=h.stateNode;switch(h.tag){case 5:h=S;break;default:h=S}typeof m=="function"?m(h):m.current=h}}function vb(h){var m=h.alternate;m!==null&&(h.alternate=null,vb(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&(delete m[Bo],delete m[_h],delete m[iv],delete m[HA],delete m[qA])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function qv(h){return h.tag===5||h.tag===3||h.tag===4}function yb(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||qv(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Kv(h,m,S){var C=h.tag;if(C===5||C===6)h=h.stateNode,m?S.nodeType===8?S.parentNode.insertBefore(h,m):S.insertBefore(h,m):(S.nodeType===8?(m=S.parentNode,m.insertBefore(h,S)):(m=S,m.appendChild(h)),S=S._reactRootContainer,S!=null||m.onclick!==null||(m.onclick=gh));else if(C!==4&&(h=h.child,h!==null))for(Kv(h,m,S),h=h.sibling;h!==null;)Kv(h,m,S),h=h.sibling}function Mh(h,m,S){var C=h.tag;if(C===5||C===6)h=h.stateNode,m?S.insertBefore(h,m):S.appendChild(h);else if(C!==4&&(h=h.child,h!==null))for(Mh(h,m,S),h=h.sibling;h!==null;)Mh(h,m,S),h=h.sibling}var bi=null,wa=!1;function Ic(h,m,S){for(S=S.child;S!==null;)zv(h,m,S),S=S.sibling}function zv(h,m,S){if(jo&&typeof jo.onCommitFiberUnmount=="function")try{jo.onCommitFiberUnmount(Au,S)}catch{}switch(S.tag){case 5:Si||Dl(S,m);case 6:var C=bi,x=wa;bi=null,Ic(h,m,S),bi=C,wa=x,bi!==null&&(wa?(h=bi,S=S.stateNode,h.nodeType===8?h.parentNode.removeChild(S):h.removeChild(S)):bi.removeChild(S.stateNode));break;case 18:bi!==null&&(wa?(h=bi,S=S.stateNode,h.nodeType===8?Sf(h.parentNode,S):h.nodeType===1&&Sf(h,S),Pu(h)):Sf(bi,S.stateNode));break;case 4:C=bi,x=wa,bi=S.stateNode.containerInfo,wa=!0,Ic(h,m,S),bi=C,wa=x;break;case 0:case 11:case 14:case 15:if(!Si&&(C=S.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){x=C=C.next;do{var B=x,ee=B.destroy;B=B.tag,ee!==void 0&&((B&2)!==0||(B&4)!==0)&&Gv(S,m,ee),x=x.next}while(x!==C)}Ic(h,m,S);break;case 1:if(!Si&&(Dl(S,m),C=S.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=S.memoizedProps,C.state=S.memoizedState,C.componentWillUnmount()}catch(le){Cn(S,m,le)}Ic(h,m,S);break;case 21:Ic(h,m,S);break;case 22:S.mode&1?(Si=(C=Si)||S.memoizedState!==null,Ic(h,m,S),Si=C):Ic(h,m,S);break;default:Ic(h,m,S)}}function Eb(h){var m=h.updateQueue;if(m!==null){h.updateQueue=null;var S=h.stateNode;S===null&&(S=h.stateNode=new eO),m.forEach(function(C){var x=od.bind(null,h,C);S.has(C)||(S.add(C),C.then(x,x))})}}function Eo(h,m){var S=m.deletions;if(S!==null)for(var C=0;C<S.length;C++){var x=S[C];try{var B=h,ee=m,le=ee;e:for(;le!==null;){switch(le.tag){case 5:bi=le.stateNode,wa=!1;break e;case 3:bi=le.stateNode.containerInfo,wa=!0;break e;case 4:bi=le.stateNode.containerInfo,wa=!0;break e}le=le.return}if(bi===null)throw Error(o(160));zv(B,ee,x),bi=null,wa=!1;var ve=x.alternate;ve!==null&&(ve.return=null),x.return=null}catch(je){Cn(x,m,je)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)$v(m,h),m=m.sibling}function $v(h,m){var S=h.alternate,C=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Eo(m,h),Ho(h),C&4){try{Oc(3,h,h.return),Qf(3,h)}catch(Ct){Cn(h,h.return,Ct)}try{Oc(5,h,h.return)}catch(Ct){Cn(h,h.return,Ct)}}break;case 1:Eo(m,h),Ho(h),C&512&&S!==null&&Dl(S,S.return);break;case 5:if(Eo(m,h),Ho(h),C&512&&S!==null&&Dl(S,S.return),h.flags&32){var x=h.stateNode;try{Su(x,"")}catch(Ct){Cn(h,h.return,Ct)}}if(C&4&&(x=h.stateNode,x!=null)){var B=h.memoizedProps,ee=S!==null?S.memoizedProps:B,le=h.type,ve=h.updateQueue;if(h.updateQueue=null,ve!==null)try{le==="input"&&B.type==="radio"&&B.name!=null&&qr(x,B),E_(le,ee);var je=E_(le,B);for(ee=0;ee<ve.length;ee+=2){var tt=ve[ee],it=ve[ee+1];tt==="style"?lc(x,it):tt==="dangerouslySetInnerHTML"?Qp(x,it):tt==="children"?Su(x,it):J(x,tt,it,je)}switch(le){case"input":pi(x,B);break;case"textarea":Fn(x,B);break;case"select":var et=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!B.multiple;var vt=B.value;vt!=null?Ni(x,!!B.multiple,vt,!1):et!==!!B.multiple&&(B.defaultValue!=null?Ni(x,!!B.multiple,B.defaultValue,!0):Ni(x,!!B.multiple,B.multiple?[]:"",!1))}x[_h]=B}catch(Ct){Cn(h,h.return,Ct)}}break;case 6:if(Eo(m,h),Ho(h),C&4){if(h.stateNode===null)throw Error(o(162));x=h.stateNode,B=h.memoizedProps;try{x.nodeValue=B}catch(Ct){Cn(h,h.return,Ct)}}break;case 3:if(Eo(m,h),Ho(h),C&4&&S!==null&&S.memoizedState.isDehydrated)try{Pu(m.containerInfo)}catch(Ct){Cn(h,h.return,Ct)}break;case 4:Eo(m,h),Ho(h);break;case 13:Eo(m,h),Ho(h),x=h.child,x.flags&8192&&(B=x.memoizedState!==null,x.stateNode.isHidden=B,!B||x.alternate!==null&&x.alternate.memoizedState!==null||(Qv=Bn())),C&4&&Eb(h);break;case 22:if(tt=S!==null&&S.memoizedState!==null,h.mode&1?(Si=(je=Si)||tt,Eo(m,h),Si=je):Eo(m,h),Ho(h),C&8192){if(je=h.memoizedState!==null,(h.stateNode.isHidden=je)&&!tt&&(h.mode&1)!==0)for(Et=h,tt=h.child;tt!==null;){for(it=Et=tt;Et!==null;){switch(et=Et,vt=et.child,et.tag){case 0:case 11:case 14:case 15:Oc(4,et,et.return);break;case 1:Dl(et,et.return);var Tt=et.stateNode;if(typeof Tt.componentWillUnmount=="function"){C=et,S=et.return;try{m=C,Tt.props=m.memoizedProps,Tt.state=m.memoizedState,Tt.componentWillUnmount()}catch(Ct){Cn(C,S,Ct)}}break;case 5:Dl(et,et.return);break;case 22:if(et.memoizedState!==null){Zf(it);continue}}vt!==null?(vt.return=et,Et=vt):Zf(it)}tt=tt.sibling}e:for(tt=null,it=h;;){if(it.tag===5){if(tt===null){tt=it;try{x=it.stateNode,je?(B=x.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(le=it.stateNode,ve=it.memoizedProps.style,ee=ve!=null&&ve.hasOwnProperty("display")?ve.display:null,le.style.display=v_("display",ee))}catch(Ct){Cn(h,h.return,Ct)}}}else if(it.tag===6){if(tt===null)try{it.stateNode.nodeValue=je?"":it.memoizedProps}catch(Ct){Cn(h,h.return,Ct)}}else if((it.tag!==22&&it.tag!==23||it.memoizedState===null||it===h)&&it.child!==null){it.child.return=it,it=it.child;continue}if(it===h)break e;for(;it.sibling===null;){if(it.return===null||it.return===h)break e;tt===it&&(tt=null),it=it.return}tt===it&&(tt=null),it.sibling.return=it.return,it=it.sibling}}break;case 19:Eo(m,h),Ho(h),C&4&&Eb(h);break;case 21:break;default:Eo(m,h),Ho(h)}}function Ho(h){var m=h.flags;if(m&2){try{e:{for(var S=h.return;S!==null;){if(qv(S)){var C=S;break e}S=S.return}throw Error(o(160))}switch(C.tag){case 5:var x=C.stateNode;C.flags&32&&(Su(x,""),C.flags&=-33);var B=yb(h);Mh(h,B,x);break;case 3:case 4:var ee=C.stateNode.containerInfo,le=yb(h);Kv(h,le,ee);break;default:throw Error(o(161))}}catch(ve){Cn(h,h.return,ve)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function rO(h,m,S){Et=h,Yv(h)}function Yv(h,m,S){for(var C=(h.mode&1)!==0;Et!==null;){var x=Et,B=x.child;if(x.tag===22&&C){var ee=x.memoizedState!==null||Lh;if(!ee){var le=x.alternate,ve=le!==null&&le.memoizedState!==null||Si;le=Lh;var je=Si;if(Lh=ee,(Si=ve)&&!je)for(Et=x;Et!==null;)ee=Et,ve=ee.child,ee.tag===22&&ee.memoizedState!==null?Sb(x):ve!==null?(ve.return=ee,Et=ve):Sb(x);for(;B!==null;)Et=B,Yv(B),B=B.sibling;Et=x,Lh=le,Si=je}Xv(h)}else(x.subtreeFlags&8772)!==0&&B!==null?(B.return=x,Et=B):Xv(h)}}function Xv(h){for(;Et!==null;){var m=Et;if((m.flags&8772)!==0){var S=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:Si||Qf(5,m);break;case 1:var C=m.stateNode;if(m.flags&4&&!Si)if(S===null)C.componentDidMount();else{var x=m.elementType===m.type?S.memoizedProps:Ba(m.type,S.memoizedProps);C.componentDidUpdate(x,S.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var B=m.updateQueue;B!==null&&z0(m,B,C);break;case 3:var ee=m.updateQueue;if(ee!==null){if(S=null,m.child!==null)switch(m.child.tag){case 5:S=m.child.stateNode;break;case 1:S=m.child.stateNode}z0(m,ee,S)}break;case 5:var le=m.stateNode;if(S===null&&m.flags&4){S=le;var ve=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":ve.autoFocus&&S.focus();break;case"img":ve.src&&(S.src=ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var je=m.alternate;if(je!==null){var tt=je.memoizedState;if(tt!==null){var it=tt.dehydrated;it!==null&&Pu(it)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(o(163))}Si||m.flags&512&&Hv(m)}catch(et){Cn(m,m.return,et)}}if(m===h){Et=null;break}if(S=m.sibling,S!==null){S.return=m.return,Et=S;break}Et=m.return}}function Zf(h){for(;Et!==null;){var m=Et;if(m===h){Et=null;break}var S=m.sibling;if(S!==null){S.return=m.return,Et=S;break}Et=m.return}}function Sb(h){for(;Et!==null;){var m=Et;try{switch(m.tag){case 0:case 11:case 15:var S=m.return;try{Qf(4,m)}catch(ve){Cn(m,S,ve)}break;case 1:var C=m.stateNode;if(typeof C.componentDidMount=="function"){var x=m.return;try{C.componentDidMount()}catch(ve){Cn(m,x,ve)}}var B=m.return;try{Hv(m)}catch(ve){Cn(m,B,ve)}break;case 5:var ee=m.return;try{Hv(m)}catch(ve){Cn(m,ee,ve)}}}catch(ve){Cn(m,m.return,ve)}if(m===h){Et=null;break}var le=m.sibling;if(le!==null){le.return=m.return,Et=le;break}Et=m.return}}var nO=Math.ceil,Nc=re.ReactCurrentDispatcher,em=re.ReactCurrentOwner,xi=re.ReactCurrentBatchConfig,mr=0,ai=null,Ln=null,Jn=0,Ra=0,rd=fo(0),oi=0,nd=null,xl=0,tm=0,Jv=0,kl=null,Gn=null,Qv=0,Wa=1/0,qo=null,ki=!1,Zv=null,Pc=null,Uh=!1,Dc=null,jh=0,id=0,ey=null,Vh=-1,rm=0;function Xi(){return(mr&6)!==0?Bn():Vh!==-1?Vh:Vh=Bn()}function xc(h){return(h.mode&1)===0?1:(mr&2)!==0&&Jn!==0?Jn&-Jn:Sh.transition!==null?(rm===0&&(rm=s0()),rm):(h=jr,h!==0||(h=window.event,h=h===void 0?16:h0(h.type)),h)}function Ca(h,m,S,C){if(50<id)throw id=0,ey=null,Error(o(185));Zd(h,S,C),((mr&2)===0||h!==ai)&&(h===ai&&((mr&2)===0&&(tm|=S),oi===4&&kc(h,Jn)),Li(h,C),S===1&&mr===0&&(m.mode&1)===0&&(Wa=Bn()+500,Rf&&wc()))}function Li(h,m){var S=h.callbackNode;o0(h,m);var C=af(h,h===ai?Jn:0);if(C===0)S!==null&&t0(S),h.callbackNode=null,h.callbackPriority=0;else if(m=C&-C,h.callbackPriority!==m){if(S!=null&&t0(S),m===1)h.tag===0?KA(nm.bind(null,h)):sv(nm.bind(null,h)),WA(function(){(mr&6)===0&&wc()}),S=null;else{switch(N_(C)){case 1:S=kn;break;case 4:S=r0;break;case 16:S=rf;break;case 536870912:S=n0;break;default:S=rf}S=sy(S,bb.bind(null,h))}h.callbackPriority=m,h.callbackNode=S}}function bb(h,m){if(Vh=-1,rm=0,(mr&6)!==0)throw Error(o(327));var S=h.callbackNode;if(Mc()&&h.callbackNode!==S)return null;var C=af(h,h===ai?Jn:0);if(C===0)return null;if((C&30)!==0||(C&h.expiredLanes)!==0||m)m=Wh(h,C);else{m=C;var x=mr;mr|=2;var B=ny();(ai!==h||Jn!==m)&&(qo=null,Wa=Bn()+500,Ms(h,m));do try{aO();break}catch(le){ry(h,le)}while(!0);pv(),Nc.current=B,mr=x,Ln!==null?m=0:(ai=null,Jn=0,m=oi)}if(m!==0){if(m===2&&(x=A_(h),x!==0&&(C=x,m=Fh(h,x))),m===1)throw S=nd,Ms(h,0),kc(h,C),Li(h,Bn()),S;if(m===6)kc(h,C);else{if(x=h.current.alternate,(C&30)===0&&!Tb(x)&&(m=Wh(h,C),m===2&&(B=A_(h),B!==0&&(C=B,m=Fh(h,B))),m===1))throw S=nd,Ms(h,0),kc(h,C),Li(h,Bn()),S;switch(h.finishedWork=x,h.finishedLanes=C,m){case 0:case 1:throw Error(o(345));case 2:Ga(h,Gn,qo);break;case 3:if(kc(h,C),(C&130023424)===C&&(m=Qv+500-Bn(),10<m)){if(af(h,0)!==0)break;if(x=h.suspendedLanes,(x&C)!==C){Xi(),h.pingedLanes|=h.suspendedLanes&x;break}h.timeoutHandle=nv(Ga.bind(null,h,Gn,qo),m);break}Ga(h,Gn,qo);break;case 4:if(kc(h,C),(C&4194240)===C)break;for(m=h.eventTimes,x=-1;0<C;){var ee=31-uo(C);B=1<<ee,ee=m[ee],ee>x&&(x=ee),C&=~B}if(C=x,C=Bn()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*nO(C/1960))-C,10<C){h.timeoutHandle=nv(Ga.bind(null,h,Gn,qo),C);break}Ga(h,Gn,qo);break;case 5:Ga(h,Gn,qo);break;default:throw Error(o(329))}}}return Li(h,Bn()),h.callbackNode===S?bb.bind(null,h):null}function Fh(h,m){var S=kl;return h.current.memoizedState.isDehydrated&&(Ms(h,m).flags|=256),h=Wh(h,m),h!==2&&(m=Gn,Gn=S,m!==null&&ty(m)),h}function ty(h){Gn===null?Gn=h:Gn.push.apply(Gn,h)}function Tb(h){for(var m=h;;){if(m.flags&16384){var S=m.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var C=0;C<S.length;C++){var x=S[C],B=x.getSnapshot;x=x.value;try{if(!ho(B(),x))return!1}catch{return!1}}}if(S=m.child,m.subtreeFlags&16384&&S!==null)S.return=m,m=S;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function kc(h,m){for(m&=~Jv,m&=~tm,h.suspendedLanes|=m,h.pingedLanes&=~m,h=h.expirationTimes;0<m;){var S=31-uo(m),C=1<<S;h[S]=-1,m&=~C}}function nm(h){if((mr&6)!==0)throw Error(o(327));Mc();var m=af(h,0);if((m&1)===0)return Li(h,Bn()),null;var S=Wh(h,m);if(h.tag!==0&&S===2){var C=A_(h);C!==0&&(m=C,S=Fh(h,C))}if(S===1)throw S=nd,Ms(h,0),kc(h,m),Li(h,Bn()),S;if(S===6)throw Error(o(345));return h.finishedWork=h.current.alternate,h.finishedLanes=m,Ga(h,Gn,qo),Li(h,Bn()),null}function Ll(h,m){var S=mr;mr|=1;try{return h(m)}finally{mr=S,mr===0&&(Wa=Bn()+500,Rf&&wc())}}function Lc(h){Dc!==null&&Dc.tag===0&&(mr&6)===0&&Mc();var m=mr;mr|=1;var S=xi.transition,C=jr;try{if(xi.transition=null,jr=1,h)return h()}finally{jr=C,xi.transition=S,mr=m,(mr&6)===0&&wc()}}function Bh(){Ra=rd.current,tn(rd)}function Ms(h,m){h.finishedWork=null,h.finishedLanes=0;var S=h.timeoutHandle;if(S!==-1&&(h.timeoutHandle=-1,BA(S)),Ln!==null)for(S=Ln.return;S!==null;){var C=S;switch(Of(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&Tf();break;case 3:Al(),tn(zi),tn(Pi),Sv();break;case 5:yv(C);break;case 4:Al();break;case 13:tn(Rn);break;case 19:tn(Rn);break;case 10:fv(C.type._context);break;case 22:case 23:Bh()}S=S.return}if(ai=h,Ln=h=Uc(h.current,null),Jn=Ra=m,oi=0,nd=null,Jv=tm=xl=0,Gn=kl=null,Rl!==null){for(m=0;m<Rl.length;m++)if(S=Rl[m],C=S.interleaved,C!==null){S.interleaved=null;var x=C.next,B=S.pending;if(B!==null){var ee=B.next;B.next=x,C.next=ee}S.pending=C}Rl=null}return h}function ry(h,m){do{var S=Ln;try{if(pv(),Rh.current=ed,Ch){for(var C=En.memoizedState;C!==null;){var x=C.queue;x!==null&&(x.pending=null),C=C.next}Ch=!1}if(Ol=0,Wn=ii=En=null,Ds=!1,Ah=0,em.current=null,S===null||S.return===null){oi=1,nd=m,Ln=null;break}e:{var B=h,ee=S.return,le=S,ve=m;if(m=Jn,le.flags|=32768,ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var je=ve,tt=le,it=tt.tag;if((tt.mode&1)===0&&(it===0||it===11||it===15)){var et=tt.alternate;et?(tt.updateQueue=et.updateQueue,tt.memoizedState=et.memoizedState,tt.lanes=et.lanes):(tt.updateQueue=null,tt.memoizedState=null)}var vt=sb(ee);if(vt!==null){vt.flags&=-257,cb(vt,ee,le,B,m),vt.mode&1&&Lv(B,je,m),m=vt,ve=je;var Tt=m.updateQueue;if(Tt===null){var Ct=new Set;Ct.add(ve),m.updateQueue=Ct}else Tt.add(ve);break e}else{if((m&1)===0){Lv(B,je,m),ad();break e}ve=Error(o(426))}}else if(fn&&le.mode&1){var An=sb(ee);if(An!==null){(An.flags&65536)===0&&(An.flags|=256),cb(An,ee,le,B,m),Yu(td(ve,le));break e}}B=ve=td(ve,le),oi!==4&&(oi=2),kl===null?kl=[B]:kl.push(B),B=ee;do{switch(B.tag){case 3:B.flags|=65536,m&=-m,B.lanes|=m;var Ne=kv(B,ve,m);K0(B,Ne);break e;case 1:le=ve;var Se=B.type,xe=B.stateNode;if((B.flags&128)===0&&(typeof Se.getDerivedStateFromError=="function"||xe!==null&&typeof xe.componentDidCatch=="function"&&(Pc===null||!Pc.has(xe)))){B.flags|=65536,m&=-m,B.lanes|=m;var st=ob(B,le,m);K0(B,st);break e}}B=B.return}while(B!==null)}ay(S)}catch(Ot){m=Ot,Ln===S&&S!==null&&(Ln=S=S.return);continue}break}while(!0)}function ny(){var h=Nc.current;return Nc.current=ed,h===null?ed:h}function ad(){(oi===0||oi===3||oi===2)&&(oi=4),ai===null||(xl&268435455)===0&&(tm&268435455)===0||kc(ai,Jn)}function Wh(h,m){var S=mr;mr|=2;var C=ny();(ai!==h||Jn!==m)&&(qo=null,Ms(h,m));do try{iO();break}catch(x){ry(h,x)}while(!0);if(pv(),mr=S,Nc.current=C,Ln!==null)throw Error(o(261));return ai=null,Jn=0,oi}function iO(){for(;Ln!==null;)iy(Ln)}function aO(){for(;Ln!==null&&!aA();)iy(Ln)}function iy(h){var m=Cb(h.alternate,h,Ra);h.memoizedProps=h.pendingProps,m===null?ay(h):Ln=m,em.current=null}function ay(h){var m=h;do{var S=m.alternate;if(h=m.return,(m.flags&32768)===0){if(S=Jf(S,m,Ra),S!==null){Ln=S;return}}else{if(S=ZA(S,m),S!==null){S.flags&=32767,Ln=S;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{oi=6,Ln=null;return}}if(m=m.sibling,m!==null){Ln=m;return}Ln=m=h}while(m!==null);oi===0&&(oi=5)}function Ga(h,m,S){var C=jr,x=xi.transition;try{xi.transition=null,jr=1,oy(h,m,S,C)}finally{xi.transition=x,jr=C}return null}function oy(h,m,S,C){do Mc();while(Dc!==null);if((mr&6)!==0)throw Error(o(327));S=h.finishedWork;var x=h.finishedLanes;if(S===null)return null;if(h.finishedWork=null,h.finishedLanes=0,S===h.current)throw Error(o(177));h.callbackNode=null,h.callbackPriority=0;var B=S.lanes|S.childLanes;if(uA(h,B),h===ai&&(Ln=ai=null,Jn=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||Uh||(Uh=!0,sy(rf,function(){return Mc(),null})),B=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||B){B=xi.transition,xi.transition=null;var ee=jr;jr=1;var le=mr;mr|=4,em.current=null,tO(h,S),$v(S,h),MA(Ef),uf=!!rv,Ef=rv=null,h.current=S,rO(S),Uo(),mr=le,jr=ee,xi.transition=B}else h.current=S;if(Uh&&(Uh=!1,Dc=h,jh=x),B=h.pendingLanes,B===0&&(Pc=null),i0(S.stateNode),Li(h,Bn()),m!==null)for(C=h.onRecoverableError,S=0;S<m.length;S++)x=m[S],C(x.value,{componentStack:x.stack,digest:x.digest});if(ki)throw ki=!1,h=Zv,Zv=null,h;return(jh&1)!==0&&h.tag!==0&&Mc(),B=h.pendingLanes,(B&1)!==0?h===ey?id++:(id=0,ey=h):id=0,wc(),null}function Mc(){if(Dc!==null){var h=N_(jh),m=xi.transition,S=jr;try{if(xi.transition=null,jr=16>h?16:h,Dc===null)var C=!1;else{if(h=Dc,Dc=null,jh=0,(mr&6)!==0)throw Error(o(331));var x=mr;for(mr|=4,Et=h.current;Et!==null;){var B=Et,ee=B.child;if((Et.flags&16)!==0){var le=B.deletions;if(le!==null){for(var ve=0;ve<le.length;ve++){var je=le[ve];for(Et=je;Et!==null;){var tt=Et;switch(tt.tag){case 0:case 11:case 15:Oc(8,tt,B)}var it=tt.child;if(it!==null)it.return=tt,Et=it;else for(;Et!==null;){tt=Et;var et=tt.sibling,vt=tt.return;if(vb(tt),tt===je){Et=null;break}if(et!==null){et.return=vt,Et=et;break}Et=vt}}}var Tt=B.alternate;if(Tt!==null){var Ct=Tt.child;if(Ct!==null){Tt.child=null;do{var An=Ct.sibling;Ct.sibling=null,Ct=An}while(Ct!==null)}}Et=B}}if((B.subtreeFlags&2064)!==0&&ee!==null)ee.return=B,Et=ee;else e:for(;Et!==null;){if(B=Et,(B.flags&2048)!==0)switch(B.tag){case 0:case 11:case 15:Oc(9,B,B.return)}var Ne=B.sibling;if(Ne!==null){Ne.return=B.return,Et=Ne;break e}Et=B.return}}var Se=h.current;for(Et=Se;Et!==null;){ee=Et;var xe=ee.child;if((ee.subtreeFlags&2064)!==0&&xe!==null)xe.return=ee,Et=xe;else e:for(ee=Se;Et!==null;){if(le=Et,(le.flags&2048)!==0)try{switch(le.tag){case 0:case 11:case 15:Qf(9,le)}}catch(Ot){Cn(le,le.return,Ot)}if(le===ee){Et=null;break e}var st=le.sibling;if(st!==null){st.return=le.return,Et=st;break e}Et=le.return}}if(mr=x,wc(),jo&&typeof jo.onPostCommitFiberRoot=="function")try{jo.onPostCommitFiberRoot(Au,h)}catch{}C=!0}return C}finally{jr=S,xi.transition=m}}return!1}function im(h,m,S){m=td(S,m),m=kv(h,m,1),h=_o(h,m,1),m=Xi(),h!==null&&(Zd(h,1,m),Li(h,m))}function Cn(h,m,S){if(h.tag===3)im(h,h,S);else for(;m!==null;){if(m.tag===3){im(m,h,S);break}else if(m.tag===1){var C=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Pc===null||!Pc.has(C))){h=td(S,h),h=ob(m,h,1),m=_o(m,h,1),h=Xi(),m!==null&&(Zd(m,1,h),Li(m,h));break}}m=m.return}}function wb(h,m,S){var C=h.pingCache;C!==null&&C.delete(m),m=Xi(),h.pingedLanes|=h.suspendedLanes&S,ai===h&&(Jn&S)===S&&(oi===4||oi===3&&(Jn&130023424)===Jn&&500>Bn()-Qv?Ms(h,0):Jv|=S),Li(h,m)}function Rb(h,m){m===0&&((h.mode&1)===0?m=1:(m=nf,nf<<=1,(nf&130023424)===0&&(nf=4194304)));var S=Xi();h=Is(h,m),h!==null&&(Zd(h,m,S),Li(h,S))}function oO(h){var m=h.memoizedState,S=0;m!==null&&(S=m.retryLane),Rb(h,S)}function od(h,m){var S=0;switch(h.tag){case 13:var C=h.stateNode,x=h.memoizedState;x!==null&&(S=x.retryLane);break;case 19:C=h.stateNode;break;default:throw Error(o(314))}C!==null&&C.delete(m),Rb(h,S)}var Cb;Cb=function(h,m,S){if(h!==null)if(h.memoizedProps!==m.pendingProps||zi.current)ua=!0;else{if((h.lanes&S)===0&&(m.flags&128)===0)return ua=!1,$f(h,m,S);ua=(h.flags&131072)!==0}else ua=!1,fn&&(m.flags&1048576)!==0&&B0(m,Af,m.index);switch(m.lanes=0,m.tag){case 2:var C=m.type;zf(h,m),h=m.pendingProps;var x=Tc(m,Pi.current);go(m,S),x=Qu(null,m,C,h,x,S);var B=wv();return m.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,ca(C)?(B=!0,wf(m)):B=!1,m.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,_v(m),x.updater=Gf,m.stateNode=x,x._reactInternals=m,Pv(m,C,h,S),m=jv(null,m,C,!0,B,S)):(m.tag=0,fn&&B&&zu(m),Yi(null,m,x,S),m=m.child),m;case 16:C=m.elementType;e:{switch(zf(h,m),h=m.pendingProps,x=C._init,C=x(C._payload),m.type=C,x=m.tag=sO(C),h=Ba(C,h),x){case 0:m=Uv(null,m,C,h,S);break e;case 1:m=hb(null,m,C,h,S);break e;case 11:m=lb(null,m,C,h,S);break e;case 14:m=ub(null,m,C,Ba(C.type,h),S);break e}throw Error(o(306,C,""))}return m;case 0:return C=m.type,x=m.pendingProps,x=m.elementType===C?x:Ba(C,x),Uv(h,m,C,x,S);case 1:return C=m.type,x=m.pendingProps,x=m.elementType===C?x:Ba(C,x),hb(h,m,C,x,S);case 3:e:{if(pb(m),h===null)throw Error(o(387));C=m.pendingProps,B=m.memoizedState,x=B.element,q0(h,m),kf(m,C,null,S);var ee=m.memoizedState;if(C=ee.element,B.isDehydrated)if(B={element:C,isDehydrated:!1,cache:ee.cache,pendingSuspenseBoundaries:ee.pendingSuspenseBoundaries,transitions:ee.transitions},m.updateQueue.baseState=B,m.memoizedState=B,m.flags&256){x=td(Error(o(423)),m),m=fb(h,m,C,S,x);break e}else if(C!==x){x=td(Error(o(424)),m),m=fb(h,m,C,S,x);break e}else for(Ta=Fo(m.stateNode.containerInfo.firstChild),ba=m,fn=!0,mo=null,S=dv(m,null,C,S),m.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(wl(),C===x){m=Ls(h,m,S);break e}Yi(h,m,C,S)}m=m.child}return m;case 5:return $0(m),h===null&&Eh(m),C=m.type,x=m.pendingProps,B=h!==null?h.memoizedProps:null,ee=x.children,Gu(C,x)?ee=null:B!==null&&Gu(C,B)&&(m.flags|=32),db(h,m),Yi(h,m,ee,S),m.child;case 6:return h===null&&Eh(m),null;case 13:return mb(h,m,S);case 4:return vv(m,m.stateNode.containerInfo),C=m.pendingProps,h===null?m.child=Xu(m,null,C,S):Yi(h,m,C,S),m.child;case 11:return C=m.type,x=m.pendingProps,x=m.elementType===C?x:Ba(C,x),lb(h,m,C,x,S);case 7:return Yi(h,m,m.pendingProps,S),m.child;case 8:return Yi(h,m,m.pendingProps.children,S),m.child;case 12:return Yi(h,m,m.pendingProps.children,S),m.child;case 10:e:{if(C=m.type._context,x=m.pendingProps,B=m.memoizedProps,ee=x.value,ln(Nf,C._currentValue),C._currentValue=ee,B!==null)if(ho(B.value,ee)){if(B.children===x.children&&!zi.current){m=Ls(h,m,S);break e}}else for(B=m.child,B!==null&&(B.return=m);B!==null;){var le=B.dependencies;if(le!==null){ee=B.child;for(var ve=le.firstContext;ve!==null;){if(ve.context===C){if(B.tag===1){ve=Ps(-1,S&-S),ve.tag=2;var je=B.updateQueue;if(je!==null){je=je.shared;var tt=je.pending;tt===null?ve.next=ve:(ve.next=tt.next,tt.next=ve),je.pending=ve}}B.lanes|=S,ve=B.alternate,ve!==null&&(ve.lanes|=S),Df(B.return,S,m),le.lanes|=S;break}ve=ve.next}}else if(B.tag===10)ee=B.type===m.type?null:B.child;else if(B.tag===18){if(ee=B.return,ee===null)throw Error(o(341));ee.lanes|=S,le=ee.alternate,le!==null&&(le.lanes|=S),Df(ee,S,m),ee=B.sibling}else ee=B.child;if(ee!==null)ee.return=B;else for(ee=B;ee!==null;){if(ee===m){ee=null;break}if(B=ee.sibling,B!==null){B.return=ee.return,ee=B;break}ee=ee.return}B=ee}Yi(h,m,x.children,S),m=m.child}return m;case 9:return x=m.type,C=m.pendingProps.children,go(m,S),x=Fa(x),C=C(x),m.flags|=1,Yi(h,m,C,S),m.child;case 14:return C=m.type,x=Ba(C,m.pendingProps),x=Ba(C.type,x),ub(h,m,C,x,S);case 15:return Mv(h,m,m.type,m.pendingProps,S);case 17:return C=m.type,x=m.pendingProps,x=m.elementType===C?x:Ba(C,x),zf(h,m),m.tag=1,ca(C)?(h=!0,wf(m)):h=!1,go(m,S),ib(m,C,x),Pv(m,C,x,S),jv(null,m,C,!0,h,S);case 19:return Bv(h,m,S);case 22:return Go(h,m,S)}throw Error(o(156,m.tag))};function sy(h,m){return vl(h,m)}function cy(h,m,S,C){this.tag=h,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ha(h,m,S,C){return new cy(h,m,S,C)}function ly(h){return h=h.prototype,!(!h||!h.isReactComponent)}function sO(h){if(typeof h=="function")return ly(h)?1:0;if(h!=null){if(h=h.$$typeof,h===ye)return 11;if(h===ke)return 14}return 2}function Uc(h,m){var S=h.alternate;return S===null?(S=Ha(h.tag,m,h.key,h.mode),S.elementType=h.elementType,S.type=h.type,S.stateNode=h.stateNode,S.alternate=h,h.alternate=S):(S.pendingProps=m,S.type=h.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=h.flags&14680064,S.childLanes=h.childLanes,S.lanes=h.lanes,S.child=h.child,S.memoizedProps=h.memoizedProps,S.memoizedState=h.memoizedState,S.updateQueue=h.updateQueue,m=h.dependencies,S.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},S.sibling=h.sibling,S.index=h.index,S.ref=h.ref,S}function sd(h,m,S,C,x,B){var ee=2;if(C=h,typeof h=="function")ly(h)&&(ee=1);else if(typeof h=="string")ee=5;else e:switch(h){case ie:return jc(S.children,x,B,m);case de:ee=8,x|=8;break;case ge:return h=Ha(12,S,m,x|2),h.elementType=ge,h.lanes=B,h;case Ae:return h=Ha(13,S,m,x),h.elementType=Ae,h.lanes=B,h;case be:return h=Ha(19,S,m,x),h.elementType=be,h.lanes=B,h;case Ue:return Gh(S,x,B,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case Oe:ee=10;break e;case me:ee=9;break e;case ye:ee=11;break e;case ke:ee=14;break e;case Me:ee=16,C=null;break e}throw Error(o(130,h==null?h:typeof h,""))}return m=Ha(ee,S,m,x),m.elementType=h,m.type=C,m.lanes=B,m}function jc(h,m,S,C){return h=Ha(7,h,C,m),h.lanes=S,h}function Gh(h,m,S,C){return h=Ha(22,h,C,m),h.elementType=Ue,h.lanes=S,h.stateNode={isHidden:!1},h}function am(h,m,S){return h=Ha(6,h,null,m),h.lanes=S,h}function cd(h,m,S){return m=Ha(4,h.children!==null?h.children:[],h.key,m),m.lanes=S,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function uy(h,m,S,C,x){this.tag=m,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=O_(0),this.expirationTimes=O_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=O_(0),this.identifierPrefix=C,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function ld(h,m,S,C,x,B,ee,le,ve){return h=new uy(h,m,S,le,ve),m===1?(m=1,B===!0&&(m|=8)):m=0,B=Ha(3,null,null,m),h.current=B,B.stateNode=h,B.memoizedState={element:C,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},_v(B),h}function om(h,m,S){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Z,key:C==null?null:""+C,children:h,containerInfo:m,implementation:S}}function dy(h){if(!h)return Sc;h=h._reactInternals;e:{if(_l(h)!==h||h.tag!==1)throw Error(o(170));var m=h;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(ca(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(o(171))}if(h.tag===1){var S=h.type;if(ca(S))return V0(h,S,m)}return m}function Ml(h,m,S,C,x,B,ee,le,ve){return h=ld(S,C,!0,h,x,B,ee,le,ve),h.context=dy(null),S=h.current,C=Xi(),x=xc(S),B=Ps(C,x),B.callback=m??null,_o(S,B,x),h.current.lanes=x,Zd(h,x,C),Li(h,C),h}function Ko(h,m,S,C){var x=m.current,B=Xi(),ee=xc(x);return S=dy(S),m.context===null?m.context=S:m.pendingContext=S,m=Ps(B,ee),m.payload={element:h},C=C===void 0?null:C,C!==null&&(m.callback=C),h=_o(x,m,ee),h!==null&&(Ca(h,x,ee,B),xf(h,x,ee)),ee}function sm(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function ud(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var S=h.retryLane;h.retryLane=S!==0&&S<m?S:m}}function hy(h,m){ud(h,m),(h=h.alternate)&&ud(h,m)}function cO(){return null}var Ab=typeof reportError=="function"?reportError:function(h){console.error(h)};function py(h){this._internalRoot=h}Hh.prototype.render=py.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(o(409));Ko(h,m,null,null)},Hh.prototype.unmount=py.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;Lc(function(){Ko(null,h,null,null)}),m[ws]=null}};function Hh(h){this._internalRoot=h}Hh.prototype.unstable_scheduleHydration=function(h){if(h){var m=c0();h={blockedOn:null,target:h,priority:m};for(var S=0;S<fc.length&&m!==0&&m<fc[S].priority;S++);fc.splice(S,0,h),S===0&&Nu(h)}};function qh(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function Kh(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function Ob(){}function Ib(h,m,S,C,x){if(x){if(typeof C=="function"){var B=C;C=function(){var je=sm(ee);B.call(je)}}var ee=Ml(m,C,h,0,null,!1,!1,"",Ob);return h._reactRootContainer=ee,h[ws]=ee.current,Ts(h.nodeType===8?h.parentNode:h),Lc(),ee}for(;x=h.lastChild;)h.removeChild(x);if(typeof C=="function"){var le=C;C=function(){var je=sm(ve);le.call(je)}}var ve=ld(h,0,!1,null,null,!1,!1,"",Ob);return h._reactRootContainer=ve,h[ws]=ve.current,Ts(h.nodeType===8?h.parentNode:h),Lc(function(){Ko(m,ve,S,C)}),ve}function cm(h,m,S,C,x){var B=S._reactRootContainer;if(B){var ee=B;if(typeof x=="function"){var le=x;x=function(){var ve=sm(ee);le.call(ve)}}Ko(m,ee,h,x)}else ee=Ib(S,m,h,x,C);return sm(ee)}of=function(h){switch(h.tag){case 3:var m=h.stateNode;if(m.current.memoizedState.isDehydrated){var S=Ur(m.pendingLanes);S!==0&&(I_(m,S|1),Li(m,Bn()),(mr&6)===0&&(Wa=Bn()+500,wc()))}break;case 13:Lc(function(){var C=Is(h,1);if(C!==null){var x=Xi();Ca(C,h,1,x)}}),hy(h,1)}},P_=function(h){if(h.tag===13){var m=Is(h,134217728);if(m!==null){var S=Xi();Ca(m,h,134217728,S)}hy(h,134217728)}},sf=function(h){if(h.tag===13){var m=xc(h),S=Is(h,m);if(S!==null){var C=Xi();Ca(S,h,m,C)}hy(h,m)}},c0=function(){return jr},D_=function(h,m){var S=jr;try{return jr=h,m()}finally{jr=S}},S_=function(h,m,S){switch(m){case"input":if(pi(h,S),m=S.name,S.type==="radio"&&m!=null){for(S=h;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<S.length;m++){var C=S[m];if(C!==h&&C.form===h.form){var x=bf(C);if(!x)throw Error(o(90));rt(C),pi(C,x)}}}break;case"textarea":Fn(h,S);break;case"select":m=S.value,m!=null&&Ni(h,!!S.multiple,m,!1)}},gl=Ll,YS=Lc;var zh={usingClientEntryPoint:!1,Events:[vh,Hu,bf,Ru,$S,Ll]},da={findFiberByHostInstance:Sl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Nb={bundleType:da.bundleType,version:da.version,rendererPackageName:da.rendererPackageName,rendererConfig:da.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:re.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=tf(h),h===null?null:h.stateNode},findFiberByHostInstance:da.findFiberByHostInstance||cO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lm.isDisabled&&lm.supportsFiber)try{Au=lm.inject(Nb),jo=lm}catch{}}return io.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zh,io.createPortal=function(h,m){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qh(m))throw Error(o(200));return om(h,m,null,S)},io.createRoot=function(h,m){if(!qh(h))throw Error(o(299));var S=!1,C="",x=Ab;return m!=null&&(m.unstable_strictMode===!0&&(S=!0),m.identifierPrefix!==void 0&&(C=m.identifierPrefix),m.onRecoverableError!==void 0&&(x=m.onRecoverableError)),m=ld(h,1,!1,null,null,S,!1,C,x),h[ws]=m.current,Ts(h.nodeType===8?h.parentNode:h),new py(m)},io.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(o(188)):(h=Object.keys(h).join(","),Error(o(268,h)));return h=tf(m),h=h===null?null:h.stateNode,h},io.flushSync=function(h){return Lc(h)},io.hydrate=function(h,m,S){if(!Kh(m))throw Error(o(200));return cm(null,h,m,!0,S)},io.hydrateRoot=function(h,m,S){if(!qh(h))throw Error(o(405));var C=S!=null&&S.hydratedSources||null,x=!1,B="",ee=Ab;if(S!=null&&(S.unstable_strictMode===!0&&(x=!0),S.identifierPrefix!==void 0&&(B=S.identifierPrefix),S.onRecoverableError!==void 0&&(ee=S.onRecoverableError)),m=Ml(m,null,h,1,S??null,x,!1,B,ee),h[ws]=m.current,Ts(h),C)for(h=0;h<C.length;h++)S=C[h],x=S._getVersion,x=x(S._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[S,x]:m.mutableSourceEagerHydrationData.push(S,x);return new Hh(m)},io.render=function(h,m,S){if(!Kh(m))throw Error(o(200));return cm(null,h,m,!1,S)},io.unmountComponentAtNode=function(h){if(!Kh(h))throw Error(o(40));return h._reactRootContainer?(Lc(function(){cm(null,null,h,!1,function(){h._reactRootContainer=null,h[ws]=null})}),!0):!1},io.unstable_batchedUpdates=Ll,io.unstable_renderSubtreeIntoContainer=function(h,m,S,C){if(!Kh(S))throw Error(o(200));if(h==null||h._reactInternals===void 0)throw Error(o(38));return cm(h,m,S,!1,C)},io.version="18.3.1-next-f1338f8080-20240426",io}var tH;function y7(){if(tH)return nD.exports;tH=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(n){console.error(n)}}return i(),nD.exports=ide(),nD.exports}var rH;function ade(){if(rH)return Jw;rH=1;var i=y7();return Jw.createRoot=i.createRoot,Jw.hydrateRoot=i.hydrateRoot,Jw}var ode=ade();const sde=i=>i instanceof Error?i.message+`
`+i.stack:JSON.stringify(i,null,2);class E7 extends ue.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}render(){return this.state.hasError?U.jsxs("div",{className:"p-4 border border-red-500 rounded",children:[U.jsx("h2",{className:"text-red-500",children:"Something went wrong."}),U.jsx("pre",{className:"mt-2 text-sm",children:sde(this.state.error)})]}):this.props.children}}y7();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $E(){return $E=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},$E.apply(this,arguments)}var Ud;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Ud||(Ud={}));const nH="popstate";function cde(i){i===void 0&&(i={});function n(s,u){let{pathname:f,search:_,hash:E}=s.location;return pL("",{pathname:f,search:_,hash:E},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function o(s,u){return typeof u=="string"?u:mR(u)}return ude(n,o,null,i)}function Xn(i,n){if(i===!1||i===null||typeof i>"u")throw new Error(n)}function S7(i,n){if(!i){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function lde(){return Math.random().toString(36).substr(2,8)}function iH(i,n){return{usr:i.state,key:i.key,idx:n}}function pL(i,n,o,s){return o===void 0&&(o=null),$E({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof n=="string"?n_(n):n,{state:o,key:n&&n.key||s||lde()})}function mR(i){let{pathname:n="/",search:o="",hash:s=""}=i;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function n_(i){let n={};if(i){let o=i.indexOf("#");o>=0&&(n.hash=i.substr(o),i=i.substr(0,o));let s=i.indexOf("?");s>=0&&(n.search=i.substr(s),i=i.substr(0,s)),i&&(n.pathname=i)}return n}function ude(i,n,o,s){s===void 0&&(s={});let{window:u=document.defaultView,v5Compat:f=!1}=s,_=u.history,E=Ud.Pop,T=null,w=I();w==null&&(w=0,_.replaceState($E({},_.state,{idx:w}),""));function I(){return(_.state||{idx:null}).idx}function A(){E=Ud.Pop;let M=I(),X=M==null?null:M-w;w=M,T&&T({action:E,location:F.location,delta:X})}function P(M,X){E=Ud.Push;let Y=pL(F.location,M,X);w=I()+1;let J=iH(Y,w),re=F.createHref(Y);try{_.pushState(J,"",re)}catch(z){if(z instanceof DOMException&&z.name==="DataCloneError")throw z;u.location.assign(re)}f&&T&&T({action:E,location:F.location,delta:1})}function j(M,X){E=Ud.Replace;let Y=pL(F.location,M,X);w=I();let J=iH(Y,w),re=F.createHref(Y);_.replaceState(J,"",re),f&&T&&T({action:E,location:F.location,delta:0})}function W(M){let X=u.location.origin!=="null"?u.location.origin:u.location.href,Y=typeof M=="string"?M:mR(M);return Y=Y.replace(/ $/,"%20"),Xn(X,"No window.location.(origin|href) available to create URL for href: "+Y),new URL(Y,X)}let F={get action(){return E},get location(){return i(u,_)},listen(M){if(T)throw new Error("A history only accepts one active listener");return u.addEventListener(nH,A),T=M,()=>{u.removeEventListener(nH,A),T=null}},createHref(M){return n(u,M)},createURL:W,encodeLocation(M){let X=W(M);return{pathname:X.pathname,search:X.search,hash:X.hash}},push:P,replace:j,go(M){return _.go(M)}};return F}var aH;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(aH||(aH={}));function dde(i,n,o){return o===void 0&&(o="/"),hde(i,n,o)}function hde(i,n,o,s){let u=typeof n=="string"?n_(n):n,f=Ig(u.pathname||"/",o);if(f==null)return null;let _=b7(i);pde(_);let E=null;for(let T=0;E==null&&T<_.length;++T){let w=wde(f);E=bde(_[T],w)}return E}function b7(i,n,o,s){n===void 0&&(n=[]),o===void 0&&(o=[]),s===void 0&&(s="");let u=(f,_,E)=>{let T={relativePath:E===void 0?f.path||"":E,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};T.relativePath.startsWith("/")&&(Xn(T.relativePath.startsWith(s),'Absolute route path "'+T.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),T.relativePath=T.relativePath.slice(s.length));let w=Vd([s,T.relativePath]),I=o.concat(T);f.children&&f.children.length>0&&(Xn(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),b7(f.children,n,I,w)),!(f.path==null&&!f.index)&&n.push({path:w,score:Ede(w,f.index),routesMeta:I})};return i.forEach((f,_)=>{var E;if(f.path===""||!((E=f.path)!=null&&E.includes("?")))u(f,_);else for(let T of T7(f.path))u(f,_,T)}),n}function T7(i){let n=i.split("/");if(n.length===0)return[];let[o,...s]=n,u=o.endsWith("?"),f=o.replace(/\?$/,"");if(s.length===0)return u?[f,""]:[f];let _=T7(s.join("/")),E=[];return E.push(..._.map(T=>T===""?f:[f,T].join("/"))),u&&E.push(..._),E.map(T=>i.startsWith("/")&&T===""?"/":T)}function pde(i){i.sort((n,o)=>n.score!==o.score?o.score-n.score:Sde(n.routesMeta.map(s=>s.childrenIndex),o.routesMeta.map(s=>s.childrenIndex)))}const fde=/^:[\w-]+$/,mde=3,gde=2,_de=1,vde=10,yde=-2,oH=i=>i==="*";function Ede(i,n){let o=i.split("/"),s=o.length;return o.some(oH)&&(s+=yde),n&&(s+=gde),o.filter(u=>!oH(u)).reduce((u,f)=>u+(fde.test(f)?mde:f===""?_de:vde),s)}function Sde(i,n){return i.length===n.length&&i.slice(0,-1).every((s,u)=>s===n[u])?i[i.length-1]-n[n.length-1]:0}function bde(i,n,o){let{routesMeta:s}=i,u={},f="/",_=[];for(let E=0;E<s.length;++E){let T=s[E],w=E===s.length-1,I=f==="/"?n:n.slice(f.length)||"/",A=fL({path:T.relativePath,caseSensitive:T.caseSensitive,end:w},I),P=T.route;if(!A)return null;Object.assign(u,A.params),_.push({params:u,pathname:Vd([f,A.pathname]),pathnameBase:Ode(Vd([f,A.pathnameBase])),route:P}),A.pathnameBase!=="/"&&(f=Vd([f,A.pathnameBase]))}return _}function fL(i,n){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[o,s]=Tde(i.path,i.caseSensitive,i.end),u=n.match(o);if(!u)return null;let f=u[0],_=f.replace(/(.)\/+$/,"$1"),E=u.slice(1);return{params:s.reduce((w,I,A)=>{let{paramName:P,isOptional:j}=I;if(P==="*"){let F=E[A]||"";_=f.slice(0,f.length-F.length).replace(/(.)\/+$/,"$1")}const W=E[A];return j&&!W?w[P]=void 0:w[P]=(W||"").replace(/%2F/g,"/"),w},{}),pathname:f,pathnameBase:_,pattern:i}}function Tde(i,n,o){n===void 0&&(n=!1),o===void 0&&(o=!0),S7(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let s=[],u="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,E,T)=>(s.push({paramName:E,isOptional:T!=null}),T?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(s.push({paramName:"*"}),u+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?u+="\\/*$":i!==""&&i!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,n?void 0:"i"),s]}function wde(i){try{return i.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return S7(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),i}}function Ig(i,n){if(n==="/")return i;if(!i.toLowerCase().startsWith(n.toLowerCase()))return null;let o=n.endsWith("/")?n.length-1:n.length,s=i.charAt(o);return s&&s!=="/"?null:i.slice(o)||"/"}function Rde(i,n){n===void 0&&(n="/");let{pathname:o,search:s="",hash:u=""}=typeof i=="string"?n_(i):i;return{pathname:o?o.startsWith("/")?o:Cde(o,n):n,search:Ide(s),hash:Nde(u)}}function Cde(i,n){let o=n.replace(/\/+$/,"").split("/");return i.split("/").forEach(u=>{u===".."?o.length>1&&o.pop():u!=="."&&o.push(u)}),o.length>1?o.join("/"):"/"}function oD(i,n,o,s){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ade(i){return i.filter((n,o)=>o===0||n.route.path&&n.route.path.length>0)}function HM(i,n){let o=Ade(i);return n?o.map((s,u)=>u===o.length-1?s.pathname:s.pathnameBase):o.map(s=>s.pathnameBase)}function qM(i,n,o,s){s===void 0&&(s=!1);let u;typeof i=="string"?u=n_(i):(u=$E({},i),Xn(!u.pathname||!u.pathname.includes("?"),oD("?","pathname","search",u)),Xn(!u.pathname||!u.pathname.includes("#"),oD("#","pathname","hash",u)),Xn(!u.search||!u.search.includes("#"),oD("#","search","hash",u)));let f=i===""||u.pathname==="",_=f?"/":u.pathname,E;if(_==null)E=o;else{let A=n.length-1;if(!s&&_.startsWith("..")){let P=_.split("/");for(;P[0]==="..";)P.shift(),A-=1;u.pathname=P.join("/")}E=A>=0?n[A]:"/"}let T=Rde(u,E),w=_&&_!=="/"&&_.endsWith("/"),I=(f||_===".")&&o.endsWith("/");return!T.pathname.endsWith("/")&&(w||I)&&(T.pathname+="/"),T}const Vd=i=>i.join("/").replace(/\/\/+/g,"/"),Ode=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),Ide=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,Nde=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function Pde(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const w7=["post","put","patch","delete"];new Set(w7);const Dde=["get",...w7];new Set(Dde);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function YE(){return YE=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},YE.apply(this,arguments)}const vC=Ee.createContext(null),R7=Ee.createContext(null),mu=Ee.createContext(null),yC=Ee.createContext(null),hl=Ee.createContext({outlet:null,matches:[],isDataRoute:!1}),C7=Ee.createContext(null);function xde(i,n){let{relative:o}=n===void 0?{}:n;i_()||Xn(!1);let{basename:s,navigator:u}=Ee.useContext(mu),{hash:f,pathname:_,search:E}=EC(i,{relative:o}),T=_;return s!=="/"&&(T=_==="/"?s:Vd([s,_])),u.createHref({pathname:T,search:E,hash:f})}function i_(){return Ee.useContext(yC)!=null}function a_(){return i_()||Xn(!1),Ee.useContext(yC).location}function A7(i){Ee.useContext(mu).static||Ee.useLayoutEffect(i)}function O7(){let{isDataRoute:i}=Ee.useContext(hl);return i?Yde():kde()}function kde(){i_()||Xn(!1);let i=Ee.useContext(vC),{basename:n,future:o,navigator:s}=Ee.useContext(mu),{matches:u}=Ee.useContext(hl),{pathname:f}=a_(),_=JSON.stringify(HM(u,o.v7_relativeSplatPath)),E=Ee.useRef(!1);return A7(()=>{E.current=!0}),Ee.useCallback(function(w,I){if(I===void 0&&(I={}),!E.current)return;if(typeof w=="number"){s.go(w);return}let A=qM(w,JSON.parse(_),f,I.relative==="path");i==null&&n!=="/"&&(A.pathname=A.pathname==="/"?n:Vd([n,A.pathname])),(I.replace?s.replace:s.push)(A,I.state,I)},[n,s,_,f,i])}const Lde=Ee.createContext(null);function Mde(i){let n=Ee.useContext(hl).outlet;return n&&Ee.createElement(Lde.Provider,{value:i},n)}function Ude(){let{matches:i}=Ee.useContext(hl),n=i[i.length-1];return n?n.params:{}}function EC(i,n){let{relative:o}=n===void 0?{}:n,{future:s}=Ee.useContext(mu),{matches:u}=Ee.useContext(hl),{pathname:f}=a_(),_=JSON.stringify(HM(u,s.v7_relativeSplatPath));return Ee.useMemo(()=>qM(i,JSON.parse(_),f,o==="path"),[i,_,f,o])}function jde(i,n){return Vde(i,n)}function Vde(i,n,o,s){i_()||Xn(!1);let{navigator:u,static:f}=Ee.useContext(mu),{matches:_}=Ee.useContext(hl),E=_[_.length-1],T=E?E.params:{};E&&E.pathname;let w=E?E.pathnameBase:"/";E&&E.route;let I=a_(),A;if(n){var P;let X=typeof n=="string"?n_(n):n;w==="/"||(P=X.pathname)!=null&&P.startsWith(w)||Xn(!1),A=X}else A=I;let j=A.pathname||"/",W=j;if(w!=="/"){let X=w.replace(/^\//,"").split("/");W="/"+j.replace(/^\//,"").split("/").slice(X.length).join("/")}let F=dde(i,{pathname:W}),M=Hde(F&&F.map(X=>Object.assign({},X,{params:Object.assign({},T,X.params),pathname:Vd([w,u.encodeLocation?u.encodeLocation(X.pathname).pathname:X.pathname]),pathnameBase:X.pathnameBase==="/"?w:Vd([w,u.encodeLocation?u.encodeLocation(X.pathnameBase).pathname:X.pathnameBase])})),_,o,s);return n&&M?Ee.createElement(yC.Provider,{value:{location:YE({pathname:"/",search:"",hash:"",state:null,key:"default"},A),navigationType:Ud.Pop}},M):M}function Fde(){let i=$de(),n=Pde(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),o=i instanceof Error?i.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Ee.createElement(Ee.Fragment,null,Ee.createElement("h2",null,"Unexpected Application Error!"),Ee.createElement("h3",{style:{fontStyle:"italic"}},n),o?Ee.createElement("pre",{style:u},o):null,null)}const Bde=Ee.createElement(Fde,null);class Wde extends Ee.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,o){return o.location!==n.location||o.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:o.error,location:o.location,revalidation:n.revalidation||o.revalidation}}componentDidCatch(n,o){console.error("React Router caught the following error during render",n,o)}render(){return this.state.error!==void 0?Ee.createElement(hl.Provider,{value:this.props.routeContext},Ee.createElement(C7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Gde(i){let{routeContext:n,match:o,children:s}=i,u=Ee.useContext(vC);return u&&u.static&&u.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=o.route.id),Ee.createElement(hl.Provider,{value:n},s)}function Hde(i,n,o,s){var u;if(n===void 0&&(n=[]),o===void 0&&(o=null),s===void 0&&(s=null),i==null){var f;if(!o)return null;if(o.errors)i=o.matches;else if((f=s)!=null&&f.v7_partialHydration&&n.length===0&&!o.initialized&&o.matches.length>0)i=o.matches;else return null}let _=i,E=(u=o)==null?void 0:u.errors;if(E!=null){let I=_.findIndex(A=>A.route.id&&(E==null?void 0:E[A.route.id])!==void 0);I>=0||Xn(!1),_=_.slice(0,Math.min(_.length,I+1))}let T=!1,w=-1;if(o&&s&&s.v7_partialHydration)for(let I=0;I<_.length;I++){let A=_[I];if((A.route.HydrateFallback||A.route.hydrateFallbackElement)&&(w=I),A.route.id){let{loaderData:P,errors:j}=o,W=A.route.loader&&P[A.route.id]===void 0&&(!j||j[A.route.id]===void 0);if(A.route.lazy||W){T=!0,w>=0?_=_.slice(0,w+1):_=[_[0]];break}}}return _.reduceRight((I,A,P)=>{let j,W=!1,F=null,M=null;o&&(j=E&&A.route.id?E[A.route.id]:void 0,F=A.route.errorElement||Bde,T&&(w<0&&P===0?(Xde("route-fallback"),W=!0,M=null):w===P&&(W=!0,M=A.route.hydrateFallbackElement||null)));let X=n.concat(_.slice(0,P+1)),Y=()=>{let J;return j?J=F:W?J=M:A.route.Component?J=Ee.createElement(A.route.Component,null):A.route.element?J=A.route.element:J=I,Ee.createElement(Gde,{match:A,routeContext:{outlet:I,matches:X,isDataRoute:o!=null},children:J})};return o&&(A.route.ErrorBoundary||A.route.errorElement||P===0)?Ee.createElement(Wde,{location:o.location,revalidation:o.revalidation,component:F,error:j,children:Y(),routeContext:{outlet:null,matches:X,isDataRoute:!0}}):Y()},null)}var I7=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(I7||{}),N7=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(N7||{});function qde(i){let n=Ee.useContext(vC);return n||Xn(!1),n}function Kde(i){let n=Ee.useContext(R7);return n||Xn(!1),n}function zde(i){let n=Ee.useContext(hl);return n||Xn(!1),n}function P7(i){let n=zde(),o=n.matches[n.matches.length-1];return o.route.id||Xn(!1),o.route.id}function $de(){var i;let n=Ee.useContext(C7),o=Kde(),s=P7();return n!==void 0?n:(i=o.errors)==null?void 0:i[s]}function Yde(){let{router:i}=qde(I7.UseNavigateStable),n=P7(N7.UseNavigateStable),o=Ee.useRef(!1);return A7(()=>{o.current=!0}),Ee.useCallback(function(u,f){f===void 0&&(f={}),o.current&&(typeof u=="number"?i.navigate(u):i.navigate(u,YE({fromRouteId:n},f)))},[i,n])}const sH={};function Xde(i,n,o){sH[i]||(sH[i]=!0)}function Jde(i,n){i==null||i.v7_startTransition,i==null||i.v7_relativeSplatPath}function D7(i){let{to:n,replace:o,state:s,relative:u}=i;i_()||Xn(!1);let{future:f,static:_}=Ee.useContext(mu),{matches:E}=Ee.useContext(hl),{pathname:T}=a_(),w=O7(),I=qM(n,HM(E,f.v7_relativeSplatPath),T,u==="path"),A=JSON.stringify(I);return Ee.useEffect(()=>w(JSON.parse(A),{replace:o,state:s,relative:u}),[w,A,u,o,s]),null}function Qde(i){return Mde(i.context)}function al(i){Xn(!1)}function Zde(i){let{basename:n="/",children:o=null,location:s,navigationType:u=Ud.Pop,navigator:f,static:_=!1,future:E}=i;i_()&&Xn(!1);let T=n.replace(/^\/*/,"/"),w=Ee.useMemo(()=>({basename:T,navigator:f,static:_,future:YE({v7_relativeSplatPath:!1},E)}),[T,E,f,_]);typeof s=="string"&&(s=n_(s));let{pathname:I="/",search:A="",hash:P="",state:j=null,key:W="default"}=s,F=Ee.useMemo(()=>{let M=Ig(I,T);return M==null?null:{location:{pathname:M,search:A,hash:P,state:j,key:W},navigationType:u}},[T,I,A,P,j,W,u]);return F==null?null:Ee.createElement(mu.Provider,{value:w},Ee.createElement(yC.Provider,{children:o,value:F}))}function ehe(i){let{children:n,location:o}=i;return jde(mL(n),o)}new Promise(()=>{});function mL(i,n){n===void 0&&(n=[]);let o=[];return Ee.Children.forEach(i,(s,u)=>{if(!Ee.isValidElement(s))return;let f=[...n,u];if(s.type===Ee.Fragment){o.push.apply(o,mL(s.props.children,f));return}s.type!==al&&Xn(!1),!s.props.index||!s.props.children||Xn(!1);let _={id:s.props.id||f.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(_.children=mL(s.props.children,f)),o.push(_)}),o}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gR(){return gR=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},gR.apply(this,arguments)}function x7(i,n){if(i==null)return{};var o={},s=Object.keys(i),u,f;for(f=0;f<s.length;f++)u=s[f],!(n.indexOf(u)>=0)&&(o[u]=i[u]);return o}function the(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function rhe(i,n){return i.button===0&&(!n||n==="_self")&&!the(i)}const nhe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ihe=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],ahe="6";try{window.__reactRouterVersion=ahe}catch{}const ohe=Ee.createContext({isTransitioning:!1}),she="startTransition",cH=tde[she];function che(i){let{basename:n,children:o,future:s,window:u}=i,f=Ee.useRef();f.current==null&&(f.current=cde({window:u,v5Compat:!0}));let _=f.current,[E,T]=Ee.useState({action:_.action,location:_.location}),{v7_startTransition:w}=s||{},I=Ee.useCallback(A=>{w&&cH?cH(()=>T(A)):T(A)},[T,w]);return Ee.useLayoutEffect(()=>_.listen(I),[_,I]),Ee.useEffect(()=>Jde(s),[s]),Ee.createElement(Zde,{basename:n,children:o,location:E.location,navigationType:E.action,navigator:_,future:s})}const lhe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",uhe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,SC=Ee.forwardRef(function(n,o){let{onClick:s,relative:u,reloadDocument:f,replace:_,state:E,target:T,to:w,preventScrollReset:I,viewTransition:A}=n,P=x7(n,nhe),{basename:j}=Ee.useContext(mu),W,F=!1;if(typeof w=="string"&&uhe.test(w)&&(W=w,lhe))try{let J=new URL(window.location.href),re=w.startsWith("//")?new URL(J.protocol+w):new URL(w),z=Ig(re.pathname,j);re.origin===J.origin&&z!=null?w=z+re.search+re.hash:F=!0}catch{}let M=xde(w,{relative:u}),X=phe(w,{replace:_,state:E,target:T,preventScrollReset:I,relative:u,viewTransition:A});function Y(J){s&&s(J),J.defaultPrevented||X(J)}return Ee.createElement("a",gR({},P,{href:W||M,onClick:F||f?s:Y,ref:o,target:T}))}),dhe=Ee.forwardRef(function(n,o){let{"aria-current":s="page",caseSensitive:u=!1,className:f="",end:_=!1,style:E,to:T,viewTransition:w,children:I}=n,A=x7(n,ihe),P=EC(T,{relative:A.relative}),j=a_(),W=Ee.useContext(R7),{navigator:F,basename:M}=Ee.useContext(mu),X=W!=null&&fhe(P)&&w===!0,Y=F.encodeLocation?F.encodeLocation(P).pathname:P.pathname,J=j.pathname,re=W&&W.navigation&&W.navigation.location?W.navigation.location.pathname:null;u||(J=J.toLowerCase(),re=re?re.toLowerCase():null,Y=Y.toLowerCase()),re&&M&&(re=Ig(re,M)||re);const z=Y!=="/"&&Y.endsWith("/")?Y.length-1:Y.length;let Z=J===Y||!_&&J.startsWith(Y)&&J.charAt(z)==="/",ie=re!=null&&(re===Y||!_&&re.startsWith(Y)&&re.charAt(Y.length)==="/"),de={isActive:Z,isPending:ie,isTransitioning:X},ge=Z?s:void 0,Oe;typeof f=="function"?Oe=f(de):Oe=[f,Z?"active":null,ie?"pending":null,X?"transitioning":null].filter(Boolean).join(" ");let me=typeof E=="function"?E(de):E;return Ee.createElement(SC,gR({},A,{"aria-current":ge,className:Oe,ref:o,style:me,to:T,viewTransition:w}),typeof I=="function"?I(de):I)});var gL;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(gL||(gL={}));var lH;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(lH||(lH={}));function hhe(i){let n=Ee.useContext(vC);return n||Xn(!1),n}function phe(i,n){let{target:o,replace:s,state:u,preventScrollReset:f,relative:_,viewTransition:E}=n===void 0?{}:n,T=O7(),w=a_(),I=EC(i,{relative:_});return Ee.useCallback(A=>{if(rhe(A,o)){A.preventDefault();let P=s!==void 0?s:mR(w)===mR(I);T(i,{replace:P,state:u,preventScrollReset:f,relative:_,viewTransition:E})}},[w,T,I,s,u,o,i,f,_,E])}function fhe(i,n){n===void 0&&(n={});let o=Ee.useContext(ohe);o==null&&Xn(!1);let{basename:s}=hhe(gL.useViewTransitionState),u=EC(i,{relative:n.relative});if(!o.isTransitioning)return!1;let f=Ig(o.currentLocation.pathname,s)||o.currentLocation.pathname,_=Ig(o.nextLocation.pathname,s)||o.nextLocation.pathname;return fL(u.pathname,_)!=null||fL(u.pathname,f)!=null}const uH=i=>{let n;const o=new Set,s=(w,I)=>{const A=typeof w=="function"?w(n):w;if(!Object.is(A,n)){const P=n;n=I??(typeof A!="object"||A===null)?A:Object.assign({},n,A),o.forEach(j=>j(n,P))}},u=()=>n,E={setState:s,getState:u,getInitialState:()=>T,subscribe:w=>(o.add(w),()=>o.delete(w))},T=n=i(s,u,E);return E},mhe=i=>i?uH(i):uH,ghe=i=>i;function _he(i,n=ghe){const o=ue.useSyncExternalStore(i.subscribe,()=>n(i.getState()),()=>n(i.getInitialState()));return ue.useDebugValue(o),o}const vhe=i=>{const n=mhe(i),o=s=>_he(n,s);return Object.assign(o,n),o},yhe=i=>vhe;function Ehe(i,n){let o;try{o=i()}catch{return}return{getItem:u=>{var f;const _=T=>T===null?null:JSON.parse(T,void 0),E=(f=o.getItem(u))!=null?f:null;return E instanceof Promise?E.then(_):_(E)},setItem:(u,f)=>o.setItem(u,JSON.stringify(f,void 0)),removeItem:u=>o.removeItem(u)}}const _L=i=>n=>{try{const o=i(n);return o instanceof Promise?o:{then(s){return _L(s)(o)},catch(s){return this}}}catch(o){return{then(s){return this},catch(s){return _L(s)(o)}}}},She=(i,n)=>(o,s,u)=>{let f={storage:Ehe(()=>localStorage),partialize:F=>F,version:0,merge:(F,M)=>({...M,...F}),...n},_=!1;const E=new Set,T=new Set;let w=f.storage;if(!w)return i((...F)=>{console.warn(`[zustand persist middleware] Unable to update item '${f.name}', the given storage is currently unavailable.`),o(...F)},s,u);const I=()=>{const F=f.partialize({...s()});return w.setItem(f.name,{state:F,version:f.version})},A=u.setState;u.setState=(F,M)=>{A(F,M),I()};const P=i((...F)=>{o(...F),I()},s,u);u.getInitialState=()=>P;let j;const W=()=>{var F,M;if(!w)return;_=!1,E.forEach(Y=>{var J;return Y((J=s())!=null?J:P)});const X=((M=f.onRehydrateStorage)==null?void 0:M.call(f,(F=s())!=null?F:P))||void 0;return _L(w.getItem.bind(w))(f.name).then(Y=>{if(Y)if(typeof Y.version=="number"&&Y.version!==f.version){if(f.migrate){const J=f.migrate(Y.state,Y.version);return J instanceof Promise?J.then(re=>[!0,re]):[!0,J]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,Y.state];return[!1,void 0]}).then(Y=>{var J;const[re,z]=Y;if(j=f.merge(z,(J=s())!=null?J:P),o(j,!0),re)return I()}).then(()=>{X==null||X(j,void 0),j=s(),_=!0,T.forEach(Y=>Y(j))}).catch(Y=>{X==null||X(void 0,Y)})};return u.persist={setOptions:F=>{f={...f,...F},F.storage&&(w=F.storage)},clearStorage:()=>{w==null||w.removeItem(f.name)},getOptions:()=>f,rehydrate:()=>W(),hasHydrated:()=>_,onHydrate:F=>(E.add(F),()=>{E.delete(F)}),onFinishHydration:F=>(T.add(F),()=>{T.delete(F)})},f.skipHydration||W(),j||P},bhe=She,The="d83b679bc7b3406c83f63864cb74aa99",_s={LOGIN:"/login",HOME:"/",HISTORY:"/history",CHAT:"/chat",FAMILY_SUMMARY:"/family-summary",DOCTOR:"/doctor"},whe={USER_PROFILE:"medjourney_user_profile"},Rhe={AGORA_CHANNEL_PREFIX:"medjourney_"},Gd=yhe()(bhe((i,n)=>({user:null,sessionState:{isConnected:!1,isRecording:!1,isProcessing:!1,isPlaying:!1},healthScore:null,messages:[],isLoading:!1,error:null,setUser:o=>i({user:o}),setSessionState:o=>i(s=>({sessionState:{...s.sessionState,...o}})),setHealthScore:o=>i({healthScore:o}),addMessage:o=>i(s=>({messages:[...s.messages,o]})),clearMessages:()=>i({messages:[]}),setIsLoading:o=>i({isLoading:o}),setError:o=>i({error:o})}),{name:whe.USER_PROFILE,partialize:i=>({user:i.user,healthScore:i.healthScore})}));/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Che={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ahe=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=(i,n)=>{const o=Ee.forwardRef(({color:s="currentColor",size:u=24,strokeWidth:f=2,absoluteStrokeWidth:_,className:E="",children:T,...w},I)=>Ee.createElement("svg",{ref:I,...Che,width:u,height:u,stroke:s,strokeWidth:_?Number(f)*24/Number(u):f,className:["lucide",`lucide-${Ahe(i)}`,E].join(" "),...w},[...n.map(([A,P])=>Ee.createElement(A,P)),...Array.isArray(T)?T:[T]]));return o.displayName=`${i}`,o};/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ohe=Sr("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ihe=Sr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nhe=Sr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phe=Sr("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dhe=Sr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wp=Sr("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=Sr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k7=Sr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KM=Sr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L7=Sr("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _R=Sr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M7=Sr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sD=Sr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lu=Sr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vL=Sr("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xhe=Sr("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yL=Sr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qw=Sr("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const khe=Sr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lhe=Sr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EL=Sr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dH=Sr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mhe=Sr("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cD=Sr("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uhe=Sr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jhe=Sr("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vhe=Sr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hH=Sr("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fhe=Sr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U7=Sr("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bC=Sr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bhe=Sr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pH=Sr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j7=Sr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zM=Sr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lD=Sr("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Whe=Sr("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fH=Sr("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ghe=Sr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Hhe=()=>{const[i,n]=Ee.useState(""),[o,s]=Ee.useState(""),{user:u,setUser:f,setIsLoading:_,isLoading:E}=Gd();if(u)return U.jsx(D7,{to:_s.HOME,replace:!0});const T=w=>{if(w.preventDefault(),!i.trim()){alert("请输入您的姓名");return}_(!0),setTimeout(()=>{const I={id:Date.now().toString(),name:i.trim(),email:`${i.trim().toLowerCase()}@medjourney.com`,age:o?parseInt(o):void 0};f(I),_(!1)},1e3)};return U.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 flex items-center justify-center p-4",children:U.jsxs("div",{className:"max-w-md w-full",children:[U.jsxs("div",{className:"text-center mb-8",children:[U.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:U.jsx(lu,{className:"w-10 h-10 text-white"})}),U.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"MedJourney"}),U.jsx("p",{className:"text-lg text-gray-600",children:"智能医疗伴侣系统"}),U.jsx("p",{className:"text-gray-500 mt-2",children:"为 Alzheimer's 患者提供温暖的 AI 陪伴"})]}),U.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[U.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"欢迎使用"}),U.jsxs("form",{onSubmit:T,className:"space-y-6",children:[U.jsxs("div",{children:[U.jsxs("label",{htmlFor:"name",className:"flex items-center text-lg font-medium text-gray-700 mb-3",children:[U.jsx(j7,{className:"w-5 h-5 mr-2 text-blue-500"}),"您的姓名"]}),U.jsx("input",{type:"text",id:"name",value:i,onChange:w=>n(w.target.value),className:"w-full px-4 py-4 text-lg border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"请输入您的姓名",required:!0})]}),U.jsxs("div",{children:[U.jsxs("label",{htmlFor:"age",className:"flex items-center text-lg font-medium text-gray-700 mb-3",children:[U.jsx(khe,{className:"w-5 h-5 mr-2 text-green-500"}),"您的年龄（可选）"]}),U.jsx("input",{type:"number",id:"age",value:o,onChange:w=>s(w.target.value),className:"w-full px-4 py-4 text-lg border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",placeholder:"请输入您的年龄",min:"1",max:"120"})]}),U.jsx("button",{type:"submit",disabled:E,className:"w-full bg-gradient-to-r from-blue-500 to-green-500 text-white text-xl font-semibold py-4 px-6 rounded-xl hover:from-blue-600 hover:to-green-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:E?U.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"}):U.jsxs(U.Fragment,{children:["开始体验",U.jsx(Nhe,{className:"w-6 h-6 ml-2"})]})})]}),U.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[U.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"主要功能："}),U.jsxs("ul",{className:"space-y-2 text-gray-600",children:[U.jsxs("li",{className:"flex items-center",children:[U.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),"AI 语音陪伴对话"]}),U.jsxs("li",{className:"flex items-center",children:[U.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-3"}),"健康状态监测"]}),U.jsxs("li",{className:"flex items-center",children:[U.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full mr-3"}),"家属简报生成"]}),U.jsxs("li",{className:"flex items-center",children:[U.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-3"}),"医学数据分析"]})]})]})]}),U.jsxs("div",{className:"text-center mt-8 text-gray-500",children:[U.jsx("p",{children:"本系统专为 Alzheimer's 患者设计"}),U.jsx("p",{children:"使用前请咨询医生意见"})]})]})})},qhe=()=>{const{user:i,healthScore:n}=Gd(),o=[{id:1,type:"对话会话",time:"10 分钟前",description:"与 AI 助手进行了 15 分钟的语音对话",icon:EL,color:"text-blue-600 bg-blue-100"},{id:2,type:"健康评估",time:"2 小时前",description:"完成了认知功能评估测试",icon:Wp,color:"text-green-600 bg-green-100"},{id:3,type:"病史更新",time:"今天早上",description:"上传了新的检查报告",icon:vL,color:"text-purple-600 bg-purple-100"}],s=[{title:"开始 AI 对话",description:"与智能助手进行语音交流",href:_s.CHAT,icon:EL,gradient:"from-blue-500 to-purple-600",textColor:"text-blue-600"},{title:"更新病史",description:"上传新的医疗记录",href:_s.HISTORY,icon:vL,gradient:"from-green-500 to-teal-600",textColor:"text-green-600"},{title:"查看简报",description:"查看家属健康简报",href:_s.FAMILY_SUMMARY,icon:zM,gradient:"from-orange-500 to-red-600",textColor:"text-orange-600"},{title:"医生视图",description:"医疗专业数据分析",href:_s.DOCTOR,icon:U7,gradient:"from-pink-500 to-purple-600",textColor:"text-pink-600"}];return U.jsxs("div",{className:"space-y-8",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"主仪表板"}),U.jsxs("p",{className:"text-gray-600 mt-2",children:["欢迎回来，",i==null?void 0:i.name,"! 这里是您的健康中心。"]})]}),U.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[U.jsx(Ng,{className:"w-5 h-5"}),U.jsx("span",{children:new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})})]})]}),U.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"综合健康评分"}),U.jsxs("p",{className:"text-3xl font-bold text-green-600 mt-1",children:[(n==null?void 0:n.overall)||85,"/100"]})]}),U.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:U.jsx(lu,{className:"w-6 h-6 text-green-600"})})]}),U.jsxs("div",{className:"mt-4",children:[U.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[U.jsx("span",{children:"进度"}),U.jsxs("span",{children:[(n==null?void 0:n.overall)||85,"%"]})]}),U.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:U.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-500",style:{width:`${(n==null?void 0:n.overall)||85}%`}})})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"认知能力"}),U.jsxs("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:[(n==null?void 0:n.cognitive)||78,"/100"]})]}),U.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:U.jsx(Wp,{className:"w-6 h-6 text-blue-600"})})]}),U.jsxs("div",{className:"mt-4",children:[U.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[U.jsx("span",{children:"进度"}),U.jsxs("span",{children:[(n==null?void 0:n.cognitive)||78,"%"]})]}),U.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:U.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-500",style:{width:`${(n==null?void 0:n.cognitive)||78}%`}})})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"情绪状态"}),U.jsxs("p",{className:"text-3xl font-bold text-purple-600 mt-1",children:[(n==null?void 0:n.emotional)||92,"/100"]})]}),U.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:U.jsx(bC,{className:"w-6 h-6 text-purple-600"})})]}),U.jsxs("div",{className:"mt-4",children:[U.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[U.jsx("span",{children:"进度"}),U.jsxs("span",{children:[(n==null?void 0:n.emotional)||92,"%"]})]}),U.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:U.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-500",style:{width:`${(n==null?void 0:n.emotional)||92}%`}})})]})]})]}),U.jsxs("div",{children:[U.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"快速操作"}),U.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map(u=>{const f=u.icon;return U.jsxs(SC,{to:u.href,className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-200 hover:-translate-y-1 group",children:[U.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${u.gradient} rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform`,children:U.jsx(f,{className:"w-6 h-6 text-white"})}),U.jsx("h3",{className:`text-lg font-semibold ${u.textColor} mb-2`,children:u.title}),U.jsx("p",{className:"text-gray-600 text-sm",children:u.description})]},u.title)})})]}),U.jsxs("div",{children:[U.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"最近活动"}),U.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100",children:o.map((u,f)=>{const _=u.icon;return U.jsx("div",{className:`p-6 ${f!==o.length-1?"border-b border-gray-100":""}`,children:U.jsxs("div",{className:"flex items-start space-x-4",children:[U.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${u.color}`,children:U.jsx(_,{className:"w-6 h-6"})}),U.jsxs("div",{className:"flex-1",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u.type}),U.jsxs("div",{className:"flex items-center text-gray-500 text-sm",children:[U.jsx(_R,{className:"w-4 h-4 mr-1"}),U.jsx("span",{children:u.time})]})]}),U.jsx("p",{className:"text-gray-600 mt-1",children:u.description})]})]})},u.id)})})]})]})},Khe=()=>{var F;const{user:i,setIsLoading:n,isLoading:o}=Gd(),[s,u]=Ee.useState(""),[f,_]=Ee.useState([]),[E,T]=Ee.useState(!1),w=Ee.useCallback(M=>{Array.from(M).filter(Y=>{const J=Y.type.startsWith("image/"),re=Y.type==="application/pdf"||Y.type.includes("document");return J||re}).forEach(Y=>{const J={id:Date.now().toString()+Math.random().toString(36).substr(2,9),file:Y,type:Y.type.startsWith("image/")?"image":"document"};if(J.type==="image"){const re=new FileReader;re.onload=z=>{var Z;J.preview=(Z=z.target)==null?void 0:Z.result,_(ie=>[...ie,J])},re.readAsDataURL(Y)}else _(re=>[...re,J])})},[]),I=Ee.useCallback(M=>{M.preventDefault(),M.stopPropagation(),M.type==="dragenter"||M.type==="dragover"?T(!0):M.type==="dragleave"&&T(!1)},[]),A=Ee.useCallback(M=>{M.preventDefault(),M.stopPropagation(),T(!1),M.dataTransfer.files&&M.dataTransfer.files[0]&&w(M.dataTransfer.files)},[w]),P=M=>{M.target.files&&M.target.files[0]&&w(M.target.files)},j=M=>{_(X=>X.filter(Y=>Y.id!==M))},W=async()=>{if(!s.trim()&&f.length===0){alert("请输入病史信息或上传相关文件");return}n(!0);try{await new Promise(M=>setTimeout(M,2e3)),console.log("保存病史:",{medicalHistory:s,files:f}),alert("病史信息保存成功！"),u(""),_([])}catch{alert("保存失败，请重试")}finally{n(!1)}};return U.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"病史导入"}),U.jsx("p",{className:"text-gray-600 mt-2",children:"请上传您的医疗记录和相关文件，帮助 AI 更好地了解您的健康状况。"})]}),U.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[U.jsx(Ng,{className:"w-5 h-5"}),U.jsx("span",{children:new Date().toLocaleDateString("zh-CN")})]})]}),U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:((F=i==null?void 0:i.name)==null?void 0:F.charAt(0))||"U"}),U.jsxs("div",{children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i==null?void 0:i.name}),U.jsxs("p",{className:"text-gray-600",children:["ID: ",i==null?void 0:i.id]}),(i==null?void 0:i.age)&&U.jsxs("p",{className:"text-gray-600",children:["年龄: ",i.age," 岁"]})]})]})}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center",children:[U.jsx(sD,{className:"w-6 h-6 mr-2 text-blue-500"}),"病史信息"]}),U.jsxs("div",{className:"space-y-4",children:[U.jsxs("div",{children:[U.jsx("label",{htmlFor:"medical-history",className:"block text-sm font-medium text-gray-700 mb-2",children:"请详细描述您的病史、症状和目前的治疗情况："}),U.jsx("textarea",{id:"medical-history",value:s,onChange:M=>u(M.target.value),className:"w-full h-40 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-lg",placeholder:`例如：
• 诊断时间和医院
• 目前的症状表现
• 正在服用的药物
• 既往病史和家族病史
• 生活习惯和日常护理情况`})]}),U.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[U.jsx(KM,{className:"w-4 h-4"}),U.jsx("span",{children:"支持 Markdown 格式，您可以使用 **粗体** 和 *斜体* 等格式化文本。"})]})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center",children:[U.jsx(pH,{className:"w-6 h-6 mr-2 text-green-500"}),"文件上传"]}),U.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200 ${E?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:I,onDragLeave:I,onDragOver:I,onDrop:A,children:[U.jsx(pH,{className:`w-12 h-12 mx-auto mb-4 ${E?"text-blue-500":"text-gray-400"}`}),U.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"拖放文件到此处，或点击上传"}),U.jsx("p",{className:"text-gray-500 mb-4",children:"支持 JPG、PNG、PDF 等格式，单个文件不超过 10MB"}),U.jsxs("label",{htmlFor:"file-upload",className:"inline-flex items-center px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 cursor-pointer transition-colors",children:[U.jsx(Uhe,{className:"w-5 h-5 mr-2"}),"选择文件"]}),U.jsx("input",{id:"file-upload",type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:P,className:"hidden"})]}),f.length>0&&U.jsxs("div",{className:"mt-6",children:[U.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["已上传的文件 (",f.length,")"]}),U.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(M=>U.jsxs("div",{className:"relative bg-gray-50 rounded-lg p-4 border border-gray-200",children:[U.jsx("button",{onClick:()=>j(M.id),className:"absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:U.jsx(Ghe,{className:"w-4 h-4"})}),M.type==="image"&&M.preview?U.jsx("img",{src:M.preview,alt:M.file.name,className:"w-full h-24 object-cover rounded-md mb-2"}):U.jsx("div",{className:"w-full h-24 bg-gray-200 rounded-md mb-2 flex items-center justify-center",children:U.jsx(sD,{className:"w-8 h-8 text-gray-400"})}),U.jsxs("div",{className:"flex items-start space-x-2",children:[M.type==="image"?U.jsx(yL,{className:"w-4 h-4 text-green-500 mt-1 flex-shrink-0"}):U.jsx(sD,{className:"w-4 h-4 text-blue-500 mt-1 flex-shrink-0"}),U.jsxs("div",{className:"min-w-0 flex-1",children:[U.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:M.file.name,children:M.file.name}),U.jsxs("p",{className:"text-xs text-gray-500",children:[(M.file.size/1024/1024).toFixed(2)," MB"]})]})]})]},M.id))})]})]}),U.jsxs("div",{className:"flex justify-end space-x-4",children:[U.jsx("button",{onClick:()=>{u(""),_([])},className:"px-6 py-3 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"清空"}),U.jsxs("button",{onClick:W,disabled:o,className:"px-8 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center",children:[o?U.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):U.jsx(jhe,{className:"w-5 h-5 mr-2"}),o?"保存中...":"保存病史"]})]})]})},Gi=i=>new Promise(n=>setTimeout(n,i));class zhe{constructor(){bn(this,"users",new Map);bn(this,"messages",new Map);bn(this,"healthScores",new Map);bn(this,"sessionRecords",new Map);bn(this,"medicalHistory",new Map);bn(this,"uploadedFiles",new Map);this.initializeMockData()}initializeMockData(){const n={id:"user_001",name:"王奶奶",email:"wang.nainai@example.com",age:72,medicalHistory:"阿尔茨海默病早期，高血压，糖尿病",avatar:"https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=100&h=100&fit=crop&crop=face"};this.users.set(n.id,n);const o={overall:85,cognitive:78,emotional:92,social:88,lastUpdated:new Date};this.healthScores.set(n.id,o);const s=[{id:"session_001",userId:n.id,startTime:new Date(Date.now()-2*60*60*1e3),endTime:new Date(Date.now()-1.5*60*60*1e3),messages:[],healthMetrics:{emotionalState:"positive",cognitivePerformance:82,responseTime:3.2,conversationQuality:88}}];this.sessionRecords.set(n.id,s)}async getUser(n){return await Gi(200),this.users.get(n)||null}async updateUser(n,o){await Gi(300);const s=this.users.get(n);if(!s)throw new Error("用户不存在");const u={...s,...o};return this.users.set(n,u),u}async getHealthScore(n){return await Gi(150),this.healthScores.get(n)||null}async updateHealthScore(n,o){await Gi(200);const s={...o,lastUpdated:new Date};return this.healthScores.set(n,s),s}async getMessages(n){return await Gi(100),this.messages.get(n)||[]}async addMessage(n,o){await Gi(150);const s=this.messages.get(n)||[];return s.push(o),this.messages.set(n,s),o}async clearMessages(n){await Gi(100),this.messages.set(n,[])}async getMedicalHistory(n){return await Gi(200),this.medicalHistory.get(n)||""}async saveMedicalHistory(n,o,s){if(await Gi(1e3),this.medicalHistory.set(n,o),s&&s.length>0){const u=s.map(_=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:_.name,size:_.size,type:_.type,uploadedAt:new Date})),f=this.uploadedFiles.get(n)||[];this.uploadedFiles.set(n,[...f,...u])}}async getSessionRecords(n){return await Gi(300),this.sessionRecords.get(n)||[]}async createSessionRecord(n,o){await Gi(200);const s={...o,id:"session_"+Date.now().toString()},u=this.sessionRecords.get(n)||[];return u.push(s),this.sessionRecords.set(n,u),s}async analyzeConversation(n){await Gi(2e3);const o=["好","开心","喜欢","不错","很好"],s=["不好","难受","痛苦","烦恼","担心"];let u=0,f=0,_=0;return n.forEach(T=>{T.sender==="user"&&(o.forEach(w=>{T.content.includes(w)&&u++}),s.forEach(w=>{T.content.includes(w)&&f++}),_+=2+Math.random()*3)}),{emotionalState:u>f?"positive":f>u?"negative":"neutral",cognitivePerformance:75+Math.random()*20,responseTime:_/Math.max(1,n.filter(T=>T.sender==="user").length),conversationQuality:80+Math.random()*15}}}const sn=new zhe,Zw={auth:{login:async(i,n)=>{await Gi(1e3);const o={id:"user_"+Date.now().toString(),name:i,email:`${i.toLowerCase()}@medjourney.com`,age:n};await sn.updateUser(o.id,o);const s={overall:80+Math.random()*15,cognitive:75+Math.random()*20,emotional:85+Math.random()*10,social:80+Math.random()*15,lastUpdated:new Date};return await sn.updateHealthScore(o.id,s),o},getCurrentUser:async()=>{var n;const i=localStorage.getItem("medjourney_user_profile");return i&&((n=JSON.parse(i).state)==null?void 0:n.user)||null}},users:{get:sn.getUser.bind(sn),update:sn.updateUser.bind(sn)},health:{getScore:sn.getHealthScore.bind(sn),updateScore:sn.updateHealthScore.bind(sn),generateDailyReport:async i=>{await Gi(1500);const n=await sn.getHealthScore(i),o=await sn.getSessionRecords(i);return{date:new Date().toISOString().split("T")[0],healthScore:n,sessionCount:o.length,insights:["今日的对话表现良好，情绪状态稳定","认知测试结果在正常范围内","建议继续保持规律的对话练习"],recommendations:["增加户外活动时间","保持良好的睡眠习惯","定期与家人交流"]}}},messages:{get:sn.getMessages.bind(sn),add:sn.addMessage.bind(sn),clear:sn.clearMessages.bind(sn)},medical:{getHistory:sn.getMedicalHistory.bind(sn),saveHistory:sn.saveMedicalHistory.bind(sn)},sessions:{get:sn.getSessionRecords.bind(sn),create:sn.createSessionRecord.bind(sn),end:async(i,n,o)=>{const s=await sn.analyzeConversation(o),u={userId:i,startTime:new Date(Date.now()-o.length*3e4),endTime:new Date,messages:o,healthMetrics:s};return await sn.createSessionRecord(i,u)}},ai:{sendMessage:async(i,n,o="text")=>{await Gi(800+Math.random()*1200);let s="";if(n.includes("你好")||n.includes("您好"))s="您好！很高兴与您聊天。今天感觉怎么样？";else if(n.includes("疼")||n.includes("不舒服"))s="听起来您感到不适。请描述一下具体的情况，我会尽力帮助您。";else if(n.includes("记不起")||n.includes("忘记"))s="记忆问题很常见，不用担心。我们可以一起慢慢回忆，或者聊聊其他开心的事情。";else if(n.includes("家人")||n.includes("孩子"))s="家人是我们生活中最重要的支撑。您想分享一些关于家人的美好回忆吗？";else if(n.includes("害怕")||n.includes("担心"))s="我理解您的担心。有什么具体让您感到不安的吗？我们可以一起面对。";else{const f=["这听起来很有趣，请告诉我更多。","我很想了解您的想法，继续说说吧。","您说得很好，这让我想到了很多。","这是一个很好的话题，我们深入聊聊。","我在认真听您说话，请继续。"];s=f[Math.floor(Math.random()*f.length)]}const u={id:Date.now().toString(),content:s,type:"text",sender:"assistant",timestamp:new Date};return await sn.addMessage(i,u),u},cognitiveAssessment:async i=>(await Gi(3e3),{assessmentId:"assessment_"+Date.now(),date:new Date,scores:{memory:75+Math.random()*20,attention:80+Math.random()*15,language:85+Math.random()*10,orientation:90+Math.random()*8,visualSpatial:78+Math.random()*18},overallScore:82+Math.random()*12,recommendations:["建议增加记忆训练游戏","保持规律的社交活动","进行适度的体育锻炼"]})},reports:{generateFamilyReport:async i=>{await Gi(2e3);const n=`
MedJourney 家属简报
==================

患者姓名：王奶奶
生成日期：${new Date().toLocaleDateString("zh-CN")}

健康状态概要：
- 综合评分：85/100
- 认知能力：78/100  
- 情绪状态：92/100
- 社交能力：88/100

本周活动总结：
- AI对话次数：24次
- 平均会话时长：15分钟
- 情绪状态：积极

关键观察：
1. 患者对话积极性良好
2. 记忆力相对稳定
3. 情绪状态正面

建议：
- 继续保持规律对话
- 增加户外活动
- 定期家庭聚会
      `;return new Blob([n],{type:"text/plain"})},generateDoctorReport:async i=>{await Gi(3e3);const n=`
MedJourney 医生诊断报告
======================

会话ID：${i}
生成日期：${new Date().toLocaleDateString("zh-CN")}

患者基本信息：
- 姓名：王奶奶
- 年龄：72岁
- 诊断：阿尔茨海默病早期

会话分析：
- 持续时间：45分钟
- 对话轮次：32次
- 平均响应时间：3.2秒

认知评估：
- 记忆力：78/100
- 注意力：82/100
- 语言能力：85/100
- 定向力：90/100

AI分析结果：
1. 患者语言表达清晰
2. 情绪状态稳定
3. 对话连贯性良好

医学建议：
- 继续药物治疗
- 增加认知训练
- 定期复诊
      `;return new Blob([n],{type:"text/plain"})}}};function $he(i=null){const[n,o]=Ee.useState({data:i,loading:!1,error:null}),s=Ee.useCallback(_=>{o(E=>({...E,data:_,error:null}))},[]),u=Ee.useCallback(_=>{o(E=>({...E,loading:_}))},[]),f=Ee.useCallback(_=>{o(E=>({...E,error:_,loading:!1}))},[]);return[n,s,u,f]}function Yhe(i){const[n,o,s,u]=$he([]),f=Ee.useCallback(async w=>{s(!0);try{const I=await Zw.messages.get(w);o(I)}catch(I){u(I instanceof Error?I.message:"获取消息失败")}},[o,s,u]),_=Ee.useCallback(async(w,I)=>{try{const A=await Zw.messages.add(w,I),P=n.data||[];return o([...P,A]),A}catch(A){const P=A instanceof Error?A.message:"发送消息失败";throw u(P),new Error(P)}},[o,u]),E=Ee.useCallback(async w=>{s(!0);try{await Zw.messages.clear(w),o([])}catch(I){u(I instanceof Error?I.message:"清空消息失败")}},[o,s,u]),T=Ee.useCallback(async(w,I,A="text")=>{try{const P={id:Date.now().toString(),content:I,type:A,sender:"user",timestamp:new Date};await _(w,P);const j=await Zw.ai.sendMessage(w,I,A),W=n.data||[];return o([...W,j]),j}catch(P){const j=P instanceof Error?P.message:"发送消息失败";throw u(j),new Error(j)}},[_,o,u]);return Ee.useEffect(()=>{i&&f(i)},[i,f]),{...n,fetchMessages:f,addMessage:_,clearMessages:E,sendMessage:T}}var pR={exports:{}},Xhe=pR.exports,mH;function Jhe(){return mH||(mH=1,function(i,n){(function(o,s){i.exports=s()})(Xhe,function(){function o(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if(a!=="default"&&!(a in e)){var c=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(e,a,c.get?c:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(e)}var s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Lp<"u"?Lp:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch{return!0}},_=!f(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=_,T=Function.prototype,w=T.call,I=E&&T.bind.bind(w,w),A=E?I:function(e){return function(){return w.apply(e,arguments)}},P=A({}.isPrototypeOf),j=function(e){return e&&e.Math===Math&&e},W=j(typeof globalThis=="object"&&globalThis)||j(typeof window=="object"&&window)||j(typeof self=="object"&&self)||j(typeof s=="object"&&s)||j(typeof s=="object"&&s)||function(){return this}()||Function("return this")(),F=_,M=Function.prototype,X=M.apply,Y=M.call,J=typeof Reflect=="object"&&Reflect.apply||(F?Y.bind(X):function(){return Y.apply(X,arguments)}),re=A,z=re({}.toString),Z=re("".slice),ie=function(e){return Z(z(e),8,-1)},de=ie,ge=A,Oe=function(e){if(de(e)==="Function")return ge(e)},me=typeof document=="object"&&document.all,ye=me===void 0&&me!==void 0?function(e){return typeof e=="function"||e===me}:function(e){return typeof e=="function"},Ae={},be=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ke=_,Me=Function.prototype.call,Ue=ke?Me.bind(Me):function(){return Me.apply(Me,arguments)},Pe={},We={}.propertyIsEnumerable,He=Object.getOwnPropertyDescriptor,fe=He&&!We.call({1:2},1);Pe.f=fe?function(e){var t=He(this,e);return!!t&&t.enumerable}:We;var Ce,ot,_t=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Lt=f,Yt=ie,br=Object,Qt=A("".split),nt=Lt(function(){return!br("z").propertyIsEnumerable(0)})?function(e){return Yt(e)==="String"?Qt(e,""):br(e)}:br,It=function(e){return e==null},Zt=It,rt=TypeError,Or=function(e){if(Zt(e))throw new rt("Can't call method on "+e);return e},vr=nt,Dn=Or,qr=function(e){return vr(Dn(e))},pi=ye,en=function(e){return typeof e=="object"?e!==null:pi(e)},xn={},ja=xn,Ni=W,co=ye,ml=function(e){return co(e)?e:void 0},Fn=function(e,t){return arguments.length<2?ml(ja[e])||ml(Ni[e]):ja[e]&&ja[e][t]||Ni[e]&&Ni[e][t]},Eu=W.navigator,__=Eu&&Eu.userAgent,lo=__?String(__):"",Yd=W,Qp=lo,Su=Yd.process,bu=Yd.Deno,qS=Su&&Su.versions||bu&&bu.version,v_=qS&&qS.v8;v_&&(ot=(Ce=v_.split("."))[0]>0&&Ce[0]<4?1:+(Ce[0]+Ce[1])),!ot&&Qp&&(!(Ce=Qp.match(/Edge\/(\d+)/))||Ce[1]>=74)&&(Ce=Qp.match(/Chrome\/(\d+)/))&&(ot=+Ce[1]);var lc=ot,KS=lc,y_=f,E_=W.String,uc=!!Object.getOwnPropertySymbols&&!y_(function(){var e=Symbol("symbol detection");return!E_(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&KS&&KS<41}),Zp=uc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",S_=Fn,Tu=ye,wu=P,zS=Object,Ru=Zp?function(e){return typeof e=="symbol"}:function(e){var t=S_("Symbol");return Tu(t)&&wu(t.prototype,zS(e))},$S=String,gl=function(e){try{return $S(e)}catch{return"Object"}},YS=ye,b_=gl,XS=TypeError,fi=function(e){if(YS(e))return e;throw new XS(b_(e)+" is not a function")},T_=fi,Xd=It,ef=function(e,t){var r=e[t];return Xd(r)?void 0:T_(r)},Cu=Ue,Jd=ye,Qd=en,w_=TypeError,JS={exports:{}},QS=W,iA=Object.defineProperty,_l=W,ZS=function(e,t){try{iA(QS,e,{value:t,configurable:!0,writable:!0})}catch{QS[e]=t}return t},R_="__core-js_shared__",e0=JS.exports=_l[R_]||ZS(R_,{});(e0.versions||(e0.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var tf=JS.exports,C_=tf,vl=function(e,t){return C_[e]||(C_[e]=t||{})},t0=Or,aA=Object,Uo=function(e){return aA(t0(e))},Bn=Uo,oA=A({}.hasOwnProperty),kn=Object.hasOwn||function(e,t){return oA(Bn(e),t)},r0=A,rf=0,sA=Math.random(),n0=r0(1 .toString),Au=function(e){return"Symbol("+(e===void 0?"":e)+")_"+n0(++rf+sA,36)},jo=vl,i0=kn,uo=Au,cA=uc,lA=Zp,Ou=W.Symbol,Iu=jo("wks"),nf=lA?Ou.for||Ou:Ou&&Ou.withoutSetter||uo,Ur=function(e){return i0(Iu,e)||(Iu[e]=cA&&i0(Ou,e)?Ou[e]:nf("Symbol."+e)),Iu[e]},af=Ue,a0=en,o0=Ru,A_=ef,s0=function(e,t){var r,a;if(Jd(r=e.toString)&&!Qd(a=Cu(r,e))||Jd(r=e.valueOf)&&!Qd(a=Cu(r,e)))return a;throw new w_("Can't convert object to primitive value")},O_=TypeError,Zd=Ur("toPrimitive"),uA=function(e,t){if(!a0(e)||o0(e))return e;var r,a=A_(e,Zd);if(a){if(r=af(a,e,t),!a0(r)||o0(r))return r;throw new O_("Can't convert object to primitive value")}return s0(e)},I_=Ru,jr=function(e){var t=uA(e,"string");return I_(t)?t:t+""},N_=en,of=W.document,P_=N_(of)&&N_(of.createElement),sf=function(e){return P_?of.createElement(e):{}},c0=sf,D_=!be&&!f(function(){return Object.defineProperty(c0("div"),"a",{get:function(){return 7}}).a!==7}),x_=be,cf=Ue,dc=Pe,hc=_t,pc=qr,eh=jr,th=kn,fc=D_,l0=Object.getOwnPropertyDescriptor;Ae.f=x_?l0:function(e,t){if(e=pc(e),t=eh(t),fc)try{return l0(e,t)}catch{}if(th(e,t))return hc(!cf(dc.f,e,t),e[t])};var u0=f,rh=ye,dA=/#|\.prototype\./,Nu=function(e,t){var r=d0[lf(e)];return r===nh||r!==hA&&(rh(t)?u0(t):!!t)},lf=Nu.normalize=function(e){return String(e).replace(dA,".").toLowerCase()},d0=Nu.data={},hA=Nu.NATIVE="N",nh=Nu.POLYFILL="P",Pu=Nu,Du=fi,uf=_,pA=Oe(Oe.bind),mc=function(e,t){return Du(e),t===void 0?e:uf?pA(e,t):function(){return e.apply(t,arguments)}},aa={},ih=be&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),k_=en,h0=String,gc=TypeError,yi=function(e){if(k_(e))return e;throw new gc(h0(e)+" is not an object")},df=be,p0=D_,hf=ih,yl=yi,L_=jr,Ea=TypeError,_c=Object.defineProperty,M_=Object.getOwnPropertyDescriptor,El="enumerable",U_="configurable",ah="writable";aa.f=df?hf?function(e,t,r){if(yl(e),t=L_(t),yl(r),typeof e=="function"&&t==="prototype"&&"value"in r&&ah in r&&!r[ah]){var a=M_(e,t);a&&a[ah]&&(e[t]=r.value,r={configurable:U_ in r?r[U_]:a[U_],enumerable:El in r?r[El]:a[El],writable:!1})}return _c(e,t,r)}:_c:function(e,t,r){if(yl(e),t=L_(t),yl(r),p0)try{return _c(e,t,r)}catch{}if("get"in r||"set"in r)throw new Ea("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var j_=aa,oh=_t,Vo=be?function(e,t,r){return j_.f(e,t,oh(1,r))}:function(e,t,r){return e[t]=r,e},xu=W,fA=J,mA=Oe,gA=ye,V_=Ae.f,_A=Pu,ku=xn,vA=mc,Lu=Vo,f0=kn,m0=function(e){var t=function(r,a,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,a)}return new e(r,a,c)}return fA(e,this,arguments)};return t.prototype=e.prototype,t},er=function(e,t){var r,a,c,l,d,p,g,v,y,b=e.target,R=e.global,O=e.stat,V=e.proto,k=R?xu:O?xu[b]:xu[b]&&xu[b].prototype,L=R?ku:ku[b]||Lu(ku,b,{})[b],H=L.prototype;for(l in t)a=!(r=_A(R?l:b+(O?".":"#")+l,e.forced))&&k&&f0(k,l),p=L[l],a&&(g=e.dontCallGetSet?(y=V_(k,l))&&y.value:k[l]),d=a&&g?g:t[l],(r||V||typeof p!=typeof d)&&(v=e.bind&&a?vA(d,xu):e.wrap&&a?m0(d):V&&gA(d)?mA(d):d,(e.sham||d&&d.sham||p&&p.sham)&&Lu(v,"sham",!0),Lu(L,l,v),V&&(f0(ku,c=b+"Prototype")||Lu(ku,c,{}),Lu(ku[c],l,d),e.real&&H&&(r||!H[l])&&Lu(H,l,d)))},yA=Math.ceil,EA=Math.floor,SA=Math.trunc||function(e){var t=+e;return(t>0?EA:yA)(t)},F_=SA,B_=function(e){var t=+e;return t!=t||t===0?0:F_(t)},bA=B_,TA=Math.max,g0=Math.min,W_=function(e,t){var r=bA(e);return r<0?TA(r+t,0):g0(r,t)},wA=B_,RA=Math.min,_0=function(e){var t=wA(e);return t>0?RA(t,9007199254740991):0},CA=_0,vc=function(e){return CA(e.length)},AA=qr,G_=W_,sh=vc,v0=function(e){return function(t,r,a){var c=AA(t),l=sh(c);if(l===0)return!e&&-1;var d,p=G_(a,l);if(e&&r!=r){for(;l>p;)if((d=c[p++])!=d)return!0}else for(;l>p;p++)if((e||p in c)&&c[p]===r)return e||p||0;return!e&&-1}},pf={includes:v0(!0),indexOf:v0(!1)},y0=pf.includes;er({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(e){return y0(this,e,arguments.length>1?arguments[1]:void 0)}});var E0=W,S0=xn,Sa=function(e,t){var r=S0[e+"Prototype"],a=r&&r[t];if(a)return a;var c=E0[e],l=c&&c.prototype;return l&&l[t]},Mu=Sa("Array","includes"),OA=en,IA=ie,NA=Ur("match"),H_=function(e){var t;return OA(e)&&((t=e[NA])!==void 0?!!t:IA(e)==="RegExp")},b0=H_,ch=TypeError,Uu={};Uu[Ur("toStringTag")]="z";var q_=String(Uu)==="[object z]",ff=q_,PA=ye,lh=ie,K_=Ur("toStringTag"),z_=Object,T0=lh(function(){return arguments}())==="Arguments",bs=ff?lh:function(e){var t,r,a;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(c,l){try{return c[l]}catch{}}(t=z_(e),K_))=="string"?r:T0?lh(t):(a=lh(t))==="Object"&&PA(t.callee)?"Arguments":a},w0=bs,DA=String,oa=function(e){if(w0(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return DA(e)},xA=Ur("match"),kA=er,LA=function(e){if(b0(e))throw new ch("The method doesn't accept regular expressions");return e},ho=Or,ju=oa,R0=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[xA]=!1,"/./"[e](t)}catch{}}return!1},C0=A("".indexOf);kA({target:"String",proto:!0,forced:!R0("includes")},{includes:function(e){return!!~C0(ju(ho(this)),ju(LA(e)),arguments.length>1?arguments[1]:void 0)}});var A0=Sa("String","includes"),$_=P,Y_=Mu,MA=A0,X_=Array.prototype,yc=String.prototype,J_=function(e){var t=e.includes;return e===X_||$_(X_,e)&&t===X_.includes?Y_:typeof e=="string"||e===yc||$_(yc,e)&&t===yc.includes?MA:t},Ve=u(J_),Q_=fi,O0=Uo,mf=nt,Vu=vc,gf=TypeError,Z_="Reduce of empty array with no initial value",_f=function(e){return function(t,r,a,c){var l=O0(t),d=mf(l),p=Vu(l);if(Q_(r),p===0&&a<2)throw new gf(Z_);var g=e?p-1:0,v=e?-1:1;if(a<2)for(;;){if(g in d){c=d[g],g+=v;break}if(g+=v,e?g<0:p<=g)throw new gf(Z_)}for(;e?g>=0:p>g;g+=v)g in d&&(c=r(c,d[g],g,l));return c}},I0={left:_f(!1)},N0=f,uh=function(e,t){var r=[][e];return!!r&&N0(function(){r.call(null,t||function(){return 1},1)})},Fu=W,P0=lo,D0=ie,po=function(e){return P0.slice(0,e.length)===e},dh=po("Bun/")?"BUN":po("Cloudflare-Workers")?"CLOUDFLARE":po("Deno/")?"DENO":po("Node.js/")?"NODE":Fu.Bun&&typeof Bun.version=="string"?"BUN":Fu.Deno&&typeof Deno.version=="object"?"DENO":D0(Fu.process)==="process"?"NODE":Fu.window&&Fu.document?"BROWSER":"REST",Bu=dh==="NODE",UA=I0.left;er({target:"Array",proto:!0,forced:!Bu&&lc>79&&lc<83||!uh("reduce")},{reduce:function(e){var t=arguments.length;return UA(this,e,t,t>1?arguments[1]:void 0)}});var jA=Sa("Array","reduce"),hh=P,VA=jA,vf=Array.prototype,x0=function(e){var t=e.reduce;return e===vf||hh(vf,e)&&t===vf.reduce?VA:t},cn=x0,sa=u(cn),yf=ie,Ts=Array.isArray||function(e){return yf(e)==="Array"},k0=er,ev=Ts,ph=A([].reverse),fh=[1,2];k0({target:"Array",proto:!0,forced:String(fh)===String(fh.reverse())},{reverse:function(){return ev(this)&&(this.length=this.length),ph(this)}});var Wu=Sa("Array","reverse"),L0=P,FA=Wu,tv=Array.prototype,M0=function(e){var t=e.reverse;return e===tv||L0(tv,e)&&t===tv.reverse?FA:t},mh=M0,gh=u(mh),rv=Au,Ef=vl("keys"),Gu=function(e){return Ef[e]||(Ef[e]=rv(e))},nv=!f(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),BA=kn,U0=ye,WA=Uo,GA=nv,Sf=Gu("IE_PROTO"),Fo=Object,j0=Fo.prototype,Ec=GA?Fo.getPrototypeOf:function(e){var t=WA(e);if(BA(t,Sf))return t[Sf];var r=t.constructor;return U0(r)&&t instanceof r?r.prototype:t instanceof Fo?j0:null},Bo=A,_h=fi,ws=en,iv=function(e){return ws(e)||e===null},HA=String,qA=TypeError,Sl=function(e,t,r){try{return Bo(_h(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},vh=en,Hu=Or,bf=function(e){if(iv(e))return e;throw new qA("Can't set "+HA(e)+" as a prototype")},av=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Sl(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(a,c){return Hu(a),bf(c),vh(a)&&(t?e(a,c):a.__proto__=c),a}}():void 0),Rs={},fo={},tn=kn,ln=qr,Sc=pf.indexOf,Pi=fo,zi=A([].push),bc=function(e,t){var r,a=ln(e),c=0,l=[];for(r in a)!tn(Pi,r)&&tn(a,r)&&zi(l,r);for(;t.length>c;)tn(a,r=t[c++])&&(~Sc(l,r)||zi(l,r));return l},Tc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ca=bc,Tf=Tc.concat("length","prototype");Rs.f=Object.getOwnPropertyNames||function(e){return ca(e,Tf)};var qu={};qu.f=Object.getOwnPropertySymbols;var V0=Fn,wf=Rs,F0=qu,Cs=yi,Rf=A([].concat),ov=V0("Reflect","ownKeys")||function(e){var t=wf.f(Cs(e)),r=F0.f;return r?Rf(t,r(e)):t},sv=kn,KA=ov,wc=Ae,Ku=aa,Rc={},Cf=bc,Af=Tc,$i=Object.keys||function(e){return Cf(e,Af)},Va=be,bl=ih,As=aa,Os=yi,Tl=qr,B0=$i;Rc.f=Va&&!bl?Object.defineProperties:function(e,t){Os(e);for(var r,a=Tl(t),c=B0(t),l=c.length,d=0;l>d;)As.f(e,r=c[d++],a[r]);return e};var zu,Of=Fn("document","documentElement"),ba=yi,Ta=Rc,fn=Tc,mo=fo,W0=Of,G0=sf,yh="prototype",Eh="script",cv=Gu("IE_PROTO"),$u=function(){},lv=function(e){return"<"+Eh+">"+e+"</"+Eh+">"},wl=function(e){e.write(lv("")),e.close();var t=e.parentWindow.Object;return e=null,t},Yu=function(){try{zu=new ActiveXObject("htmlfile")}catch{}var e,t,r;Yu=typeof document<"u"?document.domain&&zu?wl(zu):(t=G0("iframe"),r="java"+Eh+":",t.style.display="none",W0.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(lv("document.F=Object")),e.close(),e.F):wl(zu);for(var a=fn.length;a--;)delete Yu[yh][fn[a]];return Yu()};mo[cv]=!0;var Sh=Object.create||function(e,t){var r;return e!==null?($u[yh]=ba(e),r=new $u,$u[yh]=null,r[cv]=e):r=Yu(),t===void 0?r:Ta.f(r,t)},bh=en,If=Vo,uv=Error,H0=A("".replace),Xu=String(new uv("zxcasd").stack),dv=/\n\s*at [^:]*:[^\n]*/,Nf=dv.test(Xu),Pf=_t,Ju=!f(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Pf(1,7)),e.stack!==7)}),hv=Vo,pv=function(e,t){if(Nf&&typeof e=="string"&&!uv.prepareStackTrace)for(;t--;)e=H0(e,dv,"");return e},fv=Ju,Df=Error.captureStackTrace,go={},Fa=go,Rl=Ur("iterator"),mv=Array.prototype,gv=function(e){return e!==void 0&&(Fa.Array===e||mv[Rl]===e)},Is=bs,Ns=ef,_v=It,q0=go,Ps=Ur("iterator"),_o=function(e){if(!_v(e))return Ns(e,Ps)||Ns(e,"@@iterator")||q0[Is(e)]},xf=Ue,K0=fi,kf=yi,z0=gl,Th=_o,Wo=TypeError,Cl=function(e,t){var r=arguments.length<2?Th(e):t;if(K0(r))return kf(xf(r,e));throw new Wo(z0(e)+" is not iterable")},wh=Ue,Cc=yi,vv=ef,Al=function(e,t,r){var a,c;Cc(e);try{if(!(a=vv(e,"return"))){if(t==="throw")throw r;return r}a=wh(a,e)}catch(l){c=!0,a=l}if(t==="throw")throw r;if(c)throw a;return Cc(a),r},$0=mc,yv=Ue,Rn=yi,Lf=gl,Ev=gv,Sv=vc,Rh=P,bv=Cl,Ol=_o,En=Al,ii=TypeError,Wn=function(e,t){this.stopped=e,this.result=t},Ch=Wn.prototype,Ds=function(e,t,r){var a,c,l,d,p,g,v,y=r&&r.that,b=!(!r||!r.AS_ENTRIES),R=!(!r||!r.IS_RECORD),O=!(!r||!r.IS_ITERATOR),V=!(!r||!r.INTERRUPTED),k=$0(t,y),L=function(q){return a&&En(a,"normal",q),new Wn(!0,q)},H=function(q){return b?(Rn(q),V?k(q[0],q[1],L):k(q[0],q[1])):V?k(q,L):k(q)};if(R)a=e.iterator;else if(O)a=e;else{if(!(c=Ol(e)))throw new ii(Lf(e)+" is not iterable");if(Ev(c)){for(l=0,d=Sv(e);d>l;l++)if((p=H(e[l]))&&Rh(Ch,p))return p;return new Wn(!1)}a=bv(e,c)}for(g=R?e.next:a.next;!(v=yv(g,a)).done;){try{p=H(v.value)}catch(q){En(a,"throw",q)}if(typeof p=="object"&&p&&Rh(Ch,p))return p}return new Wn(!1)},Ah=oa,zA=er,Di=P,Tv=Ec,Qu=av,wv=function(e,t,r){for(var a=KA(t),c=Ku.f,l=wc.f,d=0;d<a.length;d++){var p=a[d];sv(e,p)||r&&sv(r,p)||c(e,p,l(t,p))}},vo=Sh,la=Vo,Il=_t,Rv=function(e,t){bh(t)&&"cause"in t&&If(e,"cause",t.cause)},Cv=function(e,t,r,a){fv&&(Df?Df(e,t):hv(e,"stack",pv(r,a)))},Y0=Ds,X0=function(e,t){return e===void 0?arguments.length<2?"":t:Ah(e)},J0=Ur("toStringTag"),Oh=Error,Q0=[].push,Nl=function(e,t){var r,a=Di(Mf,this);Qu?r=Qu(new Oh,a?Tv(this):Mf):(r=a?this:vo(Mf),la(r,J0,"Error")),t!==void 0&&la(r,"message",X0(t)),Cv(r,Nl,r.stack,1),arguments.length>2&&Rv(r,arguments[2]);var c=[];return Y0(e,Q0,{that:c}),la(r,"errors",c),r};Qu?Qu(Nl,Oh):wv(Nl,Oh,{name:!0});var Mf=Nl.prototype=vo(Oh.prototype,{constructor:Il(1,Nl),message:Il(1,""),name:Il(1,"AggregateError")});zA({global:!0},{AggregateError:Nl});var Ih,xs,Nh,Uf=ye,Ph=W.WeakMap,Z0=Uf(Ph)&&/native code/.test(String(Ph)),jf=W,eb=en,tb=Vo,Vf=kn,Ff=tf,Av=Gu,rb=fo,Ov="Object already initialized",Bf=jf.TypeError,$A=jf.WeakMap;if(Z0||Ff.state){var yo=Ff.state||(Ff.state=new $A);yo.get=yo.get,yo.has=yo.has,yo.set=yo.set,Ih=function(e,t){if(yo.has(e))throw new Bf(Ov);return t.facade=e,yo.set(e,t),t},xs=function(e){return yo.get(e)||{}},Nh=function(e){return yo.has(e)}}else{var Zu=Av("state");rb[Zu]=!0,Ih=function(e,t){if(Vf(e,Zu))throw new Bf(Ov);return t.facade=e,tb(e,Zu,t),t},xs=function(e){return Vf(e,Zu)?e[Zu]:{}},Nh=function(e){return Vf(e,Zu)}}var Pl,Iv,Nv,Ac={set:Ih,get:xs,has:Nh,enforce:function(e){return Nh(e)?xs(e):Ih(e,{})},getterFor:function(e){return function(t){var r;if(!eb(t)||(r=xs(t)).type!==e)throw new Bf("Incompatible receiver, "+e+" required");return r}}},ed=be,YA=kn,nb=Function.prototype,XA=ed&&Object.getOwnPropertyDescriptor,Ba=YA(nb,"name"),Wf={PROPER:Ba&&(function(){}).name==="something",CONFIGURABLE:Ba&&(!ed||ed&&XA(nb,"name").configurable)},Gf=Vo,ks=function(e,t,r,a){return a&&a.enumerable?e[t]=r:Gf(e,t,r),e},ib=f,ab=ye,Pv=en,td=Sh,Hf=Ec,Dv=ks,xv=Ur("iterator"),kv=!1;[].keys&&("next"in(Nv=[].keys())?(Iv=Hf(Hf(Nv)))!==Object.prototype&&(Pl=Iv):kv=!0);var ob=!Pv(Pl)||ib(function(){var e={};return Pl[xv].call(e)!==e});ab((Pl=ob?{}:td(Pl))[xv])||Dv(Pl,xv,function(){return this});var Lv={IteratorPrototype:Pl,BUGGY_SAFARI_ITERATORS:kv},sb=bs,cb=q_?{}.toString:function(){return"[object "+sb(this)+"]"},JA=q_,ua=aa.f,Yi=Vo,lb=kn,ub=cb,Mv=Ur("toStringTag"),Go=function(e,t,r,a){var c=r?e:e&&e.prototype;c&&(lb(c,Mv)||ua(c,Mv,{configurable:!0,value:t}),a&&!JA&&Yi(c,"toString",ub))},db=Lv.IteratorPrototype,Uv=Sh,hb=_t,jv=Go,pb=go,fb=function(){return this},Dh=function(e,t,r,a){var c=t+" Iterator";return e.prototype=Uv(db,{next:hb(+!a,r)}),jv(e,c,!1,!0),pb[c]=fb,e},Vv=er,mb=Ue,Fv=Wf,qf=Dh,QA=Ec,gb=Go,Kf=ks,Bv=go,zf=Lv,Ls=Fv.PROPER,$f=zf.BUGGY_SAFARI_ITERATORS,Yf=Ur("iterator"),Xf="keys",xh="values",Wv="entries",kh=function(){return this},Ei=function(e,t,r,a,c,l,d){qf(r,t,a);var p,g,v,y=function(H){if(H===c&&k)return k;if(!$f&&H&&H in O)return O[H];switch(H){case Xf:case xh:case Wv:return function(){return new r(this,H)}}return function(){return new r(this)}},b=t+" Iterator",R=!1,O=e.prototype,V=O[Yf]||O["@@iterator"]||c&&O[c],k=!$f&&V||y(c),L=t==="Array"&&O.entries||V;if(L&&(p=QA(L.call(new e)))!==Object.prototype&&p.next&&(gb(p,b,!0,!0),Bv[b]=kh),Ls&&c===xh&&V&&V.name!==xh&&(R=!0,k=function(){return mb(V,this)}),c)if(g={values:y(xh),keys:l?k:y(Xf),entries:y(Wv)},d)for(v in g)($f||R||!(v in O))&&Kf(O,v,g[v]);else Vv({target:t,proto:!0,forced:$f||R},g);return d&&O[Yf]!==k&&Kf(O,Yf,k,{}),Bv[t]=k,g},Jf=function(e,t){return{value:e,done:t}},ZA=qr,Lh=go,Si=Ac;aa.f;var eO=Ei,Et=Jf,Dl="Array Iterator",Gv=Si.set,_b=Si.getterFor(Dl);eO(Array,"Array",function(e,t){Gv(this,{type:Dl,target:ZA(e),index:0,kind:t})},function(){var e=_b(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Et(void 0,!0);switch(e.kind){case"keys":return Et(r,!1);case"values":return Et(t[r],!1)}return Et([r,t[r]],!1)},"values"),Lh.Arguments=Lh.Array;var tO=aa,Oc=function(e,t,r){return tO.f(e,t,r)},Qf=Fn,Hv=Oc,vb=be,qv=Ur("species"),yb=P,Kv=TypeError,Mh=function(e,t){if(yb(t,e))return e;throw new Kv("Incorrect invocation")},bi=ye,wa=tf,Ic=A(Function.toString);bi(wa.inspectSource)||(wa.inspectSource=function(e){return Ic(e)});var zv=wa.inspectSource,Eb=A,Eo=f,$v=ye,Ho=bs,rO=zv,Yv=function(){},Xv=Fn("Reflect","construct"),Zf=/^\s*(?:class|function)\b/,Sb=Eb(Zf.exec),nO=!Zf.test(Yv),Nc=function(e){if(!$v(e))return!1;try{return Xv(Yv,[],e),!0}catch{return!1}},em=function(e){if(!$v(e))return!1;switch(Ho(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return nO||!!Sb(Zf,rO(e))}catch{return!0}};em.sham=!0;var xi,mr,ai,Ln,Jn=!Xv||Eo(function(){var e;return Nc(Nc.call)||!Nc(Object)||!Nc(function(){e=!0})||e})?em:Nc,Ra=Jn,rd=gl,oi=TypeError,nd=yi,xl=function(e){if(Ra(e))return e;throw new oi(rd(e)+" is not a constructor")},tm=It,Jv=Ur("species"),kl=function(e,t){var r,a=nd(e).constructor;return a===void 0||tm(r=nd(a)[Jv])?t:xl(r)},Gn=A([].slice),Qv=TypeError,Wa=function(e,t){if(e<t)throw new Qv("Not enough arguments");return e},qo=/(?:ipad|iphone|ipod).*applewebkit/i.test(lo),ki=W,Zv=J,Pc=mc,Uh=ye,Dc=kn,jh=f,id=Of,ey=Gn,Vh=sf,rm=Wa,Xi=qo,xc=Bu,Ca=ki.setImmediate,Li=ki.clearImmediate,bb=ki.process,Fh=ki.Dispatch,ty=ki.Function,Tb=ki.MessageChannel,kc=ki.String,nm=0,Ll={},Lc="onreadystatechange";jh(function(){xi=ki.location});var Bh=function(e){if(Dc(Ll,e)){var t=Ll[e];delete Ll[e],t()}},Ms=function(e){return function(){Bh(e)}},ry=function(e){Bh(e.data)},ny=function(e){ki.postMessage(kc(e),xi.protocol+"//"+xi.host)};Ca&&Li||(Ca=function(e){rm(arguments.length,1);var t=Uh(e)?e:ty(e),r=ey(arguments,1);return Ll[++nm]=function(){Zv(t,void 0,r)},mr(nm),nm},Li=function(e){delete Ll[e]},xc?mr=function(e){bb.nextTick(Ms(e))}:Fh&&Fh.now?mr=function(e){Fh.now(Ms(e))}:Tb&&!Xi?(Ln=(ai=new Tb).port2,ai.port1.onmessage=ry,mr=Pc(Ln.postMessage,Ln)):ki.addEventListener&&Uh(ki.postMessage)&&!ki.importScripts&&xi&&xi.protocol!=="file:"&&!jh(ny)?(mr=ny,ki.addEventListener("message",ry,!1)):mr=Lc in Vh("script")?function(e){id.appendChild(Vh("script"))[Lc]=function(){id.removeChild(this),Bh(e)}}:function(e){setTimeout(Ms(e),0)});var ad={set:Ca,clear:Li},Wh=W,iO=be,aO=Object.getOwnPropertyDescriptor,iy=function(e){if(!iO)return Wh[e];var t=aO(Wh,e);return t&&t.value},ay=function(){this.head=null,this.tail=null};ay.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ga,oy,Mc,im,Cn,wb=ay,Rb=/ipad|iphone|ipod/i.test(lo)&&typeof Pebble<"u",oO=/web0s(?!.*chrome)/i.test(lo),od=W,Cb=iy,sy=mc,cy=ad.set,Ha=wb,ly=qo,sO=Rb,Uc=oO,sd=Bu,jc=od.MutationObserver||od.WebKitMutationObserver,Gh=od.document,am=od.process,cd=od.Promise,uy=Cb("queueMicrotask");if(!uy){var ld=new Ha,om=function(){var e,t;for(sd&&(e=am.domain)&&e.exit();t=ld.get();)try{t()}catch(r){throw ld.head&&Ga(),r}e&&e.enter()};ly||sd||Uc||!jc||!Gh?!sO&&cd&&cd.resolve?((im=cd.resolve(void 0)).constructor=cd,Cn=sy(im.then,im),Ga=function(){Cn(om)}):sd?Ga=function(){am.nextTick(om)}:(cy=sy(cy,od),Ga=function(){cy(om)}):(oy=!0,Mc=Gh.createTextNode(""),new jc(om).observe(Mc,{characterData:!0}),Ga=function(){Mc.data=oy=!oy}),uy=function(e){ld.head||Ga(),ld.add(e)}}var dy=uy,Ml=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ko=W.Promise,sm=W,ud=Ko,hy=ye,cO=Pu,Ab=zv,py=Ur,Hh=dh,qh=lc,Kh=ud&&ud.prototype,Ob=py("species"),Ib=hy(sm.PromiseRejectionEvent),cm=cO("Promise",function(){var e=Ab(ud),t=e!==String(ud);if(!t&&qh===66||!Kh.catch||!Kh.finally)return!0;if(!qh||qh<51||!/native code/.test(e)){var r=new ud(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((r.constructor={})[Ob]=a,!(r.then(function(){})instanceof a))return!0}return!(t||Hh!=="BROWSER"&&Hh!=="DENO"||Ib)}),zh={CONSTRUCTOR:cm,REJECTION_EVENT:Ib},da={},Nb=fi,lm=TypeError,h=function(e){var t,r;this.promise=new e(function(a,c){if(t!==void 0||r!==void 0)throw new lm("Bad Promise constructor");t=a,r=c}),this.resolve=Nb(t),this.reject=Nb(r)};da.f=function(e){return new h(e)};var m,S,C=er,x=Bu,B=W,ee=Ue,le=ks,ve=Go,je=function(e){var t=Qf(e);vb&&t&&!t[qv]&&Hv(t,qv,{configurable:!0,get:function(){return this}})},tt=fi,it=ye,et=en,vt=Mh,Tt=kl,Ct=ad.set,An=dy,Ne=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},Se=Ml,xe=wb,st=Ac,Ot=Ko,Mt=zh,Ut=da,Wt="Promise",si=Mt.CONSTRUCTOR,xr=Mt.REJECTION_EVENT,zo=st.getterFor(Wt),lO=st.set,gZ=Ot&&Ot.prototype,fy=Ot,uO=gZ,J2=B.TypeError,dO=B.document,hO=B.process,pO=Ut.f,_Z=pO,vZ=!!(dO&&dO.createEvent&&B.dispatchEvent),Q2="unhandledrejection",Z2=function(e){var t;return!(!et(e)||!it(t=e.then))&&t},eU=function(e,t){var r,a,c,l=t.value,d=t.state===1,p=d?e.ok:e.fail,g=e.resolve,v=e.reject,y=e.domain;try{p?(d||(t.rejection===2&&EZ(t),t.rejection=1),p===!0?r=l:(y&&y.enter(),r=p(l),y&&(y.exit(),c=!0)),r===e.promise?v(new J2("Promise-chain cycle")):(a=Z2(r))?ee(a,r,g,v):g(r)):v(l)}catch(b){y&&!c&&y.exit(),v(b)}},tU=function(e,t){e.notified||(e.notified=!0,An(function(){for(var r,a=e.reactions;r=a.get();)eU(r,e);e.notified=!1,t&&!e.rejection&&yZ(e)}))},rU=function(e,t,r){var a,c;vZ?((a=dO.createEvent("Event")).promise=t,a.reason=r,a.initEvent(e,!1,!0),B.dispatchEvent(a)):a={promise:t,reason:r},!xr&&(c=B["on"+e])?c(a):e===Q2&&Ne("Unhandled promise rejection",r)},yZ=function(e){ee(Ct,B,function(){var t,r=e.facade,a=e.value;if(nU(e)&&(t=Se(function(){x?hO.emit("unhandledRejection",a,r):rU(Q2,r,a)}),e.rejection=x||nU(e)?2:1,t.error))throw t.value})},nU=function(e){return e.rejection!==1&&!e.parent},EZ=function(e){ee(Ct,B,function(){var t=e.facade;x?hO.emit("rejectionHandled",t):rU("rejectionhandled",t,e.value)})},um=function(e,t,r){return function(a){e(t,a,r)}},dm=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,tU(e,!0))},fO=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new J2("Promise can't be resolved itself");var a=Z2(t);a?An(function(){var c={done:!1};try{ee(a,t,um(fO,c,e),um(dm,c,e))}catch(l){dm(c,l,e)}}):(e.value=t,e.state=1,tU(e,!1))}catch(c){dm({done:!1},c,e)}}};si&&(uO=(fy=function(e){vt(this,uO),tt(e),ee(m,this);var t=zo(this);try{e(um(fO,t),um(dm,t))}catch(r){dm(t,r)}}).prototype,(m=function(e){lO(this,{type:Wt,done:!1,notified:!1,parent:!1,reactions:new xe,rejection:!1,state:0,value:null})}).prototype=le(uO,"then",function(e,t){var r=zo(this),a=pO(Tt(this,fy));return r.parent=!0,a.ok=!it(e)||e,a.fail=it(t)&&t,a.domain=x?hO.domain:void 0,r.state===0?r.reactions.add(a):An(function(){eU(a,r)}),a.promise}),S=function(){var e=new m,t=zo(e);this.promise=e,this.resolve=um(fO,t),this.reject=um(dm,t)},Ut.f=pO=function(e){return e===fy||e===void 0?new S(e):_Z(e)}),C({global:!0,wrap:!0,forced:si},{Promise:fy}),ve(fy,Wt,!1,!0),je(Wt);var iU=Ur("iterator"),aU=!1;try{var SZ=0,oU={next:function(){return{done:!!SZ++}},return:function(){aU=!0}};oU[iU]=function(){return this},Array.from(oU,function(){throw 2})}catch{}var bZ=Ko,TZ=function(e,t){try{if(!t&&!aU)return!1}catch{return!1}var r=!1;try{var a={};a[iU]=function(){return{next:function(){return{done:r=!0}}}},e(a)}catch{}return r},Pb=zh.CONSTRUCTOR||!TZ(function(e){bZ.all(e).then(void 0,function(){})}),wZ=Ue,RZ=fi,CZ=da,AZ=Ml,OZ=Ds;er({target:"Promise",stat:!0,forced:Pb},{all:function(e){var t=this,r=CZ.f(t),a=r.resolve,c=r.reject,l=AZ(function(){var d=RZ(t.resolve),p=[],g=0,v=1;OZ(e,function(y){var b=g++,R=!1;v++,wZ(d,t,y).then(function(O){R||(R=!0,p[b]=O,--v||a(p))},c)}),--v||a(p)});return l.error&&c(l.value),r.promise}});var IZ=er,NZ=zh.CONSTRUCTOR;Ko&&Ko.prototype,IZ({target:"Promise",proto:!0,forced:NZ,real:!0},{catch:function(e){return this.then(void 0,e)}});var PZ=Ue,DZ=fi,xZ=da,kZ=Ml,LZ=Ds;er({target:"Promise",stat:!0,forced:Pb},{race:function(e){var t=this,r=xZ.f(t),a=r.reject,c=kZ(function(){var l=DZ(t.resolve);LZ(e,function(d){PZ(l,t,d).then(r.resolve,a)})});return c.error&&a(c.value),r.promise}});var MZ=da;er({target:"Promise",stat:!0,forced:zh.CONSTRUCTOR},{reject:function(e){var t=MZ.f(this);return(0,t.reject)(e),t.promise}});var UZ=yi,jZ=en,VZ=da,sU=function(e,t){if(UZ(e),jZ(t)&&t.constructor===e)return t;var r=VZ.f(e);return(0,r.resolve)(t),r.promise},FZ=er,BZ=Ko,WZ=zh.CONSTRUCTOR,GZ=sU,HZ=Fn("Promise"),qZ=!WZ;FZ({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return GZ(qZ&&this===HZ?BZ:this,e)}});var KZ=Ue,zZ=fi,$Z=da,YZ=Ml,XZ=Ds;er({target:"Promise",stat:!0,forced:Pb},{allSettled:function(e){var t=this,r=$Z.f(t),a=r.resolve,c=r.reject,l=YZ(function(){var d=zZ(t.resolve),p=[],g=0,v=1;XZ(e,function(y){var b=g++,R=!1;v++,KZ(d,t,y).then(function(O){R||(R=!0,p[b]={status:"fulfilled",value:O},--v||a(p))},function(O){R||(R=!0,p[b]={status:"rejected",reason:O},--v||a(p))})}),--v||a(p)});return l.error&&c(l.value),r.promise}});var JZ=Ue,QZ=fi,ZZ=Fn,eee=da,tee=Ml,ree=Ds,cU="No one promise resolved";er({target:"Promise",stat:!0,forced:Pb},{any:function(e){var t=this,r=ZZ("AggregateError"),a=eee.f(t),c=a.resolve,l=a.reject,d=tee(function(){var p=QZ(t.resolve),g=[],v=0,y=1,b=!1;ree(e,function(R){var O=v++,V=!1;y++,JZ(p,t,R).then(function(k){V||b||(b=!0,c(k))},function(k){V||b||(V=!0,g[O]=k,--y||l(new r(g,cU)))})}),--y||l(new r(g,cU))});return d.error&&l(d.value),a.promise}});var nee=er,iee=J,aee=Gn,oee=da,see=fi,lU=Ml,mO=W.Promise,uU=!1;nee({target:"Promise",stat:!0,forced:!mO||!mO.try||lU(function(){mO.try(function(e){uU=e===8},8)}).error||!uU},{try:function(e){var t=arguments.length>1?aee(arguments,1):[],r=oee.f(this),a=lU(function(){return iee(see(e),void 0,t)});return(a.error?r.reject:r.resolve)(a.value),r.promise}});var cee=da;er({target:"Promise",stat:!0},{withResolvers:function(){var e=cee.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var lee=er,gO=Ko,uee=f,dee=Fn,hee=ye,pee=kl,dU=sU,fee=gO&&gO.prototype;lee({target:"Promise",proto:!0,real:!0,forced:!!gO&&uee(function(){fee.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=pee(this,dee("Promise")),r=hee(e);return this.then(r?function(a){return dU(t,e()).then(function(){return a})}:e,r?function(a){return dU(t,e()).then(function(){throw a})}:e)}});var _O=A,mee=B_,gee=oa,_ee=Or,vee=_O("".charAt),hU=_O("".charCodeAt),yee=_O("".slice),pU=function(e){return function(t,r){var a,c,l=gee(_ee(t)),d=mee(r),p=l.length;return d<0||d>=p?e?"":void 0:(a=hU(l,d))<55296||a>56319||d+1===p||(c=hU(l,d+1))<56320||c>57343?e?vee(l,d):a:e?yee(l,d,d+2):c-56320+(a-55296<<10)+65536}},vO={codeAt:pU(!1),charAt:pU(!0)},Eee=vO.charAt,See=oa,fU=Ac,bee=Ei,mU=Jf,gU="String Iterator",Tee=fU.set,wee=fU.getterFor(gU);bee(String,"String",function(e){Tee(this,{type:gU,string:See(e),index:0})},function(){var e,t=wee(this),r=t.string,a=t.index;return a>=r.length?mU(void 0,!0):(e=Eee(r,a),t.index+=e.length,mU(e,!1))});var Ree=xn.Promise,Cee={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Aee=W,Oee=Go,_U=go;for(var yO in Cee)Oee(Aee[yO],yO),_U[yO]=_U.Array;var vU=Ree,Ge=u(vU),Iee=Sa("Array","values"),Nee=bs,Pee=kn,Dee=P,xee=Iee,EO=Array.prototype,kee={DOMTokenList:!0,NodeList:!0},Lee=function(e){var t=e.values;return e===EO||Dee(EO,e)&&t===EO.values||Pee(kee,Nee(e))?xee:t},Aa=u(Lee),yU=gl,Mee=TypeError,EU=Gn,Uee=Math.floor,SO=function(e,t){var r=e.length;if(r<8)for(var a,c,l=1;l<r;){for(c=l,a=e[l];c&&t(e[c-1],a)>0;)e[c]=e[--c];c!==l++&&(e[c]=a)}else for(var d=Uee(r/2),p=SO(EU(e,0,d),t),g=SO(EU(e,d),t),v=p.length,y=g.length,b=0,R=0;b<v||R<y;)e[b+R]=b<v&&R<y?t(p[b],g[R])<=0?p[b++]:g[R++]:b<v?p[b++]:g[R++];return e},SU=SO,bU=lo.match(/firefox\/(\d+)/i),jee=!!bU&&+bU[1],Vee=/MSIE|Trident/.test(lo),TU=lo.match(/AppleWebKit\/(\d+)\./),Fee=!!TU&&+TU[1],Bee=er,wU=A,Wee=fi,Gee=Uo,RU=vc,Hee=function(e,t){if(!delete e[t])throw new Mee("Cannot delete property "+yU(t)+" of "+yU(e))},CU=oa,bO=f,qee=SU,Kee=uh,AU=jee,zee=Vee,OU=lc,IU=Fee,dd=[],NU=wU(dd.sort),$ee=wU(dd.push),Yee=bO(function(){dd.sort(void 0)}),Xee=bO(function(){dd.sort(null)}),Jee=Kee("sort"),PU=!bO(function(){if(OU)return OU<70;if(!(AU&&AU>3)){if(zee)return!0;if(IU)return IU<603;var e,t,r,a,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)dd.push({k:t+a,v:r})}for(dd.sort(function(l,d){return d.v-l.v}),a=0;a<dd.length;a++)t=dd[a].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});Bee({target:"Array",proto:!0,forced:Yee||!Xee||!Jee||!PU},{sort:function(e){e!==void 0&&Wee(e);var t=Gee(this);if(PU)return e===void 0?NU(t):NU(t,e);var r,a,c=[],l=RU(t);for(a=0;a<l;a++)a in t&&$ee(c,t[a]);for(qee(c,function(d){return function(p,g){return g===void 0?-1:p===void 0?1:d!==void 0?+d(p,g)||0:CU(p)>CU(g)?1:-1}}(e)),r=RU(c),a=0;a<r;)t[a]=c[a++];for(;a<l;)Hee(t,a++);return t}});var Qee=Sa("Array","sort"),Zee=P,ete=Qee,TO=Array.prototype,tte=function(e){var t=e.sort;return e===TO||Zee(TO,e)&&t===TO.sort?ete:t},$h=u(tte),rte=er,nte=A,ite=W_,ate=RangeError,DU=String.fromCharCode,xU=String.fromCodePoint,ote=nte([].join);rte({target:"String",stat:!0,forced:!!xU&&xU.length!==1},{fromCodePoint:function(e){for(var t,r=[],a=arguments.length,c=0;a>c;){if(t=+arguments[c++],ite(t,1114111)!==t)throw new ate(t+" is not a valid code point");r[c]=t<65536?DU(t):DU(55296+((t-=65536)>>10),t%1024+56320)}return ote(r,"")}});var ste=f,cte=Ur("iterator"),Db=!ste(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),a="";return e.pathname="c%20d",t.forEach(function(c,l){t.delete("b"),a+=l+c}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[cte]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"}),lte=ks,wO=er,kU=W,RO=iy,ute=Fn,xb=Ue,Us=A,my=be,LU=Db,MU=ks,dte=Oc,hte=function(e,t,r){for(var a in t)r&&r.unsafe&&e[a]?e[a]=t[a]:lte(e,a,t[a],r);return e},pte=Go,fte=Dh,CO=Ac,UU=Mh,AO=ye,mte=kn,gte=mc,_te=bs,vte=yi,jU=en,Oa=oa,yte=Sh,VU=_t,FU=Cl,Ete=_o,kb=Jf,hm=Wa,Ste=SU,bte=Ur("iterator"),pm="URLSearchParams",BU=pm+"Iterator",WU=CO.set,$o=CO.getterFor(pm),Tte=CO.getterFor(BU),GU=RO("fetch"),Lb=RO("Request"),gy=RO("Headers"),OO=Lb&&Lb.prototype,HU=gy&&gy.prototype,wte=kU.TypeError,Rte=kU.encodeURIComponent,Cte=String.fromCharCode,Ate=ute("String","fromCodePoint"),Ote=parseInt,Mb=Us("".charAt),qU=Us([].join),hd=Us([].push),KU=Us("".replace),Ite=Us([].shift),zU=Us([].splice),$U=Us("".split),YU=Us("".slice),Nte=Us(/./.exec),Pte=/\+/g,Dte=/^[0-9a-f]+$/i,XU=function(e,t){var r=YU(e,t,t+2);return Nte(Dte,r)?Ote(r,16):NaN},xte=function(e){for(var t=0,r=128;r>0&&(e&r)!=0;r>>=1)t++;return t},kte=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},JU=function(e){for(var t=(e=KU(e,Pte," ")).length,r="",a=0;a<t;){var c=Mb(e,a);if(c==="%"){if(Mb(e,a+1)==="%"||a+3>t){r+="%",a++;continue}var l=XU(e,a+1);if(l!=l){r+=c,a++;continue}a+=2;var d=xte(l);if(d===0)c=Cte(l);else{if(d===1||d>4){r+="�",a++;continue}for(var p=[l],g=1;g<d&&!(++a+3>t||Mb(e,a)!=="%");){var v=XU(e,a+1);if(v!=v){a+=3;break}if(v>191||v<128)break;hd(p,v),a+=2,g++}if(p.length!==d){r+="�";continue}var y=kte(p);y===null?r+="�":c=Ate(y)}}r+=c,a++}return r},Lte=/[!'()~]|%20/g,Mte={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Ute=function(e){return Mte[e]},QU=function(e){return KU(Rte(e),Lte,Ute)},IO=fte(function(e,t){WU(this,{type:BU,target:$o(e).entries,index:0,kind:t})},pm,function(){var e=Tte(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,kb(void 0,!0);var a=t[r];switch(e.kind){case"keys":return kb(a.key,!1);case"values":return kb(a.value,!1)}return kb([a.key,a.value],!1)},!0),ZU=function(e){this.entries=[],this.url=null,e!==void 0&&(jU(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Mb(e,0)==="?"?YU(e,1):e:Oa(e)))};ZU.prototype={type:pm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,a,c,l,d,p,g=this.entries,v=Ete(e);if(v)for(r=(t=FU(e,v)).next;!(a=xb(r,t)).done;){if(l=(c=FU(vte(a.value))).next,(d=xb(l,c)).done||(p=xb(l,c)).done||!xb(l,c).done)throw new wte("Expected sequence with length 2");hd(g,{key:Oa(d.value),value:Oa(p.value)})}else for(var y in e)mte(e,y)&&hd(g,{key:y,value:Oa(e[y])})},parseQuery:function(e){if(e)for(var t,r,a=this.entries,c=$U(e,"&"),l=0;l<c.length;)(t=c[l++]).length&&(r=$U(t,"="),hd(a,{key:JU(Ite(r)),value:JU(qU(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],a=0;a<t.length;)e=t[a++],hd(r,QU(e.key)+"="+QU(e.value));return qU(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ub=function(){UU(this,fm);var e=WU(this,new ZU(arguments.length>0?arguments[0]:void 0));my||(this.size=e.entries.length)},fm=Ub.prototype;if(hte(fm,{append:function(e,t){var r=$o(this);hm(arguments.length,2),hd(r.entries,{key:Oa(e),value:Oa(t)}),my||this.length++,r.updateURL()},delete:function(e){for(var t=$o(this),r=hm(arguments.length,1),a=t.entries,c=Oa(e),l=r<2?void 0:arguments[1],d=l===void 0?l:Oa(l),p=0;p<a.length;){var g=a[p];if(g.key!==c||d!==void 0&&g.value!==d)p++;else if(zU(a,p,1),d!==void 0)break}my||(this.size=a.length),t.updateURL()},get:function(e){var t=$o(this).entries;hm(arguments.length,1);for(var r=Oa(e),a=0;a<t.length;a++)if(t[a].key===r)return t[a].value;return null},getAll:function(e){var t=$o(this).entries;hm(arguments.length,1);for(var r=Oa(e),a=[],c=0;c<t.length;c++)t[c].key===r&&hd(a,t[c].value);return a},has:function(e){for(var t=$o(this).entries,r=hm(arguments.length,1),a=Oa(e),c=r<2?void 0:arguments[1],l=c===void 0?c:Oa(c),d=0;d<t.length;){var p=t[d++];if(p.key===a&&(l===void 0||p.value===l))return!0}return!1},set:function(e,t){var r=$o(this);hm(arguments.length,1);for(var a,c=r.entries,l=!1,d=Oa(e),p=Oa(t),g=0;g<c.length;g++)(a=c[g]).key===d&&(l?zU(c,g--,1):(l=!0,a.value=p));l||hd(c,{key:d,value:p}),my||(this.size=c.length),r.updateURL()},sort:function(){var e=$o(this);Ste(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=$o(this).entries,a=gte(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)a((t=r[c++]).value,t.key,this)},keys:function(){return new IO(this,"keys")},values:function(){return new IO(this,"values")},entries:function(){return new IO(this,"entries")}},{enumerable:!0}),MU(fm,bte,fm.entries,{}),MU(fm,"toString",function(){return $o(this).serialize()},{enumerable:!0}),my&&dte(fm,"size",{get:function(){return $o(this).entries.length},configurable:!0,enumerable:!0}),pte(Ub,pm),wO({global:!0,forced:!LU},{URLSearchParams:Ub}),!LU&&AO(gy)){var jte=Us(HU.has),Vte=Us(HU.set),ej=function(e){if(jU(e)){var t,r=e.body;if(_te(r)===pm)return t=e.headers?new gy(e.headers):new gy,jte(t,"content-type")||Vte(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),yte(e,{body:VU(0,Oa(r)),headers:VU(0,t)})}return e};if(AO(GU)&&wO({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return GU(e,arguments.length>1?ej(arguments[1]):{})}}),AO(Lb)){var NO=function(e){return UU(this,OO),new Lb(e,arguments.length>1?ej(arguments[1]):{})};OO.constructor=NO,NO.prototype=OO,wO({global:!0,dontCallGetSet:!0,forced:!0},{Request:NO})}}var Yo,Fte={URLSearchParams:Ub,getState:$o},Bte=xn.URLSearchParams,tj=be,Wte=A,Gte=Ue,Hte=f,PO=$i,qte=qu,Kte=Pe,zte=Uo,$te=nt,mm=Object.assign,rj=Object.defineProperty,Yte=Wte([].concat),Xte=!mm||Hte(function(){if(tj&&mm({b:1},mm(rj({},"a",{enumerable:!0,get:function(){rj(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),a="abcdefghijklmnopqrst";return e[r]=7,a.split("").forEach(function(c){t[c]=c}),mm({},e)[r]!==7||PO(mm({},t)).join("")!==a})?function(e,t){for(var r=zte(e),a=arguments.length,c=1,l=qte.f,d=Kte.f;a>c;)for(var p,g=$te(arguments[c++]),v=l?Yte(PO(g),l(g)):PO(g),y=v.length,b=0;y>b;)p=v[b++],tj&&!Gte(d,g,p)||(r[p]=g[p]);return r}:mm,Jte=yi,Qte=Al,Zte=be,ere=aa,tre=_t,DO=function(e,t,r){Zte?ere.f(e,t,tre(0,r)):e[t]=r},rre=mc,nre=Ue,ire=Uo,are=function(e,t,r,a){try{return a?t(Jte(r)[0],r[1]):t(r)}catch(c){Qte(e,"throw",c)}},ore=gv,sre=Jn,cre=vc,nj=DO,lre=Cl,ure=_o,ij=Array,Yh=A,xO=2147483647,dre=/[^\0-\u007E]/,aj=/[.\u3002\uFF0E\uFF61]/g,oj="Overflow: input needs wider integers to process",sj=RangeError,hre=Yh(aj.exec),gm=Math.floor,kO=String.fromCharCode,cj=Yh("".charCodeAt),lj=Yh([].join),pd=Yh([].push),pre=Yh("".replace),fre=Yh("".split),mre=Yh("".toLowerCase),uj=function(e){return e+22+75*(e<26)},gre=function(e,t,r){var a=0;for(e=r?gm(e/700):e>>1,e+=gm(e/t);e>455;)e=gm(e/35),a+=36;return gm(a+36*e/(e+38))},_re=function(e){var t=[];e=function(H){for(var q=[],te=0,oe=H.length;te<oe;){var se=cj(H,te++);if(se>=55296&&se<=56319&&te<oe){var ae=cj(H,te++);(64512&ae)==56320?pd(q,((1023&se)<<10)+(1023&ae)+65536):(pd(q,se),te--)}else pd(q,se)}return q}(e);var r,a,c=e.length,l=128,d=0,p=72;for(r=0;r<e.length;r++)(a=e[r])<128&&pd(t,kO(a));var g=t.length,v=g;for(g&&pd(t,"-");v<c;){var y=xO;for(r=0;r<e.length;r++)(a=e[r])>=l&&a<y&&(y=a);var b=v+1;if(y-l>gm((xO-d)/b))throw new sj(oj);for(d+=(y-l)*b,l=y,r=0;r<e.length;r++){if((a=e[r])<l&&++d>xO)throw new sj(oj);if(a===l){for(var R=d,O=36;;){var V=O<=p?1:O>=p+26?26:O-p;if(R<V)break;var k=R-V,L=36-V;pd(t,kO(uj(V+k%L))),R=gm(k/L),O+=36}pd(t,kO(uj(R))),p=gre(d,b,v===g),d=0,v++}}d++,l++}return lj(t,"")},vre=er,LO=be,yre=Db,MO=W,dj=mc,Xo=A,jb=ks,Jo=Oc,Ere=Mh,UO=kn,jO=Xte,_m=function(e){var t=ire(e),r=sre(this),a=arguments.length,c=a>1?arguments[1]:void 0,l=c!==void 0;l&&(c=rre(c,a>2?arguments[2]:void 0));var d,p,g,v,y,b,R=ure(t),O=0;if(!R||this===ij&&ore(R))for(d=cre(t),p=r?new this(d):ij(d);d>O;O++)b=l?c(t[O],O):t[O],nj(p,O,b);else for(p=r?new this:[],y=(v=lre(t,R)).next;!(g=nre(y,v)).done;O++)b=l?are(v,c,[g.value,O],!0):g.value,nj(p,O,b);return p.length=O,p},js=Gn,Sre=vO.codeAt,bre=function(e){var t,r,a=[],c=fre(pre(mre(e),aj,"."),".");for(t=0;t<c.length;t++)r=c[t],pd(a,hre(dre,r)?"xn--"+_re(r):r);return lj(a,".")},Ul=oa,Tre=Go,wre=Wa,hj=Fte,pj=Ac,Rre=pj.set,Vb=pj.getterFor("URL"),Cre=hj.URLSearchParams,Are=hj.getState,_y=MO.URL,VO=MO.TypeError,Fb=MO.parseInt,Ore=Math.floor,fj=Math.pow,Qo=Xo("".charAt),Vs=Xo(/./.exec),vy=Xo([].join),Ire=Xo(1 .toString),Nre=Xo([].pop),vm=Xo([].push),FO=Xo("".replace),Pre=Xo([].shift),Dre=Xo("".split),yy=Xo("".slice),Bb=Xo("".toLowerCase),xre=Xo([].unshift),BO="Invalid scheme",Xh="Invalid host",mj="Invalid port",gj=/[a-z]/i,kre=/[\d+-.a-z]/i,WO=/\d/,Lre=/^0x/i,Mre=/^[0-7]+$/,Ure=/^\d+$/,_j=/^[\da-f]+$/i,jre=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Vre=/[\0\t\n\r #/:<>?@[\\\]^|]/,Fre=/^[\u0000-\u0020]+/,Bre=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wre=/[\t\n\r]/g,Ey=function(e){var t,r,a,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)xre(t,e%256),e=Ore(e/256);return vy(t,".")}if(typeof e=="object"){for(t="",a=function(l){for(var d=null,p=1,g=null,v=0,y=0;y<8;y++)l[y]!==0?(v>p&&(d=g,p=v),g=null,v=0):(g===null&&(g=y),++v);return v>p?g:d}(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),a===r?(t+=r?":":"::",c=!0):(t+=Ire(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},Wb={},vj=jO({},Wb,{" ":1,'"':1,"<":1,">":1,"`":1}),yj=jO({},vj,{"#":1,"?":1,"{":1,"}":1}),GO=jO({},yj,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),fd=function(e,t){var r=Sre(e,0);return r>32&&r<127&&!UO(t,e)?e:encodeURIComponent(e)},Gb={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Sy=function(e,t){var r;return e.length===2&&Vs(gj,Qo(e,0))&&((r=Qo(e,1))===":"||!t&&r==="|")},Ej=function(e){var t;return e.length>1&&Sy(yy(e,0,2))&&(e.length===2||(t=Qo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Gre=function(e){return e==="."||Bb(e)==="%2e"},HO={},Sj={},qO={},bj={},Tj={},KO={},wj={},Rj={},Hb={},qb={},zO={},$O={},YO={},XO={},Cj={},JO={},ym={},Vc={},Aj={},Jh={},jl={},QO=function(e,t,r){var a,c,l,d=Ul(e);if(t){if(c=this.parse(d))throw new VO(c);this.searchParams=null}else{if(r!==void 0&&(a=new QO(r,!0)),c=this.parse(d,null,a))throw new VO(c);(l=Are(new Cre)).bindURL(this),this.searchParams=l}};QO.prototype={type:"URL",parse:function(e,t,r){var a,c,l,d,p,g=this,v=t||HO,y=0,b="",R=!1,O=!1,V=!1;for(e=Ul(e),t||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,e=FO(e,Fre,""),e=FO(e,Bre,"$1")),e=FO(e,Wre,""),a=_m(e);y<=a.length;){switch(c=a[y],v){case HO:if(!c||!Vs(gj,c)){if(t)return BO;v=qO;continue}b+=Bb(c),v=Sj;break;case Sj:if(c&&(Vs(kre,c)||c==="+"||c==="-"||c==="."))b+=Bb(c);else{if(c!==":"){if(t)return BO;b="",v=qO,y=0;continue}if(t&&(g.isSpecial()!==UO(Gb,b)||b==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=b,t)return void(g.isSpecial()&&Gb[g.scheme]===g.port&&(g.port=null));b="",g.scheme==="file"?v=XO:g.isSpecial()&&r&&r.scheme===g.scheme?v=bj:g.isSpecial()?v=Rj:a[y+1]==="/"?(v=Tj,y++):(g.cannotBeABaseURL=!0,vm(g.path,""),v=Aj)}break;case qO:if(!r||r.cannotBeABaseURL&&c!=="#")return BO;if(r.cannotBeABaseURL&&c==="#"){g.scheme=r.scheme,g.path=js(r.path),g.query=r.query,g.fragment="",g.cannotBeABaseURL=!0,v=jl;break}v=r.scheme==="file"?XO:KO;continue;case bj:if(c!=="/"||a[y+1]!=="/"){v=KO;continue}v=Hb,y++;break;case Tj:if(c==="/"){v=qb;break}v=Vc;continue;case KO:if(g.scheme=r.scheme,c===Yo)g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=js(r.path),g.query=r.query;else if(c==="/"||c==="\\"&&g.isSpecial())v=wj;else if(c==="?")g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=js(r.path),g.query="",v=Jh;else{if(c!=="#"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=js(r.path),g.path.length--,v=Vc;continue}g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=js(r.path),g.query=r.query,g.fragment="",v=jl}break;case wj:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,v=Vc;continue}v=qb}else v=Hb;break;case Rj:if(v=Hb,c!=="/"||Qo(b,y+1)!=="/")continue;y++;break;case Hb:if(c!=="/"&&c!=="\\"){v=qb;continue}break;case qb:if(c==="@"){R&&(b="%40"+b),R=!0,l=_m(b);for(var k=0;k<l.length;k++){var L=l[k];if(L!==":"||V){var H=fd(L,GO);V?g.password+=H:g.username+=H}else V=!0}b=""}else if(c===Yo||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(R&&b==="")return"Invalid authority";y-=_m(b).length+1,b="",v=zO}else b+=c;break;case zO:case $O:if(t&&g.scheme==="file"){v=JO;continue}if(c!==":"||O){if(c===Yo||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&b==="")return Xh;if(t&&b===""&&(g.includesCredentials()||g.port!==null))return;if(d=g.parseHost(b))return d;if(b="",v=ym,t)return;continue}c==="["?O=!0:c==="]"&&(O=!1),b+=c}else{if(b==="")return Xh;if(d=g.parseHost(b))return d;if(b="",v=YO,t===$O)return}break;case YO:if(!Vs(WO,c)){if(c===Yo||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||t){if(b!==""){var q=Fb(b,10);if(q>65535)return mj;g.port=g.isSpecial()&&q===Gb[g.scheme]?null:q,b=""}if(t)return;v=ym;continue}return mj}b+=c;break;case XO:if(g.scheme="file",c==="/"||c==="\\")v=Cj;else{if(!r||r.scheme!=="file"){v=Vc;continue}switch(c){case Yo:g.host=r.host,g.path=js(r.path),g.query=r.query;break;case"?":g.host=r.host,g.path=js(r.path),g.query="",v=Jh;break;case"#":g.host=r.host,g.path=js(r.path),g.query=r.query,g.fragment="",v=jl;break;default:Ej(vy(js(a,y),""))||(g.host=r.host,g.path=js(r.path),g.shortenPath()),v=Vc;continue}}break;case Cj:if(c==="/"||c==="\\"){v=JO;break}r&&r.scheme==="file"&&!Ej(vy(js(a,y),""))&&(Sy(r.path[0],!0)?vm(g.path,r.path[0]):g.host=r.host),v=Vc;continue;case JO:if(c===Yo||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&Sy(b))v=Vc;else if(b===""){if(g.host="",t)return;v=ym}else{if(d=g.parseHost(b))return d;if(g.host==="localhost"&&(g.host=""),t)return;b="",v=ym}continue}b+=c;break;case ym:if(g.isSpecial()){if(v=Vc,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==Yo&&(v=Vc,c!=="/"))continue}else g.fragment="",v=jl;else g.query="",v=Jh;break;case Vc:if(c===Yo||c==="/"||c==="\\"&&g.isSpecial()||!t&&(c==="?"||c==="#")){if((p=Bb(p=b))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||vm(g.path,"")):Gre(b)?c==="/"||c==="\\"&&g.isSpecial()||vm(g.path,""):(g.scheme==="file"&&!g.path.length&&Sy(b)&&(g.host&&(g.host=""),b=Qo(b,0)+":"),vm(g.path,b)),b="",g.scheme==="file"&&(c===Yo||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Pre(g.path);c==="?"?(g.query="",v=Jh):c==="#"&&(g.fragment="",v=jl)}else b+=fd(c,yj);break;case Aj:c==="?"?(g.query="",v=Jh):c==="#"?(g.fragment="",v=jl):c!==Yo&&(g.path[0]+=fd(c,Wb));break;case Jh:t||c!=="#"?c!==Yo&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":fd(c,Wb)):(g.fragment="",v=jl);break;case jl:c!==Yo&&(g.fragment+=fd(c,vj))}y++}},parseHost:function(e){var t,r,a;if(Qo(e,0)==="["){if(Qo(e,e.length-1)!=="]"||(t=function(c){var l,d,p,g,v,y,b,R=[0,0,0,0,0,0,0,0],O=0,V=null,k=0,L=function(){return Qo(c,k)};if(L()===":"){if(Qo(c,1)!==":")return;k+=2,V=++O}for(;L();){if(O===8)return;if(L()!==":"){for(l=d=0;d<4&&Vs(_j,L());)l=16*l+Fb(L(),16),k++,d++;if(L()==="."){if(d===0||(k-=d,O>6))return;for(p=0;L();){if(g=null,p>0){if(!(L()==="."&&p<4))return;k++}if(!Vs(WO,L()))return;for(;Vs(WO,L());){if(v=Fb(L(),10),g===null)g=v;else{if(g===0)return;g=10*g+v}if(g>255)return;k++}R[O]=256*R[O]+g,++p!=2&&p!==4||O++}if(p!==4)return;break}if(L()===":"){if(k++,!L())return}else if(L())return;R[O++]=l}else{if(V!==null)return;k++,V=++O}}if(V!==null)for(y=O-V,O=7;O!==0&&y>0;)b=R[O],R[O--]=R[V+y-1],R[V+--y]=b;else if(O!==8)return;return R}(yy(e,1,-1)),!t))return Xh;this.host=t}else if(this.isSpecial()){if(e=bre(e),Vs(jre,e)||(t=function(c){var l,d,p,g,v,y,b,R=Dre(c,".");if(R.length&&R[R.length-1]===""&&R.length--,(l=R.length)>4)return c;for(d=[],p=0;p<l;p++){if((g=R[p])==="")return c;if(v=10,g.length>1&&Qo(g,0)==="0"&&(v=Vs(Lre,g)?16:8,g=yy(g,v===8?1:2)),g==="")y=0;else{if(!Vs(v===10?Ure:v===8?Mre:_j,g))return c;y=Fb(g,v)}vm(d,y)}for(p=0;p<l;p++)if(y=d[p],p===l-1){if(y>=fj(256,5-l))return null}else if(y>255)return null;for(b=Nre(d),p=0;p<d.length;p++)b+=d[p]*fj(256,3-p);return b}(e),t===null))return Xh;this.host=t}else{if(Vs(Vre,e))return Xh;for(t="",r=_m(e),a=0;a<r.length;a++)t+=fd(r[a],Wb);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return UO(Gb,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Sy(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,a=e.password,c=e.host,l=e.port,d=e.path,p=e.query,g=e.fragment,v=t+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=r+(a?":"+a:"")+"@"),v+=Ey(c),l!==null&&(v+=":"+l)):t==="file"&&(v+="//"),v+=e.cannotBeABaseURL?d[0]:d.length?"/"+vy(d,"/"):"",p!==null&&(v+="?"+p),g!==null&&(v+="#"+g),v},setHref:function(e){var t=this.parse(e);if(t)throw new VO(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Em(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Ey(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ul(e)+":",HO)},getUsername:function(){return this.username},setUsername:function(e){var t=_m(Ul(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=fd(t[r],GO)}},getPassword:function(){return this.password},setPassword:function(e){var t=_m(Ul(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=fd(t[r],GO)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Ey(e):Ey(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,zO)},getHostname:function(){var e=this.host;return e===null?"":Ey(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,$O)},getPort:function(){var e=this.port;return e===null?"":Ul(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Ul(e))===""?this.port=null:this.parse(e,YO))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+vy(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,ym))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Ul(e))===""?this.query=null:(Qo(e,0)==="?"&&(e=yy(e,1)),this.query="",this.parse(e,Jh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Ul(e))!==""?(Qo(e,0)==="#"&&(e=yy(e,1)),this.fragment="",this.parse(e,jl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Em=function(e){var t=Ere(this,Ia),r=wre(arguments.length,1)>1?arguments[1]:void 0,a=Rre(t,new QO(e,!1,r));LO||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},Ia=Em.prototype,Zo=function(e,t){return{get:function(){return Vb(this)[e]()},set:t&&function(r){return Vb(this)[t](r)},configurable:!0,enumerable:!0}};if(LO&&(Jo(Ia,"href",Zo("serialize","setHref")),Jo(Ia,"origin",Zo("getOrigin")),Jo(Ia,"protocol",Zo("getProtocol","setProtocol")),Jo(Ia,"username",Zo("getUsername","setUsername")),Jo(Ia,"password",Zo("getPassword","setPassword")),Jo(Ia,"host",Zo("getHost","setHost")),Jo(Ia,"hostname",Zo("getHostname","setHostname")),Jo(Ia,"port",Zo("getPort","setPort")),Jo(Ia,"pathname",Zo("getPathname","setPathname")),Jo(Ia,"search",Zo("getSearch","setSearch")),Jo(Ia,"searchParams",Zo("getSearchParams")),Jo(Ia,"hash",Zo("getHash","setHash"))),jb(Ia,"toJSON",function(){return Vb(this).serialize()},{enumerable:!0}),jb(Ia,"toString",function(){return Vb(this).serialize()},{enumerable:!0}),_y){var Oj=_y.createObjectURL,Ij=_y.revokeObjectURL;Oj&&jb(Em,"createObjectURL",dj(Oj,_y)),Ij&&jb(Em,"revokeObjectURL",dj(Ij,_y))}Tre(Em,"URL"),vre({global:!0,forced:!yre,sham:!LO},{URL:Em});var Hre=er,Nj=f,qre=Wa,Pj=oa,Kre=Db,ZO=Fn("URL"),zre=Kre&&Nj(function(){ZO.canParse()}),$re=Nj(function(){return ZO.canParse.length!==1});Hre({target:"URL",stat:!0,forced:!zre||$re},{canParse:function(e){var t=qre(arguments.length,1),r=Pj(e),a=t<2||arguments[1]===void 0?void 0:Pj(arguments[1]);try{return!!new ZO(r,a)}catch{return!1}}});var Yre=er,Xre=Wa,Dj=oa,Jre=Db,Qre=Fn("URL");Yre({target:"URL",stat:!0,forced:!Jre},{parse:function(e){var t=Xre(arguments.length,1),r=Dj(e),a=t<2||arguments[1]===void 0?void 0:Dj(arguments[1]);try{return new Qre(r,a)}catch{return null}}});var Kb=u(xn.URL);let xj=!0,kj=!0;function zb(e,t,r){const a=e.match(t);return a&&a.length>=r&&parseInt(a[r],10)}function Qh(e,t,r){if(!e.RTCPeerConnection)return;const a=e.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(d,p){if(d!==t)return c.apply(this,arguments);const g=v=>{const y=r(v);y&&(p.handleEvent?p.handleEvent(y):p(y))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,g),c.apply(this,[d,g])};const l=a.removeEventListener;a.removeEventListener=function(d,p){if(d!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(p))return l.apply(this,arguments);const g=this._eventMap[t].get(p);return this._eventMap[t].delete(p),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[d,g])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function Zre(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(xj=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ene(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(kj=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Lj(){if(typeof window=="object"){if(xj)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function eI(e,t){kj&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Mj(e){return Object.prototype.toString.call(e)==="[object Object]"}function Uj(e){var t;return Mj(e)?sa(t=Object.keys(e)).call(t,function(r,a){const c=Mj(e[a]),l=c?Uj(e[a]):e[a],d=c&&!Object.keys(l).length;return l===void 0||d?r:Object.assign(r,{[a]:l})},{}):e}function tI(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?tI(e,e.get(t[a]),r):a.endsWith("Ids")&&t[a].forEach(c=>{tI(e,e.get(c),r)})}))}function jj(e,t,r){const a=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;const l=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&l.push(d)}),l.forEach(d=>{e.forEach(p=>{p.type===a&&p.trackId===d.id&&tI(e,p,c)})}),c}const Vj=Lj;function Fj(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const a=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const p={};return Object.keys(d).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const v=typeof d[g]=="object"?d[g]:{ideal:d[g]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const y=function(b,R){return b?b+R.charAt(0).toUpperCase()+R.slice(1):R==="deviceId"?"sourceId":R};if(v.ideal!==void 0){p.optional=p.optional||[];let b={};typeof v.ideal=="number"?(b[y("min",g)]=v.ideal,p.optional.push(b),b={},b[y("max",g)]=v.ideal,p.optional.push(b)):(b[y("",g)]=v.ideal,p.optional.push(b))}v.exact!==void 0&&typeof v.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[y("",g)]=v.exact):["min","max"].forEach(b=>{v[b]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[y(b,g)]=v[b])})}),d.advanced&&(p.optional=(p.optional||[]).concat(d.advanced)),p},c=function(d,p){if(t.version>=61)return p(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const g=function(v,y,b){y in v&&!(b in v)&&(v[b]=v[y],delete v[y])};g((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),g(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=a(d.audio)}if(d&&typeof d.video=="object"){let g=d.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const v=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||v)){let y;if(delete d.video.facingMode,g.exact==="environment"||g.ideal==="environment"?y=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(y=["front"]),y)return r.mediaDevices.enumerateDevices().then(b=>{let R=(b=b.filter(O=>O.kind==="videoinput")).find(O=>y.some(V=>{var k;return Ve(k=O.label.toLowerCase()).call(k,V)}));return!R&&b.length&&Ve(y).call(y,"back")&&(R=b[b.length-1]),R&&(d.video.deviceId=g.exact?{exact:R.deviceId}:{ideal:R.deviceId}),d.video=a(d.video),Vj("chrome: "+JSON.stringify(d)),p(d)})}d.video=a(d.video)}return Vj("chrome: "+JSON.stringify(d)),p(d)},l=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(d,p,g){c(d,v=>{r.webkitGetUserMedia(v,p,y=>{g&&g(l(y))})})}).bind(r),r.mediaDevices.getUserMedia){const d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return c(p,g=>d(g).then(v=>{if(g.audio&&!v.getAudioTracks().length||g.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return v},v=>Ge.reject(l(v))))}}}function Bj(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Wj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===a.track.id):{track:a.track};const l=new Event("track");l.track=a.track,l.receiver=c,l.transceiver={receiver:c},l.streams=[r.stream],this.dispatchEvent(l)}),r.stream.getTracks().forEach(a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===a.id):{track:a};const l=new Event("track");l.track=a,l.receiver=c,l.transceiver={receiver:c},l.streams=[r.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Qh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Gj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(c,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=c.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,p){let g=c.apply(this,arguments);return g||(g=t(this,d),this._senders.push(g)),g};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);const p=this._senders.indexOf(d);p!==-1&&this._senders.splice(p,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(l=>{const d=this._senders.find(p=>p.track===l);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Hj(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,a,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const l=function(p){const g={};return p.result().forEach(v=>{const y={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(b=>{y[b]=v.stat(b)}),g[y.id]=y}),g},d=function(p){return new Map(Object.keys(p).map(g=>[g,p[g]]))};if(arguments.length>=2){const p=function(g){a(d(l(g)))};return t.apply(this,[p,r])}return new Ge((p,g)=>{t.apply(this,[function(v){p(d(l(v)))},g])}).then(a,c)}}function qj(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach(l=>l._pc=this),c});const a=e.RTCPeerConnection.prototype.addTrack;a&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(l=>jj(l,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a}),Qh(e,"track",a=>(a.receiver._pc=a.srcElement,a)),e.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>jj(c,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let a,c,l;return this.getSenders().forEach(d=>{d.track===r&&(a?l=!0:a=d)}),this.getReceivers().forEach(d=>(d.track===r&&(c?l=!0:c=d),d.track===r)),l||a&&c?Ge.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Ge.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Kj(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(g=>d.indexOf(g)===-1);this._shimmedLocalStreams[l.id]=[l].concat(p)};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],a.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const p=this._shimmedLocalStreams[d].indexOf(l);p!==-1&&this._shimmedLocalStreams[d].splice(p,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),c.apply(this,arguments)}}function zj(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Kj(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const g=r.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(b=>b.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new e.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}a.apply(this,[g])};const c=e.RTCPeerConnection.prototype.removeStream;function l(g,v){let y=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(b=>{const R=g._reverseStreams[b],O=g._streams[R.id];y=y.replace(new RegExp(O.id,"g"),R.id)}),new RTCSessionDescription({type:v.type,sdp:y})}e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(O=>O===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(O=>O.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[v.id];if(R)R.addTrack(g),Ge.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const O=new e.MediaStream([g]);this._streams[v.id]=O,this._reverseStreams[O.id]=v,this.addStream(O)}return this.getSenders().find(O=>O.track===g)},["createOffer","createAnswer"].forEach(function(g){const v=e.RTCPeerConnection.prototype[g],y={[g](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[R=>{const O=l(this,R);b[0].apply(null,[O])},R=>{b[1]&&b[1].apply(null,R)},arguments[2]]):v.apply(this,arguments).then(R=>l(this,R))}};e.RTCPeerConnection.prototype[g]=y[g]});const d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,v){let y=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(b=>{const R=g._reverseStreams[b],O=g._streams[R.id];y=y.replace(new RegExp(R.id,"g"),O.id)}),new RTCSessionDescription({type:v.type,sdp:y})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=p.get.apply(this);return g.type===""?g:l(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(b=>g.track===b)&&(v=this._streams[y])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function rI(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]})}function $j(e,t){Qh(e,"negotiationneeded",r=>{const a=r.target;if(!(t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return r})}var Yj=Object.freeze({__proto__:null,fixNegotiationNeeded:$j,shimAddTrackRemoveTrack:zj,shimAddTrackRemoveTrackWithNative:Kj,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(a=>{const c=r.video&&r.video.width,l=r.video&&r.video.height,d=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:d||3}},c&&(r.video.mandatory.maxWidth=c),l&&(r.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Gj,shimGetStats:Hj,shimGetUserMedia:Fj,shimMediaStream:Bj,shimOnTrack:Wj,shimPeerConnection:rI,shimSenderReceiverGetStats:qj});function Xj(e,t){const r=e&&e.navigator,a=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,l,d){eI("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(l,d)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(d,p,g){p in d&&!(g in d)&&(d[g]=d[p],delete d[p])},l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),c(d.audio,"autoGainControl","mozAutoGainControl"),c(d.audio,"noiseSuppression","mozNoiseSuppression")),l(d)},a&&a.prototype.getSettings){const d=a.prototype.getSettings;a.prototype.getSettings=function(){const p=d.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){const d=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[p])}}}}function Jj(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nI(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const l=e.RTCPeerConnection.prototype[c],d={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=d[c]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,l,d]=arguments;return a.apply(this,[c||null]).then(p=>{if(t.version<53&&!l)try{p.forEach(g=>{g.type=r[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;p.forEach((v,y)=>{p.set(y,Object.assign({},v,{type:r[v.type]||v.type}))})}return p}).then(l,d)}}function Qj(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(c=>c._pc=this),a});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ge.resolve(new Map)}}function Zj(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r}),Qh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function eV(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){eI("removeStream","removeTrack"),this.getSenders().forEach(r=>{var a;r.track&&Ve(a=t.getTracks()).call(a,r.track)&&this.removeTrack(r)})})}function tV(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function rV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=t.apply(this,arguments);if(a){const{sender:l}=c,d=l.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=r,l.sendEncodings=r,this.setParametersPromises.push(l.setParameters(d).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return c})}function nV(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function iV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ge.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function aV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ge.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var oV=Object.freeze({__proto__:null,shimAddTransceiver:rV,shimCreateAnswer:aV,shimCreateOffer:iV,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Ge.reject(a)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:nV,shimGetUserMedia:Xj,shimOnTrack:Jj,shimPeerConnection:nI,shimRTCDataChannel:tV,shimReceiverGetStats:Zj,shimRemoveStream:eV,shimSenderGetStats:Qj});function sV(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var a;this._localStreams||(this._localStreams=[]),Ve(a=this._localStreams).call(a,r)||this._localStreams.push(r),r.getAudioTracks().forEach(c=>t.call(this,c,r)),r.getVideoTracks().forEach(c=>t.call(this,c,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var a=arguments.length,c=new Array(a>1?a-1:0),l=1;l<a;l++)c[l-1]=arguments[l];return c&&c.forEach(d=>{var p;this._localStreams?Ve(p=this._localStreams).call(p,d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const a=t.getTracks();this.getSenders().forEach(c=>{Ve(a).call(a,c.track)&&this.removeTrack(c)})})}}function cV(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),Ve(l=this._remoteStreams).call(l,c))return;this._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,this.dispatchEvent(d)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const l=new Event("addstream");l.stream=c,r.dispatchEvent(l)})}),t.apply(r,arguments)}}}function lV(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,a=t.createAnswer,c=t.setLocalDescription,l=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(g,v){const y=arguments.length>=2?arguments[2]:arguments[0],b=r.apply(this,[y]);return v?(b.then(g,v),Ge.resolve()):b},t.createAnswer=function(g,v){const y=arguments.length>=2?arguments[2]:arguments[0],b=a.apply(this,[y]);return v?(b.then(g,v),Ge.resolve()):b};let p=function(g,v,y){const b=c.apply(this,[g]);return y?(b.then(v,y),Ge.resolve()):b};t.setLocalDescription=p,p=function(g,v,y){const b=l.apply(this,[g]);return y?(b.then(v,y),Ge.resolve()):b},t.setRemoteDescription=p,p=function(g,v,y){const b=d.apply(this,[g]);return y?(b.then(v,y),Ge.resolve()):b},t.addIceCandidate=p}function uV(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,a=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>a(dV(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,a,c){t.mediaDevices.getUserMedia(r).then(a,c)}).bind(t))}function dV(e){return e&&e.video!==void 0?Object.assign({},e,{video:Uj(e.video)}):e}function hV(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const c=[];for(let l=0;l<r.iceServers.length;l++){let d=r.iceServers[l];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(eI("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,c.push(d)):c.push(r.iceServers[l])}r.iceServers=c}return new t(r,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function pV(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fV(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):r.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(l=>l.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function mV(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var gV=Object.freeze({__proto__:null,shimAudioContext:mV,shimCallbacksAPI:lV,shimConstraints:dV,shimCreateOfferLegacy:fV,shimGetUserMedia:uV,shimLocalStreamsAPI:sV,shimRTCIceServerUrls:hV,shimRemoteStreamsAPI:cV,shimTrackEventTransceiver:pV}),_V=`	
\v\f\r                　\u2028\u2029\uFEFF`,tne=Or,rne=oa,iI=_V,vV=A("".replace),nne=RegExp("^["+iI+"]+"),ine=RegExp("(^|[^"+iI+"])["+iI+"]+$"),ane=function(e){return function(t){var r=rne(tne(t));return 1&e&&(r=vV(r,nne,"")),2&e&&(r=vV(r,ine,"$1")),r}},one={trim:ane(3)},sne=Wf.PROPER,cne=f,yV=_V,lne=one.trim;er({target:"String",proto:!0,forced:function(e){return cne(function(){return!!yV[e]()||"​᠎"[e]()!=="​᠎"||sne&&yV[e].name!==e})}("trim")},{trim:function(){return lne(this)}});var une=Sa("String","trim"),dne=P,hne=une,aI=String.prototype,pne=function(e){var t=e.trim;return typeof e=="string"||e===aI||dne(aI,e)&&t===aI.trim?hne:t},Ti=u(pne),EV={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(r){return r.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},t.getDescription=function(r){const a=t.splitSections(r);return a&&a[0]},t.getMediaSections=function(r){const a=t.splitSections(r);return a.shift(),a},t.matchPrefix=function(r,a){return t.splitLines(r).filter(c=>c.indexOf(a)===0)},t.parseCandidate=function(r){let a;a=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":c.relatedAddress=a[l+1];break;case"rport":c.relatedPort=parseInt(a[l+1],10);break;case"tcptype":c.tcpType=a[l+1];break;case"ufrag":c.ufrag=a[l+1],c.usernameFragment=a[l+1];break;default:c[a[l]]===void 0&&(c[a[l]]=a[l+1])}return c},t.writeCandidate=function(r){const a=[];a.push(r.foundation);const c=r.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const l=r.type;return a.push("typ"),a.push(l),l!=="host"&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let a=r.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let a=r.payloadType;r.preferredPayloadType!==void 0&&(a=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const a={};let c;const l=r.substring(r.indexOf(" ")+1).split(";");for(let d=0;d<l.length;d++)c=l[d].trim().split("="),a[c[0].trim()]=c[1];return a},t.writeFmtp=function(r){let a="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const l=[];Object.keys(r.parameters).forEach(d=>{r.parameters[d]!==void 0?l.push(d+"="+r.parameters[d]):l.push(d)}),a+="a=fmtp:"+c+" "+l.join(";")+`\r
`}return a},t.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(r){let a="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+c+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(r){const a=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,a),10)},l=r.indexOf(":",a);return l>-1?(c.attribute=r.substring(a+1,l),c.value=r.substring(l+1)):c.attribute=r.substring(a+1),c},t.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},t.getMid=function(r){const a=t.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:t.matchPrefix(r+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,a){let c="a=setup:"+a+`\r
`;return r.fingerprints.forEach(l=>{c+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),c},t.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,a){return t.matchPrefix(r+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,a){const c=t.matchPrefix(r+a,"a=ice-ufrag:")[0],l=t.matchPrefix(r+a,"a=ice-pwd:")[0];return c&&l?{usernameFragment:c.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");a.profile=c[2];for(let d=3;d<c.length;d++){const p=c[d],g=t.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(g){const v=t.parseRtpMap(g),y=t.matchPrefix(r,"a=fmtp:"+p+" ");switch(v.parameters=y.length?t.parseFmtp(y[0]):{},v.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(d=>{a.headerExtensions.push(t.parseExtmap(d))});const l=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(d=>{l.forEach(p=>{d.rtcpFeedback.find(g=>g.type===p.type&&g.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),a},t.writeRtpDescription=function(r,a){let c="";c+="m="+r+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(d=>{c+=t.writeRtpMap(d),c+=t.writeFmtp(d),c+=t.writeRtcpFb(d)});let l=0;return a.codecs.forEach(d=>{d.maxptime>l&&(l=d.maxptime)}),l>0&&(c+="a=maxptime:"+l+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(d=>{c+=t.writeExtmap(d)}),c},t.parseRtpEncodingParameters=function(r){const a=[],c=t.parseRtpParameters(r),l=c.fecMechanisms.indexOf("RED")!==-1,d=c.fecMechanisms.indexOf("ULPFEC")!==-1,p=t.matchPrefix(r,"a=ssrc:").map(R=>t.parseSsrcMedia(R)).filter(R=>R.attribute==="cname"),g=p.length>0&&p[0].ssrc;let v;const y=t.matchPrefix(r,"a=ssrc-group:FID").map(R=>R.substring(17).split(" ").map(O=>parseInt(O,10)));y.length>0&&y[0].length>1&&y[0][0]===g&&(v=y[0][1]),c.codecs.forEach(R=>{if(R.name.toUpperCase()==="RTX"&&R.parameters.apt){let O={ssrc:g,codecPayloadType:parseInt(R.parameters.apt,10)};g&&v&&(O.rtx={ssrc:v}),a.push(O),l&&(O=JSON.parse(JSON.stringify(O)),O.fec={ssrc:g,mechanism:d?"red+ulpfec":"red"},a.push(O))}}),a.length===0&&g&&a.push({ssrc:g});let b=t.matchPrefix(r,"b=");return b.length&&(b=b[0].indexOf("b=TIAS:")===0?parseInt(b[0].substring(7),10):b[0].indexOf("b=AS:")===0?1e3*parseInt(b[0].substring(5),10)*.95-16e3:void 0,a.forEach(R=>{R.maxBitrate=b})),a},t.parseRtcpParameters=function(r){const a={},c=t.matchPrefix(r,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const l=t.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=l.length===0;const d=t.matchPrefix(r,"a=rtcp-mux");return a.mux=d.length>0,a},t.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+=`a=rtcp-rsize\r
`),r.mux&&(a+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),a},t.parseMsid=function(r){let a;const c=t.matchPrefix(r,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=t.matchPrefix(r,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return l.length>0?(a=l[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},t.parseSctpDescription=function(r){const a=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:");let l;c.length>0&&(l=parseInt(c[0].substring(19),10)),isNaN(l)&&(l=65536);const d=t.matchPrefix(r,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const p=t.matchPrefix(r,"a=sctpmap:");if(p.length>0){const g=p[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:l}}},t.writeSctpDescription=function(r,a){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,a,c){let l;const d=a!==void 0?a:2;return l=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+l+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,a){const c=t.splitLines(r);for(let l=0;l<c.length;l++)switch(c[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[l].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const a=t.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(r){const a=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const a=t.splitLines(r);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(EV);var SV=EV.exports,Sm=u(SV),fne=o({__proto__:null,default:Sm},[SV]);function $b(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new t(r),c=Sm.parseCandidate(r.candidate),l=Object.assign(a,c);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Qh(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function oI(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Qh(e,"icecandidate",t=>{if(t.candidate){const r=Sm.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function Yb(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(p){if(!p||!p.sdp)return!1;const g=Sm.splitSections(p.sdp);return g.shift(),g.some(v=>{const y=Sm.parseMLine(v);return y&&y.kind==="application"&&y.protocol.indexOf("SCTP")!==-1})},a=function(p){const g=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const v=parseInt(g[1],10);return v!=v?-1:v},c=function(p){let g=65536;return t.browser==="firefox"&&(g=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),g},l=function(p,g){let v=65536;t.browser==="firefox"&&t.version===57&&(v=65535);const y=Sm.matchPrefix(p.sdp,"a=max-message-size:");return y.length>0?v=parseInt(y[0].substr(19),10):t.browser==="firefox"&&g!==-1&&(v=2147483637),v},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const p=a(arguments[0]),g=c(p),v=l(arguments[0],p);let y;y=g===0&&v===0?Number.POSITIVE_INFINITY:g===0||v===0?Math.max(g,v):Math.min(g,v);const b={};Object.defineProperty(b,"maxMessageSize",{get:()=>y}),this._sctp=b}return d.apply(this,arguments)}}function Xb(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(a,c){const l=a.send;a.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(a.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return t(a,this),a},Qh(e,"datachannel",a=>(t(a.channel,a.target),a))}function sI(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const l=c.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const d=new Event("connectionstatechange",c);l.dispatchEvent(d)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function cI(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(l=>Ti(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return r.apply(this,arguments)}}function Jb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ge.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ge.resolve())})}function Qb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?r.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var mne=Object.freeze({__proto__:null,removeExtmapAllowMixed:cI,shimAddIceCandidateNullOrEmpty:Jb,shimConnectionState:sI,shimMaxMessageSize:Yb,shimParameterlessSetLocalDescription:Qb,shimRTCIceCandidate:$b,shimRTCIceCandidateRelayProtocol:oI,shimSendThrowTypeError:Xb});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=Lj,a=function(l){const d={browser:null,version:null};if(l===void 0||!l.navigator)return d.browser="Not a browser.",d;const{navigator:p}=l;if(p.mozGetUserMedia)d.browser="firefox",d.version=zb(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)d.browser="chrome",d.version=zb(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=zb(p.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return d}(e),c={browserDetails:a,commonShim:mne,extractVersion:zb,disableLog:Zre,disableWarnings:ene,sdp:fne};switch(a.browser){case"chrome":if(!Yj||!rI||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(a.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=Yj,Jb(e,a),Qb(e),Fj(e,a),Bj(e),rI(e,a),Wj(e),zj(e,a),Gj(e),Hj(e),qj(e),$j(e,a),$b(e),oI(e),sI(e),Yb(e,a),Xb(e),cI(e,a);break;case"firefox":if(!oV||!nI||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=oV,Jb(e,a),Qb(e),Xj(e,a),nI(e,a),Jj(e),eV(e),Qj(e),Zj(e),tV(e),rV(e),nV(e),iV(e),aV(e),$b(e),sI(e),Yb(e,a),Xb(e);break;case"safari":if(!gV||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=gV,Jb(e,a),Qb(e),hV(e),fV(e),lV(e),sV(e),cV(e),pV(e),uV(e),mV(e),$b(e),oI(e),Yb(e,a),Xb(e),cI(e,a);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var lI=W;er({global:!0,forced:lI.globalThis!==lI},{globalThis:lI});var bV=u(W),uI={exports:{}};(function(e,t){(function(r,a){var c="function",l="undefined",d="object",p="string",g="major",v="model",y="name",b="type",R="vendor",O="version",V="architecture",k="console",L="mobile",H="tablet",q="smarttv",te="wearable",oe="embedded",se="Amazon",ae="Apple",pe="ASUS",Te="BlackBerry",Fe="Browser",ze="Chrome",At="Firefox",bt="Google",pt="Huawei",Er="LG",hr="Microsoft",ra="Motorola",we="Opera",Le="Samsung",Xe="Sharp",Re="Sony",D="Xiaomi",Q="Zebra",ne="Facebook",De="Chromium OS",yt="Mac OS",_r=" Browser",_n=function(hn){for(var vn={},Rr=0;Rr<hn.length;Rr++)vn[hn[Rr].toUpperCase()]=hn[Rr];return vn},Io=function(hn,vn){return typeof hn===p&&fs(vn).indexOf(fs(hn))!==-1},fs=function(hn){return hn.toLowerCase()},CE=function(hn,vn){if(typeof hn===p)return hn=hn.replace(/^\s\s*/,""),typeof vn===l?hn:hn.substring(0,500)},Cp=function(hn,vn){for(var Rr,_a,Zs,Jr,eu,Bt,ec=0;ec<vn.length&&!eu;){var Ap=vn[ec],il=vn[ec+1];for(Rr=_a=0;Rr<Ap.length&&!eu&&Ap[Rr];)if(eu=Ap[Rr++].exec(hn))for(Zs=0;Zs<il.length;Zs++)Bt=eu[++_a],typeof(Jr=il[Zs])===d&&Jr.length>0?Jr.length===2?typeof Jr[1]==c?this[Jr[0]]=Jr[1].call(this,Bt):this[Jr[0]]=Jr[1]:Jr.length===3?typeof Jr[1]!==c||Jr[1].exec&&Jr[1].test?this[Jr[0]]=Bt?Bt.replace(Jr[1],Jr[2]):a:this[Jr[0]]=Bt?Jr[1].call(this,Bt,Jr[2]):a:Jr.length===4&&(this[Jr[0]]=Bt?Jr[3].call(this,Bt.replace(Jr[1],Jr[2])):a):this[Jr]=Bt||a;ec+=2}},pg=function(hn,vn){for(var Rr in vn)if(typeof vn[Rr]===d&&vn[Rr].length>0){for(var _a=0;_a<vn[Rr].length;_a++)if(Io(vn[Rr][_a],hn))return Rr==="?"?a:Rr}else if(Io(vn[Rr],hn))return Rr==="?"?a:Rr;return vn.hasOwnProperty("*")?vn["*"]:hn},$w={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Yw={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[O,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[O,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,O],[/opios[\/ ]+([\w\.]+)/i],[O,[y,we+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[O,[y,we+" GX"]],[/\bopr\/([\w\.]+)/i],[O,[y,we]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[O,[y,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[O,[y,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[y,O],[/quark(?:pc)?\/([-\w\.]+)/i],[O,[y,"Quark"]],[/\bddg\/([\w\.]+)/i],[O,[y,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[O,[y,"UC"+Fe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[O,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[O,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[O,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[O,[y,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[O,[y,"Smart Lenovo "+Fe]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+Fe],O],[/\bfocus\/([\w\.]+)/i],[O,[y,At+" Focus"]],[/\bopt\/([\w\.]+)/i],[O,[y,we+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[O,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[O,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[O,[y,we+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[O,[y,"MIUI"+_r]],[/fxios\/([\w\.-]+)/i],[O,[y,At]],[/\bqihoobrowser\/?([\w\.]*)/i],[O,[y,"360"]],[/\b(qq)\/([\w\.]+)/i],[[y,/(.+)/,"$1Browser"],O],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1"+_r],O],[/samsungbrowser\/([\w\.]+)/i],[O,[y,Le+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[O,[y,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[y,"Sogou Mobile"],O],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[y,O],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[y],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[O,y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,ne],O],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[y,O],[/\bgsa\/([\w\.]+) .*safari\//i],[O,[y,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[O,[y,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[O,[y,ze+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,ze+" WebView"],O],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[O,[y,"Android "+Fe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,O],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[O,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[O,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[O,pg,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[y,O],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],O],[/(wolvic|librewolf)\/([\w\.]+)/i],[y,O],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[O,[y,At+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[y,[O,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[y,[O,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[V,"amd64"]],[/(ia32(?=;))/i],[[V,fs]],[/((?:i[346]|x)86)[;\)]/i],[[V,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[V,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[V,"armhf"]],[/windows (ce|mobile); ppc;/i],[[V,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[V,/ower/,"",fs]],[/(sun4\w)[;\)]/i],[[V,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[V,fs]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[R,Le],[b,H]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[R,Le],[b,L]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[R,ae],[b,L]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[R,ae],[b,H]],[/(macintosh);/i],[v,[R,ae]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[R,Xe],[b,L]],[/(?:honor)([-\w ]+)[;\)]/i],[v,[R,"Honor"],[b,L]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[R,pt],[b,H]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[R,pt],[b,L]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[v,/_/g," "],[R,D],[b,L]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[R,D],[b,H]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[R,"OPPO"],[b,L]],[/\b(opd2\d{3}a?) bui/i],[v,[R,"OPPO"],[b,H]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[R,"Vivo"],[b,L]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[R,"Realme"],[b,L]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[R,ra],[b,L]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[R,ra],[b,H]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[R,Er],[b,H]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[R,Er],[b,L]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[R,"Lenovo"],[b,H]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[R,"Nokia"],[b,L]],[/(pixel c)\b/i],[v,[R,bt],[b,H]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[R,bt],[b,L]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[R,Re],[b,L]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[R,Re],[b,H]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[R,"OnePlus"],[b,L]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[R,se],[b,H]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[R,se],[b,L]],[/(playbook);[-\w\),; ]+(rim)/i],[v,R,[b,H]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[R,Te],[b,L]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[R,pe],[b,H]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[R,pe],[b,L]],[/(nexus 9)/i],[v,[R,"HTC"],[b,H]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[R,[v,/_/g," "],[b,L]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[R,"TCL"],[b,H]],[/(itel) ((\w+))/i],[[R,fs],v,[b,pg,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[R,"Acer"],[b,H]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[R,"Meizu"],[b,L]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[R,"Ulefone"],[b,L]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[R,"Energizer"],[b,L]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[R,"Cat"],[b,L]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[R,"Smartfren"],[b,L]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[R,"Nothing"],[b,L]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[R,v,[b,L]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[R,v,[b,H]],[/(surface duo)/i],[v,[R,hr],[b,H]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[R,"Fairphone"],[b,L]],[/(u304aa)/i],[v,[R,"AT&T"],[b,L]],[/\bsie-(\w*)/i],[v,[R,"Siemens"],[b,L]],[/\b(rct\w+) b/i],[v,[R,"RCA"],[b,H]],[/\b(venue[\d ]{2,7}) b/i],[v,[R,"Dell"],[b,H]],[/\b(q(?:mv|ta)\w+) b/i],[v,[R,"Verizon"],[b,H]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[R,"Barnes & Noble"],[b,H]],[/\b(tm\d{3}\w+) b/i],[v,[R,"NuVision"],[b,H]],[/\b(k88) b/i],[v,[R,"ZTE"],[b,H]],[/\b(nx\d{3}j) b/i],[v,[R,"ZTE"],[b,L]],[/\b(gen\d{3}) b.+49h/i],[v,[R,"Swiss"],[b,L]],[/\b(zur\d{3}) b/i],[v,[R,"Swiss"],[b,H]],[/\b((zeki)?tb.*\b) b/i],[v,[R,"Zeki"],[b,H]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[R,"Dragon Touch"],v,[b,H]],[/\b(ns-?\w{0,9}) b/i],[v,[R,"Insignia"],[b,H]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[R,"NextBook"],[b,H]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[R,"Voice"],v,[b,L]],[/\b(lvtel\-)?(v1[12]) b/i],[[R,"LvTel"],v,[b,L]],[/\b(ph-1) /i],[v,[R,"Essential"],[b,L]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[R,"Envizen"],[b,H]],[/\b(trio[-\w\. ]+) b/i],[v,[R,"MachSpeed"],[b,H]],[/\btu_(1491) b/i],[v,[R,"Rotor"],[b,H]],[/(shield[\w ]+) b/i],[v,[R,"Nvidia"],[b,H]],[/(sprint) (\w+)/i],[R,v,[b,L]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[R,hr],[b,L]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[R,Q],[b,H]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[R,Q],[b,L]],[/smart-tv.+(samsung)/i],[R,[b,q]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[R,Le],[b,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[R,Er],[b,q]],[/(apple) ?tv/i],[R,[v,ae+" TV"],[b,q]],[/crkey/i],[[v,ze+"cast"],[R,bt],[b,q]],[/droid.+aft(\w+)( bui|\))/i],[v,[R,se],[b,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[R,Xe],[b,q]],[/(bravia[\w ]+)( bui|\))/i],[v,[R,Re],[b,q]],[/(mitv-\w{5}) bui/i],[v,[R,D],[b,q]],[/Hbbtv.*(technisat) (.*);/i],[R,v,[b,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[R,CE],[v,CE],[b,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[R,v,[b,k]],[/droid.+; (shield) bui/i],[v,[R,"Nvidia"],[b,k]],[/(playstation [345portablevi]+)/i],[v,[R,Re],[b,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[R,hr],[b,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[v,[R,Le],[b,te]],[/((pebble))app/i],[R,v,[b,te]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[R,ae],[b,te]],[/droid.+; (glass) \d/i],[v,[R,bt],[b,te]],[/droid.+; (wt63?0{2,3})\)/i],[v,[R,Q],[b,te]],[/droid.+; (glass) \d/i],[v,[R,bt],[b,te]],[/(pico) (4|neo3(?: link|pro)?)/i],[R,v,[b,te]],[/; (quest( \d| pro)?)/i],[v,[R,ne],[b,te]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[R,[b,oe]],[/(aeobc)\b/i],[v,[R,se],[b,oe]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[b,L]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[b,H]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,H]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,L]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[R,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[O,[y,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[y,O],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[O,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,O],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[O,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,O],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[y,[O,pg,$w]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[O,pg,$w],[y,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[O,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,yt],[O,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[O,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,O],[/\(bb(10);/i],[O,[y,Te]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[O,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[O,[y,At+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[O,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[O,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[O,[y,ze+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,De],O],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,O],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],O],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,O]]},No=function(hn,vn){if(typeof hn===d&&(vn=hn,hn=a),!(this instanceof No))return new No(hn,vn).getResult();var Rr=typeof r!==l&&r.navigator?r.navigator:a,_a=hn||(Rr&&Rr.userAgent?Rr.userAgent:""),Zs=Rr&&Rr.userAgentData?Rr.userAgentData:a,Jr=vn?function(Bt,ec){var Ap={};for(var il in Bt)ec[il]&&ec[il].length%2==0?Ap[il]=ec[il].concat(Bt[il]):Ap[il]=Bt[il];return Ap}(Yw,vn):Yw,eu=Rr&&Rr.userAgent==_a;return this.getBrowser=function(){var Bt={};return Bt[y]=a,Bt[O]=a,Cp.call(Bt,_a,Jr.browser),Bt[g]=function(ec){return typeof ec===p?ec.replace(/[^\d\.]/g,"").split(".")[0]:a}(Bt[O]),eu&&Rr&&Rr.brave&&typeof Rr.brave.isBrave==c&&(Bt[y]="Brave"),Bt},this.getCPU=function(){var Bt={};return Bt[V]=a,Cp.call(Bt,_a,Jr.cpu),Bt},this.getDevice=function(){var Bt={};return Bt[R]=a,Bt[v]=a,Bt[b]=a,Cp.call(Bt,_a,Jr.device),eu&&!Bt[b]&&Zs&&Zs.mobile&&(Bt[b]=L),eu&&Bt[v]=="Macintosh"&&Rr&&typeof Rr.standalone!==l&&Rr.maxTouchPoints&&Rr.maxTouchPoints>2&&(Bt[v]="iPad",Bt[b]=H),Bt},this.getEngine=function(){var Bt={};return Bt[y]=a,Bt[O]=a,Cp.call(Bt,_a,Jr.engine),Bt},this.getOS=function(){var Bt={};return Bt[y]=a,Bt[O]=a,Cp.call(Bt,_a,Jr.os),eu&&!Bt[y]&&Zs&&Zs.platform&&Zs.platform!="Unknown"&&(Bt[y]=Zs.platform.replace(/chrome os/i,De).replace(/macos/i,yt)),Bt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return _a},this.setUA=function(Bt){return _a=typeof Bt===p&&Bt.length>500?CE(Bt,500):Bt,this},this.setUA(_a),this};No.VERSION="0.7.40",No.BROWSER=_n([y,O,g]),No.CPU=_n([V]),No.DEVICE=_n([v,R,b,k,L,q,H,te,oe]),No.ENGINE=No.OS=_n([y,O]),e.exports&&(t=e.exports=No),t.UAParser=No;var Zl=typeof r!==l&&(r.jQuery||r.Zepto);if(Zl&&!Zl.ua){var Xw=new No;Zl.ua=Xw.getResult(),Zl.ua.get=function(){return Xw.getUA()},Zl.ua.set=function(hn){Xw.setUA(hn);var vn=Xw.getResult();for(var Rr in vn)Zl.ua[Rr]=vn[Rr]}}})(typeof window=="object"?window:s)})(uI,uI.exports);var gne=u(uI.exports),TV=ad.clear;er({global:!0,bind:!0,forced:W.clearImmediate!==TV},{clearImmediate:TV});var wV=W,_ne=J,vne=ye,yne=dh,Ene=lo,Sne=Gn,bne=Wa,Tne=wV.Function,wne=/MSIE .\./.test(Ene)||yne==="BUN"&&function(){var e=wV.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Rne=er,RV=W,CV=ad.set,Cne=function(e,t){var r=1;return wne?function(a,c){var l=bne(arguments.length,1)>r,d=vne(a)?a:Tne(a),p=l?Sne(arguments,r):[],g=l?function(){_ne(d,this,p)}:d;return e(g)}:e},AV=RV.setImmediate?Cne(CV):CV;Rne({global:!0,bind:!0,forced:RV.setImmediate!==AV},{setImmediate:AV});var OV=u(xn.setImmediate),Ane=W,One=dy,Ine=fi,Nne=Wa,Pne=be;er({global:!0,dontCallGetSet:!0,forced:f(function(){return Pne&&Object.getOwnPropertyDescriptor(Ane,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Nne(arguments.length,1),One(Ine(e))}});var IV=u(xn.queueMicrotask);function NV(e,t){return function(){return e.apply(t,arguments)}}const{toString:Dne}=Object.prototype,{getPrototypeOf:dI}=Object,{iterator:Zb,toStringTag:PV}=Symbol,eT=(hI=Object.create(null),e=>{const t=Dne.call(e);return hI[t]||(hI[t]=t.slice(8,-1).toLowerCase())});var hI;const Fs=e=>(e=e.toLowerCase(),t=>eT(t)===e),tT=e=>t=>typeof t===e,{isArray:bm}=Array,by=tT("undefined"),DV=Fs("ArrayBuffer"),xne=tT("string"),qa=tT("function"),xV=tT("number"),rT=e=>e!==null&&typeof e=="object",nT=e=>{if(eT(e)!=="object")return!1;const t=dI(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||PV in e||Zb in e)},kne=Fs("Date"),Lne=Fs("File"),Mne=Fs("Blob"),Une=Fs("FileList"),jne=Fs("URLSearchParams"),[Vne,Fne,Bne,Wne]=["ReadableStream","Request","Response","Headers"].map(Fs);function Ty(e,t){let r,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),bm(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{const l=c?Object.getOwnPropertyNames(e):Object.keys(e),d=l.length;let p;for(r=0;r<d;r++)p=l[r],t.call(null,e[p],p,e)}}function kV(e,t){t=t.toLowerCase();const r=Object.keys(e);let a,c=r.length;for(;c-- >0;)if(a=r[c],t===a.toLowerCase())return a;return null}const Zh=bV!==void 0?bV:typeof self<"u"?self:typeof window<"u"?window:Lp,LV=e=>!by(e)&&e!==Zh,Gne=(pI=typeof Uint8Array<"u"&&dI(Uint8Array),e=>pI&&e instanceof pI);var pI;const Hne=Fs("HTMLFormElement"),MV=(e=>{let{hasOwnProperty:t}=e;return(r,a)=>t.call(r,a)})(Object.prototype),qne=Fs("RegExp"),UV=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),a={};Ty(r,(c,l)=>{let d;(d=t(c,l,e))!==!1&&(a[l]=d||c)}),Object.defineProperties(e,a)},Kne=Fs("AsyncFunction"),jV=(VV=typeof OV=="function",FV=qa(Zh.postMessage),VV?OV:FV?(fI="axios@".concat(Math.random()),iT=[],Zh.addEventListener("message",e=>{let{source:t,data:r}=e;t===Zh&&r===fI&&iT.length&&iT.shift()()},!1),e=>{iT.push(e),Zh.postMessage(fI,"*")}):e=>setTimeout(e));var VV,FV,fI,iT;const zne=IV!==void 0?IV.bind(Zh):typeof process<"u"&&process.nextTick||jV;var Be={isArray:bm,isArrayBuffer:DV,isBuffer:function(e){return e!==null&&!by(e)&&e.constructor!==null&&!by(e.constructor)&&qa(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||qa(e.append)&&((t=eT(e))==="formdata"||t==="object"&&qa(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&DV(e.buffer),t},isString:xne,isNumber:xV,isBoolean:e=>e===!0||e===!1,isObject:rT,isPlainObject:nT,isReadableStream:Vne,isRequest:Fne,isResponse:Bne,isHeaders:Wne,isUndefined:by,isDate:kne,isFile:Lne,isBlob:Mne,isRegExp:qne,isFunction:qa,isStream:e=>rT(e)&&qa(e.pipe),isURLSearchParams:jne,isTypedArray:Gne,isFileList:Une,forEach:Ty,merge:function e(){const{caseless:t}=LV(this)&&this||{},r={},a=(c,l)=>{const d=t&&kV(r,l)||l;nT(r[d])&&nT(c)?r[d]=e(r[d],c):nT(c)?r[d]=e({},c):bm(c)?r[d]=c.slice():r[d]=c};for(let c=0,l=arguments.length;c<l;c++)arguments[c]&&Ty(arguments[c],a);return r},extend:function(e,t,r){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ty(t,(c,l)=>{r&&qa(c)?e[l]=NV(c,r):e[l]=c},{allOwnKeys:a}),e},trim:e=>Ti(e)?Ti(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,a)=>{let c,l,d;const p={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),l=c.length;l-- >0;)d=c[l],a&&!a(d,e,t)||p[d]||(t[d]=e[d],p[d]=!0);e=r!==!1&&dI(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:eT,kindOfTest:Fs,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const a=e.indexOf(t,r);return a!==-1&&a===r},toArray:e=>{if(!e)return null;if(bm(e))return e;let t=e.length;if(!xV(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Zb]).call(e);let a;for(;(a=r.next())&&!a.done;){const c=a.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r;const a=[];for(;(r=e.exec(t))!==null;)a.push(r);return a},isHTMLForm:Hne,hasOwnProperty:MV,hasOwnProp:MV,reduceDescriptors:UV,freezeMethods:e=>{UV(e,(t,r)=>{if(qa(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=e[r];qa(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},a=c=>{c.forEach(l=>{r[l]=!0})};return bm(e)?a(e):a(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,a){return r.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:kV,global:Zh,isContextDefined:LV,isSpecCompliantForm:function(e){return!!(e&&qa(e.append)&&e[PV]==="FormData"&&e[Zb])},toJSONObject:e=>{const t=new Array(10),r=(a,c)=>{if(rT(a)){if(t.indexOf(a)>=0)return;if(!("toJSON"in a)){t[c]=a;const l=bm(a)?[]:{};return Ty(a,(d,p)=>{const g=r(d,c+1);!by(g)&&(l[p]=g)}),t[c]=void 0,l}}return a};return r(e,0)},isAsyncFn:Kne,isThenable:e=>e&&(rT(e)||qa(e))&&qa(e.then)&&qa(e.catch),setImmediate:jV,asap:zne,isIterable:e=>e!=null&&qa(e[Zb])};function lr(e,t,r,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}Be.inherits(lr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Be.toJSONObject(this.config),code:this.code,status:this.status}}});const BV=lr.prototype,WV={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{WV[e]={value:e}}),Object.defineProperties(lr,WV),Object.defineProperty(BV,"isAxiosError",{value:!0}),lr.from=(e,t,r,a,c,l)=>{const d=Object.create(BV);return Be.toFlatObject(e,d,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),lr.call(d,e.message,t,r,a,c),d.cause=e,d.name=e.name,l&&Object.assign(d,l),d};function mI(e){return Be.isPlainObject(e)||Be.isArray(e)}function GV(e){return Be.endsWith(e,"[]")?e.slice(0,-2):e}function HV(e,t,r){return e?e.concat(t).map(function(a,c){return a=GV(a),!r&&c?"["+a+"]":a}).join(r?".":""):t}const $ne=Be.toFlatObject(Be,{},null,function(e){return/^is[A-Z]/.test(e)});function aT(e,t,r){if(!Be.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const a=(r=Be.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(R,O){return!Be.isUndefined(O[R])})).metaTokens,c=r.visitor||v,l=r.dots,d=r.indexes,p=(r.Blob||typeof Blob<"u"&&Blob)&&Be.isSpecCompliantForm(t);if(!Be.isFunction(c))throw new TypeError("visitor must be a function");function g(R){if(R===null)return"";if(Be.isDate(R))return R.toISOString();if(!p&&Be.isBlob(R))throw new lr("Blob is not supported. Use a Buffer instead.");return Be.isArrayBuffer(R)||Be.isTypedArray(R)?p&&typeof Blob=="function"?new Blob([R]):Buffer.from(R):R}function v(R,O,V){let k=R;if(R&&!V&&typeof R=="object"){if(Be.endsWith(O,"{}"))O=a?O:O.slice(0,-2),R=JSON.stringify(R);else if(Be.isArray(R)&&function(L){return Be.isArray(L)&&!L.some(mI)}(R)||(Be.isFileList(R)||Be.endsWith(O,"[]"))&&(k=Be.toArray(R)))return O=GV(O),k.forEach(function(L,H){!Be.isUndefined(L)&&L!==null&&t.append(d===!0?HV([O],H,l):d===null?O:O+"[]",g(L))}),!1}return!!mI(R)||(t.append(HV(V,O,l),g(R)),!1)}const y=[],b=Object.assign($ne,{defaultVisitor:v,convertValue:g,isVisitable:mI});if(!Be.isObject(e))throw new TypeError("data must be an object");return function R(O,V){if(!Be.isUndefined(O)){if(y.indexOf(O)!==-1)throw Error("Circular reference detected in "+V.join("."));y.push(O),Be.forEach(O,function(k,L){(!(Be.isUndefined(k)||k===null)&&c.call(t,k,Be.isString(L)?Ti(L).call(L):L,V,b))===!0&&R(k,V?V.concat(L):[L])}),y.pop()}}(e),t}function qV(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function gI(e,t){this._pairs=[],e&&aT(e,this,t)}const KV=gI.prototype;function Yne(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zV(e,t,r){if(!t)return e;const a=r&&r.encode||Yne;Be.isFunction(r)&&(r={serialize:r});const c=r&&r.serialize;let l;if(l=c?c(t,r):Be.isURLSearchParams(t)?t.toString():new gI(t,r).toString(a),l){const d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}KV.append=function(e,t){this._pairs.push([e,t])},KV.toString=function(e){const t=e?function(r){return e.call(this,r,qV)}:qV;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var $V=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Be.forEach(this.handlers,function(t){t!==null&&e(t)})}},YV={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},XV={exports:{}},Xne=er,Jne=be,JV=aa.f;Xne({target:"Object",stat:!0,forced:Object.defineProperty!==JV,sham:!Jne},{defineProperty:JV});var QV=xn.Object,Qne=XV.exports=function(e,t,r){return QV.defineProperty(e,t,r)};QV.defineProperty.sham&&(Qne.sham=!0);var ZV=u(XV.exports),Zne=TypeError,eF=Ts,eie=Jn,tie=en,rie=Ur("species"),tF=Array,nie=function(e){var t;return eF(e)&&(t=e.constructor,(eie(t)&&(t===tF||eF(t.prototype))||tie(t)&&(t=t[rie])===null)&&(t=void 0)),t===void 0?tF:t},rF=function(e,t){return new(nie(e))(t===0?0:t)},iie=f,aie=lc,oie=Ur("species"),nF=function(e){return aie>=51||!iie(function(){var t=[];return(t.constructor={})[oie]=function(){return{foo:1}},t[e](Boolean).foo!==1})},sie=er,cie=f,lie=Ts,uie=en,die=Uo,hie=vc,iF=function(e){if(e>9007199254740991)throw Zne("Maximum allowed index exceeded");return e},aF=DO,pie=rF,fie=nF,mie=lc,oF=Ur("isConcatSpreadable"),gie=mie>=51||!cie(function(){var e=[];return e[oF]=!1,e.concat()[0]!==e}),_ie=function(e){if(!uie(e))return!1;var t=e[oF];return t!==void 0?!!t:lie(e)};sie({target:"Array",proto:!0,forced:!gie||!fie("concat")},{concat:function(e){var t,r,a,c,l,d=die(this),p=pie(d,0),g=0;for(t=-1,a=arguments.length;t<a;t++)if(_ie(l=t===-1?d:arguments[t]))for(c=hie(l),iF(g+c),r=0;r<c;r++,g++)r in l&&aF(p,g,l[r]);else iF(g+1),aF(p,g++,l);return p.length=g,p}});var sF={},vie=ie,yie=qr,cF=Rs.f,Eie=Gn,lF=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];sF.f=function(e){return lF&&vie(e)==="Window"?function(t){try{return cF(t)}catch{return Eie(lF)}}(e):cF(yie(e))};var Tm={},Sie=Ur;Tm.f=Sie;var uF=xn,bie=kn,Tie=Tm,wie=aa.f,Hn=function(e){var t=uF.Symbol||(uF.Symbol={});bie(t,e)||wie(t,e,{value:Tie.f(e)})},Rie=Ue,Cie=Fn,Aie=Ur,Oie=ks,dF=function(){var e=Cie("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,a=Aie("toPrimitive");t&&!t[a]&&Oie(t,a,function(c){return Rie(r,this)},{})},Iie=mc,Nie=nt,Pie=Uo,Die=vc,xie=rF,hF=A([].push),kie=function(e){var t=e===1,r=e===2,a=e===3,c=e===4,l=e===6,d=e===7,p=e===5||l;return function(g,v,y,b){for(var R,O,V=Pie(g),k=Nie(V),L=Die(k),H=Iie(v,y),q=0,te=b||xie,oe=t?te(g,L):r||d?te(g,0):void 0;L>q;q++)if((p||q in k)&&(O=H(R=k[q],q,V),e))if(t)oe[q]=O;else if(O)switch(e){case 3:return!0;case 5:return R;case 6:return q;case 2:hF(oe,R)}else switch(e){case 4:return!1;case 7:hF(oe,R)}return l?-1:a||c?c:oe}},pF={forEach:kie(0)},oT=er,wy=W,_I=Ue,Lie=A,wm=be,Rm=uc,Mie=f,Mi=kn,Uie=P,vI=yi,sT=qr,yI=jr,jie=oa,EI=_t,Cm=Sh,fF=$i,Vie=Rs,mF=sF,Fie=qu,gF=Ae,_F=aa,Bie=Rc,vF=Pe,yF=ks,Wie=Oc,SI=vl,EF=fo,SF=Au,Gie=Ur,Hie=Tm,qie=Hn,Kie=dF,zie=Go,bF=Ac,cT=pF.forEach,Ka=Gu("hidden"),lT="Symbol",Ry="prototype",$ie=bF.set,TF=bF.getterFor(lT),Bs=Object[Ry],ep=wy.Symbol,uT=ep&&ep[Ry],Yie=wy.RangeError,Xie=wy.TypeError,bI=wy.QObject,wF=gF.f,tp=_F.f,RF=mF.f,Jie=vF.f,CF=Lie([].push),Vl=SI("symbols"),Cy=SI("op-symbols"),Qie=SI("wks"),TI=!bI||!bI[Ry]||!bI[Ry].findChild,AF=function(e,t,r){var a=wF(Bs,t);a&&delete Bs[t],tp(e,t,r),a&&e!==Bs&&tp(Bs,t,a)},wI=wm&&Mie(function(){return Cm(tp({},"a",{get:function(){return tp(this,"a",{value:7}).a}})).a!==7})?AF:tp,RI=function(e,t){var r=Vl[e]=Cm(uT);return $ie(r,{type:lT,tag:e,description:t}),wm||(r.description=t),r},dT=function(e,t,r){e===Bs&&dT(Cy,t,r),vI(e);var a=yI(t);return vI(r),Mi(Vl,a)?(r.enumerable?(Mi(e,Ka)&&e[Ka][a]&&(e[Ka][a]=!1),r=Cm(r,{enumerable:EI(0,!1)})):(Mi(e,Ka)||tp(e,Ka,EI(1,Cm(null))),e[Ka][a]=!0),wI(e,a,r)):tp(e,a,r)},CI=function(e,t){vI(e);var r=sT(t),a=fF(r).concat(PF(r));return cT(a,function(c){wm&&!_I(OF,r,c)||dT(e,c,r[c])}),e},OF=function(e){var t=yI(e),r=_I(Jie,this,t);return!(this===Bs&&Mi(Vl,t)&&!Mi(Cy,t))&&(!(r||!Mi(this,t)||!Mi(Vl,t)||Mi(this,Ka)&&this[Ka][t])||r)},IF=function(e,t){var r=sT(e),a=yI(t);if(r!==Bs||!Mi(Vl,a)||Mi(Cy,a)){var c=wF(r,a);return!c||!Mi(Vl,a)||Mi(r,Ka)&&r[Ka][a]||(c.enumerable=!0),c}},NF=function(e){var t=RF(sT(e)),r=[];return cT(t,function(a){Mi(Vl,a)||Mi(EF,a)||CF(r,a)}),r},PF=function(e){var t=e===Bs,r=RF(t?Cy:sT(e)),a=[];return cT(r,function(c){!Mi(Vl,c)||t&&!Mi(Bs,c)||CF(a,Vl[c])}),a};Rm||(ep=function(){if(Uie(uT,this))throw new Xie("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?jie(arguments[0]):void 0,t=SF(e),r=function(a){var c=this===void 0?wy:this;c===Bs&&_I(r,Cy,a),Mi(c,Ka)&&Mi(c[Ka],t)&&(c[Ka][t]=!1);var l=EI(1,a);try{wI(c,t,l)}catch(d){if(!(d instanceof Yie))throw d;AF(c,t,l)}};return wm&&TI&&wI(Bs,t,{configurable:!0,set:r}),RI(t,e)},yF(uT=ep[Ry],"toString",function(){return TF(this).tag}),yF(ep,"withoutSetter",function(e){return RI(SF(e),e)}),vF.f=OF,_F.f=dT,Bie.f=CI,gF.f=IF,Vie.f=mF.f=NF,Fie.f=PF,Hie.f=function(e){return RI(Gie(e),e)},wm&&Wie(uT,"description",{configurable:!0,get:function(){return TF(this).description}})),oT({global:!0,wrap:!0,forced:!Rm,sham:!Rm},{Symbol:ep}),cT(fF(Qie),function(e){qie(e)}),oT({target:lT,stat:!0,forced:!Rm},{useSetter:function(){TI=!0},useSimple:function(){TI=!1}}),oT({target:"Object",stat:!0,forced:!Rm,sham:!wm},{create:function(e,t){return t===void 0?Cm(e):CI(Cm(e),t)},defineProperty:dT,defineProperties:CI,getOwnPropertyDescriptor:IF}),oT({target:"Object",stat:!0,forced:!Rm},{getOwnPropertyNames:NF}),Kie(),zie(ep,lT),EF[Ka]=!0;var DF=uc&&!!Symbol.for&&!!Symbol.keyFor,Zie=er,eae=Fn,tae=kn,rae=oa,xF=vl,nae=DF,AI=xF("string-to-symbol-registry"),iae=xF("symbol-to-string-registry");Zie({target:"Symbol",stat:!0,forced:!nae},{for:function(e){var t=rae(e);if(tae(AI,t))return AI[t];var r=eae("Symbol")(t);return AI[t]=r,iae[r]=t,r}});var aae=er,oae=kn,sae=Ru,cae=gl,lae=DF,kF=vl("symbol-to-string-registry");aae({target:"Symbol",stat:!0,forced:!lae},{keyFor:function(e){if(!sae(e))throw new TypeError(cae(e)+" is not a symbol");if(oae(kF,e))return kF[e]}});var LF=Ts,uae=ye,MF=ie,dae=oa,UF=A([].push),hae=er,jF=Fn,VF=J,pae=Ue,Ay=A,FF=f,BF=ye,WF=Ru,GF=Gn,fae=function(e){if(uae(e))return e;if(LF(e)){for(var t=e.length,r=[],a=0;a<t;a++){var c=e[a];typeof c=="string"?UF(r,c):typeof c!="number"&&MF(c)!=="Number"&&MF(c)!=="String"||UF(r,dae(c))}var l=r.length,d=!0;return function(p,g){if(d)return d=!1,g;if(LF(this))return g;for(var v=0;v<l;v++)if(r[v]===p)return g}}},mae=uc,gae=String,md=jF("JSON","stringify"),hT=Ay(/./.exec),HF=Ay("".charAt),_ae=Ay("".charCodeAt),vae=Ay("".replace),yae=Ay(1 .toString),Eae=/[\uD800-\uDFFF]/g,qF=/^[\uD800-\uDBFF]$/,KF=/^[\uDC00-\uDFFF]$/,zF=!mae||FF(function(){var e=jF("Symbol")("stringify detection");return md([e])!=="[null]"||md({a:e})!=="{}"||md(Object(e))!=="{}"}),$F=FF(function(){return md("\uDF06\uD834")!=='"\\udf06\\ud834"'||md("\uDEAD")!=='"\\udead"'}),Sae=function(e,t){var r=GF(arguments),a=fae(t);if(BF(a)||e!==void 0&&!WF(e))return r[1]=function(c,l){if(BF(a)&&(l=pae(a,this,gae(c),l)),!WF(l))return l},VF(md,null,r)},bae=function(e,t,r){var a=HF(r,t-1),c=HF(r,t+1);return hT(qF,e)&&!hT(KF,c)||hT(KF,e)&&!hT(qF,a)?"\\u"+yae(_ae(e,0),16):e};md&&hae({target:"JSON",stat:!0,forced:zF||$F},{stringify:function(e,t,r){var a=GF(arguments),c=VF(zF?Sae:md,null,a);return $F&&typeof c=="string"?vae(c,Eae,bae):c}});var YF=qu,Tae=Uo;er({target:"Object",stat:!0,forced:!uc||f(function(){YF.f(1)})},{getOwnPropertySymbols:function(e){var t=YF.f;return t?t(Tae(e)):[]}}),Hn("asyncIterator"),Hn("hasInstance"),Hn("isConcatSpreadable"),Hn("iterator"),Hn("match"),Hn("matchAll"),Hn("replace"),Hn("search"),Hn("species"),Hn("split");var wae=dF;Hn("toPrimitive"),wae();var Rae=Fn,Cae=Go;Hn("toStringTag"),Cae(Rae("Symbol"),"Symbol"),Hn("unscopables"),Go(W.JSON,"JSON",!0);var Aae=xn.Symbol,Oae=Ur,Iae=aa.f,XF=Oae("metadata"),JF=Function.prototype;JF[XF]===void 0&&Iae(JF,XF,{value:null}),Hn("asyncDispose"),Hn("dispose"),Hn("metadata");var Nae=Aae,Pae=A,OI=Fn("Symbol"),Dae=OI.keyFor,xae=Pae(OI.prototype.valueOf),QF=OI.isRegisteredSymbol||function(e){try{return Dae(xae(e))!==void 0}catch{return!1}};er({target:"Symbol",stat:!0},{isRegisteredSymbol:QF});for(var kae=vl,ZF=Fn,Lae=A,Mae=Ru,Uae=Ur,pT=ZF("Symbol"),eB=pT.isWellKnownSymbol,tB=ZF("Object","getOwnPropertyNames"),jae=Lae(pT.prototype.valueOf),rB=kae("wks"),II=0,nB=tB(pT),Vae=nB.length;II<Vae;II++)try{var iB=nB[II];Mae(pT[iB])&&Uae(iB)}catch{}var aB=function(e){if(eB&&eB(e))return!0;try{for(var t=jae(e),r=0,a=tB(rB),c=a.length;r<c;r++)if(rB[a[r]]==t)return!0}catch{}return!1};er({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:aB}),Hn("customMatcher"),Hn("observable"),er({target:"Symbol",stat:!0},{isRegistered:QF}),er({target:"Symbol",stat:!0,forced:!0},{isWellKnown:aB}),Hn("matcher"),Hn("metadataKey"),Hn("patternMatch"),Hn("replaceAll");var Am=u(Nae),oB=u(Tm.f("iterator"));function Oy(e){return Oy=typeof Am=="function"&&typeof oB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Am=="function"&&t.constructor===Am&&t!==Am.prototype?"symbol":typeof t},Oy(e)}var Fae=u(Tm.f("toPrimitive"));function Bae(e){var t=function(r,a){if(Oy(r)!="object"||!r)return r;var c=r[Fae];if(c!==void 0){var l=c.call(r,a);if(Oy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}(e,"string");return Oy(t)=="symbol"?t:t+""}function G(e,t,r){return(t=Bae(t))in e?ZV(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var sB=u(Bte),Wae={isBrowser:!0,classes:{URLSearchParams:sB!==void 0?sB:gI,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const NI=typeof window<"u"&&typeof document<"u",PI=typeof navigator=="object"&&navigator||void 0,Gae=NI&&(!PI||["ReactNative","NativeScript","NS"].indexOf(PI.product)<0),Hae=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qae=NI&&window.location.href||"http://localhost";function cB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function lB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cB(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cB(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}var ha=lB(lB({},Object.freeze({__proto__:null,hasBrowserEnv:NI,hasStandardBrowserEnv:Gae,hasStandardBrowserWebWorkerEnv:Hae,navigator:PI,origin:qae})),Wae),Kae=yi,zae=Ue,$ae=kn,Yae=P,Xae=function(){var e=Kae(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},uB=RegExp.prototype,dB=function(e){var t=e.flags;return t!==void 0||"flags"in uB||$ae(e,"flags")||!Yae(uB,e)?t:zae(Xae,e)},Jae=vO.charAt,hB=Ue,Qae=yi,Zae=ye,eoe=ie,toe=/./.exec,roe=TypeError,noe=er,pB=Ue,fB=Oe,ioe=Dh,fT=Jf,mB=Or,gB=_0,Iy=oa,aoe=yi,ooe=en,soe=ie,coe=H_,_B=dB,loe=ef,uoe=f,doe=kl,hoe=function(e,t,r){return t+(r?Jae(e,t).length:1)},poe=function(e,t){var r=e.exec;if(Zae(r)){var a=hB(r,e,t);return a!==null&&Qae(a),a}if(eoe(e)==="RegExp")return hB(toe,e,t);throw new roe("RegExp#exec called on incompatible receiver")},vB=Ac,foe=Ur("matchAll"),yB="RegExp String",EB=yB+" Iterator",moe=vB.set,goe=vB.getterFor(EB),_oe=TypeError,DI=fB("".indexOf),mT=fB("".matchAll),xI=!!mT&&!uoe(function(){mT("a",/./)}),voe=ioe(function(e,t,r,a){moe(this,{type:EB,regexp:e,string:t,global:r,unicode:a,done:!1})},yB,function(){var e=goe(this);if(e.done)return fT(void 0,!0);var t=e.regexp,r=e.string,a=poe(t,r);return a===null?(e.done=!0,fT(void 0,!0)):e.global?(Iy(a[0])===""&&(t.lastIndex=hoe(r,gB(t.lastIndex),e.unicode)),fT(a,!1)):(e.done=!0,fT(a,!1))}),SB=function(e){var t,r,a,c=aoe(this),l=Iy(e),d=doe(c,RegExp),p=Iy(_B(c));return t=new d(d===RegExp?c.source:c,p),r=!!~DI(p,"g"),a=!!~DI(p,"u"),t.lastIndex=gB(c.lastIndex),new voe(t,l,r,a)};noe({target:"String",proto:!0,forced:xI},{matchAll:function(e){var t,r,a,c,l=mB(this);if(ooe(e)){if(coe(e)&&(t=Iy(mB(_B(e))),!~DI(t,"g")))throw new _oe("`.matchAll` does not allow non-global regexes");if(xI)return mT(l,e);if((a=loe(e,foe))===void 0&&soe(e)==="RegExp"&&(a=SB),a)return pB(a,e,l)}else if(xI)return mT(l,e);return r=Iy(l),c=new RegExp(e,"g"),pB(SB,c,r)}});var yoe=Sa("String","matchAll"),Eoe=P,Soe=yoe,kI=String.prototype,boe=function(e){var t=e.matchAll;return typeof e=="string"||e===kI||Eoe(kI,e)&&t===kI.matchAll?Soe:t},Toe=u(boe);function bB(e){function t(r,a,c,l){let d=r[l++];if(d==="__proto__")return!0;const p=Number.isFinite(+d),g=l>=r.length;return d=!d&&Be.isArray(c)?c.length:d,g?(Be.hasOwnProp(c,d)?c[d]=[c[d],a]:c[d]=a,!p):(c[d]&&Be.isObject(c[d])||(c[d]=[]),t(r,a,c[d],l)&&Be.isArray(c[d])&&(c[d]=function(v){const y={},b=Object.keys(v);let R;const O=b.length;let V;for(R=0;R<O;R++)V=b[R],y[V]=v[V];return y}(c[d])),!p)}if(Be.isFormData(e)&&Be.isFunction(e.entries)){const r={};return Be.forEachEntry(e,(a,c)=>{t(function(l){return Toe(Be).call(Be,/\w+|\[(\w*)]/g,l).map(d=>d[0]==="[]"?"":d[1]||d[0])}(a),c,r,0)}),r}return null}const LI={transitional:YV,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",a=r.indexOf("application/json")>-1,c=Be.isObject(e);if(c&&Be.isHTMLForm(e)&&(e=new FormData(e)),Be.isFormData(e))return a?JSON.stringify(bB(e)):e;if(Be.isArrayBuffer(e)||Be.isBuffer(e)||Be.isStream(e)||Be.isFile(e)||Be.isBlob(e)||Be.isReadableStream(e))return e;if(Be.isArrayBufferView(e))return e.buffer;if(Be.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(d,p){return aT(d,new ha.classes.URLSearchParams,Object.assign({visitor:function(g,v,y,b){return ha.isNode&&Be.isBuffer(g)?(this.append(v,g.toString("base64")),!1):b.defaultVisitor.apply(this,arguments)}},p))}(e,this.formSerializer).toString();if((l=Be.isFileList(e))||r.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return aT(l?{"files[]":e}:e,d&&new d,this.formSerializer)}}return c||a?(t.setContentType("application/json",!1),function(d,p,g){if(Be.isString(d))try{return(p||JSON.parse)(d),Ti(Be).call(Be,d)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){const t=this.transitional||LI.transitional,r=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Be.isResponse(e)||Be.isReadableStream(e))return e;if(e&&Be.isString(e)&&(r&&!this.responseType||a)){const c=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(l){if(c)throw l.name==="SyntaxError"?lr.from(l,lr.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ha.classes.FormData,Blob:ha.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Be.forEach(["delete","get","head","post","put","patch"],e=>{LI.headers[e]={}});var MI=LI;const woe=Be.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),TB=Symbol("internals");function Ny(e){var t;return e&&Ti(t=String(e)).call(t).toLowerCase()}function gT(e){return e===!1||e==null?e:Be.isArray(e)?e.map(gT):String(e)}function UI(e,t,r,a,c){return Be.isFunction(a)?a.call(this,t,r):(c&&(t=r),Be.isString(t)?Be.isString(a)?t.indexOf(a)!==-1:Be.isRegExp(a)?a.test(t):void 0:void 0)}class _T{constructor(t){t&&this.set(t)}set(t,r,a){const c=this;function l(g,v,y){const b=Ny(v);if(!b)throw new Error("header name must be a non-empty string");const R=Be.findKey(c,b);(!R||c[R]===void 0||y===!0||y===void 0&&c[R]!==!1)&&(c[R||v]=gT(g))}const d=(g,v)=>Be.forEach(g,(y,b)=>l(y,b,v));if(Be.isPlainObject(t)||t instanceof this.constructor)d(t,r);else if(Be.isString(t)&&(t=Ti(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ti(p=t).call(p)))d((g=>{const v={};let y,b,R;return g&&g.split(`
`).forEach(function(O){var V,k;R=O.indexOf(":"),y=Ti(V=O.substring(0,R)).call(V).toLowerCase(),b=Ti(k=O.substring(R+1)).call(k),!y||v[y]&&woe[y]||(y==="set-cookie"?v[y]?v[y].push(b):v[y]=[b]:v[y]=v[y]?v[y]+", "+b:b)}),v})(t),r);else if(Be.isObject(t)&&Be.isIterable(t)){let g,v,y={};for(const b of t){if(!Be.isArray(b))throw TypeError("Object iterator must return a key-value pair");y[v=b[0]]=(g=y[v])?Be.isArray(g)?[...g,b[1]]:[g,b[1]]:b[1]}d(y,r)}else t!=null&&l(r,t,a);var p;return this}get(t,r){if(t=Ny(t)){const a=Be.findKey(this,t);if(a){const c=this[a];if(!r)return c;if(r===!0)return function(l){const d=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=p.exec(l);)d[g[1]]=g[2];return d}(c);if(Be.isFunction(r))return r.call(this,c,a);if(Be.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Ny(t)){const a=Be.findKey(this,t);return!(!a||this[a]===void 0||r&&!UI(0,this[a],a,r))}return!1}delete(t,r){const a=this;let c=!1;function l(d){if(d=Ny(d)){const p=Be.findKey(a,d);!p||r&&!UI(0,a[p],p,r)||(delete a[p],c=!0)}}return Be.isArray(t)?t.forEach(l):l(t),c}clear(t){const r=Object.keys(this);let a=r.length,c=!1;for(;a--;){const l=r[a];t&&!UI(0,this[l],l,t,!0)||(delete this[l],c=!0)}return c}normalize(t){const r=this,a={};return Be.forEach(this,(c,l)=>{var d;const p=Be.findKey(a,l);if(p)return r[p]=gT(c),void delete r[l];const g=t?function(v){return Ti(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(y,b,R)=>b.toUpperCase()+R)}(l):Ti(d=String(l)).call(d);g!==l&&delete r[l],r[g]=gT(c),a[g]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return Be.forEach(this,(a,c)=>{a!=null&&a!==!1&&(r[c]=t&&Be.isArray(a)?a.join(", "):a)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,a]=t;return r+": "+a}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var a=arguments.length,c=new Array(a>1?a-1:0),l=1;l<a;l++)c[l-1]=arguments[l];return c.forEach(d=>r.set(d)),r}static accessor(t){const r=(this[TB]=this[TB]={accessors:{}}).accessors,a=this.prototype;function c(l){const d=Ny(l);r[d]||(function(p,g){const v=Be.toCamelCase(" "+g);["get","set","has"].forEach(y=>{Object.defineProperty(p,y+v,{value:function(b,R,O){return this[y].call(this,g,b,R,O)},configurable:!0})})}(a,l),r[d]=!0)}return Be.isArray(t)?t.forEach(c):c(t),this}}_T.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Be.reduceDescriptors(_T.prototype,(e,t)=>{let{value:r}=e,a=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[a]=c}}}),Be.freezeMethods(_T);var Ws=_T;function jI(e,t){const r=this||MI,a=t||r,c=Ws.from(a.headers);let l=a.data;return Be.forEach(e,function(d){l=d.call(r,l,c.normalize(),t?t.status:void 0)}),c.normalize(),l}function wB(e){return!(!e||!e.__CANCEL__)}function Om(e,t,r){lr.call(this,e??"canceled",lr.ERR_CANCELED,t,r),this.name="CanceledError"}function RB(e,t,r){const a=r.config.validateStatus;r.status&&a&&!a(r.status)?t(new lr("Request failed with status code "+r.status,[lr.ERR_BAD_REQUEST,lr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}Be.inherits(Om,lr,{__CANCEL__:!0});const vT=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(l,d){l=l||10;const p=new Array(l),g=new Array(l);let v,y=0,b=0;return d=d!==void 0?d:1e3,function(R){const O=Date.now(),V=g[b];v||(v=O),p[y]=R,g[y]=O;let k=b,L=0;for(;k!==y;)L+=p[k++],k%=l;if(y=(y+1)%l,y===b&&(b=(b+1)%l),O-v<d)return;const H=V&&O-V;return H?Math.round(1e3*L/H):void 0}}(50,250);return function(l,d){let p,g,v=0,y=1e3/d;const b=function(R){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,g&&(clearTimeout(g),g=null),l.apply(null,R)};return[function(){const R=Date.now(),O=R-v;for(var V=arguments.length,k=new Array(V),L=0;L<V;L++)k[L]=arguments[L];O>=y?b(k,R):(p=k,g||(g=setTimeout(()=>{g=null,b(p)},y-O)))},()=>p&&b(p)]}(l=>{const d=l.loaded,p=l.lengthComputable?l.total:void 0,g=d-a,v=c(g);a=d,e({loaded:d,total:p,progress:p?d/p:void 0,bytes:g,rate:v||void 0,estimated:v&&p&&d<=p?(p-d)/v:void 0,event:l,lengthComputable:p!=null,[t?"download":"upload"]:!0})},r)},CB=(e,t)=>{const r=e!=null;return[a=>t[0]({lengthComputable:r,total:e,loaded:a}),t[1]]},AB=e=>function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Be.asap(()=>e(...r))};var Roe=ha.hasStandardBrowserEnv?((e,t)=>r=>(r=new Kb(r,ha.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new Kb(ha.origin),ha.navigator&&/(msie|trident)/i.test(ha.navigator.userAgent)):()=>!0,Coe=ha.hasStandardBrowserEnv?{write(e,t,r,a,c,l){const d=[e+"="+encodeURIComponent(t)];Be.isNumber(r)&&d.push("expires="+new Date(r).toGMTString()),Be.isString(a)&&d.push("path="+a),Be.isString(c)&&d.push("domain="+c),l===!0&&d.push("secure"),document.cookie=d.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function OB(e,t,r){let a=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(a||r==0)?function(c,l){return l?c.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):c}(e,t):t}function IB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}const NB=e=>e instanceof Ws?function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?IB(Object(a),!0).forEach(function(c){G(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):IB(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e):e;function rp(e,t){t=t||{};const r={};function a(v,y,b,R){return Be.isPlainObject(v)&&Be.isPlainObject(y)?Be.merge.call({caseless:R},v,y):Be.isPlainObject(y)?Be.merge({},y):Be.isArray(y)?y.slice():y}function c(v,y,b,R){return Be.isUndefined(y)?Be.isUndefined(v)?void 0:a(void 0,v,0,R):a(v,y,0,R)}function l(v,y){if(!Be.isUndefined(y))return a(void 0,y)}function d(v,y){return Be.isUndefined(y)?Be.isUndefined(v)?void 0:a(void 0,v):a(void 0,y)}function p(v,y,b){return b in t?a(v,y):b in e?a(void 0,v):void 0}const g={url:l,method:l,data:l,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:p,headers:(v,y,b)=>c(NB(v),NB(y),0,!0)};return Be.forEach(Object.keys(Object.assign({},e,t)),function(v){const y=g[v]||c,b=y(e[v],t[v],v);Be.isUndefined(b)&&y!==p||(r[v]=b)}),r}var PB=e=>{const t=rp({},e);let r,{data:a,withXSRFToken:c,xsrfHeaderName:l,xsrfCookieName:d,headers:p,auth:g}=t;if(t.headers=p=Ws.from(p),t.url=zV(OB(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),g&&p.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),Be.isFormData(a)){if(ha.hasStandardBrowserEnv||ha.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if((r=p.getContentType())!==!1){const[v,...y]=r?r.split(";").map(b=>Ti(b).call(b)).filter(Boolean):[];p.setContentType([v||"multipart/form-data",...y].join("; "))}}if(ha.hasStandardBrowserEnv&&(c&&Be.isFunction(c)&&(c=c(t)),c||c!==!1&&Roe(t.url))){const v=l&&d&&Coe.read(d);v&&p.set(l,v)}return t},Aoe=typeof XMLHttpRequest<"u"&&function(e){return new Ge(function(t,r){const a=PB(e);let c=a.data;const l=Ws.from(a.headers).normalize();let d,p,g,v,y,{responseType:b,onUploadProgress:R,onDownloadProgress:O}=a;function V(){v&&v(),y&&y(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let k=new XMLHttpRequest;function L(){if(!k)return;const q=Ws.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders());RB(function(te){t(te),V()},function(te){r(te),V()},{data:b&&b!=="text"&&b!=="json"?k.response:k.responseText,status:k.status,statusText:k.statusText,headers:q,config:e,request:k}),k=null}k.open(a.method.toUpperCase(),a.url,!0),k.timeout=a.timeout,"onloadend"in k?k.onloadend=L:k.onreadystatechange=function(){k&&k.readyState===4&&(k.status!==0||k.responseURL&&k.responseURL.indexOf("file:")===0)&&setTimeout(L)},k.onabort=function(){k&&(r(new lr("Request aborted",lr.ECONNABORTED,e,k)),k=null)},k.onerror=function(){r(new lr("Network Error",lr.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let q=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const te=a.transitional||YV;a.timeoutErrorMessage&&(q=a.timeoutErrorMessage),r(new lr(q,te.clarifyTimeoutError?lr.ETIMEDOUT:lr.ECONNABORTED,e,k)),k=null},c===void 0&&l.setContentType(null),"setRequestHeader"in k&&Be.forEach(l.toJSON(),function(q,te){k.setRequestHeader(te,q)}),Be.isUndefined(a.withCredentials)||(k.withCredentials=!!a.withCredentials),b&&b!=="json"&&(k.responseType=a.responseType),O&&([g,y]=vT(O,!0),k.addEventListener("progress",g)),R&&k.upload&&([p,v]=vT(R),k.upload.addEventListener("progress",p),k.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(d=q=>{k&&(r(!q||q.type?new Om(null,e,k):q),k.abort(),k=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const H=function(q){const te=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return te&&te[1]||""}(a.url);H&&ha.protocols.indexOf(H)===-1?r(new lr("Unsupported protocol "+H+":",lr.ERR_BAD_REQUEST,e)):k.send(c||null)})},Ooe=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let a,c=new AbortController;const l=function(v){if(!a){a=!0,p();const y=v instanceof Error?v:this.reason;c.abort(y instanceof lr?y:new Om(y instanceof Error?y.message:y))}};let d=t&&setTimeout(()=>{d=null,l(new lr("timeout ".concat(t," of ms exceeded"),lr.ETIMEDOUT))},t);const p=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(v=>{v.unsubscribe?v.unsubscribe(l):v.removeEventListener("abort",l)}),e=null)};e.forEach(v=>v.addEventListener("abort",l));const{signal:g}=c;return g.unsubscribe=()=>Be.asap(p),g}},VI=u(vU),DB=Tm.f("asyncIterator"),Ioe=u(DB);function FI(e,t){this.v=e,this.k=t}function So(e){return function(){return new Py(e.apply(this,arguments))}}function Py(e){var t,r;function a(l,d){try{var p=e[l](d),g=p.value,v=g instanceof FI;VI.resolve(v?g.v:g).then(function(y){if(v){var b=l==="return"?"return":"next";if(!g.k||y.done)return a(b,y);y=e[b](y).value}c(p.done?"return":"normal",y)},function(y){a("throw",y)})}catch(y){c("throw",y)}}function c(l,d){switch(l){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?a(t.key,t.arg):r=null}this._invoke=function(l,d){return new VI(function(p,g){var v={key:l,arg:d,resolve:p,reject:g,next:null};r?r=r.next=v:(t=r=v,a(l,d))})},typeof e.return!="function"&&(this.return=void 0)}function Gt(e){return new FI(e,0)}function yT(e){var t={},r=!1;function a(c,l){return r=!0,l=new VI(function(d){d(e[c](l))}),{done:!1,value:new FI(l,1)}}return t[Am!==void 0&&oB||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):a("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return a("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):a("return",c)}),t}Py.prototype[typeof Am=="function"&&Ioe||"@@asyncIterator"]=function(){return this},Py.prototype.next=function(e){return this._invoke("next",e)},Py.prototype.throw=function(e){return this._invoke("throw",e)},Py.prototype.return=function(e){return this._invoke("return",e)};var BI=u(DB);function WI(e){var t,r,a,c=2;for(typeof Symbol<"u"&&(r=BI,a=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new ET(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function ET(e){function t(r){if(Object(r)!==r)return Ge.reject(new TypeError(r+" is not an object."));var a=r.done;return Ge.resolve(r.value).then(function(c){return{value:c,done:a}})}return ET=function(r){this.s=r,this.n=r.next},ET.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Ge.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Ge.reject(r):t(a.apply(this.s,arguments))}},new ET(e)}const Noe=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let a,c=0;for(;c<r;)a=c+t,yield e.slice(c,a),c=a},Poe=function(){var e=So(function*(t,r){var a,c=!1,l=!1;try{for(var d,p=WI(Doe(t));c=!(d=yield Gt(p.next())).done;c=!1){const g=d.value;yield*yT(WI(Noe(g,r)))}}catch(g){l=!0,a=g}finally{try{c&&p.return!=null&&(yield Gt(p.return()))}finally{if(l)throw a}}});return function(t,r){return e.apply(this,arguments)}}(),Doe=function(){var e=So(function*(t){if(t[BI])return void(yield*yT(WI(t)));const r=t.getReader();try{for(;;){const{done:a,value:c}=yield Gt(r.read());if(a)break;yield c}}finally{yield Gt(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),xB=(e,t,r,a)=>{const c=Poe(e,t);let l,d=0,p=g=>{l||(l=!0,a&&a(g))};return new ReadableStream({async pull(g){try{const{done:v,value:y}=await c.next();if(v)return p(),void g.close();let b=y.byteLength;if(r){let R=d+=b;r(R)}g.enqueue(new Uint8Array(y))}catch(v){throw p(v),v}},cancel:g=>(p(g),c.return())},{highWaterMark:2})};function kB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function LB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kB(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kB(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const ST=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",MB=ST&&typeof ReadableStream=="function",xoe=ST&&(typeof TextEncoder=="function"?(UB=new TextEncoder,e=>UB.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var UB;const jB=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return!!e(...r)}catch{return!1}},koe=MB&&jB(()=>{let e=!1;const t=new Request(ha.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),GI=MB&&jB(()=>Be.isReadableStream(new Response("").body)),bT={stream:GI&&(e=>e.body)};var VB;ST&&(VB=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!bT[e]&&(bT[e]=Be.isFunction(VB[e])?t=>t[e]():(t,r)=>{throw new lr("Response type '".concat(e,"' is not supported"),lr.ERR_NOT_SUPPORT,r)})}));const Loe=async(e,t)=>{const r=Be.toFiniteNumber(e.getContentLength());return r??(async a=>a==null?0:Be.isBlob(a)?a.size:Be.isSpecCompliantForm(a)?(await new Request(ha.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:Be.isArrayBufferView(a)||Be.isArrayBuffer(a)?a.byteLength:(Be.isURLSearchParams(a)&&(a+=""),Be.isString(a)?(await xoe(a)).byteLength:void 0))(t)};var Moe=ST&&(async e=>{let{url:t,method:r,data:a,signal:c,cancelToken:l,timeout:d,onDownloadProgress:p,onUploadProgress:g,responseType:v,headers:y,withCredentials:b="same-origin",fetchOptions:R}=PB(e);v=v?(v+"").toLowerCase():"text";let O,V=Ooe([c,l&&l.toAbortSignal()],d);const k=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let L;try{if(g&&koe&&r!=="get"&&r!=="head"&&(L=await Loe(y,a))!==0){let se,ae=new Request(t,{method:"POST",body:a,duplex:"half"});if(Be.isFormData(a)&&(se=ae.headers.get("content-type"))&&y.setContentType(se),ae.body){const[pe,Te]=CB(L,vT(AB(g)));a=xB(ae.body,65536,pe,Te)}}Be.isString(b)||(b=b?"include":"omit");const H="credentials"in Request.prototype;O=new Request(t,LB(LB({},R),{},{signal:V,method:r.toUpperCase(),headers:y.normalize().toJSON(),body:a,duplex:"half",credentials:H?b:void 0}));let q=await fetch(O);const te=GI&&(v==="stream"||v==="response");if(GI&&(p||te&&k)){const se={};["status","statusText","headers"].forEach(Fe=>{se[Fe]=q[Fe]});const ae=Be.toFiniteNumber(q.headers.get("content-length")),[pe,Te]=p&&CB(ae,vT(AB(p),!0))||[];q=new Response(xB(q.body,65536,pe,()=>{Te&&Te(),k&&k()}),se)}v=v||"text";let oe=await bT[Be.findKey(bT,v)||"text"](q,e);return!te&&k&&k(),await new Ge((se,ae)=>{RB(se,ae,{data:oe,headers:Ws.from(q.headers),status:q.status,statusText:q.statusText,config:e,request:O})})}catch(H){throw k&&k(),H&&H.name==="TypeError"&&/Load failed|fetch/i.test(H.message)?Object.assign(new lr("Network Error",lr.ERR_NETWORK,e,O),{cause:H.cause||H}):lr.from(H,H&&H.code,e,O)}});const HI={http:null,xhr:Aoe,fetch:Moe};Be.forEach(HI,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const FB=e=>"- ".concat(e),Uoe=e=>Be.isFunction(e)||e===null||e===!1;var BB={getAdapter:e=>{e=Be.isArray(e)?e:[e];const{length:t}=e;let r,a;const c={};for(let l=0;l<t;l++){let d;if(r=e[l],a=r,!Uoe(r)&&(a=HI[(d=String(r)).toLowerCase()],a===void 0))throw new lr("Unknown adapter '".concat(d,"'"));if(a)break;c[d||"#"+l]=a}if(!a){const l=Object.entries(c).map(d=>{let[p,g]=d;return"adapter ".concat(p," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new lr("There is no suitable adapter to dispatch the request "+(t?l.length>1?`since :
`+l.map(FB).join(`
`):" "+FB(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:HI};function qI(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Om(null,e)}function WB(e){return qI(e),e.headers=Ws.from(e.headers),e.data=jI.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),BB.getAdapter(e.adapter||MI.adapter)(e).then(function(t){return qI(e),t.data=jI.call(e,e.transformResponse,t),t.headers=Ws.from(t.headers),t},function(t){return wB(t)||(qI(e),t&&t.response&&(t.response.data=jI.call(e,e.transformResponse,t.response),t.response.headers=Ws.from(t.response.headers))),Ge.reject(t)})}const GB="1.9.0",TT={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{TT[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const HB={};TT.transitional=function(e,t,r){function a(c,l){return"[Axios v"+GB+"] Transitional option '"+c+"'"+l+(r?". "+r:"")}return(c,l,d)=>{if(e===!1)throw new lr(a(l," has been removed"+(t?" in "+t:"")),lr.ERR_DEPRECATED);return t&&!HB[l]&&(HB[l]=!0,console.warn(a(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,l,d)}},TT.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var wT={assertOptions:function(e,t,r){if(typeof e!="object")throw new lr("options must be an object",lr.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let c=a.length;for(;c-- >0;){const l=a[c],d=t[l];if(d){const p=e[l],g=p===void 0||d(p,l,e);if(g!==!0)throw new lr("option "+l+" must be "+g,lr.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new lr("Unknown option "+l,lr.ERR_BAD_OPTION)}},validators:TT};const Fc=wT.validators;let RT=class{constructor(e){this.defaults=e||{},this.interceptors={request:new $V,response:new $V}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=rp(this.defaults,t);const{transitional:r,paramsSerializer:a,headers:c}=t;r!==void 0&&wT.assertOptions(r,{silentJSONParsing:Fc.transitional(Fc.boolean),forcedJSONParsing:Fc.transitional(Fc.boolean),clarifyTimeoutError:Fc.transitional(Fc.boolean)},!1),a!=null&&(Be.isFunction(a)?t.paramsSerializer={serialize:a}:wT.assertOptions(a,{encode:Fc.function,serialize:Fc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),wT.assertOptions(t,{baseUrl:Fc.spelling("baseURL"),withXsrfToken:Fc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=c&&Be.merge(c.common,c[t.method]);c&&Be.forEach(["delete","get","head","post","put","patch","common"],O=>{delete c[O]}),t.headers=Ws.concat(l,c);const d=[];let p=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(t)===!1||(p=p&&O.synchronous,d.unshift(O.fulfilled,O.rejected))});const g=[];let v;this.interceptors.response.forEach(function(O){g.push(O.fulfilled,O.rejected)});let y,b=0;if(!p){const O=[WB.bind(this),void 0];for(O.unshift.apply(O,d),O.push.apply(O,g),y=O.length,v=Ge.resolve(t);b<y;)v=v.then(O[b++],O[b++]);return v}y=d.length;let R=t;for(b=0;b<y;){const O=d[b++],V=d[b++];try{R=O(R)}catch(k){V.call(this,k);break}}try{v=WB.call(this,R)}catch(O){return Ge.reject(O)}for(b=0,y=g.length;b<y;)v=v.then(g[b++],g[b++]);return v}getUri(e){return zV(OB((e=rp(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Be.forEach(["delete","get","head","options"],function(e){RT.prototype[e]=function(t,r){return this.request(rp(r||{},{method:e,url:t,data:(r||{}).data}))}}),Be.forEach(["post","put","patch"],function(e){function t(r){return function(a,c,l){return this.request(rp(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}RT.prototype[e]=t(),RT.prototype[e+"Form"]=t(!0)});var CT=RT;class KI{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Ge(function(c){r=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let l=a._listeners.length;for(;l-- >0;)a._listeners[l](c);a._listeners=null}),this.promise.then=c=>{let l;const d=new Ge(p=>{a.subscribe(p),l=p}).then(c);return d.cancel=function(){a.unsubscribe(l)},d},t(function(c,l,d){a.reason||(a.reason=new Om(c,l,d),r(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=a=>{t.abort(a)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new KI(function(a){t=a}),cancel:t}}}var joe=KI;const zI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zI).forEach(e=>{let[t,r]=e;zI[r]=t});var Voe=zI;const mi=function e(t){const r=new CT(t),a=NV(CT.prototype.request,r);return Be.extend(a,CT.prototype,r,{allOwnKeys:!0}),Be.extend(a,r,null,{allOwnKeys:!0}),a.create=function(c){return e(rp(t,c))},a}(MI);mi.Axios=CT,mi.CanceledError=Om,mi.CancelToken=joe,mi.isCancel=wB,mi.VERSION=GB,mi.toFormData=aT,mi.AxiosError=lr,mi.Cancel=mi.CanceledError,mi.all=function(e){return Ge.all(e)},mi.spread=function(e){return function(t){return e.apply(null,t)}},mi.isAxiosError=function(e){return Be.isObject(e)&&e.isAxiosError===!0},mi.mergeConfig=rp,mi.AxiosHeaders=Ws,mi.formToJSON=e=>bB(Be.isHTMLForm(e)?new FormData(e):e),mi.getAdapter=BB.getAdapter,mi.HttpStatusCode=Voe,mi.default=mi;var Ji=mi;const Foe=()=>{};function Dy(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Foe};return e.promise=new Ge((t,r)=>{e.resolve=a=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(a),e.value=a)},e.reject=a=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(a))}}),e}const AT=new Map,OT=new Map,Bc=new Map;let On=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Xt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const qB=new gne;let Gs=qB.getResult(),$I=null;function Ht(e){if(!$I){Gs=qB.getResult();const t=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return Xt.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Xt.CHROME;case"Safari":case"Mobile Safari":return Xt.SAFARI;case"Edge":return Xt.EDGE;case"Firefox":return Xt.FIREFOX;case"QQ":case"QQBrowser":return Xt.QQ;case"Opera":return Xt.OPERA;case"WeChat":return Xt.WECHAT;default:return p.browser.name||""}}(Gs),r=KB(Gs),a=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(Gs),c=Gs.os.version,l=KB(Gs,!1),d=Gs.device.type;if(!(t&&r&&a&&c))return{name:t,version:r,os:a,osVersion:c,browserVersion:l,deviceType:d};$I={name:t,version:r,os:a,osVersion:c,browserVersion:l,deviceType:d}}return $I}function KB(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function IT(){return Ht().os}function zB(){const e=Ht();return"".concat(e.os," ").concat(e.osVersion)}function NT(){const e=Ht();return!!(Gs.engine.name==="WebKit"&&e.os===On.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Xt.SAFARI||Ui()&&e.name!==Xt.SAFARI)}function Fl(){return Ht().name===Xt.CHROME}function Qn(){return Ht().name===Xt.SAFARI}function $B(){return Ht().name===Xt.EDGE}function Vr(){return Ht().name===Xt.FIREFOX}function Ui(){return Ht().os===On.IOS}function xy(e){const t=Ht();return!(t.name!==Xt.CHROME||!t.osVersion)&&Number(t.version)>=e}function YB(e){const t=Ht();return!(t.name!==Xt.CHROME||!t.osVersion)&&Number(t.version)<e}function YI(e,t,r){const a=Ht();return!(a.name!==e||!a.osVersion)&&(r?Number(a.version)>=t&&Number(a.version)<=r:Number(a.version)===t)}function XI(e){const t=Ht();return!(t.name!==Xt.EDGE||!t.osVersion)&&Number(t.version)>=e}function XB(e){const t=Ht();return!(t.name!==Xt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function JB(e,t,r){const a=Ht();if(a.os!==On.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function QB(e,t,r){const a=Ht();if(a.name!==Xt.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function JI(e){const t=Ht();return!(t.name!==Xt.OPERA||!t.osVersion)&&Number(t.version)>=e}function ZB(){const e=Ht();if(e.os!==On.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Im(){const e=Ht();if(e.os!==On.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function QI(){const e=Ht();if(e.os!==On.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function e3(){const e=Ht();if(e.os!==On.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function es(){return Qn()&&navigator.maxTouchPoints>0}function t3(){return Ht().name===Xt.WECHAT}function r3(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ZI(){const e=IT();return function(){const{deviceType:t}=Ht();return t==="mobile"||t==="tablet"}()||e===On.ANDROID||e===On.IOS||e===On.HARMONY_OS}function Bl(){const e=Ht();return e.name!==Xt.EDGE&&e.name!==Xt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function PT(){return IT()===On.ANDROID}function ky(){const e=Ht();return PT()&&(e.name===Xt.CHROME||e.name===Xt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function mt(e,t,r){return(t=function(a){var c=function(l,d){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var g=p.call(l,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Ye(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n3(Object(r),!0).forEach(function(a){mt(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n3(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let K=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),_e=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),mt(this,"code",void 0),mt(this,"message",void 0),mt(this,"data",void 0),mt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Wl(e,t){if(typeof e!="boolean")throw new _e(K.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Sn(e,t,r){if(!Ve(r).call(r,e))throw new _e(K.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function ur(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new _e(K.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(a,"]. integer only"))}function eN(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _e(K.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&ur(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&ur(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&ur(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&ur(e.ideal,"".concat(t,".ideal"),1,1/0)}else ur(e,t,1,1/0)}function qn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _e(K.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!i3(e,r,a,c))throw new _e(K.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function Gl(e,t){if(!Array.isArray(e))throw new _e(K.INVALID_PARAMS,"".concat(t," should be an array"))}function Fr(e){return e==null}function i3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!a||function(c){if(typeof c!="string")return!1;for(let l=0;l<c.length;l+=1){const d=c.charCodeAt(l);if(d<0||d>255)return!1}return!0}(e))}var Ly=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Ly||{}),tN=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(tN||{});const a3=new class{constructor(){mt(this,"_clientSize",null),mt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),mt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),mt(this,"getStyle",e=>window.getComputedStyle(e,null)),mt(this,"checkCssVisibleProperty",e=>{var t;let r=!0;const a=this.getStyle(e),{display:c,visibility:l,opacity:d,filter:p}=a;return(c==="none"||Ve(t=["hidden","collapse"]).call(t,l)||Number(d)<.1)&&(r=!1),!!r&&(p&&p.split(" ").filter(g=>{var v;const y=g.split("(")[0];return Ve(v=["brightness","blur","opacity"]).call(v,y)}).map(g=>{const[v,y]=g.split(/\(|\)/);return[v,Number(y.match(/^[0-9\.]+/))]}).forEach(g=>{const[v,y]=g;switch(v){case"brightness":(y<.1||y>3)&&(r=!1);break;case"blur":y>3&&(r=!1);break;case"opacity":y<.1&&(r=!1)}}),r)}),mt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,a=!0;const c=d=>t(d);let l=e;for(;l&&a;)c(l)||(r=!1,a=!1),l=l.parentElement,l||(a=!1);return r}),mt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),mt(this,"getSizeAboutClient",e=>{const{width:t,height:r,left:a,right:c,top:l,bottom:d}=e.getBoundingClientRect(),p=this.getClientWidth(),g=this.getClientHeight();return{width:t,height:r,left:a,right:c,top:l,bottom:d,clientWidth:p,clientHeight:g,clientMin:Math.min(p,g)}}),mt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),mt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),mt(this,"checkCoverForAPoint",(e,t,r)=>{const a=this.elementFromPoint(e,t);return a!==null&&a!==r}),mt(this,"getPointPositionList",()=>{const{width:e,height:t,left:r,top:a}=this._clientSize,c=e/6,l=t/6,d=[],p=10**6;for(let g=0;g<5;g++)for(let v=0;v<5;v++){const y=(r*p+(g===0?.1:g===4?(c*g*p-1e5)/p:c*g)*p)/p,b=(a*p+(v===0?.1:v===4?(l*v*p-1e5)/p:l*v)*p)/p;d.push({x:y,y:b})}return[...d]}),mt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),mt(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),mt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:r,bottom:a,clientHeight:c,clientWidth:l,clientMin:d}=this._clientSize;let p,g,v,y;if(e<0)p=0;else{if(!(e<l))return!1;p=e}if(t<0)return!1;if(g=t<l?t:l,r<0)v=0;else{if(!(r<c))return!1;v=r}if(a<0)return!1;y=a<c?a:c;const b=g-p,R=y-v;return this.checkSizeIsVisible(b,R,d)}),mt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),mt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Ly.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Ly.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ly.SIZE)}}return this.returnHiddenResult(Ly.STYLE)}return this.returnHiddenResult(tN.UNMOUNTED)}return this.returnHiddenResult(tN.INVALID_HTML_ELEMENT)}),mt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function rN(e){return new TextEncoder().encode(e)}const o3=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},nN=async e=>function(t,r){let a="";return new Uint8Array(t).forEach(c=>{a+=c.toString(r).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",rN(e)),16);let kr=class{constructor(){mt(this,"_events",{}),mt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const r=this._events[e],a=this._indexOfListener(r,t);a!==-1&&r.splice(a,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var r=arguments.length,a=new Array(r>1?r-1:0),c=1;c<r;c++)a[c-1]=arguments[c];for(let l=0;l<t.length;l+=1){const d=t[l];d.once&&this.off(e,d.listener),d.listener.apply(this,a||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,r)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},My=null;function s3(){if(My)return My;if(window.electron)return My=window.electron;if(!window.require)return null;try{return My=window.require("electron"),My}catch{return null}}let rn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Br=function(e){return e.TRACER="tracer",e}({});function c3(e){return ur(e.timeout,"config.timeout",0,1e5),ur(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ur(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ur(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Boe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),tr=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Uy(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function l3(e){return qn(e.turnServerURL,"turnServerURL"),qn(e.username,"username"),qn(e.password,"password"),e.udpport&&ur(e.udpport,"udpport",1,99999,!0),e.forceturn&&Wl(e.forceturn,"forceturn"),e.security&&Wl(e.security,"security"),e.tcpport&&ur(e.tcpport,"tcpport",1,99999,!0),!0}function iN(e){return e.level!==void 0&&Sn(e.level,"level",[1,2,3]),e.delay!==void 0&&ur(e.delay,"delay",0,3e3,!0),!0}let Dt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Zn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Na=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Nm=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ei(e,t){for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];return e.getListeners(t).length===0?Ge.reject(new _e(K.UNEXPECTED_ERROR,"can not emit promise")):new Ge((l,d)=>{e.emit(t,...a,l,d)})}function pr(e,t){if(e.getListeners(t).length===0)return Ge.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];return ei(e,t,...a)}function za(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];return jy(e,t,...a)}function jy(e,t){let r=null,a=null;for(var c=arguments.length,l=new Array(c>2?c-2:0),d=2;d<c;d++)l[d-2]=arguments[d];if(e.emit(t,...l,p=>{r=p},p=>{a=p}),a!==null)throw a;if(r===null)throw new _e(K.UNEXPECTED_ERROR,"handler is not sync");return r}const nn=new class extends kr{set networkState(e){this.emit(Nm.NETWORK_STATE_CHANGE,e,this._networkState),e===Na.ONLINE?this.emit(Nm.ONLINE):e===Na.OFFLINE&&(this.onlineWaiter=new Ge(t=>{this.once(Nm.ONLINE,()=>{this.onlineWaiter=void 0,t(Na.ONLINE)})}),this.emit(Nm.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Na.ONLINE}constructor(){super(),mt(this,"_moduleName","network-indicator"),mt(this,"_networkState",Na.ONLINE),mt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Na.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Na.OFFLINE})}};function DT(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Pm(e){const t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function xT(e){Ge!==void 0?Ge.resolve().then(e):setTimeout(e,0)}function Lr(e){return JSON.parse(JSON.stringify(e))}function np(e){try{return Lr(e)}catch{return e}}const u3={};function gd(e,t){u3[t]||(u3[t]=!0,e())}function ip(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let a=0;a<t.length;a+=1)r[a]=t.charCodeAt(a);return r}function _d(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function d3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const a=new Uint8Array(t);a.set(r),r=a}return r}function h3(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=sa(t).call(t,(d,p)=>d+p.length,0),c=new Uint8Array(new ArrayBuffer(a));let l=0;return t.forEach(d=>{c.set(d,l),l+=d.length}),c}function Wc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function p3(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?Wc(r):r.size}),t+138}function Woe(e){const t=new _e(K.TIMEOUT,"timeout");return new Ge((r,a)=>{window.setTimeout(()=>a(t),e)})}function Kn(e){return new Ge(t=>{window.setTimeout(t,e)})}function gr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+gr(e-r.length,"")}function ap(){return gr(32,"").toUpperCase()}const kT=()=>{},f3=new class{constructor(){mt(this,"fnMap",new Map)}throttleByKey(e,t,r,a){for(var c=arguments.length,l=new Array(c>4?c-4:0),d=4;d<c;d++)l[d-4]=arguments[d];if(this.fnMap.has(t)){const p=this.fnMap.get(t);if(p.threshold!==r){p.fn(...p.args),clearTimeout(p.timer);const g=window.setTimeout(()=>{const v=this.fnMap.get(t);v&&v.fn(...v.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:g,args:l,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(t,Ye(Ye({},p),{},{fn:e,args:l,skipFn:a}))}else{const p=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:p,args:l,skipFn:a})}}},m3=f3.throttleByKey.bind(f3);function g3(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function aN(e,t){if(!g3(e)||!g3(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let a=0;a<t.length;a++)r[a]=aN(e[a],t[a]);return r}{const r=Ye({},e);for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?r[a]=aN(e[a],t[a]):r[a]=t[a]);return r}}function _3(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let a=0;for(;e>0&&(r[a]=255&e,e>>=8,a++,a!==t););return r}function oN(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function sN(e){return sa(e).call(e,(t,r)=>t+r,0)}function v3(e){const t="0123456789abcdef";function r(te){let oe,se="";for(oe=0;oe<=3;oe++)se+=t.charAt(te>>8*oe+4&15)+t.charAt(te>>8*oe&15);return se}function a(te,oe){const se=(65535&te)+(65535&oe);return(te>>16)+(oe>>16)+(se>>16)<<16|65535&se}function c(te,oe,se,ae,pe,Te){return a(function(Fe,ze){return Fe<<ze|Fe>>>32-ze}(a(a(oe,te),a(ae,Te)),pe),se)}function l(te,oe,se,ae,pe,Te,Fe){return c(oe&se|~oe&ae,te,oe,pe,Te,Fe)}function d(te,oe,se,ae,pe,Te,Fe){return c(oe&ae|se&~ae,te,oe,pe,Te,Fe)}function p(te,oe,se,ae,pe,Te,Fe){return c(oe^se^ae,te,oe,pe,Te,Fe)}function g(te,oe,se,ae,pe,Te,Fe){return c(se^(oe|~ae),te,oe,pe,Te,Fe)}const v=function(te){let oe;const se=1+(te.length+8>>6),ae=new Array(16*se);for(oe=0;oe<16*se;oe++)ae[oe]=0;for(oe=0;oe<te.length;oe++)ae[oe>>2]|=te.charCodeAt(oe)<<oe%4*8;return ae[oe>>2]|=128<<oe%4*8,ae[16*se-2]=8*te.length,ae}(e);let y,b,R,O,V,k=1732584193,L=-271733879,H=-1732584194,q=271733878;for(y=0;y<v.length;y+=16)b=k,R=L,O=H,V=q,k=l(k,L,H,q,v[y+0],7,-680876936),q=l(q,k,L,H,v[y+1],12,-389564586),H=l(H,q,k,L,v[y+2],17,606105819),L=l(L,H,q,k,v[y+3],22,-1044525330),k=l(k,L,H,q,v[y+4],7,-176418897),q=l(q,k,L,H,v[y+5],12,1200080426),H=l(H,q,k,L,v[y+6],17,-1473231341),L=l(L,H,q,k,v[y+7],22,-45705983),k=l(k,L,H,q,v[y+8],7,1770035416),q=l(q,k,L,H,v[y+9],12,-1958414417),H=l(H,q,k,L,v[y+10],17,-42063),L=l(L,H,q,k,v[y+11],22,-1990404162),k=l(k,L,H,q,v[y+12],7,1804603682),q=l(q,k,L,H,v[y+13],12,-40341101),H=l(H,q,k,L,v[y+14],17,-1502002290),L=l(L,H,q,k,v[y+15],22,1236535329),k=d(k,L,H,q,v[y+1],5,-165796510),q=d(q,k,L,H,v[y+6],9,-1069501632),H=d(H,q,k,L,v[y+11],14,643717713),L=d(L,H,q,k,v[y+0],20,-373897302),k=d(k,L,H,q,v[y+5],5,-701558691),q=d(q,k,L,H,v[y+10],9,38016083),H=d(H,q,k,L,v[y+15],14,-660478335),L=d(L,H,q,k,v[y+4],20,-405537848),k=d(k,L,H,q,v[y+9],5,568446438),q=d(q,k,L,H,v[y+14],9,-1019803690),H=d(H,q,k,L,v[y+3],14,-187363961),L=d(L,H,q,k,v[y+8],20,1163531501),k=d(k,L,H,q,v[y+13],5,-1444681467),q=d(q,k,L,H,v[y+2],9,-51403784),H=d(H,q,k,L,v[y+7],14,1735328473),L=d(L,H,q,k,v[y+12],20,-1926607734),k=p(k,L,H,q,v[y+5],4,-378558),q=p(q,k,L,H,v[y+8],11,-2022574463),H=p(H,q,k,L,v[y+11],16,1839030562),L=p(L,H,q,k,v[y+14],23,-35309556),k=p(k,L,H,q,v[y+1],4,-1530992060),q=p(q,k,L,H,v[y+4],11,1272893353),H=p(H,q,k,L,v[y+7],16,-155497632),L=p(L,H,q,k,v[y+10],23,-1094730640),k=p(k,L,H,q,v[y+13],4,681279174),q=p(q,k,L,H,v[y+0],11,-358537222),H=p(H,q,k,L,v[y+3],16,-722521979),L=p(L,H,q,k,v[y+6],23,76029189),k=p(k,L,H,q,v[y+9],4,-640364487),q=p(q,k,L,H,v[y+12],11,-421815835),H=p(H,q,k,L,v[y+15],16,530742520),L=p(L,H,q,k,v[y+2],23,-995338651),k=g(k,L,H,q,v[y+0],6,-198630844),q=g(q,k,L,H,v[y+7],10,1126891415),H=g(H,q,k,L,v[y+14],15,-1416354905),L=g(L,H,q,k,v[y+5],21,-57434055),k=g(k,L,H,q,v[y+12],6,1700485571),q=g(q,k,L,H,v[y+3],10,-1894986606),H=g(H,q,k,L,v[y+10],15,-1051523),L=g(L,H,q,k,v[y+1],21,-2054922799),k=g(k,L,H,q,v[y+8],6,1873313359),q=g(q,k,L,H,v[y+15],10,-30611744),H=g(H,q,k,L,v[y+6],15,-1560198380),L=g(L,H,q,k,v[y+13],21,1309151649),k=g(k,L,H,q,v[y+4],6,-145523070),q=g(q,k,L,H,v[y+11],10,-1120210379),H=g(H,q,k,L,v[y+2],15,718787259),L=g(L,H,q,k,v[y+9],21,-343485551),k=a(k,b),L=a(L,R),H=a(H,O),q=a(q,V);return r(k)+r(L)+r(H)+r(q)}let Goe=1,y3=console,ci=class{static setLogger(e){y3=e}constructor(e,t){mt(this,"id",void 0),mt(this,"lockingPromise",Ge.resolve()),mt(this,"locks",0),mt(this,"name",""),mt(this,"lockId",void 0),this.lockId=Goe++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");y3.debug("".concat(r," ").concat(a))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new Ge(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),a=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),a}};function Dm(e,t){return function(r,a,c){const l=c.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const p=await d.lock("From ".concat(e,".").concat(a));try{for(var g=arguments.length,v=new Array(g),y=0;y<g;y++)v[y]=arguments[y];return await l.apply(this,v)}finally{p()}},c}}const un={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function cN(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Hs(e,t,r,a){const c=Object.assign({},un,a);let l=c.timeout;const d=async()=>{await function(v){return new Ge(y=>{window.setTimeout(y,v)})}(l),l*=c.timeoutFactor,l=Math.min(c.maxRetryTimeout,l)};let p=!1;const g=new Ge(async(v,y)=>{t=t||(()=>!1),r=r||(()=>!0);for(let b=0;b<c.maxRetryCount;b+=1){if(p)return y(new _e(K.OPERATION_ABORTED));try{const R=await e();if(!t(R,b)||b+1===c.maxRetryCount)return v(R);await d()}catch(R){if(!r(R,b)||b+1===c.maxRetryCount)return y(R);await d()}}});return g.cancel=()=>p=!0,g}let LT,E3=class{constructor(e){mt(this,"input",[]),mt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:sa(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},MT=0,lN=0;function uN(e,t,r,a){return new Ge((c,l)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),MT+=Wc(t.data)):r&&(t.data.size?MT+=t.data.size:t.data instanceof FormData?MT+=p3(t.data):MT+=Wc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ji.request(t).then(d=>{typeof d.data=="string"?lN+=Wc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?lN+=d.data.byteLength:lN+=Wc(JSON.stringify(d.data)),c(d.data)}).catch(d=>{Ji.isCancel(d)?l(new _e(K.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?l(new _e(K.NETWORK_TIMEOUT,d.message)):d.response?l(new _e(K.NETWORK_RESPONSE_ERROR,d.response.status)):l(new _e(K.NETWORK_ERROR,d.message))})})}async function Hoe(e,t){const r=new Blob([t.data],{type:"buffer"});return await uN(e,Ye(Ye({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const S3=()=>window.isSecureContext!==void 0;function ts(e){if(Array.isArray(e))return e.map(r=>r);if(!b3(e))return e;const t={};for(const r in e){const a=e[r];b3(a)||Array.isArray(a)?t[r]=ts(a):t[r]=a}return t}function b3(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let dN=class{constructor(e){mt(this,"input",[]),mt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Gc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Vy={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Gc,remoteCandidate:Gc},updateInterval:0},T3={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},w3={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},R3={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},C3={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let hN=class{constructor(e,t){mt(this,"onFirstVideoReceived",void 0),mt(this,"onFirstVideoDecoded",void 0),mt(this,"onFirstAudioReceived",void 0),mt(this,"onFirstVideoDecodedTimeout",void 0),mt(this,"onFirstAudioDecoded",void 0),mt(this,"onSelectedLocalCandidateChanged",void 0),mt(this,"onSelectedRemoteCandidateChanged",void 0),mt(this,"videoIsReady",!1),mt(this,"videoIsReady2",{}),mt(this,"pc",void 0),mt(this,"options",void 0),mt(this,"intervalTimer",void 0),mt(this,"stats",ts(Vy)),mt(this,"isFirstVideoReceived",{}),mt(this,"isFirstVideoDecoded",{}),mt(this,"isFirstAudioReceived",{}),mt(this,"isFirstAudioDecoded",{}),mt(this,"isFirstVideoDecodedTimeout",{}),mt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ge(e=>{e({local:Ye({},Gc),remote:Ye({},Gc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,l=0,d=0;for(const p of r)e[p].forEach((g,v)=>{if(!this.lossRateWindowStats[t-1][p][v]||!this.lossRateWindowStats[0][p][v])return;const y=this.lossRateWindowStats[t-1][p][v].packets-this.lossRateWindowStats[0][p][v].packets,b=this.lossRateWindowStats[t-1][p][v].packetsLost-this.lossRateWindowStats[0][p][v].packetsLost;p==="videoSend"||p==="audioSend"?(a+=y,l+=b):(c+=y,d+=b),Number.isNaN(y)||Number.isNaN(y)?g.packetLostRate=0:g.packetLostRate=y<=0||b<=0?0:b/(y+b)});e.sendPacketLossRate=a<=0||l<=0?0:l/(a+l),e.recvPacketLossRate=c<=0||d<=0?0:d/(c+d)}},qoe=class extends hN{constructor(){super(...arguments),mt(this,"_stats",Vy),mt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ts(Vy);const r=t.filter(c=>c.type==="ssrc");this.processSSRCStats(r);const a=t.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;const a=Ve(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=ts(w3);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=ts(T3),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),l){const d=l.stats,p=Date.now()-l.lts;c.framesDecodeFreezeTime=d.framesDecodeFreezeTime,c.framesDecodeInterval=d.framesDecodeInterval,c.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(l.lts=Date.now(),c.framesDecodeInterval=p,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<l.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ye({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=ts(C3);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=ts(R3);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Ge((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(r=>{const a={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(c=>{a[c]=r.stat(c)}),t.push(a)}),t}},Fy=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),UT=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),pN=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),$a=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var xm=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(xm||{});function By(e,t,r,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:xm.kNone;if(!t)return;const l=Number(t[r]);if(typeof l!="number")return;const d=Number(t[a]);if(typeof d!="number")return;if(!e)return d?l/d*c:void 0;const p=Number(e[r]);if(typeof p!="number")return;const g=Number(e[a]);if(typeof g!="number")return;const v=d-g;return v?(l-p)/v*c:void 0}let A3=class extends hN{constructor(){super(...arguments),mt(this,"_stats",Vy),mt(this,"report",void 0),mt(this,"lastDecodeVideoReceiverStats",new Map),mt(this,"lastVideoFramesRecv",new Map),mt(this,"lastVideoFramesSent",new Map),mt(this,"lastVideoFramesDecode",new Map),mt(this,"lastVideoFramesOutput",new Map),mt(this,"lastVideoJBDelay",new Map),mt(this,"lastAudioJBDelay",new Map),mt(this,"mediaBytesSent",new Map),mt(this,"mediaBytesRetransmit",new Map),mt(this,"mediaBytesTargetEncode",new Map),mt(this,"lastDecodeAudioReceiverStats",new Map),mt(this,"lastAudioConcealment",new Map),mt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ts(Vy),this.report.forEach(e=>{switch(e.type){case $a.OUTBOUND:case $a.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,a=!t&&!("frameWidth"in e);e.type===$a.OUTBOUND?t==="audio"||a?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===$a.INBOUND&&(t==="audio"||a?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case $a.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case $a.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Ye({},Gc),remote:Ye({},Gc)};return e.forEach(r=>{let a;if(r.type===$a.TRANSPORT&&(a=e.get(r.selectedCandidatePairId)),r.type===$a.CANDIDATE_PAIR&&r.selected&&(a=r),a){const c=(l,d)=>{l.type=d.type,l.id=d.id,d.address&&(l.address=d.address),d.candidateType&&(l.candidateType=d.candidateType),d.port&&(l.port=d.port),d.priority&&(l.priority=d.priority),d.protocol&&(l.protocol=d.protocol),d.relayProtocol&&(l.relayProtocol=d.relayProtocol)};if(a.localCandidateId){const l=e.get(a.localCandidateId);l&&c(t.local,l)}if(a.remoteCandidateId){const l=e.get(a.remoteCandidateId);l&&c(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===$a.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===$a.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===$a.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ye({},t),Ye({},this.stats.selectedCandidatePair.localCandidate)),e.type===$a.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ye({},t),Ye({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(a=>a.ssrc===e.ssrc);t||(t=ts(C3),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=By(r,t,"totalProcessingDelay","jitterBufferEmittedCount",xm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ye({},t))}calculateAudioFreeze(e,t,r){const a=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&a!=null){const c=a.lts,l=r.timestamp,d=l-c;if(d<=0)return;const p=e.concealedSamples-t.concealedSamples-0,g=a.nonSilent+p,v=e.totalSamplesReceived-t.totalSamplesReceived;if(v<=0)return;const y=80*v/d,b=200*v/d,R=d/v;let O=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,g>y&&(a.plc80>0?(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*R)):(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*R)),O=a.plc80+1);let V=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,g>b&&(a.plc200>0?(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*R)):(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*R)),V=a.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:p,lts:l,plc80:O,plc200:V})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(d=>d.ssrc===e.ssrc);t||(t=ts(T3),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),a=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const d=t.decodedFrame?t.decodedFrame.width:0,p=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,d,p),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const d=r.stats,p=l-r.lts;t.framesDecodeFreezeTime=d.framesDecodeFreezeTime,t.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=p,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<d.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=By(r==null?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=By(r==null?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",xm.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=By(r==null?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",xm.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=By(r==null?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",xm.kMillisecondsFromSeconds),a&&l-a.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-a.count)/((l-a.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):a?t.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&l-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((l-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ye({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(a=>a.ssrc===e.ssrc);t||(t=ts(w3),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const a=new dN(10);a.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,a)}if(e.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(e.ssrc);if(a)a.add(e.retransmittedBytesSent);else{const c=new dN(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{const c=new dN(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const a=this.lastEncoderMs.get(e.ssrc);if(!a||a.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-a.lastFrameCount,l=e.totalEncodeTime-a.lastEncoderTime;t.avgEncodeMs=1e3*l/c}}if(e.framesEncoded&&e.qpSum){const a=this.lastEncoderMs.get(e.ssrc);!a||a.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-a.lastQpSum)/(e.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const a=this.findRemoteStatsId(e.ssrc,$a.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=ts(R3),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,$a.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;const a=Array.from(Aa(r=this.report).call(r)).find(c=>c.type===t&&c.ssrc===e);return a?a.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var a,c,l,d;const p=t?this.report.get(t):void 0,g=(a=p==null?void 0:p.framesSent)!==null&&a!==void 0?a:e.framesSent;if(typeof g!="number")return;let v=(c=p==null?void 0:p.frameWidth)!==null&&c!==void 0?c:e.frameWidth,y=(l=p==null?void 0:p.frameHeight)!==null&&l!==void 0?l:e.frameHeight,b=(d=p==null?void 0:p.framesPerSecond)!==null&&d!==void 0?d:e.framesPerSecond;if(typeof v=="number"&&typeof y=="number"||(v=0,y=0),b==null){const R=Date.now(),O=this.lastVideoFramesSent.get(r.ssrc);O&&R-O.lts>=800?(b=Math.round((g-O.count)/((R-O.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:R,rate:b})):O?b=O.rate:this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:R,rate:0})}r.sentFrame={width:v,height:y,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(e,t,r){var a,c,l,d,p;const g=t?this.report.get(t):void 0,v=(a=g==null?void 0:g.framesReceived)!==null&&a!==void 0?a:e.framesReceived,y=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:e.frameWidth,b=(l=g==null?void 0:g.frameHeight)!==null&&l!==void 0?l:e.frameHeight,R=(d=g==null?void 0:g.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,O=(p=g==null?void 0:g.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof v=="number"){const V=this.lastVideoFramesRecv.get(r.ssrc),k=Date.now();r.framesReceivedCount=v;let L=0;V&&k-V.lts>=800?(L=Math.round((v-V.count)/((k-V.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:k,rate:L})):V?L=V.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:k,rate:0}),r.receivedFrame={width:y||0,height:b||0,frameRate:L||0},r.decodedFrame={width:y||0,height:b||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:y||0,height:b||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(R&&O){const V=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let k=V.jitterBufferMs;const L=O-V.jitterBufferEmittedCount;L>0&&(k=1e3*(R-V.jitterBufferDelay)/L),r.jitterBufferMs=k,r.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:O,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var a,c,l,d;const p=t?this.report.get(t):void 0,g=(a=(c=p==null?void 0:p.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&a!==void 0?a:0,v=(l=(d=p==null?void 0:p.echoReturnLossEnhancement)!==null&&d!==void 0?d:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;r.aecReturnLoss=g,r.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,t,r){var a,c,l,d,p,g,v,y,b;const R=t?this.report.get(t):void 0,O=(a=R==null?void 0:R.removedSamplesForAcceleration)!==null&&a!==void 0?a:e.removedSamplesForAcceleration,V=(c=R==null?void 0:R.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(l=R==null?void 0:R.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,L=(d=R==null?void 0:R.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount,H=(p=R==null?void 0:R.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,q=(g=R==null?void 0:R.totalSamplesDuration)!==null&&g!==void 0?g:e==null?void 0:e.totalSamplesDuration,te=(v=R==null?void 0:R.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples,oe=(y=R==null?void 0:R.silentConcealedSamples)!==null&&y!==void 0?y:e.silentConcealedSamples,se=(b=R==null?void 0:R.concealmentEvents)!==null&&b!==void 0?b:e.concealmentEvents;if(typeof V=="number"&&(r.totalSamplesReceived=V),typeof oe=="number"&&(r.silentConcealedSamples=oe),typeof se=="number"&&(r.concealmentEvents=se),typeof te=="number"&&(r.concealedSamples=te),O&&V&&(r.accelerateRate=O/V),k&&L){const pe=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Te=pe.jitterBufferMs;const Fe=L-pe.jitterBufferEmittedCount;Fe>0&&(Te=1e3*(k-pe.jitterBufferDelay)/Fe),r.jitterBufferMs=Math.round(Te),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:L,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=H;let ae=1920;q&&V&&(ae=V/q/50,r.receivedFrames=Math.round(V/ae)),te&&(r.droppedFrames=Math.round(te/ae))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()});const a=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},Koe=class extends hN{updateStats(){return Ge.resolve()}};function fN(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return l?l<76?new qoe(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new A3(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(d){if(!window.RTCStatsReport)return!1;const p=d.getStats();return!!(p instanceof Ge||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(p))}(e)?new A3(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new Koe(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const O3="websdk_ng_install_id";function mN(){try{if($("INSTALL_ID"))return $("INSTALL_ID");let e=window.localStorage.getItem(O3);return e||(e=ap(),window.localStorage.setItem(O3,e)),sr("INSTALL_ID",e),e}catch{return}}const bo=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],a=t[2];return"".concat(r,".").concat(a)}return"4.0.0.999"}("4.23.4"),gN=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let op=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ti=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),c=[];for(let p=0;p<6;p++)c.push("1");const l=c.join(""),d={};return d[e]=a,d[t]=l,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ti;const jT={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},_N={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},vN="v4.23.4-0-g17410532-dirty(6/5/2025, 4:24:52 PM)",yN={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},Ar=Ye(Ye(Ye(Ye({},yN),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:_N,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},jT),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function sr(e,t,r){var a,c,l;Ve(a=Object.keys(Ar)).call(a,e)&&(!r&&Ve(c=Object.keys(qs)).call(c,e)||(Ar[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(Ar.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Ar.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,Ar.USE_NEW_NETWORK_CONFIG=l,l&&(Ar.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ar.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ar.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ar.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ar.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ar.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Ar.ENABLE_INSTANT_VIDEO=!0,Ar.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Ar.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Ar.NEW_TURN_MODE||(Ar.NEW_TURN_MODE=4))))}function $(e){return Ar[e]}gN||(Ar.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ar.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ar.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ar.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ar.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ar.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ar.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ar.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ar.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ar.AREAS=["NORTH_AMERICA","OVERSEA"]);let I3=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const qs={};var jt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(jt||{});let VT=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const N3=128,zoe=96,P3=1e3,km=10;let $oe=0;var D3=(()=>{var e={8:(a,c,l)=>{l.r(c),l.d(c,{Parser:()=>Fe,Printer:()=>Er,parse:()=>Le,print:()=>Xe});const d=`
`,p="".concat("\r").concat(d),g=" ";let v;function y(Re){return Re>="0"&&Re<="9"}function b(Re){return Re>="!"&&Re<="~"}function R(Re){return b(Re)||Re>=""&&Re<="ÿ"}function O(Re){return Re==="!"||Re>="#"&&Re<="'"||Re>="*"&&Re<="+"||Re>="-"&&Re<="."||Re>="0"&&Re<="9"||Re>="A"&&Re<="Z"||Re>="^"&&Re<="~"}function V(Re){return Re>="1"&&Re<="9"}function k(Re){return Re>="A"&&Re<="Z"||Re>="a"&&Re<="z"}function L(Re){return Re==="d"||Re==="h"||Re==="m"||Re==="s"}function H(Re){return Re>""&&Re<"	"||Re>"\v"&&Re<"\f"||Re>""&&Re<"ÿ"}function q(Re){return k(Re)||y(Re)||Re==="+"||Re==="/"}function te(Re){return y(Re)||k(Re)||Re==="+"||Re==="/"||Re==="-"||Re==="_"}function oe(Re){return k(Re)||y(Re)||Re==="+"||Re==="/"}function se(Re,D){var Q=Object.keys(Re);if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(Re);D&&(ne=ne.filter(function(De){return Object.getOwnPropertyDescriptor(Re,De).enumerable})),Q.push.apply(Q,ne)}return Q}function ae(Re){for(var D=1;D<arguments.length;D++){var Q=arguments[D]!=null?arguments[D]:{};D%2?se(Object(Q),!0).forEach(function(ne){pe(Re,ne,Q[ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Re,Object.getOwnPropertyDescriptors(Q)):se(Object(Q)).forEach(function(ne){Object.defineProperty(Re,ne,Object.getOwnPropertyDescriptor(Q,ne))})}return Re}function pe(Re,D,Q){return D in Re?Object.defineProperty(Re,D,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Re[D]=Q,Re}(function(Re){Re.VERSION="v",Re.ORIGIN="o",Re.SESSION_NAME="s",Re.INFORMATION="i",Re.URI="u",Re.EMAIL="e",Re.PHONE="p",Re.CONNECTION="c",Re.BANDWIDTH="b",Re.TIME="t",Re.REPEAT="r",Re.ZONE_ADJUSTMENTS="z",Re.KEY="k",Re.ATTRIBUTE="a",Re.MEDIA="m"})(v||(v={}));class Te{consumeText(D,Q){let ne=Q;for(;ne<D.length;){const De=D[ne];if(De==="\0"||De==="\r"||De===d)break;ne+=1}if(ne-Q==0)throw new Error("Invalid text, at ".concat(D));return ne}consumeUnicastAddress(D,Q,ne){return this.consumeTill(D,Q,g)}consumeOneOrMore(D,Q,ne){let De=Q;for(;ne(D[De]);)De++;if(De-Q==0)throw new Error("Invalid rule at ".concat(Q,"."));return De}consumeSpace(D,Q){if(D[Q]===g)return Q+1;throw new Error("Invalid space at ".concat(Q,"."))}consumeIP4Address(D,Q){let ne=Q;for(let De=0;De<4;De++)if(ne=this.consumeDecimalUChar(D,ne),De!==3){if(D[ne]!==".")throw new Error("Invalid IP4 address.");ne++}return ne}consumeDecimalUChar(D,Q){let ne=Q;for(let yt=0;yt<3&&y(D[ne]);yt++,ne++);if(ne-Q==0)throw new Error("Invalid decimal uchar.");const De=parseInt(D.slice(Q,ne));if(De>=0&&De<=255)return ne;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,Q){let ne=this.consumeHexpart(D,Q);return D[ne]===":"&&(ne+=1,ne=this.consumeIP4Address(D,ne)),ne}consumeHexpart(D,Q){let ne=Q;if(D[ne]===":"&&D[ne+1]===":"){ne+=2;try{ne=this.consumeHexseq(D,ne)}catch{}return ne}if(ne=this.consumeHexseq(D,ne),D[ne]===":"&&D[ne+1]===":"){ne+=2;try{ne=this.consumeHexseq(D,ne)}catch{}return ne}return ne}consumeHexseq(D,Q){let ne=Q;for(;ne=this.consumeHex4(D,ne),D[ne]===":"&&D[ne+1]!==":";)ne+=1;return ne}consumeHex4(D,Q){let ne=0;for(;ne<4;ne++)if(!((De=D[Q+ne])>="0"&&De<="9"||De>="a"&&De<="f"||De>="A"&&De<="F")){if(ne===0)throw new Error("Invalid hex 4");break}var De;return Q+ne}consumeFQDN(D,Q){let ne=Q;for(;y(D[ne])||k(D[ne])||D[ne]==="-"||D[ne]===".";)ne+=1;if(ne-Q<4)throw new Error("Invalid FQDN");return ne}consumeExtnAddr(D,Q){return this.consumeOneOrMore(D,Q,R)}consumeMulticastAddress(D,Q,ne){switch(ne){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,Q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,Q);default:try{return this.consumeFQDN(D,Q)}catch{return this.consumeExtnAddr(D,Q)}}}consumeIP6MulticastAddress(D,Q){const ne=this.consumeHexpart(D,Q);return D[ne]==="/"?this.consumeInteger(D,ne+1):ne}consumeIP4MulticastAddress(D,Q){let ne=Q+3;const De=D.slice(Q,ne),yt=parseInt(De);if(yt<224||yt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let _r=0;_r<3;_r++){if(D[ne]!==".")throw new Error("Invalid IP4 multicast address.");ne+=1,ne=this.consumeDecimalUChar(D,ne)}return D[ne]==="/"&&(ne+=1),ne=this.consumeTTL(D,ne),D[ne]==="/"&&(ne=this.consumeInteger(D,ne)),ne}consumeInteger(D,Q){if(!V(D[Q]))throw new Error("Invalid integer.");for(Q+=1;y(D[Q]);)Q+=1;return Q}consumeTTL(D,Q){if(D[Q]==="0")return Q+1;if(!V(D[Q]))throw new Error("Invalid TTL.");Q+=1;for(let ne=0;ne<2&&y(D[Q]);ne++)Q+=1;return Q}consumeToken(D,Q){return this.consumeOneOrMore(D,Q,O)}consumeTime(D,Q){let ne=Q;if(D[ne]==="0")return ne+1;for(V(D[ne])&&(ne+=1);y(D[ne]);)ne++;if(ne-Q<10)throw new Error("Invalid time");return ne}consumeAddress(D,Q){return this.consumeTill(D,Q,g)}consumeTypedTime(D,Q){let ne=Q;return ne=this.consumeOneOrMore(D,ne,y),L(D[ne])?ne+1:ne}consumeRepeatInterval(D,Q){if(!V(D[Q]))throw new Error("Invalid repeat interval");for(Q+=1;y(D[Q]);)Q+=1;return L(D[Q])&&(Q+=1),Q}consumePort(D,Q){return this.consumeOneOrMore(D,Q,y)}consume(D,Q,ne){for(let De=0;De<ne.length;De++){if(Q+De>=D.length)throw new Error("consume exceeding value length");if(D[Q+De]!==ne[De])throw new Error("consume ".concat(ne," failed at ").concat(De))}return Q+ne.length}consumeTill(D,Q,ne){let De=Q;for(;De<D.length&&(typeof ne!="string"||D[De]!==ne)&&(typeof ne!="function"||!ne(D[De]));)De++;return De}}class Fe extends Te{constructor(){super(),pe(this,"records",[]),pe(this,"currentLine",0)}parse(D){const Q=this.probeEOL(D);this.records=D.split(Q).filter(Zl=>!!Ti(Zl).call(Zl)).map(this.parseLine),this.currentLine=0;const ne=this.parseVersion(),De=this.parseOrigin(),yt=this.parseSessionName(),_r=this.parseInformation(),_n=this.parseUri(),Io=this.parseEmail(),fs=this.parsePhone(),CE=this.parseConnection(),Cp=this.parseBandWidth(),pg=this.parseTimeFields(),$w=this.parseKey(),Yw=this.parseSessionAttribute(),No=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ne,origin:De,sessionName:yt,information:_r,uri:_n,emails:Io,phones:fs,connection:CE,bandwidths:Cp,timeFields:pg,key:$w,attributes:Yw,mediaDescriptions:No}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let Q=0;Q<D.length;Q++)if(D[Q]===d)return D[Q-1]==="\r"?p:d;throw new Error("Invalid newline character.")}parseLine(D,Q){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ne=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ne,value:D.slice(2),line:Q,cur:0}}parseSessionAttribute(){const D=new At;for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==v.ATTRIBUTE)break;const ne={attField:this.extractOneOrMore(Q,De=>O(De)&&De!==":"),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,ne.attValue=this.extractOneOrMore(Q,H)),D.parse(ne),this.currentLine++}return D.digest()}parseMediaAttributes(D){const Q=new bt(D);for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==v.ATTRIBUTE)break;const De={attField:this.extractOneOrMore(ne,yt=>O(yt)&&yt!==":"),_cur:0};ne.value[ne.cur]===":"&&(ne.cur+=1,De.attValue=this.extractOneOrMore(ne,H)),Q.parse(De),this.currentLine++}return Q.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===v.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===v.ZONE_ADJUSTMENTS){const Q=[];for(;;)try{const ne=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let De=!1;D.value[D.cur]==="-"&&(De=!0,D.cur+=1);const yt=this.extract(D,this.consumeTypedTime);Q.push({time:ne,typedTime:yt,back:De})}catch{break}if(Q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Q}return[]}parseRepeat(){const D=[];for(;;){const Q=this.getCurrentRecord();if(Q.type!==v.REPEAT)break;{const ne=this.extract(Q,this.consumeRepeatInterval),De=this.parseTypedTime(Q);D.push({repeatInterval:ne,typedTimes:De}),this.currentLine++}}return D}parseTypedTime(D){const Q=[];for(;;)try{this.consumeSpaceForRecord(D),Q.push(this.extract(D,this.consumeTypedTime))}catch{break}if(Q.length===0)throw new Error("Invalid typed time.");return Q}parseTime(){const D=this.getCurrentRecord(),Q=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const ne=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:Q,stopTime:ne}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==v.BANDWIDTH)break;{const ne=this.extractOneOrMore(Q,O);if(Q.value[Q.cur]!==":")throw new Error("Invalid bandwidth field.");Q.cur++;const De=this.extractOneOrMore(Q,y);D.push({bwtype:ne,bandwidth:De}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==v.VERSION)throw new Error("first sdp record must be version");const Q=D.value.slice(0,this.consumeOneOrMore(D.value,0,y));if(Q.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,Q}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const Q=this.extractOneOrMore(D,R);this.consumeSpaceForRecord(D);const ne=this.extractOneOrMore(D,y);this.consumeSpaceForRecord(D);const De=this.extractOneOrMore(D,y);this.consumeSpaceForRecord(D);const yt=this.extractOneOrMore(D,O);this.consumeSpaceForRecord(D);const _r=this.extractOneOrMore(D,O);this.consumeSpaceForRecord(D);const _n=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:Q,sessId:ne,sessVersion:De,nettype:yt,addrtype:_r,unicastAddress:_n}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===v.SESSION_NAME){const Q=this.extract(D,this.consumeText);return this.currentLine++,Q}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==v.INFORMATION)return;const Q=this.extract(D,this.consumeText);return this.currentLine++,Q}parseUri(){const D=this.getCurrentRecord();if(D.type===v.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const Q=this.getCurrentRecord();if(Q.type!==v.EMAIL)break;D.push(Q.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const Q=this.getCurrentRecord();if(Q.type!==v.PHONE)break;D.push(Q.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===v.CONNECTION){const Q=this.extractOneOrMore(D,O);this.consumeSpaceForRecord(D);const ne=this.extractOneOrMore(D,O);this.consumeSpaceForRecord(D);const De=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:Q,addrtype:ne,address:De}}}parseMedia(){const D=this.getCurrentRecord(),Q=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let ne=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,ne+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const De=[];for(De.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,De.push(this.extract(D,this.consumeToken));if(De.length===0)throw new Error("Invalid proto");const yt=this.parseFmt(D);return this.currentLine++,{mediaType:Q,port:ne,protos:De,fmts:yt}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===v.TIME;){const Q=this.parseTime(),ne=this.parseRepeat(),De=this.parseZone();D.push({time:Q,repeats:ne,zones:De})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const Q=this.parseMedia(),ne=this.parseInformation(),De=this.parseConnections(),yt=this.parseBandWidth(),_r=this.parseKey(),_n=this.parseMediaAttributes(Q);D.push({media:Q,information:ne,connections:De,bandwidths:yt,key:_r,attributes:_n})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const Q=[];for(;;)try{this.consumeSpaceForRecord(D),Q.push(this.extract(D,this.consumeToken))}catch{break}if(Q.length===0)throw new Error("Invalid fmts");return Q}extract(D,Q){for(var ne=arguments.length,De=new Array(ne>2?ne-2:0),yt=2;yt<ne;yt++)De[yt-2]=arguments[yt];const _r=Q.call(this,D.value,D.cur,...De),_n=D.value.slice(D.cur,_r);return D.cur=_r,_n}extractOneOrMore(D,Q){const ne=this.consumeOneOrMore(D.value,D.cur,Q),De=D.value.slice(D.cur,ne);return D.cur=ne,De}consumeSpaceForRecord(D){if(D.value[D.cur]!==g)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class ze extends Te{constructor(){super(...arguments),pe(this,"attributes",void 0),pe(this,"digested",!1)}extractOneOrMore(D,Q,ne){const De=this.consumeOneOrMore(D.attValue,D._cur,Q),yt=D.attValue.slice(D._cur,De),[_r,_n]=ne||[];if(typeof _r=="number"&&yt.length<_r)throw new Error("error in length, should be more or equal than ".concat(_r," characters."));if(typeof _n=="number"&&yt.length>_n)throw new Error("error in length, should be less or equal than ".concat(_n," characters."));return D._cur=De,yt}consumeAttributeSpace(D){if(D.attValue[D._cur]!==g)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,Q){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var ne=arguments.length,De=new Array(ne>2?ne-2:0),yt=2;yt<ne;yt++)De[yt-2]=arguments[yt];const _r=Q.call(this,D.attValue,D._cur,...De),_n=D.attValue.slice(D._cur,_r);return D._cur=_r,_n}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,Q){if(!D.attValue)throw new Error;for(let ne=0;ne<Q.length;ne++)if(Q[ne]!==D.attValue[D._cur+ne])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,q,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,q,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const Q=[];for(;!this.atEnd(D);){Q.push(this.extractOneOrMore(D,q));try{this.consumeAttributeSpace(D)}catch(ne){if(this.atEnd(D))break;throw ne}}this.attributes.iceOptions=Q}parseFingerprint(D){const Q=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ne=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Q,fingerprint:ne})}parseExtmap(D){const Q=this.extractOneOrMore(D,y);let ne;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),ne=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const De=this.extract(D,this.consumeTill,g),yt=ae(ae({entry:parseInt(Q,10)},ne&&{direction:ne}),{},{extensionName:De});this.peekChar(D)===g&&(this.consumeAttributeSpace(D),yt.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(yt)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const Q=this.extract(D,this.consumeTill);if(Q!=="active"&&Q!=="passive"&&Q!=="actpass"&&Q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Q}}class At extends ze{constructor(){super(...arguments),pe(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(Q){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),Q}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const Q=this.extract(D,this.consumeToken),ne=[];for(;!this.atEnd(D)&&this.peekChar(D)===g;)this.consumeAttributeSpace(D),ne.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:Q,identificationTag:ne})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,te)}parseIdentity(D){const Q=this.extractOneOrMore(D,oe),ne=[];for(;!this.atEnd(D)&&this.peekChar(D)===g;){this.consumeAttributeSpace(D);const De=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const yt=this.extractOneOrMore(D,_r=>_r!==g&&H(_r));ne.push({name:De,value:yt})}this.attributes.identities.push({assertionValue:Q,extensions:ne})}parseMsidSemantic(D){this.peekChar(D)===g&&this.consumeAttributeSpace(D);const Q={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),Q.applyForAll=!0;break}{const ne=this.extract(D,this.consumeTill,g);Q.identifierList.push(ne)}}this.attributes.msidSemantic=Q}}class bt extends ze{constructor(D){super(),pe(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(Q){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),Q}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const Q=this.extractOneOrMore(D,q,[1,32]);this.consumeAttributeSpace(D);const ne=this.extractOneOrMore(D,y,[1,5]);this.consumeAttributeSpace(D);const De=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const yt=this.extractOneOrMore(D,y,[1,10]);this.consumeAttributeSpace(D);const _r=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const _n=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const Io={foundation:Q,componentId:ne,transport:De,priority:yt,connectionAddress:_r,port:_n,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),Io.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),Io.relPort=this.extract(D,this.consumePort));this.peekChar(D)===g;){this.consumeAttributeSpace(D);const fs=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),Io.extension[fs]=this.extractOneOrMore(D,b)}this.attributes.candidates.push(Io)}parseRemoteCandidate(D){const Q=[];for(;;){const ne=this.extractOneOrMore(D,y,[1,5]);this.consumeAttributeSpace(D);const De=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const yt=this.extract(D,this.consumePort);Q.push({componentId:ne,connectionAddress:De,port:yt});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(Q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const Q=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ne=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const De={encodingName:ne,clockRate:this.extractOneOrMore(D,y)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),De.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const yt=this.attributes.payloads.find(_r=>_r.payloadType===parseInt(Q,10));yt?yt.rtpMap=De:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtpMap:De,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const Q=this.extractOneOrMore(D,y);this.consumeAttributeSpace(D);const ne=this.extract(D,this.consumeTill,":");let De;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),De=this.extract(D,this.consumeTill));const yt=this.attributes.ssrcs.find(_r=>_r.ssrcId===parseInt(Q,10));yt?yt.attributes[ne]=De:this.attributes.ssrcs.push({ssrcId:parseInt(Q,10),attributes:{[ne]:De}})}parseFmtp(D){const Q=this.extract(D,this.consumeTill,g);this.consumeAttributeSpace(D);const ne=this.extract(D,this.consumeTill),De={};ne.split(";").forEach(_r=>{let[_n,Io]=_r.split("=");_n=Ti(_n).call(_n);const fs=typeof Io=="string"?Ti(Io).call(Io):null;typeof _n=="string"&&_n.length>0&&(De[_n]=fs)});const yt=this.attributes.payloads.find(_r=>_r.payloadType===parseInt(Q,10));yt?yt.fmtp={parameters:De}:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[],fmtp:{parameters:De}})}parseFmtParameters(D){const Q={},ne=this.extract(D,this.consumeTill,"=");D._cur++;const De=this.extract(D,this.consumeTill,";");for(Q[ne]=De;D.attValue[D._cur]===";";){const yt=this.extract(D,this.consumeTill,"=");D._cur++;const _r=this.extract(D,this.consumeTill,";");Q[yt]=_r}return Q}parseRtcpFb(D){let Q="";Q=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,g),this.consumeAttributeSpace(D);const ne=this.extract(D,this.consumeTill,g);let De;if(ne==="trr-int")De={type:ne,interval:this.extract(D,this.consumeTill)};else{const yt={type:ne};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),yt.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===g&&(yt.additional=this.extract(D,this.consumeTill))),De=yt}if(Q==="*")this.attributes.rtcpFeedbackWildcards.push(De);else{const yt=this.attributes.payloads.find(_r=>_r.payloadType===parseInt(Q,10));yt?yt.rtcpFeedbacks.push(De):this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[De]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const Q={port:this.extract(D,this.consumePort)};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),Q.netType=this.extractOneOrMore(D,O),this.consumeAttributeSpace(D),Q.addressType=this.extractOneOrMore(D,O),this.consumeAttributeSpace(D),Q.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=Q}parseMsid(D){const Q={id:this.extractOneOrMore(D,O,[1,64])};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),Q.appdata=this.extractOneOrMore(D,O,[1,64])),this.attributes.msids.push(Q)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const Q=this.extractOneOrMore(D,De=>k(De)||y(De)||De==="_"||De==="-");this.consumeAttributeSpace(D);const ne={id:Q,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===g){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const De=[];for(;;){const yt=this.extract(D,this.consumeToken);De.push(yt);try{this.extract(D,this.consume,",")}catch{break}}ne.payloads=De,this.peekChar(D)===g&&this.extract(D,this.consume,g)}for(;;){const De=this.extract(D,this.consumeToken);switch(De){case"depend":{const yt={type:De,rids:this.extract(D,this.consume,"=").split(",")};ne.params.push(yt);break}default:{const yt={type:De};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),yt.val=this.extract(D,this.consumeTill,";")),ne.params.push(yt)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(ne)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,y,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const Q=this.extract(D,this.consumeToken),ne=[];for(;;)try{this.consumeAttributeSpace(D);const De=this.extract(D,this.consumeInteger);ne.push(parseInt(De,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Q,ssrcIds:ne})}}function pt(Re,D,Q){return D in Re?Object.defineProperty(Re,D,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Re[D]=Q,Re}class Er{constructor(){pt(this,"eol",p)}print(D,Q){let ne="";return Q&&(this.eol=Q),ne+=this.printVersion(D.version),ne+=this.printOrigin(D.origin),ne+=this.printSessionName(D.sessionName),ne+=this.printInformation(D.information),ne+=this.printUri(D.uri),ne+=this.printEmail(D.emails),ne+=this.printPhone(D.phones),ne+=this.printConnection(D.connection),ne+=this.printBandwidth(D.bandwidths),ne+=this.printTimeFields(D.timeFields),ne+=this.printKey(D.key),ne+=this.printSessionAttributes(D.attributes),ne+=this.printMediaDescription(D.mediaDescriptions),ne}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let Q="";for(const ne of D)Q+="e=".concat(ne).concat(this.eol);return Q}printPhone(D){let Q="";for(const ne of D)Q+="e=".concat(ne).concat(this.eol);return Q}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let Q="";for(const ne of D)Q+="b=".concat(ne.bwtype,":").concat(ne.bandwidth).concat(this.eol);return Q}printTimeFields(D){let Q="";for(const ne of D){Q+="t=".concat(ne.time.startTime," ").concat(ne.time.startTime).concat(this.eol);for(const De of ne.repeats)Q+="r=".concat(De.repeatInterval," ").concat(De.typedTimes.join(" ")).concat(this.eol);ne.zoneAdjustments&&(Q+="z=",Q+="z=".concat(ne.zoneAdjustments.map(De=>"".concat(De.time," ").concat(De.back?"-":""," ").concat(De.typedTime)).join(" ")).concat(this.eol),Q+=this.eol)}return Q}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let Q="";for(const ne of D)Q+="a=".concat(ne.attField).concat(ne.attValue?":".concat(ne.attValue):"").concat(this.eol);return Q}printMediaDescription(D){let Q="";for(const ne of D)Q+=this.printMedia(ne.media),Q+=this.printInformation(ne.information),Q+=this.printConnections(ne.connections),Q+=this.printBandwidth(ne.bandwidths),Q+=this.printKey(ne.key),Q+=this.printMediaAttributes(ne);return Q}printConnections(D){let Q="";for(const ne of D)Q+=this.printConnection(ne);return Q}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new ra(this.eol).print(D)}printMediaAttributes(D){return new we(this.eol).print(D)}}class hr{constructor(D){pt(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(g)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(Q=>"a=fingerprint:".concat(Q.hashFunction).concat(g).concat(Q.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(Q=>"a=extmap:".concat(Q.entry).concat(Q.direction?"/".concat(Q.direction):"").concat(g).concat(Q.extensionName).concat(Q.extensionAttributes?"".concat(g).concat(Q.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(Q=>"a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol)).join("")}}class ra extends hr{print(D){let Q="";return Q+=this.printGroups(D.groups),Q+=this.printMsidSemantic(D.msidSemantic),Q+=this.printIceLite(D.iceLite),Q+=this.printIceUfrag(D.iceUfrag),Q+=this.printIcePwd(D.icePwd),Q+=this.printIceOptions(D.iceOptions),Q+=this.printFingerprints(D.fingerprints),Q+=this.printSetup(D.setup),Q+=this.printTlsId(D.tlsId),Q+=this.printIdentity(D.identities),Q+=this.printExtmap(D.extmaps),Q+=this.printUnrecognized(D.unrecognized),Q}printGroups(D){let Q="";return D.length>0&&(Q+=D.map(ne=>"a=group:".concat(ne.semantic).concat(ne.identificationTag.map(De=>"".concat(g).concat(De)).join("")).concat(this.eol)).join("")),Q}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(Q=>"a=identity:".concat(Q.assertionValue).concat(Q.extensions.map(ne=>"".concat(g).concat(ne.name).concat(ne.value?"=".concat(ne.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let Q="a=msid-semantic:".concat(D.semantic);return D.applyForAll?Q+="".concat(g,"*"):D.identifierList.length>0&&(Q+=D.identifierList.map(ne=>"".concat(g).concat(ne))),Q+this.eol}}class we extends hr{print(D){const Q=D.attributes;let ne="";return ne+=this.printRTCP(Q.rtcp),ne+=this.printIceUfrag(Q.iceUfrag),ne+=this.printIcePwd(Q.icePwd),ne+=this.printIceOptions(Q.iceOptions),ne+=this.printCandidates(Q.candidates),ne+=this.printRemoteCandidatesList(Q.remoteCandidatesList),ne+=this.printEndOfCandidates(Q.endOfCandidates),ne+=this.printFingerprints(Q.fingerprints),ne+=this.printSetup(Q.setup),ne+=this.printMid(Q.mid),ne+=this.printExtmap(Q.extmaps),ne+=this.printRTPRelated(Q),ne+=this.printPtime(Q.ptime),ne+=this.printMaxPtime(Q.maxPtime),ne+=this.printDirection(Q.direction),ne+=this.printSSRCGroups(Q.ssrcGroups),ne+=this.printSSRC(Q.ssrcs),ne+=this.printRTCPMux(Q.rtcpMux),ne+=this.printRTCPMuxOnly(Q.rtcpMuxOnly),ne+=this.printRTCPRsize(Q.rtcpRsize),ne+=this.printMSId(Q.msids),ne+=this.printImageattr(Q.imageattr),ne+=this.printRid(Q.rids),ne+=this.printSimulcast(Q.simulcast),ne+=this.printSCTPPort(Q.sctpPort),ne+=this.printMaxMessageSize(Q.maxMessageSize),ne+=this.printUnrecognized(Q.unrecognized),ne}printCandidates(D){return D.map(Q=>"a=candidate:".concat(Q.foundation).concat(g).concat(Q.componentId).concat(g).concat(Q.transport).concat(g).concat(Q.priority).concat(g).concat(Q.connectionAddress).concat(g).concat(Q.port).concat(g,"typ").concat(g).concat(Q.type).concat(Q.relAddr?"".concat(g,"raddr").concat(g).concat(Q.relAddr):"").concat(Q.relPort?"".concat(g,"rport").concat(g).concat(Q.relPort):"").concat(Object.keys(Q.extension).map(ne=>"".concat(g).concat(ne).concat(g).concat(Q.extension[ne])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(Q=>"a=remote-candidates:".concat(Q.join(g)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const Q=D.payloads;let ne="";ne+=D.rtcpFeedbackWildcards.map(De=>this.printRTCPFeedback("*",De)).join("");for(const De of Q)ne+=this.printRtpMap(De.payloadType,De.rtpMap),ne+=this.printFmtp(De.payloadType,De.fmtp),ne+=De.rtcpFeedbacks.map(yt=>this.printRTCPFeedback(De.payloadType,yt)).join("");return ne}printFmtp(D,Q){if(!Q)return"";const ne=Object.keys(Q.parameters);return ne.length===1&&Q.parameters[ne[0]]===null?"a=fmtp:".concat(D).concat(g).concat(ne[0]).concat(this.eol):"a=fmtp:".concat(D).concat(g).concat(Object.keys(Q.parameters).map(De=>"".concat(De,"=").concat(Q.parameters[De])).join(";")).concat(this.eol)}printRtpMap(D,Q){return Q?"a=rtpmap:".concat(D).concat(g).concat(Q.encodingName,"/").concat(Q.clockRate).concat(Q.encodingParameters?"/".concat(Q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,Q){let ne="a=rtcp-fb:".concat(D).concat(g),De=Q;return De.type==="trr-int"?ne+="ttr-int".concat(g).concat(De.interval):(ne+="".concat(De.type),De.parameter&&(ne+="".concat(g).concat(De.parameter),De.additional&&(ne+="".concat(g).concat(De.additional)))),ne+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(Q=>Object.keys(Q.attributes).map(ne=>"a=ssrc:".concat(Q.ssrcId.toString(10)).concat(g).concat(ne).concat(Q.attributes[ne]?":".concat(Q.attributes[ne]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let Q="a=rtcp:".concat(D.port);return D.netType&&(Q+="".concat(g).concat(D.netType)),D.addressType&&(Q+="".concat(g).concat(D.addressType)),D.address&&(Q+="".concat(g).concat(D.address)),Q+this.eol}printMSId(D){return D.map(Q=>"a=msid:".concat(Q.id).concat(Q.appdata?"".concat(g).concat(Q.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(Q=>"a=imageattr:".concat(Q).concat(this.eol)).join("")}printRid(D){return D.map(Q=>{let ne="a=rid:".concat(Q.id).concat(g).concat(Q.direction);return Q.payloads&&(ne+="".concat(g,"pt=").concat(Q.payloads.join(","))),Q.params.length>0&&(ne+="".concat(g).concat(Q.params.map(De=>De.type==="depend"?"depend=".concat(De.rids.join(",")):"".concat(De.type,"=").concat(De.val)).join(";"))),ne+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(Q=>"a=ssrc-group:".concat(Q.semantic).concat(Q.ssrcIds.map(ne=>"".concat(g).concat(ne.toString(10))).join("")).concat(this.eol)).join("")}}function Le(Re){return new Fe().parse(Re)}function Xe(Re,D){return new Er().print(Re,D)}}},t={};function r(a){if(t[a])return t[a].exports;var c=t[a]={exports:{}};return e[a](c,c.exports,r),c.exports}return r.d=(a,c)=>{for(var l in c)r.o(c,l)&&!r.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:c[l]})},r.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),r.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},r(8)})();function pa(e){return D3.parse(e)}function vd(e,t){return D3.print(e,t)}var Yoe=Sa("Array","keys"),Xoe=bs,Joe=kn,Qoe=P,Zoe=Yoe,EN=Array.prototype,ese={DOMTokenList:!0,NodeList:!0},tse=function(e){var t=e.keys;return e===EN||Qoe(EN,e)&&t===EN.keys||Joe(ese,Xoe(e))?Zoe:t},Ya=u(tse);function Wr(e,t,r){return(t=function(a){var c=function(l,d){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var g=p.call(l,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function wt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x3(Object(r),!0).forEach(function(a){Wr(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x3(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const k3=new class extends kr{constructor(){super(...arguments),Wr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class rse{constructor(t){Wr(this,"logger",void 0),Wr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function SN(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function L3(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const To={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},FT=Date.now(),Wy=e=>{for(const t in To)if(Object.prototype.hasOwnProperty.call(To,t)&&To[t]===e)return t;return"DEFAULT"},N=new class{constructor(){Wr(this,"proxyServerURL",void 0),Wr(this,"logLevel",To.DEBUG),Wr(this,"uploadState","collecting"),Wr(this,"uploadLogWaitingList",[]),Wr(this,"uploadLogUploadingList",[]),Wr(this,"uploadErrorCount",0),Wr(this,"currentLogID",0),Wr(this,"url",void 0),Wr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[To.DEBUG].concat(t);this.log.apply(this,a)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[To.INFO].concat(t);this.log.apply(this,a)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[To.WARNING].concat(t);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[To.ERROR].concat(t);this.log.apply(this,a)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[To.DEBUG].concat(t);this.uploadLog.apply(this,a)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){sr("UPLOAD_LOG",!0)}disableLogUpload(){sr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new rse(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-FT<100)return void setTimeout(()=>{this.log(...t)},Date.now()-FT);const a=Math.max(0,Math.min(4,t[0]));if(t[0]=SN()+" Agora-SDK [".concat(Wy(a),"]:"),this.appendLogToWaitingList(a,...t),a<this.logLevel)return;const c=SN()+" %cAgora-SDK [".concat(Wy(a),"]:");let l=[];if(!$("USE_NEW_LOG"))switch(a){case To.DEBUG:l=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case To.INFO:l=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case To.WARNING:l=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case To.ERROR:l=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-FT<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-FT);const a=Math.max(0,Math.min(4,t[0]));t[0]=SN()+" Agora-SDK [".concat(Wy(a),"]:"),this.appendLogToWaitingList(a,...t)}appendLogToWaitingList(e){if(!$("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=L3()+" Agora-SDK [".concat(Wy(e),"]:"):r[0]=L3()+" Agora-SDK [".concat(Wy(e),"]:");let c="";r.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),c+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:bo,process_id:$("PROCESS_ID"),payload:JSON.stringify(e)};return Hs(async()=>{const r=await Ji.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=r,a}},()=>(this.uploadLogUploadingList=[],!1),r=>{const a={status:-1,message:r.message,errorRange:e.map(c=>c.log_item_id)};return r.response?(a.status=r.response.status,a.data=r.response.data,a.headers=r.response.headers):r.request&&(a.status=r.request.status),k3.reportLogUploadError(a),!0},{timeout:$("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var M3;function nse(e){return qn(e.reportId,"params.reportId",0,100,!1),qn(e.category,"params.category",0,100,!1),qn(e.event,"params.event",0,100,!1),qn(e.label,"params.label",0,100,!1),ur(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(M3={}).FREE="free",M3.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const ise={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let In=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Ir=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let ase=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,a){const c=a.value;if(typeof c=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);a.value=function(){for(var d,p=arguments.length,g=new Array(p),v=0;v<p;v++)g[v]=arguments[v];let y=g;if(e.argsMap)try{y=e.argsMap(this,...g)}catch(R){N.warning(R),y=[]}try{JSON.stringify(y)}catch{N.warning("arguments for method ".concat(l,".").concat(String(r)," not serializable for apiInvoke.")),y=[]}const b=(e.report||Ze).reportApiInvoke(this._sessionId||null,{id:this._clientId||((d=this.store)===null||d===void 0?void 0:d.clientId)||this._ID,name:"".concat(l,".").concat(String(r)),options:y,tag:Br.TRACER,reportResult:e.reportResult},e.throttleTime);try{const R=c.apply(this,g);return R instanceof Ge?R.then(O=>(b.onSuccess(e.reportResult&&O),O)).catch(O=>{throw b.onError(O),O}):(b.onSuccess(e.reportResult&&R),R)}catch(R){throw b.onError(R),R}}}return a}}const Ze=new class{constructor(){Wr(this,"baseInfoMap",new Map),Wr(this,"proxyServer",void 0),Wr(this,"eventUploadTimer",void 0),Wr(this,"setSessionIdTimer",void 0),Wr(this,"url",void 0),Wr(this,"sids",new Set),Wr(this,"backupUrl",void 0),Wr(this,"_appId",void 0),Wr(this,"_aid",0),Wr(this,"keyEventUploadPendingItems",[]),Wr(this,"normalEventUploadPendingItems",[]),Wr(this,"apiInvokeUploadPendingItems",[]),Wr(this,"apiInvokeCount",0),Wr(this,"apiInvokeLoggedCount",0),Wr(this,"ltsList",[]),Wr(this,"lastSendNormalEventTime",Date.now()),Wr(this,"customReportCounterTimer",void 0),Wr(this,"customReportCount",0),Wr(this,"extApiInvoke",async e=>{for(const t of e){const r=wt(wt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Br.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,a]=t;return r+a}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,l=!!$("SHOW_REPORT_INVOKER_LOG"),d=!!$("SHOW_REPORT_USER_INVOKER_LOG"),p=l||d&&t.id;p&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function v(O,V){if(p){let k="[apiInvoke-".concat(g,"]");if(t.id&&(k+="[".concat(t.id,"]")),t.name&&(k+="[".concat(t.name,"]"),t.name===rn.JOIN))return N.info("".concat(k," ").concat(O));N.info("".concat(k," ").concat(O),O==="start"?t.options:V||"")}}const y=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:a,options:t.options,states:t.states||null});v("start");let b=!1;Kn(t.timeout).then(()=>{b||(this.sendApiInvoke(wt(wt({},y()),{},{error:K.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const R=new _e(K.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:O=>{const V=()=>{if(b)throw R;return b=!0,this.sendApiInvoke(wt(wt({},y()),{},{success:!0},t.reportResult&&{result:O})),v("onSuccess"),O};return r?m3(V,t.name+"Success",r,()=>b=!0):V()},onError:O=>{const V=()=>{if(b)throw O;b=!0,this.sendApiInvoke(wt(wt({},y()),{},{success:!1,error:O})),v("onFailure",O.toString())};return r?m3(V,t.name+"Error",r,()=>b=!0):V()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),a=this.createBaseInfo(e,r);a.cname=t.cname;const c=Object.assign({},{willUploadConsoleLog:$("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:gN?"global":"oversea",areas:$("AREAS")&&$("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:d,channelMode:p,isABTestSuccess:g,lsid:v,clientRole:y}=t,b=Date.now(),R=wt(wt({},a),{},{eventType:In.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:vN,lts:b,elapse:b-r,extend:JSON.stringify(c),mode:t.mode,process:$("PROCESS_ID"),appType:$("APP_TYPE"),success:!0,version:bo,stringUid:l,channelProfile:d,channelMode:p,isABTestSuccess:g,lsid:v,clientType:Ve(O=window.navigator.userAgent).call(O,"AgoraWebView")?42:20,clientRole:y,serviceId:$("PROCESS_ID"),extensionID:$("PLUGIN_INFO").join(",")||""});var O;this.send({type:Ir.SESSION,data:R},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{role:t.role,eventType:In.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Ir.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{eventType:In.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Ir.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info;t.vid&&(a.vid=t.vid),a.uid=t.uid,a.cid=t.cid;const c=Date.now(),{firstSuccess:l,addr:d,isProxy:p}=t,g=c-r.startTime,v=wt(wt({},a),{},{eventType:In.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:g,eventElapse:c-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:mN(),isABTestSuccess:t.isABTestSuccess?1:0}),y=v.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),l)this.send({type:Ir.JOIN_GATEWAY,data:v},!0);else{let b;if(d)if(p){const O=d.match(/h=(\d{1,3}-){3}\d{1,3}/g),V=d.match(/p=[0-9]{1,6}/g);b={isSuccess:y,gatewayIp:O&&O.length?O[0].split("=")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split("=")[1]:"",isProxy:p?1:0}}else{const O=d.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),V=d.match(/(:|p=)[0-9]{1,6}/g);b={isSuccess:y,gatewayIp:O&&O.length?O[0].split("//")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split(/:|p=/g)[1]:"",isProxy:p?1:0}}else b={isSuccess:y,gatewayIp:"",port:"",isProxy:p?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const R=Object.assign({},v,b,{eventType:In.REJOIN_GATEWAY});this.send({type:Ir.RE_JOIN_GATEWAY,data:R},!0)}}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=Date.now(),c=wt(wt({},r.info),{},{lts:a,timeout:t,elapse:a-r.startTime});this.send({type:Ir.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{eventType:In.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Ir.PUBLISH,data:l},!0)}subscribe(e,t,r){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,l=Date.now(),d=wt(wt({},c),{},{eventType:In.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-a.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:Ir.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;const r=[...Ya(t=this.baseInfoMap).call(t)],a=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const l=c.info,d=Date.now(),p=wt(wt({},l),{},{eventType:In.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-c.startTime,status:e.status?1:2});this.send({type:Ir.WS_COMPRESSOR_INIT,data:p},!0)}firstRemoteVideoDecode(e,t,r,a){const c=this.baseInfoMap.get(e);if(!c)return;const l=c.info,d=Date.now(),p=wt(wt(wt({},l),a),{},{elapse:d-c.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max((a.firstFrame||d)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:r,data:p},!0)}firstRemoteFrame(e,t,r,a){const c=this.baseInfoMap.get(e);if(!c)return;const l=c.info,d=Date.now(),p=wt(wt(wt({},l),a),{},{elapse:d-c.startTime,eventType:t,lts:d});this.send({type:r,data:p},!0)}abTest(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt(wt({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-r.startTime,eventType:In.AB_TEST,lts:c});this.send({type:Ir.AB_TEST,data:l},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt(wt({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-r.startTime,eventType:In.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:Ir.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt(wt({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:In.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Ir.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,r,a){const c=this.baseInfoMap.get(e);if(!c)return;const l=c.info,d=Date.now(),p=wt(wt(wt({},l),a),{},{eventType:t,lts:d});this.send({type:r,data:p},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{eventType:In.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:Ir.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{eventType:In.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ir.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{eventType:In.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ir.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?N.debug("reportProxyServerurl: ".concat(e)):N.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt({},a),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Ir.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now();(function(l,d,p){const g=l[d];if(!g||typeof g!="string")return[l];l[d]="";const v=Wc(JSON.stringify(l));let y=0;const b=[];let R=0;for(let O=0;O<g.length;O++)R+=g.charCodeAt(O)<=127?1:3,R<=p-v||(b[b.length]=Ye(Ye({},l),{},{[d]:g.substring(y,O)}),y=O,R=g.charCodeAt(O)<=127?1:3);return y!==g.length-1&&(b[b.length]=Ye(Ye({},l),{},{[d]:g.substring(y)})),b})(wt(wt(wt({},a),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Ir.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt(wt({},a),t),{},{elapse:c-r.startTime,lts:c});this.send({type:Ir.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt(wt({},a),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:Ir.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,c=Date.now(),l=wt(wt(wt({},a),t),{},{elapse:c-r.startTime,lts:c});this.send({type:Ir.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>$("CUSTOM_REPORT_LIMIT"))throw new _e(K.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),a=t.map(c=>({type:Ir.USER_ANALYTICS,data:wt(wt({sid:e},c),{},{lts:r})}));try{$("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw N.error("send custom report message failed",c.toString()),new _e(K.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const t=$("NOT_REPORT_EVENT");if(e.tag&&Ve(t)&&Ve(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:a,uid:c,cid:l}=r.info;let d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _e){const{code:g,message:v}=e.error;d=g||v||e.error.toString()}else d=e.error.toString();const p={invokeId:e.invokeId,sid:e.sid,cname:a,cid:l,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Ir.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],a=[];for(;e.length;){const l=e.shift();r.length<20?r.push(l):a.push(l)}e.push(...a);for(const l of[...r]){var c;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),$h(c=this.ltsList).call(c,(d,p)=>d-p))}return t||(this.lastSendNormalEventTime=Date.now()),$("ENABLE_EVENT_REPORT")&&r.length&&($("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((l=>d=>{$("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$("NORMAL_EVENT_QUEUE_CAPACITY")),N.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){nn.networkState===Na.OFFLINE&&await Ge.race([nn.onlineWaiter,Kn(2*un.maxRetryTimeout)]);const t=c=>{let l=new Uint8Array;return c.forEach(d=>{const p=rN(JSON.stringify(d.data)),g=new ArrayBuffer(5),v=(b=>{let R=0;return Object.entries(Ir).forEach(O=>{let[V,k]=O;k===b.type&&(R=ase[V])}),R})(d),y=new DataView(g);y.setUint16(0,p.byteLength,!0),y.setUint8(2,255&v),y.setUint8(3,v>>>8&255),y.setUint8(4,v>>>16&255),l=o3(l,new Uint8Array(g)),l=o3(l,p)}),l},r="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await uN(a,{timeout:1e4,data:t(e),headers:wt(wt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(c===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(p=>{const g=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return g&&g.info.vid&&+g.info.vid||0})(e[0]),a=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:r,aid:a};nn.networkState===Na.OFFLINE&&await Ge.race([nn.onlineWaiter,Kn(2*un.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat($("EVENT_REPORT_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(l));for(let p=0;p<2;p+=1){p===1&&(d=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat($("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(l)));try{t?await Hoe(d,{timeout:1e4,data:c}):await uN(d,{timeout:1e4,data:c})}catch(g){if(p===1)throw g;continue}return}}createBaseInfo(e,t){const r=Object.assign({},ise);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),a=r[r.length-1];a&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:a,tag:Br.TRACER}).onSuccess()}};k3.on("REPORT_LOG_UPLOAD",e=>{e.networkState=nn.networkState,Ze.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Br.TRACER}).onSuccess("logUploadError")});class he extends _e{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Wr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,N)}throw(){super.throw(N)}}const zn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function qt(){return zn}function U3(){return"setSinkId"in HTMLAudioElement.prototype&&(!$("RESTRICTION_SET_PLAYBACK_DEVICE")||(Fl()||$B())&&!ZI())}function j3(){return!zn.supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&Bl()}let $n=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Lm(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Kt(e,t,r,a,c){return{width:e,height:t,frameRate:r,bitrateMin:a,bitrateMax:c}}function rs(e,t,r,a,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:a,bitrateMax:c}}function bN(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const ose={"90p":Kt(160,90),"90p_1":Kt(160,90),"120p":Kt(160,120,15,30,65),"120p_1":Kt(160,120,15,30,65),"120p_3":Kt(120,120,15,30,50),"120p_4":Kt(212,120),"180p":Kt(320,180,15,30,140),"180p_1":Kt(320,180,15,30,140),"180p_3":Kt(180,180,15,30,100),"180p_4":Kt(240,180,15,30,120),"240p":Kt(320,240,15,40,200),"240p_1":Kt(320,240,15,40,200),"240p_3":Kt(240,240,15,40,140),"240p_4":Kt(424,240,15,40,220),"360p":Kt(640,360,15,80,400),"360p_1":Kt(640,360,15,80,400),"360p_3":Kt(360,360,15,80,260),"360p_4":Kt(640,360,30,80,600),"360p_6":Kt(360,360,30,80,400),"360p_7":Kt(480,360,15,80,320),"360p_8":Kt(480,360,30,80,490),"360p_9":Kt(640,360,15,80,800),"360p_10":Kt(640,360,24,80,800),"360p_11":Kt(640,360,24,80,1e3),"480p":Kt(640,480,15,100,500),"480p_1":Kt(640,480,15,100,500),"480p_2":Kt(640,480,30,100,1e3),"480p_3":Kt(480,480,15,100,400),"480p_4":Kt(640,480,30,100,750),"480p_6":Kt(480,480,30,100,600),"480p_8":Kt(848,480,15,100,610),"480p_9":Kt(848,480,30,100,930),"480p_10":Kt(640,480,10,100,400),"720p":Kt(1280,720,15,120,1130),"720p_auto":Kt(1280,720,30,900,3e3),"720p_1":Kt(1280,720,15,120,1130),"720p_2":Kt(1280,720,30,120,2e3),"720p_3":Kt(1280,720,30,120,1710),"720p_5":Kt(960,720,15,120,910),"720p_6":Kt(960,720,30,120,1380),"1080p":Kt(1920,1080,15,120,2080),"1080p_1":Kt(1920,1080,15,120,2080),"1080p_2":Kt(1920,1080,30,120,3e3),"1080p_3":Kt(1920,1080,30,120,3150),"1080p_5":Kt(1920,1080,60,120,4780),"1440p":Kt(2560,1440,30,120,4850),"1440p_1":Kt(2560,1440,30,120,4850),"1440p_2":Kt(2560,1440,60,120,7350),"4k":Kt(3840,2160,30,120,8910),"4k_1":Kt(3840,2160,30,120,8910),"4k_3":Kt(3840,2160,60,120,13500)},sse={"480p":rs(640,480,5),"480p_1":rs(640,480,5),"480p_2":rs(640,480,30),"480p_3":rs(640,480,15),"720p":rs(1280,720,5),"720p_auto":Kt(1280,720,30,900,3e3),"720p_1":rs(1280,720,5),"720p_2":rs(1280,720,30),"720p_3":rs(1280,720,15),"1080p":rs(1920,1080,5),"1080p_1":rs(1920,1080,5),"1080p_2":rs(1920,1080,30),"1080p_3":rs(1920,1080,15)},cse={"1SL1TL":bN(1,1),"3SL3TL":bN(3,3),"2SL3TL":bN(2,3)};function ns(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},ose[e]):e}function TN(e){return typeof e=="string"?Object.assign({},sse[e]):e}function BT(e){return typeof e=="string"?Object.assign({},cse[e]):e}const lse={speech_low_quality:Lm(16e3,!1),speech_standard:Lm(32e3,!1,18),music_standard:Lm(48e3,!1),standard_stereo:Lm(48e3,!0,56),high_quality:Lm(48e3,!1,128),high_quality_stereo:Lm(48e3,!0,192)};function WT(e){return typeof e=="string"?Object.assign({},lse[e]):e}const Mm=[];function V3(e){return Sn(e,"mediaSource",["screen","window","application"]),!0}let Je=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),dr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Um=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),use=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),dse=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),sp=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),jm=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Vm=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Fm=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Xa=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const wN={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},RN={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},F3={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},hse={uplinkNetworkQuality:0,downlinkNetworkQuality:0},B3={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ji=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ja=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Gy=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),cp=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),gi=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Hc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const CN={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let GT=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Vt(e,t,r,a,c){var l,d,p={};return Object.keys(a).forEach(function(g){p[g]=a[g]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=sa(l=gh(d=r.slice()).call(d)).call(l,function(g,v){return v(e,t,g)||g},p),c&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(c):void 0,p.initializer=void 0),p.initializer===void 0?(Object.defineProperty(e,t,p),null):p}function ce(e,t,r){return(t=function(a){var c=function(l,d){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var g=p.call(l,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Nr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W3(Object(r),!0).forEach(function(a){ce(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W3(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class G3 extends kr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(sp.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),ce(this,"trackMediaType",void 0),ce(this,"_ID",void 0),ce(this,"_rtpTransceiver",void 0),ce(this,"_lowRtpTransceiver",void 0),ce(this,"_hints",[]),ce(this,"_isClosed",!1),ce(this,"_originMediaStreamTrack",void 0),ce(this,"mediaStreamTrack",void 0),ce(this,"_external",{}),this._ID=r||gr(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(a){Ve(Mm).call(Mm,a)||Mm.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||gd(()=>{var r;Ze.reportApiInvoke(null,{name:rn.GET_MEDIA_STREAM_TRACK,options:[],tag:Br.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Um.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const r=Mm.indexOf(t);r!==-1&&Mm.splice(r,1)}(this),this.emit(jm.CLOSED),this.removeAllListeners(sp.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===Um.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(sp.TRANSCEIVER_UPDATED,t,r)}}class Bm extends G3{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),ce(this,"_enabled",!0),ce(this,"_muted",!1),ce(this,"_isExternalTrack",!1),ce(this,"_isClosed",!1),ce(this,"_enabledMutex",void 0),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ci("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,N.debug("[".concat(this.getTrackId(),"] close")),this.emit(Je.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pr(this,Je.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jm.TRACK_ENDED)}stateCheck(t,r){if(N.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Wl(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new _e(K.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",N);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new _e(K.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",N)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ge.resolve([])}}const H3=window.AudioContext||window.webkitAudioContext;let Qa=null;const cr=new class extends kr{constructor(){super(...arguments),ce(this,"prevState",void 0),ce(this,"curState",void 0),ce(this,"currentTime",void 0),ce(this,"currentTimeStuckAt",void 0),ce(this,"interruptDetectorTrack",void 0),ce(this,"onLocalAudioTrackMute",()=>{N.info("ios15-interruption-start"),this.emit($n.IOS_15_16_INTERRUPTION_START)}),ce(this,"onLocalAudioTrackUnmute",async()=>{N.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?N.info("ios15-interruption-end-canceled"):(Qa&&await Qa.suspend(),this.emit($n.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){N.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){N.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Wm(){if(!Qa){if(function(){if(!H3)return void N.error("your browser is not support web audio");N.info("create audio context");const e=Nr({},$("WEBAUDIO_INIT_OPTIONS"));N.debug("audio context init option:",JSON.stringify(e)),Qa=new H3(e),cr.curState=Qa.state,Qa.onstatechange=()=>{cr.prevState=cr.curState,cr.curState=Qa?Qa.state:void 0;const{prevState:t,curState:r}=cr,a=r==="running",c=r==="interrupted",l=t==="running",d=t==="suspended",p=t==="interrupted",g=Ht().osVersion;(Ui()||es())&&l&&c&&(N.info("ios".concat(g,"-interruption-start")),cr.emit($n.IOS_INTERRUPTION_START)),(Ui()||es())&&(d||p)&&a&&(N.info("ios".concat(g,"-interruption-end")),cr.emit($n.IOS_INTERRUPTION_END)),t!==r&&cr.emit($n.STATE_CHANGE,r,t)},setInterval(()=>{var t;const r=(t=Qa)===null||t===void 0?void 0:t.currentTime;cr.currentTime!==r?(cr.currentTimeStuckAt&&(N.debug("AudioContext current time resume at ".concat(r)),cr.currentTimeStuckAt=void 0),cr.currentTime=r):(r!==cr.currentTimeStuckAt&&(Ze.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Br.TRACER}).onSuccess(),N.warning("AudioContext current time stuck at ".concat(r))),cr.currentTimeStuckAt=r)},5e3),async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,l=!1,d=!1;function p(k){t.state==="running"?g(!1):Ui()||es()?t.state==="suspended"&&(g(!0),k&&t.resume().then(v,v)):t.state!=="closed"&&(g(!0),k&&t.resume().then(v,v))}function g(k){if(c!==k){c=k;for(let L=0,H=r;L<H.length;L+=1){const q=H[L];k?window.addEventListener(q,y,{capture:!0,passive:!0}):window.removeEventListener(q,y,{capture:!0,passive:!0})}}}function v(){p(!1)}function y(){p(!0)}function b(k){if(!d)if(a.paused)if(k){let L;R(!1),d=!0;try{L=a.play(),L?L.then(O,O):(a.addEventListener("playing",O),a.addEventListener("abort",O),a.addEventListener("error",O))}catch{O()}}else R(!0);else R(!1)}function R(k){if(l!==k){l=k;for(let L=0,H=r;L<H.length;L++){const q=H[L];k?window.addEventListener(q,V,{capture:!0,passive:!0}):window.removeEventListener(q,V,{capture:!0,passive:!0})}}}function O(){a.removeEventListener("playing",O),a.removeEventListener("abort",O),a.removeEventListener("error",O),d=!1,b(!1)}function V(){b(!0)}if(Ui()){const k=t.createMediaStreamDestination(),L=document.createElement("div");L.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=L.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=k.stream,b(!0)}cr.on($n.STATE_CHANGE,function(){p(!0)}),p(!1)}(Qa)}(),!Qa)throw new _e(K.NOT_SUPPORTED,"can not create audio context");return Qa}return Qa}function lp(e){if(function(){if(AN!==null)return AN;const a=Wm(),c=a.createBufferSource(),l=a.createGain(),d=a.createGain();c.connect(l),c.connect(d),c.disconnect(l);let p=!1;try{c.disconnect(l)}catch{p=!0}return c.disconnect(),AN=p,p}())return;const t=e.connect,r=e.disconnect;e.connect=(a,c,l)=>{var d;return e._inputNodes||(e._inputNodes=[]),Ve(d=e._inputNodes).call(d,a)||(a instanceof AudioNode?(e._inputNodes.push(a),t.call(e,a,c,l)):t.call(e,a,c)),e},e.disconnect=(a,c,l)=>{r.call(e),a?DT(e._inputNodes,a):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let AN=null;function ON(e,t){let r=!1;const a=1/t;if($("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{r?window.clearInterval(c):e(performance.now()/1e3)},1e3*a)}else{const c=Wm();let l=c.createGain();l.gain.value=0,l.connect(c.destination);const d=()=>{if(r)return void(l=null);const p=c.createOscillator();p.onended=d,p.connect(l),p.start(0),p.stop(c.currentTime+a),e(c.currentTime)};d()}return()=>{r=!0}}class q3{constructor(){ce(this,"context",void 0),ce(this,"analyserNode",void 0),ce(this,"sourceNode",void 0),this.context=Wm(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ui()||es()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<t.length;++c)t[c]=a[c]/128-1}const r=sa(t).call(t,(a,c)=>a+c*c,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{N.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class K3 extends kr{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ce(this,"outputNode",void 0),ce(this,"outputTrack",void 0),ce(this,"isPlayed",!1),ce(this,"sourceNode",void 0),ce(this,"context",void 0),ce(this,"audioBufferNode",void 0),ce(this,"destNode",void 0),ce(this,"audioOutputLevel",0),ce(this,"volumeLevelAnalyser",void 0),ce(this,"_processedNode",void 0),ce(this,"playNode",void 0),ce(this,"isDestroyed",!1),ce(this,"onNoAudioInput",void 0),ce(this,"isNoAudioInput",!1),ce(this,"_noAudioInputCount",0),this.context=Wm(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),lp(this.outputNode),this.volumeLevelAnalyser=new q3}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(Xa.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const l=a.outputBuffer.getChannelData(c);for(let d=0;d<l.length;d+=1)l[d]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!qt().webAudioMediaStreamDest)throw new _e(K.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&xT(()=>{cr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ui()||es()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let a;r.getFloatTimeDomainData?(a=new Float32Array(r.fftSize),r.getFloatTimeDomainData(a)):(a=new Uint8Array(r.fftSize),r.getByteTimeDomainData(a));let c=!1;for(let l=0;l<a.length;l++)a[l]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Kn(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class z3 extends K3{get isFreeze(){return!1}constructor(t,r,a){var c;if(super(),ce(this,"sourceNode",void 0),ce(this,"track",void 0),ce(this,"clonedTrack",void 0),ce(this,"audioElement",void 0),ce(this,"isCurrentTrackCloned",!1),ce(this,"isRemoteTrack",!1),ce(this,"originVolumeLevelAnalyser",void 0),ce(this,"rebuildWebAudio",async()=>{if(N.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void N.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>N.info("resume success")),N.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),lp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),lp(this.outputNode),this.emit(Xa.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new _e(K.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(l),lp(this.sourceNode),a){const p=a.clone();p.enabled=!0,this.clonedTrack=p,N.debug("create an unmuted track ".concat(p.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([p]));lp(g),this.originVolumeLevelAnalyser=new q3,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const d=Ht();r&&d.os===On.IOS&&Number((c=d.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(cr.on($n.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),lp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Xa.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),cr.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),N.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));lp(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function $3(e,t,r){const a=(l,d)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||d:l:d,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:a(t.height,1080),maxWidth:a(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function pse(e,t){const r=await Y3(e.mediaSource),{sourceId:a,audio:c}=await function(l){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ge((p,g)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const b=document.createElement("div");b.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",b.setAttribute("style","height: 12%;");const R=document.createElement("div");R.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const O=document.createElement("div");O.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const V=document.createElement("button");V.innerHTML="cancel",V.setAttribute("style","width: 85px;"),V.onclick=()=>{document.body.removeChild(H);const q=new Error("NotAllowedError");q.name="NotAllowedError",g(q)};let k=d;const L=document.createElement("div");if(d){const q=document.createElement("input");q.setAttribute("type","checkbox");const te=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),te.innerText="Share audio",q.checked=k,q.onchange=()=>{k=q.checked},L.appendChild(q),L.appendChild(te)}O.appendChild(L),O.appendChild(V),y.appendChild(b),y.appendChild(R),y.appendChild(O);const H=document.createElement("div");H.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),H.appendChild(v),H.appendChild(y),document.body.appendChild(H),l.map(q=>{if(q.id){const te=document.createElement("div");te.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let oe=q.thumbnail;try{const{width:se}=oe.getSize();se>1920&&(oe=oe.resize({width:1920}))}catch(se){throw se&&se.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),se}te.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+oe.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(se){return"&#"+se.charCodeAt(0)+";"})+"</span>",te.onclick=()=>{document.body.removeChild(H),p({sourceId:q.id,audio:k})},R.appendChild(te)}})})}(r,t);return await $3(a,e,c)}async function Y3(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=s3();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new _e(K.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{a=null}a&&a.then||(a=new Ge((l,d)=>{r.desktopCapturer.getSources({types:t},(p,g)=>{p?d(p):l(g)})}));try{return await a}catch(l){throw new _e(K.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const IN=new ci("safari");let X3=!1,J3=!1;async function Za(e,t){let r=0,a=null;for(;r<2;)try{a=await fse(e,t,r>0);break}catch(c){if(c instanceof _e)throw N.error("[".concat(t,"] ").concat(c.toString())),c;const l=HT(c.name||c.code||c,c.message);if(l.code===K.MEDIA_OPTION_INVALID){N.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Kn(500);continue}throw N.error("[".concat(t,"] ").concat(l.toString())),l}if(!a)throw new _e(K.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function fse(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _e(K.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const a=qt(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return N.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(s3())e.screen.sourceId?Gm(c,await $3(e.screen.sourceId,e.screen,!!e.screenAudio)):Gm(c,await pse(e.screen,!!e.screenAudio));else if(Fl()&&e.screen.extensionId&&e.screen.mandatory){if(!a.getStreamFromExtension)throw new _e(K.NOT_SUPPORTED,"This browser does not support screen sharing");N.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const R=await(d=e.screen.extensionId,p=t,new Ge((O,V)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},k=>{if(!k||!k.streamId)return N.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),k),void V(new _e(K.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));O(k.streamId)})}catch(k){N.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),k.toString()),V(new _e(K.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=R,Gm(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(a.getDisplayMedia){var l;e.screen.mediaSource&&V3(e.screen.mediaSource);const R={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:O,surfaceSwitching:V,systemAudio:k,preferCurrentTab:L}=e.screen,H={selfBrowserSurface:O,surfaceSwitching:V,systemAudio:k,preferCurrentTab:L};!O&&delete H.selfBrowserSurface,!V&&delete H.surfaceSwitching,!k&&delete H.systemAudio,!L&&delete H.preferCurrentTab,N.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:R,audio:e.screenAudio,controls:H})),Gm(c,await navigator.mediaDevices.getDisplayMedia(Nr({video:R,audio:e.screenAudio},H)))}else{if(!Vr())throw N.error("[".concat(t,"] This browser does not support screenSharing")),new _e(K.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&V3(e.screen.mediaSource);const R={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};N.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(R))),Gm(c,await navigator.mediaDevices.getUserMedia(R))}}var d,p;if(!e.video&&!e.audio)return c;let g={video:e.video,audio:e.audio},v=$("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),g=aN(g,v)}catch{}N.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(g)),Ht();let y,b=null;(Qn()||Ui()||NT())&&(b=await IN.lock());try{y=await navigator.mediaDevices.getUserMedia(g)}catch(R){throw b&&b(),R}return g.audio&&(X3=!0),g.video&&(J3=!0),Gm(c,y),b&&b(),c}function HT(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _e(K.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new _e(K.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new _e(K.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new _e(K.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _e(K.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new _e(K.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return N.error("getUserMedia unexpected error",e),new _e(K.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Gm(e,t){const r=e.getVideoTracks()[0],a=e.getAudioTracks()[0],c=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(a&&e.removeTrack(a),e.addTrack(l)),c&&(r&&e.removeTrack(r),e.addTrack(c))}const eo=new class extends kr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(cp.STATE_CHANGE,e),this._state=e)}constructor(){super(),ce(this,"_state",Gy.IDLE),ce(this,"isAccessMicrophonePermission",!1),ce(this,"isAccessCameraPermission",!1),ce(this,"lastAccessMicrophonePermission",!1),ce(this,"lastAccessCameraPermission",!1),ce(this,"checkdeviceMatched",!1),ce(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{($("ENUMERATE_DEVICES_INTERVAL")||(PT()||IT()===On.HARMONY_OS)&&Bl())&&this.updateDevicesInfo()},$("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>N.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new _e(K.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let l=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;c.audio&&(l=!1),c.video&&(d=!1);let p=null,g=null,v=null;if(!r&&(l||d)){if(IN.isLocked&&(N.debug("[device manager] wait GUM lock"),(await IN.lock())(),N.debug("[device manager] GUM unlock")),X3&&(l=!1,this.isAccessMicrophonePermission=!0),J3&&(d=!1,this.isAccessCameraPermission=!0),N.debug("[device manager] check media device permissions",e,t,l,d),l&&d){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(y){const b=HT(y.name||y.code||y,y.message);if(b.code===K.PERMISSION_DENIED)throw b;N.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(y){const b=HT(y.name||y.code||y,y.message);if(b.code===K.PERMISSION_DENIED)throw b;N.warning("getUserMedia failed in getDevices",b)}this.isAccessMicrophonePermission=!0}else if(d){try{g=await navigator.mediaDevices.getUserMedia({video:t})}catch(y){const b=HT(y.name||y.code||y,y.message);if(b.code===K.PERMISSION_DENIED)throw b;N.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0}N.debug("[device manager] mic permission",e,"cam permission",t)}try{const y=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(b=>b.stop()),g&&g.getTracks().forEach(b=>b.stop()),v&&v.getTracks().forEach(b=>b.stop()),p=null,g=null,v=null,y}catch(y){return p&&p.getTracks().forEach(b=>b.stop()),g&&g.getTracks().forEach(b=>b.stop()),v&&v.getTracks().forEach(b=>b.stop()),p=null,g=null,v=null,new _e(K.ENUMERATE_DEVICES_FAILED,y.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new _e(K.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Gy.INITING;try{await this.updateDevicesInfo(),this.state=Gy.INITEND}catch(e){throw N.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Gy.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new _e(K.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),l=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");c&&l?l.groupId===c.groupId?N.debug("[device-check] default input ".concat(c.label," and output ").concat(l.label," is the same group")):N.debug("[device-check] default input ".concat(c.label," and output ").concat(l.label," is not the same group")):N.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const l=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),d),r.push(d)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((c,l)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))}),this.state!==Gy.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(cp.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(cp.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(cp.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(c=>c.kind==="audioinput"),r=e.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of t)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of r)if(c.label&&c.deviceId){a.video=!0;break}return a}};let NN=!1;const to=new class extends kr{constructor(){super(...arguments),ce(this,"onAutoplayFailed",void 0),ce(this,"onAudioAutoplayFailed",void 0)}};function Q3(){if(Ht(),!NN){const e=t=>{t.preventDefault(),NN=!1,ky()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};NN=!0,ky()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),N.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),to.onAutoplayFailed?to.onAutoplayFailed():to.onAudioAutoplayFailed?N.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):N.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),to.emit("autoplay-failed")}}function Z3(e,t,r,a){if(!e)return;const c=Ze.getBaseInfoBySessionId(e);if(!c)return;const l=c.info,d=Date.now(),p=Nr(Nr({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:d,elapse:d-c.startTime,cbRegistered:to.onAutoplayFailed||to.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:a,extend:void 0});Ze.send({type:Ir.AUTOPLAY_FAILED,data:p},!0)}const mse=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qi=new class{constructor(){ce(this,"onAutoplayFailed",void 0),ce(this,"elementMap",new Map),ce(this,"elementStateMap",new Map),ce(this,"elementsNeedToResume",[]),ce(this,"sinkIdMap",new Map),ce(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,a]=t;const c=this.elementStateMap.get(r),l=a.srcObject.getAudioTracks()[0],d=l&&l.readyState;if(N.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return a.pause(),void a.play();if(cr.curState==="running")return Im()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e;const a=r.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(N.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),cr.on($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cr.on($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),cr.on($n.STATE_CHANGE,()=>{Ui()&&cr.prevState==="suspended"&&cr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(a){throw new _e(K.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(e,t,r,a){if(this.elementMap.has(t))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,gi.INIT),this.setVolume(t,r);const l=this.sinkIdMap.get(t);if(l)try{c.setSinkId(l).catch(p=>{N.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){N.warning("[".concat(t,"] set sink id failed"),p.toString())}const d=c.play();d&&d.then&&d.catch(p=>{a&&Z3(a,"audio",p.message,t),N.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(N.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),xT(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Q3()}))})}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){mse.forEach(r=>{t.addEventListener(r,a=>{const c=this.elementStateMap.get(e),l=a.type==="pause"?"paused":a.type;if(N.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(l)),a.type==="error"){const d=t==null?void 0:t.error;d&&N.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{N.debug("Auto resume audio element success")}).catch(r=>{N.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new Ge(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{ky()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Kr(){return function(e,t,r){const a=r.value;return typeof a=="function"&&(r.value=function(){this._isClosed&&new _e(K.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",N);for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];const p=a.apply(this,l);return p instanceof Ge?new Ge((g,v)=>{p.then(g).catch(v)}):p}),r}}class e5 extends kr{constructor(t){super(),ce(this,"name","VideoProcessorDestination"),ce(this,"ID","0"),ce(this,"_source",void 0),ce(this,"videoContext",void 0),ce(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _e(K.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _e(K.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ji.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ji.ON_TRACK,void 0)}}class t5 extends kr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"usageRegistry",[]),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await ei(this,Ja.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var a;return N.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),pr(this,Ja.REQUEST_UPDATE_CONSTRAINTS,Array.from(Aa(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return N.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),pr(this,Ja.REQUEST_UPDATE_CONSTRAINTS,Array.from(Aa(r=this.constraintsMap).call(r)))}registerStats(t,r,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:a})}unregisterStats(t,r){const a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:a,type:c,cb:l}of this.statsRegistry)try{const d=l();t.push({processorID:r,processorName:a,type:c,stats:d})}catch(d){N.error(new _e(K.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,r){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let a=r();a instanceof Ge&&(a=await a),t.push(Nr(Nr({},a),{},{direction:this.direction}))}catch(a){N.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class r5 extends kr{constructor(t){super(),ce(this,"name","AudioProcessorDestination"),ce(this,"ID","0"),ce(this,"inputTrack",void 0),ce(this,"inputNode",void 0),ce(this,"audioProcessorContext",void 0),ce(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _e(K.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _e(K.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ji.ON_TRACK,void 0),this.emit(ji.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ji.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ji.ON_NODE,this.inputNode))}}class n5 extends kr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,a){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"audioContext",void 0),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"usageRegistry",[]),ce(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=a}async getConstraints(){return ei(this,Ja.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var a;return N.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),pr(this,Ja.REQUEST_UPDATE_CONSTRAINTS,Array.from(Aa(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),pr(this,Ja.REQUEST_UPDATE_CONSTRAINTS,Array.from(Aa(r=this.constraintsMap).call(r)))}registerStats(t,r,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:a})}unregisterStats(t,r){const a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:a,type:c,cb:l}of this.statsRegistry)try{const d=l();t.push({processorID:r,processorName:a,type:c,stats:d})}catch(d){N.error(new _e(K.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,r){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let a=r();a instanceof Ge&&(a=await a),t.push(Nr(Nr({},a),{},{direction:this.direction}))}catch(a){N.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class PN extends kr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ce(this,"context",void 0),ce(this,"processSourceNode",void 0),ce(this,"outputTrack",void 0),ce(this,"processedNode",void 0),ce(this,"clonedTrack",void 0),ce(this,"outputNode",void 0),this.outputNode=new gse}setVolume(){}createOutputTrack(){throw new _e(K.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class gse{disconnect(){}connect(){}}function i5(e){return new Ge((t,r)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const l=Ui()?"canplay":"playing";c.addEventListener(l,()=>{const d=c.videoWidth,p=c.videoHeight;!d&&Vr()||(a=!0,c.srcObject=null,c.remove(),t([d,p]))}),c.srcObject=new MediaStream([e]),c.play().catch(kT),setTimeout(()=>{a||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function qT(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=ns(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!r3()&&r.frameRate&&(t.frameRate=r.frameRate),$B()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Vr()&&(t.frameRate={ideal:30,max:30}),t}function a5(e){const t={};return r3()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Fl()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function o5(e){const t=a5(e);if(e.encoderConfig){const r=WT(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),PT()&&(t.sampleRate=void 0),t}const _se=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:a,height:c}=e.getMediaStreamTrackSettings();let{frameRate:l=r,width:d=a,height:p=c}=t;if(!l||!d||!p)return;d=oN(d),p=oN(p),l=oN(l);const{max:g,min:v}=function(O,V,k){const L=200*Math.pow(k/15,.6)*Math.pow(O*V/640/360,.75);return{min:Math.floor(L),max:Math.floor(4*L)}}(d,p,l),{bitrateMax:y,bitrateMin:b}=t||{};y||N.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(p,", fps: ").concat(l,"] => [brMax: ").concat(y,", brMin: ").concat(b,"]"));const{maxFramerate:R}=$("ENCODER_CONFIG_LIMIT");return R&&typeof R=="number"&&(l=Math.min(l,R)),{frameRate:l,bitrateMax:y||g,bitrateMin:b||v,scaleResolutionDownBy:1,scale:0}},s5=async(e,t,r)=>await(async(a,c,l)=>{const d=function(v){const y=[];for(let b=0;b<v.length;b+=2)y.push(parseInt(v.slice(b,b+2),16));return Uint8Array.from(y)}(v3(""+c+l)).slice(0,16),p=d.slice(0,12),g=await window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},g,a))})(e.buffer,t,r),DN=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ge((r,a)=>{t.toBlob(async c=>{if(t.remove(),c){const l=await c5(c);r({buffer:l,width:t.width,height:t.height})}else a(new _e(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},c5=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var l5,u5,d5,h5,p5,f5,m5,g5,_5,v5,y5,E5,S5,b5,T5,w5,R5,C5,Mr,A5,O5,I5,N5,P5,D5,qc,x5,k5,L5,M5,U5,j5,V5,F5,B5,W5,G5,H5,q5,ri;let Gr=(l5=ut({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),u5=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),d5=Kr(),h5=Dm("LocalAudioTrack","_enabledMutex"),p5=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),f5=Kr(),m5=Dm("LocalAudioTrack","_enabledMutex"),g5=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),_5=Kr(),v5=Kr(),y5=Kr(),E5=ut({argsMap:e=>[e.getTrackId()]}),S5=Kr(),b5=ut({argsMap:e=>[e.getTrackId()]}),T5=Kr(),w5=ut({argsMap:e=>[e.getTrackId()]}),R5=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),C5=ut({argsMap:e=>[e.getTrackId()]}),Vt((Mr=class extends Bm{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Qi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,a){super(e,r),ce(this,"trackMediaType",Fm.AUDIO),ce(this,"_encoderConfig",void 0),ce(this,"_trackSource",void 0),ce(this,"metadata",[]),ce(this,"_enabled",!0),ce(this,"_volume",100),ce(this,"_useAudioElement",!0),ce(this,"_bypassWebAudio",!1),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_processorDestination",void 0),ce(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!a,this._trackSource=new PN,$("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Qn()&&!Qa?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){ur(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Qi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void N.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,pr(this,Je.NEED_REPLACE_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{N.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!U3())throw new _e(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await pr(this,Je.NEED_ENABLE_TRACK,this),N.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(a){throw r||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await pr(this,Je.NEED_DISABLE_TRACK,this)}catch(a){throw r||(this._enabled=!0),N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await pr(this,Je.NEED_MUTE_TRACK,this):await pr(this,Je.NEED_UNMUTE_TRACK,this))}getStats(){return gd(()=>{N.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),za(this,Je.GET_STATS)||Nr({},wN)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Xa.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Xa.ON_AUDIO_BUFFER),this._source.on(Xa.ON_AUDIO_BUFFER,r=>e(r))}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pr(this,Je.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ge.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _e(K.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ji.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await pr(this,Je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pr(this,Je.NEED_REPLACE_TRACK,this))}),e.on(ji.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ji.ON_TRACK),e.removeAllListeners(ji.ON_NODE)}bindProcessorContextEvents(e){e.on(Ja.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ja.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof PN&&(this._trackSource=new z3(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new n5(this._source.context,this.getTrackId(),"local"),t=new r5(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Xa.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Qi.stop(this.getTrackId()),this._source.play()),pr(this,Je.NEED_REPLACE_MIXING_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{N.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[l5],Object.getOwnPropertyDescriptor(Mr.prototype,"setVolume"),Mr.prototype),Vt(Mr.prototype,"setPlaybackDevice",[u5,d5],Object.getOwnPropertyDescriptor(Mr.prototype,"setPlaybackDevice"),Mr.prototype),Vt(Mr.prototype,"setEnabled",[h5,p5,f5],Object.getOwnPropertyDescriptor(Mr.prototype,"setEnabled"),Mr.prototype),Vt(Mr.prototype,"setMuted",[m5,g5,_5],Object.getOwnPropertyDescriptor(Mr.prototype,"setMuted"),Mr.prototype),Vt(Mr.prototype,"getStats",[v5],Object.getOwnPropertyDescriptor(Mr.prototype,"getStats"),Mr.prototype),Vt(Mr.prototype,"setAudioFrameCallback",[y5],Object.getOwnPropertyDescriptor(Mr.prototype,"setAudioFrameCallback"),Mr.prototype),Vt(Mr.prototype,"play",[E5,S5],Object.getOwnPropertyDescriptor(Mr.prototype,"play"),Mr.prototype),Vt(Mr.prototype,"stop",[b5,T5],Object.getOwnPropertyDescriptor(Mr.prototype,"stop"),Mr.prototype),Vt(Mr.prototype,"close",[w5],Object.getOwnPropertyDescriptor(Mr.prototype,"close"),Mr.prototype),Vt(Mr.prototype,"pipe",[R5],Object.getOwnPropertyDescriptor(Mr.prototype,"pipe"),Mr.prototype),Vt(Mr.prototype,"unpipe",[C5],Object.getOwnPropertyDescriptor(Mr.prototype,"unpipe"),Mr.prototype),Mr),Hy=(A5=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),O5=Kr(),I5=Dm("MicrophoneAudioTrack","_enabledMutex"),N5=ut({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),P5=Kr(),D5=ut({argsMap:e=>[e.getTrackId()]}),Vt((qc=class extends Gr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,a){super(e,t.encoderConfig?WT(t.encoderConfig):{},a,$("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ce(this,"_config",void 0),ce(this,"_deviceName","default"),ce(this,"_constraints",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Im()||QI())&&cr.bindInterruptDetectorTrack(this)}async setDevice(e){if(N.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await eo.getDeviceById(e),r={};r.audio=Nr({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let a=null;try{a=await Za(r,this.getTrackId())}catch(c){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await Za({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await eo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}N.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return N.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),$("AUTO_RESET_AUDIO_ROUTE")&&(Ui()||es())){const d=navigator.audioSession;d&&(e||(d.type="playback"),d.type="auto")}if(!e){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),r||(this._enabled=!1);try{await pr(this,Je.NEED_DISABLE_TRACK,this)}catch(d){throw N.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const c=Nr({},this._constraints),l=eo.searchDeviceIdByName(this._deviceName);l&&!c.deviceId&&(c.deviceId=l);try{r||(this._enabled=!0);const d=await Za({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await pr(this,Je.NEED_ENABLE_TRACK,this)}catch(d){throw r||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}N.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Im()||QI())&&cr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ui()||es())&&this._enabled&&!this._isClosed&&cr.duringInterruption){const e=async()=>{cr.off($n.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};cr.on($n.IOS_INTERRUPTION_END,e)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jm.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=eo.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const a=await Za({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ja.REQUEST_UPDATE_CONSTRAINTS,async(t,r,a)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){a(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ja.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[A5,O5],Object.getOwnPropertyDescriptor(qc.prototype,"setDevice"),qc.prototype),Vt(qc.prototype,"setEnabled",[I5,N5,P5],Object.getOwnPropertyDescriptor(qc.prototype,"setEnabled"),qc.prototype),Vt(qc.prototype,"close",[D5],Object.getOwnPropertyDescriptor(qc.prototype,"close"),qc.prototype),qc),vse=(x5=ut({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),k5=Kr(),L5=ut({argsMap:e=>[e.getTrackId()]}),M5=Kr(),U5=ut({argsMap:e=>[e.getTrackId()]}),j5=Kr(),V5=ut({argsMap:e=>[e.getTrackId()]}),F5=Kr(),B5=ut({argsMap:e=>[e.getTrackId()]}),W5=Kr(),G5=ut({argsMap:e=>[e.getTrackId()]}),H5=ut({argsMap:e=>[e.getTrackId()]}),q5=Kr(),Vt((ri=class extends Gr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,a){super(t.createOutputTrack(),r,a),ce(this,"source",void 0),ce(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Xa.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(jm.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ur(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[x5,k5],Object.getOwnPropertyDescriptor(ri.prototype,"startProcessAudioBuffer"),ri.prototype),Vt(ri.prototype,"pauseProcessAudioBuffer",[L5,M5],Object.getOwnPropertyDescriptor(ri.prototype,"pauseProcessAudioBuffer"),ri.prototype),Vt(ri.prototype,"seekAudioBuffer",[U5,j5],Object.getOwnPropertyDescriptor(ri.prototype,"seekAudioBuffer"),ri.prototype),Vt(ri.prototype,"resumeProcessAudioBuffer",[V5,F5],Object.getOwnPropertyDescriptor(ri.prototype,"resumeProcessAudioBuffer"),ri.prototype),Vt(ri.prototype,"stopProcessAudioBuffer",[B5,W5],Object.getOwnPropertyDescriptor(ri.prototype,"stopProcessAudioBuffer"),ri.prototype),Vt(ri.prototype,"close",[G5],Object.getOwnPropertyDescriptor(ri.prototype,"close"),ri.prototype),Vt(ri.prototype,"setAudioBufferPlaybackSpeed",[H5,q5],Object.getOwnPropertyDescriptor(ri.prototype,"setAudioBufferPlaybackSpeed"),ri.prototype),ri);class mn extends Gr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Wm().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,gr(8,"track-mix-")),ce(this,"trackList",void 0),ce(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(N.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):N.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){N.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}DT(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof mn?r.emit(sp.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class yse extends K3{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Xa.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ce(this,"audioBuffer",void 0),ce(this,"sourceNode",void 0),ce(this,"startPlayTime",0),ce(this,"startPlayOffset",0),ce(this,"pausePlayTime",0),ce(this,"options",void 0),ce(this,"currentLoopCount",0),ce(this,"currentPlaybackSpeed",100),ce(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):N.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const K5=new Map;function z5(e,t){if(e.length===0||t.length===0)return 1/0;const r=sN(e),a=sN(t);return Math.floor(a/r)}class xN{get rendFrameRate(){const t=Math.max(1,z5(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(N.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){ce(this,"trackId",void 0),ce(this,"config",void 0),ce(this,"onFirstVideoFrameDecoded",void 0),ce(this,"onVideoStateChanged",void 0),ce(this,"freezeTimeCounterList",[]),ce(this,"renderFreezeAccTime",0),ce(this,"renderFreezeAccTime2",0),ce(this,"isKeepLastFrame",!1),ce(this,"timeUpdatedCount",0),ce(this,"freezeTime",0),ce(this,"playbackTime",0),ce(this,"lastTimeUpdatedTime",0),ce(this,"autoplayFailed",!1),ce(this,"videoTrack",void 0),ce(this,"videoElement",void 0),ce(this,"cacheVideoElement",void 0),ce(this,"_render_interframe_delays",[]),ce(this,"_render_interframe_delays_sizes",[]),ce(this,"_videoState",Hc.VideoStateStopped),ce(this,"videoElementCheckInterval",void 0),ce(this,"videoElementFreezeTimeout",void 0),ce(this,"_videoElementStatus",gi.NONE),ce(this,"isGettingVideoDimensions",!1),ce(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return N.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),ce(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&cr.curState==="running"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(zB())),e3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ce(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=gi.PLAYING;break;case"loadeddata":if(this.videoState=Hc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=gi.CANPLAY;break;case"stalled":this.videoElementStatus=gi.STALLED;break;case"suspend":this.videoElementStatus=gi.SUSPEND;break;case"pause":this.videoElementStatus=gi.PAUSED,Ui()||es()||Qn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=gi.WAITING;break;case"abort":this.videoElementStatus=gi.ABORT;break;case"ended":this.videoElementStatus=gi.ENDED;break;case"emptied":this.videoElementStatus=gi.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=gi.ERROR,N.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Kc.lastVisibleTime<Kc.lastHiddenTime||l<Kc.lastHiddenTime||l<Kc.lastVisibleTime)return;for(c>$("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(zB())),e3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),cr.on($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cr.on($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch(c=>{t&&Z3(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(N.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):N.warning("[".concat(this.trackId,"] play warning: "),c)});const a=Ht();if((a.name==="Safari"&&Number(a.version)===15||Im())&&r&&r.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return N.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const a=r.getImageData(0,0,t.width,t.height);return t.remove(),a}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new Ge((l,d)=>{a.toBlob(async p=>{if(a.remove(),p){const g=await c5(p);l({buffer:g,width:a.width,height:a.height})}else d(new _e(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await DN(t)}destroy(){cr.off($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cr.off($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Hc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=gi.INIT,!this.videoElementCheckInterval&&($5.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(l){return l!==document.body&&document.body.contains(l)})(this.videoElement)||(this.videoElementStatus=gi.DESTROYED)},1e3),$("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let l;const d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Hc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Hc.VideoStateFrozen:document.addEventListener("visibilitychange",d))},g=(v,y)=>{if(this.videoElementStatus===gi.PLAYING){if(l){const O=y.presentationTime-l.presentationTime,V=y.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(V),this._render_interframe_delays.push(O);const k=sN(this._render_interframe_delays_sizes),L=k-this._render_interframe_delays_sizes[0];if(k>30&&L>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Hc.VideoStateStarting&&(this.videoState=Hc.VideoStateDecoding),this.videoState===Hc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION"))),O<$("VIDEO_FREEZE_DURATION")&&this.videoState===Hc.VideoStateFrozen&&(this.videoState=Hc.VideoStateDecoding),O>$("VIDEO_FREEZE_DURATION")&&Kc.lastVisibleTime>=Kc.lastHiddenTime&&l.timestamp>Kc.lastVisibleTime&&l.timestamp>Kc.lastHiddenTime){const H=Math.min(66,z5(this._render_interframe_delays_sizes,this._render_interframe_delays)),q=Math.max(0,O-(V-1)*H);this.renderFreezeAccTime2+=q>H?q:0,this.renderFreezeAccTime+=O}}l=Nr(Nr({},y),{},{timestamp:v})}var b,R;$("ENABLE_VIDEO_FRAME_CALLBACK")&&((b=(R=this.videoElement).requestVideoFrameCallback)===null||b===void 0||b.call(R,g))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),PT()&&!$("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Ht();a.name==="Safari"&&Number(a.version)===15||Im()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(l=>{N.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){$5.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=gi.NONE}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{N.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{N.error(a)}),this.autoplayFailed=!1,ky()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};ky()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Q3()}}const $5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Y5 extends xN{constructor(t){super(t),ce(this,"container",void 0),ce(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,a):await DN(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var X5,J5,Q5,Z5,e4,t4,r4,n4,i4,a4,o4,s4,c4,l4,u4,d4,h4,p4,f4,m4,g4,_4,v4,y4,E4,S4,xt,b4,T4,w4,R4,C4,A4,O4,I4,ro;let Tr=(X5=ut({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),J5=Kr(),Q5=ut({argsMap:e=>[e.getTrackId()]}),Z5=Dm("LocalVideoTrack","_enabledMutex"),e4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),t4=Kr(),r4=Dm("LocalVideoTrack","_enabledMutex"),n4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),i4=Kr(),a4=ut({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),o4=Kr(),s4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),c4=Kr(),l4=Kr(),u4=ut({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),d4=Kr(),h4=Kr(),p4=Kr(),f4=Kr(),m4=Kr(),g4=Kr(),_4=Kr(),v4=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),y4=ut({argsMap:e=>[e.getTrackId()]}),E4=ut({argsMap:e=>[e.getTrackId()]}),S4=ut({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),xt=class V7 extends Bm{get videoHeight(){if(Qn()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Qn()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==gi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,a,c,l,d){if(super(t,l),ce(this,"trackMediaType",Fm.VIDEO),ce(this,"_player",void 0),ce(this,"isUseScaleResolutionDownBy",!1),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ce(this,"_encoderConfig",void 0),ce(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ce(this,"_optimizationMode",void 0),ce(this,"_saveEncodeBitrateRatio",1),ce(this,"_videoHeight",void 0),ce(this,"_videoWidth",void 0),ce(this,"_forceBitrateLimit",void 0),ce(this,"_enabled",!0),ce(this,"_processorDestination",void 0),ce(this,"_processorContext",void 0),Qn()){const{width:p,height:g}=t.getSettings();this._videoWidth=p,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=d||[],r&&this._hints.indexOf(dr.CUSTOM_TRACK)!==-1?this._encoderConfig=Lr(r):this._encoderConfig=r,this._hints.indexOf(dr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(YI(Xt.CHROME,115)&&IT().indexOf("Windows")!==-1){const p=function(g,v){if("VideoFrame"in window&&"TransformStream"in window&&qt().supportWebRTCInsertableStream){const y=new MediaStreamTrackProcessor(g),b=new MediaStreamTrackGenerator({kind:"video"});let R,O,V=Date.now();const k=()=>{L&&(clearInterval(L),L=void 0),R&&(R.close(),R=void 0),g.stop(),O=void 0,b.removeEventListener("ended",k)};let L=window.setInterval(()=>{if(O&&R&&Date.now()-V>1e3)try{b.readyState==="live"?O.enqueue(R.clone()):k()}catch{k()}},1e3);const H=new TransformStream({transform:(q,te)=>{b.readyState==="live"?(O=te,V=Date.now(),R===void 0?(R=q,te.enqueue(q.clone())):(te.enqueue(R),R=q)):q.close()}});return b.addEventListener("ended",k),y.readable.pipeThrough(H).pipeTo(b.writable),b}}(t);p&&(N.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}r&&this._hints.indexOf(dr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new t5(this.getTrackId(),"local"),this._processorDestination=new e5(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const c=document.getElementById(t);c?t=c:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=Nr(Nr(Nr({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(a):(t instanceof HTMLVideoElement?this._player=new xN(a):this._player=new Y5(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(jm.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await pr(this,Je.NEED_DISABLE_TRACK,this)}catch(a){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return r||(this._enabled=!1),void N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await pr(this,Je.NEED_ENABLE_TRACK,this)}catch(a){throw N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await pr(this,Je.NEED_MUTE_TRACK,this):await pr(this,Je.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),N.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await pr(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(N)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new _e(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=ns(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const a=qT({encoderConfig:t});(Qn()||Ui()||es())&&(a.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const l=new _e(K.UNEXPECTED_ERROR,c.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await pr(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(N)}}getStats(){return gd(()=>{N.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),za(this,Je.GET_STATS)||Nr({},RN)}async setBeautyEffect(t){N.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await DN(t)}async setBitrateLimit(t){N.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void N.error(K.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await pr(this,Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=r,N.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}N.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return N.error(K.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,N.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){i5(this._originMediaStreamTrack).then(t=>{let[r,a]=t;this._videoHeight=a,this._videoWidth=r}).catch(kT)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new _e(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");N.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=ns(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await pr(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(N)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!t||!r||!a)return;const{bitrateMax:c,bitrateMin:l}=this._encoderConfig;if(l==null||c==null){const{max:d,min:p}=function(g,v,y,b,R){const O=$("BITRATE_ADAPTER_TYPE");if(O==="DEFAULT_BITRATE")return{min:b,max:R};if(R===void 0){const V=Math.floor(200*Math.pow(y/15,.6)*Math.pow(g*v/640/360,.75));R=O==="STANDARD_BITRATE"?4*V:2*V,b=b??V}else b=b??Math.floor(R/10);return{min:b,max:R}}(t,r,a,l,c);if(this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=d,$("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&c==null){const[g,v]=function(y,b,R){const O=4*Math.floor(2e5*Math.pow(R/15,.6)*Math.pow(y*b/230400,.75)),V=y*b,k=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),L=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let H=Aa(k).call(k).next().value,q=1;if(k.has(V))H=k.get(V);else{var te;const ze=$h(te=Array.from(k.entries())).call(te,(bt,pt)=>{let[Er]=bt,[hr]=pt;return Er-hr}),At=ze.find(bt=>{let[pt]=bt;return pt>V});if(At){const bt=ze.indexOf(At);if(bt>0){const pt=ze[bt-1],Er=(V-pt[0])/(At[0]-pt[0]);H=pt[1]+Er*(At[1]-pt[1])}else H=At[1]}else H=ze[ze.length-1][1]}if(L.has(V))q=L.get(V);else{var oe;const ze=$h(oe=Array.from(L.entries())).call(oe,(bt,pt)=>{let[Er]=bt,[hr]=pt;return Er-hr}),At=ze.find(bt=>{let[pt]=bt;return pt>V});if(At){const bt=ze.indexOf(At);if(bt>0){const pt=ze[bt-1],Er=(V-pt[0])/(At[0]-pt[0]);q=pt[1]+Er*(At[1]-pt[1])}else q=At[1]}else q=ze[ze.length-1][1]}const se=$("VIDEO_NEW_BITRATE_RATIO");se&&se>0&&(H=se/100);const ae=Math.floor(O*H),pe=Math.floor(65e4*Math.pow(y*b/230400,.5)*Math.pow(R/15,.69));let Te=ae;const Fe=$("VIDEO_STANDARD_BITRATE_VERSION");return Fe&&Fe>0&&(Fe===1?Te=O:Fe===2?Te=ae:Fe===3&&(Te=pe)),[Math.floor(Te/1e3),q]}(t,r,a);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=p?Math.min(p,g):g,this._saveEncodeBitrateRatio=v,N.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else N.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(d,", brMin: ").concat(p,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;const a=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:l,slot:d}=c;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const p=a3.checkOneElementVisible(l),g=Object.assign({},p);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const v=Ze.reportApiInvoke(null,{tag:Br.TRACER,name:rn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new _e(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=Nr(Nr({},a),ns(t))),a=np(a);const c=gr(8,"track-video-cloned-"),l=new V7(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,np(this._scalabilityMode),this._optimizationMode,c,np(this._hints));return t&&a&&l.setEncoderConfiguration(a),N.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),l}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new _e(K.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new _e(K.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(gd(()=>{Ze.reportApiInvoke(null,{name:rn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Br.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!$("ENABLE_VIDEO_SEI")||!$("ENABLE_ENCODED_TRANSFORM"))return void N.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new _e(K.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void N.warning("Video track is not published, SEI can not be send");const a=r.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",t):N.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ji.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await pr(this,Je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pr(this,Je.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ji.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ja.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ja.REQUEST_CONSTRAINTS)}},Vt(xt.prototype,"play",[X5,J5],Object.getOwnPropertyDescriptor(xt.prototype,"play"),xt.prototype),Vt(xt.prototype,"stop",[Q5],Object.getOwnPropertyDescriptor(xt.prototype,"stop"),xt.prototype),Vt(xt.prototype,"setEnabled",[Z5,e4,t4],Object.getOwnPropertyDescriptor(xt.prototype,"setEnabled"),xt.prototype),Vt(xt.prototype,"setMuted",[r4,n4,i4],Object.getOwnPropertyDescriptor(xt.prototype,"setMuted"),xt.prototype),Vt(xt.prototype,"setSaveEncodeBitrateRatio",[a4,o4],Object.getOwnPropertyDescriptor(xt.prototype,"setSaveEncodeBitrateRatio"),xt.prototype),Vt(xt.prototype,"setEncoderConfiguration",[s4,c4],Object.getOwnPropertyDescriptor(xt.prototype,"setEncoderConfiguration"),xt.prototype),Vt(xt.prototype,"getStats",[l4],Object.getOwnPropertyDescriptor(xt.prototype,"getStats"),xt.prototype),Vt(xt.prototype,"setBeautyEffect",[u4,d4],Object.getOwnPropertyDescriptor(xt.prototype,"setBeautyEffect"),xt.prototype),Vt(xt.prototype,"getCurrentFrameData",[h4],Object.getOwnPropertyDescriptor(xt.prototype,"getCurrentFrameData"),xt.prototype),Vt(xt.prototype,"getCurrentFrameImage",[p4],Object.getOwnPropertyDescriptor(xt.prototype,"getCurrentFrameImage"),xt.prototype),Vt(xt.prototype,"setBitrateLimit",[f4],Object.getOwnPropertyDescriptor(xt.prototype,"setBitrateLimit"),xt.prototype),Vt(xt.prototype,"setOptimizationMode",[m4],Object.getOwnPropertyDescriptor(xt.prototype,"setOptimizationMode"),xt.prototype),Vt(xt.prototype,"setScalabiltyMode",[g4],Object.getOwnPropertyDescriptor(xt.prototype,"setScalabiltyMode"),xt.prototype),Vt(xt.prototype,"updateMediaStreamTrackResolution",[_4],Object.getOwnPropertyDescriptor(xt.prototype,"updateMediaStreamTrackResolution"),xt.prototype),Vt(xt.prototype,"pipe",[v4],Object.getOwnPropertyDescriptor(xt.prototype,"pipe"),xt.prototype),Vt(xt.prototype,"unpipe",[y4],Object.getOwnPropertyDescriptor(xt.prototype,"unpipe"),xt.prototype),Vt(xt.prototype,"close",[E4],Object.getOwnPropertyDescriptor(xt.prototype,"close"),xt.prototype),Vt(xt.prototype,"replaceTrack",[S4],Object.getOwnPropertyDescriptor(xt.prototype,"replaceTrack"),xt.prototype),xt),kN=(b4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),T4=Kr(),w4=Dm("CameraVideoTrack","_enabledMutex"),R4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),C4=Kr(),A4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),O4=Kr(),I4=ut({argsMap:e=>[e.getTrackId()]}),ro=class F7 extends Tr{get __className__(){return"CameraVideoTrack"}constructor(t,r,a,c,l,d){super(t,ns(r.encoderConfig),c,l,d),ce(this,"_config",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_constraints",void 0),ce(this,"_enabled",!0),ce(this,"_deviceName","default"),ce(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Im()||QI())&&!function(){const p=Ht();if(p.os!==On.IOS||!p.osVersion)return!1;const g=p.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&t3()&&this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=t.label,this._encoderConfig=ns(this._config.encoderConfig),cr.on($n.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),cr.on($n.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(N.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await eo.getDeviceById(t),a={};a.video=Nr({},this._constraints),a.video.deviceId={exact:t},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Za(a,this.getTrackId())}catch(l){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),c=await Za({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await eo.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){N.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:Nr(Nr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await Za(r,this.getTrackId())}catch(c){throw N.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await Za({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Nr({},r.video),N.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await Za({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await pr(this,Je.NEED_ENABLE_TRACK,this)}catch(a){throw N.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await pr(this,Je.NEED_DISABLE_TRACK,this)}catch(a){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new _e(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=ns(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const a=Lr(this._config);a.encoderConfig=t;const c=qT(a);(Qn()||Ui()||es())&&(c.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(l){const d=new _e(K.UNEXPECTED_ERROR,l.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await pr(this,Je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(N)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ui()||es())&&this._enabled&&!this._isClosed&&cr.duringInterruption){const t=async()=>{cr.off($n.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};cr.on($n.IOS_INTERRUPTION_END,t)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jm.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,a=eo.searchDeviceIdByName(this._deviceName);if(a&&!r.deviceId&&(r.deviceId={exact:a}),this._enabled){const c=await Za({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),cr.off($n.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),cr.off($n.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=Nr(Nr({},a),ns(t))),a=np(a);const c=gr(8,"track-cam-cloned-"),l=new F7(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,np(Nr(Nr({},this._config),{},{encoderConfig:a})),np(this._constraints),np(this._scalabilityMode),this._optimizationMode,c);return t&&a&&l.setEncoderConfiguration(a),N.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),l}bindProcessorContextEvents(){this.processorContext.on(Ja.REQUEST_UPDATE_CONSTRAINTS,async(t,r,a)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){a(c)}}),this.processorContext.on(Ja.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Vt(ro.prototype,"setDevice",[b4,T4],Object.getOwnPropertyDescriptor(ro.prototype,"setDevice"),ro.prototype),Vt(ro.prototype,"setEnabled",[w4,R4,C4],Object.getOwnPropertyDescriptor(ro.prototype,"setEnabled"),ro.prototype),Vt(ro.prototype,"setEncoderConfiguration",[A4,O4],Object.getOwnPropertyDescriptor(ro.prototype,"setEncoderConfiguration"),ro.prototype),Vt(ro.prototype,"close",[I4],Object.getOwnPropertyDescriptor(ro.prototype,"close"),ro.prototype),ro);function LN(e,t,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=Nr(Nr({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?N.debug("[".concat(e,"] set content hint to"),r.optimizationMode):N.debug("[".concat(e,"] set content hint failed")))):N.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var N4,P4,D4,x4,wo,k4,L4,M4,U4,j4,V4,wi;class F4 extends G3{getUserId(){return this._userId}constructor(t,r,a,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(gr(5,""))),ce(this,"_userId",void 0),ce(this,"_uintId",void 0),ce(this,"_isDestroyed",!1),ce(this,"store",void 0),ce(this,"processor",void 0),ce(this,"processorContext",void 0),this._userId=r,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,N.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Hm=(N4=ut({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),P4=ut({argsMap:e=>[e.getTrackId()]}),D4=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),x4=ut({argsMap:e=>[e.getTrackId()]}),Vt((wo=class extends F4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==gi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,a){super(e,t,r,a),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ce(this,"trackMediaType",Fm.VIDEO),ce(this,"_videoWidth",void 0),ce(this,"_videoHeight",void 0),ce(this,"_player",void 0),ce(this,"processorDestination",void 0),ce(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new t5(this.getTrackId(),"remote"),this.processorDestination=new e5(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gd(()=>{N.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),za(this,Je.GET_STATS)||Nr({},B3)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const a=document.getElementById(e);a?e=a:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=Nr(Nr({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new xN(r):this._player=new Y5(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Vm.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(Vm.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Vm.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){i5(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(kT)}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),a={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:c,slot:l}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&l instanceof HTMLElement){const d=a3.checkOneElementVisible(c),p=Object.assign({},d);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const g=Ze.reportApiInvoke(null,{tag:Br.TRACER,name:rn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(r){throw new _e(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ji.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ji.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(sp.SEI_RECEIVED,e)}}).prototype,"play",[N4],Object.getOwnPropertyDescriptor(wo.prototype,"play"),wo.prototype),Vt(wo.prototype,"stop",[P4],Object.getOwnPropertyDescriptor(wo.prototype,"stop"),wo.prototype),Vt(wo.prototype,"pipe",[D4],Object.getOwnPropertyDescriptor(wo.prototype,"pipe"),wo.prototype),Vt(wo.prototype,"unpipe",[x4],Object.getOwnPropertyDescriptor(wo.prototype,"unpipe"),wo.prototype),wo),qm=(k4=ut({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),L4=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),M4=ut({argsMap:e=>[e.getTrackId()]}),U4=ut({argsMap:e=>[e.getTrackId()]}),j4=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),V4=ut({argsMap:e=>[e.getTrackId()]}),Vt((wi=class extends F4{get isPlaying(){return this._useAudioElement?Qi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,a){super(e,t,r,a),ce(this,"trackMediaType",Fm.AUDIO),ce(this,"_source",void 0),ce(this,"_useAudioElement",!0),ce(this,"_volume",100),ce(this,"processorContext",void 0),ce(this,"processorDestination",void 0),ce(this,"_played",!1),ce(this,"_bypassWebAudio",!1),$("DISABLE_WEBAUDIO")?(this._source=new PN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new z3(e,!0),$("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Xa.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Vm.FIRST_FRAME_DECODED)}),this.processorContext=new n5(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new r5(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Xa.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Xa.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Xa.ON_AUDIO_BUFFER),this._source.on(Xa.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Qi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!U3())throw new _e(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gd(()=>{N.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),za(this,Je.GET_STATS)||Nr({},F3)}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ji.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ji.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ji.ON_TRACK),this.processorDestination.removeAllListeners(ji.ON_NODE)}}).prototype,"setVolume",[k4],Object.getOwnPropertyDescriptor(wi.prototype,"setVolume"),wi.prototype),Vt(wi.prototype,"setPlaybackDevice",[L4],Object.getOwnPropertyDescriptor(wi.prototype,"setPlaybackDevice"),wi.prototype),Vt(wi.prototype,"play",[M4],Object.getOwnPropertyDescriptor(wi.prototype,"play"),wi.prototype),Vt(wi.prototype,"stop",[U4],Object.getOwnPropertyDescriptor(wi.prototype,"stop"),wi.prototype),Vt(wi.prototype,"pipe",[j4],Object.getOwnPropertyDescriptor(wi.prototype,"pipe"),wi.prototype),Vt(wi.prototype,"unpipe",[V4],Object.getOwnPropertyDescriptor(wi.prototype,"unpipe"),wi.prototype),wi);const Kc=new class extends kr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ce(this,"_lastHiddenTime",0),ce(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),N.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class B4 extends kr{constructor(t,r){super(),ce(this,"trackMediaType",Fm.DATA),ce(this,"_version",1),ce(this,"_type",3),ce(this,"_config",void 0),ce(this,"_originDataChannel",void 0),ce(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ce(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),ce(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ge((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const a=setTimeout(()=>{var c;r(new _e(K.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new _e(K.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new _e(K.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[GT.OPEN,GT.CLOSE,GT.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),t.addEventListener(r,a)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,c]=r;t.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class Ese extends B4{constructor(t){super(t),ce(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void($("SHOW_DATASTREAM2_LOG")&&N.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let l=r.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(GT.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Sse extends B4{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function KT(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>Kb.revokeObjectURL(e),0),new Worker(Kb.createObjectURL(e))}const W4=71,MN=1,UN=2,jN=1,G4=2;var Hl=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Hl||{});function H4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=e.getUint8(0);if(r!==W4)return;const a=e.getUint16(1),c=MN+UN+a,l=new Uint8Array(e.byteLength-c);l.set(new Uint8Array(e.buffer,c,e.byteLength-c));const d={m:r,tlvLen:a,tlv:[],frame:l};let p=MN+UN;for(;p<c;){const g=e.getUint8(p),v=e.getUint16(p+jN),y=jN+G4;if(g===Hl.AUDIO_LEVEL){let b=e.getUint8(p+y);for(let R=1;R<v;R++)b=b<<8|e.getUint8(p+y+R);d.tlv.push({tag:g,length:v,value:t?127^b>>1:127&b})}else if(g===Hl.METADATA||g===Hl.AUDIO_64_BIT_PTS){const b=new Uint8Array(v);for(let R=0;R<v;R++)b[R]=e.getUint8(p+y+R);d.tlv.push({tag:g,length:v,value:b})}p+=y+v}return d}const zT=new Map,$T=127,up=1e-10,VN=139/13,YT=new Map;function FN(e,t,r){const a="".concat(e,"-").concat(t,"-").concat(r);let c=0;return YT.has(a)?c=YT.get(a):(c=Math.log(function(d,p){const g=d-p;p<g&&(p=g);let v=1;for(let y=d,b=1;y>p;y--,b++)v=v*y/b;return v}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,YT.set(a,c)),c<up&&(c=up),c}function q4(e,t,r){const a=t.length,c=e.length/a;let l=!1;for(let d=0,p=0;d<a;d++){let g=0;for(let v=p+c;p<v;p++)e[p]>r&&g++;t[d]!==g&&(t[d]=g,l=!0)}return l}window.cache=YT;let bse=0;class K4{constructor(t){ce(this,"id",void 0),ce(this,"immediates",[]),ce(this,"lastNonSilence",-1),ce(this,"immediateSpeechActivityScore",up),ce(this,"lastLevelChangedTime",Date.now()),ce(this,"levels",[]),ce(this,"longs",[]),ce(this,"longSpeechActivityScore",up),ce(this,"mediums",[]),ce(this,"mediumSpeechActivityScore",up),ce(this,"minLevel",0),ce(this,"nextMinLevel",0),ce(this,"nextMinLevelWindowLength",0),ce(this,"energyScore",0),this.id=t||"".concat(bse++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,r=this.levels,a=this.minLevel+VN;let c=!1;for(let l=0;l<t.length;++l){let d=r[l];d<a&&(d=0);const p=Math.floor(d/VN);t[l]!==p&&(t[l]=p,c=!0)}return c}computeLongs(){return q4(this.mediums,this.longs,4)}computeMediums(){return q4(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=FN(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=FN(this.longs[0],10,47),this.longSpeechActivityScore>up&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=FN(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(gh(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let a=t;return t<0&&(a=0),t>$T&&(a=$T),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+VN?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>$T&&(r=$T),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Tse{constructor(t){ce(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class BN{constructor(t,r,a){ce(this,"isDominant",void 0),ce(this,"energyRanking",void 0),ce(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=a}}class wse extends kr{constructor(t){super(),ce(this,"dominantId",null),ce(this,"lastDecisionTime",0),ce(this,"lastLevelChangedTime",0),ce(this,"lastLevelIdleTime",0),ce(this,"relativeSpeechActivities",[]),ce(this,"speakers",new Map),ce(this,"enableSilence",!1),ce(this,"timeoutToSilenceInterval",0),ce(this,"decisionMaker",null),ce(this,"loudest",[]),ce(this,"numLoudestToTrack",3),ce(this,"energyExpireTimeMs",250),ce(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),a!=null&&(this.energyAlphaPct=a),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){const a=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const l=c.levelChanged(r,a);return this.updateLoudestList(c,l,a)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new K4(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,a){const c=t.id===this.dominantId;if(r<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==t;)++g;return new BN(c,g,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new BN(c,0,t.energyScore);const l=a-this.energyExpireTimeMs;let d=0;for(;d<this.loudest.length;){const g=this.loudest[d];if(g.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(d,1);else if(g.id!==t.id)++d;else if(this.loudest.splice(d,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<t.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new BN(c,p,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Tse(this),this.decisionMaker.execute())}makeDecision(t){let r=null,a=null;const c=this.speakers.size;let l=null;if(c===0)l=null;else if(c===1){var d;const p=Aa(d=this.speakers).call(d).next().value;this.enableSilence&&p&&(l=p.id,p.evaluateSpeechActivityScores(t),t-p.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){const y=this.speakers.entries().next();y.value&&(l=y.value[0],p=y.value[1])}else l=p.id;p!=null&&p.evaluateSpeechActivityScores(t);const g=this.relativeSpeechActivities;let v=2;for(const y of this.speakers.entries()){const[b,R]=y;if(R===p)continue;R.evaluateSpeechActivityScores(t);for(let L=0;L<g.length;++L){const H=p==null?up:p.getSpeechActivityScore(L);g[L]=Math.log(R.getSpeechActivityScore(L)/H)}const O=g[0],V=g[1],k=g[2];O>3&&V>2&&k>0&&V>v&&(v=V,l=b)}this.enableSilence&&p!=null&&l===p.id&&t-p.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(r=this.dominantId,this.dominantId=l,a=this.dominantId),a==null&&!this.enableSilence||a===r||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const t=Date.now(),r=300-(t-this.lastLevelIdleTime);let a=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):a=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(t){const r=[];for(const c of Aa(a=this.speakers).call(a)){var a;const l=t-c.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<l&&c.levelTimedOut()}r.forEach(c=>this.speakers.delete(c))}}const Km=new Map;let Ks=null,XT=null;const z4=3;let dp=[];const zs=new Map,JT=new Map;class Rse{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){ce(this,"id",void 0),ce(this,"track",void 0),ce(this,"score",0),ce(this,"active",!0),ce(this,"muted",!1),ce(this,"timer",0),ce(this,"actives",0),ce(this,"inactives",0),this.id=t,this.track=r,this.setActive(zs.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:a}=function(){const c=[],l=[];return Array.from(Aa(zs).call(zs)).forEach(d=>{d.active?c.push(d):l.push(d)}),{actives:c,inactives:l}}();if(r.length>3){let c;r.forEach(l=>{(!c||c.score>l.score)&&(c=l)}),c&&c.setActive(!1)}if(r.length<3&&a.length>0){let c;a.forEach(l=>{(!c||c.score<l.score)&&l.id!==this.id&&(c=l)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(r){let a;return Array.from(Aa(zs).call(zs)).forEach(c=>{!c.active||c.id===r||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(r){let a;return Array.from(Aa(zs).call(zs)).forEach(c=>{c.active||c.id===r||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let QT;function $4(e){const t=zs.get(e);t&&(zs.delete(e),t.clearTimer())}const ZT=new Map,Cse=new Map;function Ase(e,t,r){let a=new Uint8Array(e,t,r),c=[],l=0;for(;c.length<r;)l+3<r&&a[l]===0&&a[l+1]===0&&a[l+2]===3&&(a[l+3]===0||a[l+3]===1||a[l+3]===2||a[l+3]===3)?(c.push(a[l],a[l+1],a[l+3]),l+=4):(c.push(a[l]),l++);return new Uint8Array(c)}const ew=new Map,qy=new Map;(function(){const e=Ht();zn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),zn.getStreamFromExtension=e.name===Xt.CHROME&&Number(e.version)>34,zn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),zn.supportMinBitrate=e.name===Xt.CHROME||e.name===Xt.EDGE,zn.supportSetRtpSenderParameters=function(){const t=Ht();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Bl()||!(!Qn()&&!NT())||t.name===Xt.FIREFOX&&Number(t.version)>=64)}(),e.name===Xt.SAFARI&&(Number(e.version)>=14?zn.supportDualStream=!0:zn.supportDualStream=!1),zn.webAudioMediaStreamDest=function(){const t=Ht();return!(t.name===Xt.SAFARI&&Number(t.version)<12)}(),zn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",zn.supportWebGL=typeof WebGLRenderingContext<"u",zn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Bl()||(zn.webAudioWithAEC=!0),zn.supportShareAudio=function(){const t=Ht();return(t.os===On.WIN_10||t.os===On.WIN_81||t.os===On.WIN_7||t.os===On.LINUX||t.os===On.MAC_OS||t.os===On.CHROMIUM_OS)&&t.name===Xt.CHROME&&Number(t.version)>=74}(),zn.supportDataChannel=!!(xy(76)||function(t){const r=Ht();return!(r.name!==Xt.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||XB(14)),zn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Vr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),zn.supportWebRTCEncodedTransform=function(){const t=Ht();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),zn.supportWebRTCInsertableStream=function(){const t=Ht();return(t.name===Xt.CHROME||t.name===Xt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),zn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,zn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,xT(()=>{zn.supportDualStreamEncoding=function(){const t=Ht();return!!$("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&$("CHROME_DUAL_STREAM_USE_ENCODING"))}(),N.debug("browser ua: ",navigator.userAgent),N.info("browser info: ",e),N.info("browser compatibility: ",zn)})})();const Ose=["CHINA","GLOBAL"],Y4=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hp=[],zm=[];function pp(e,t){return!!t&&hp.some(r=>r.uid===e&&r.channelName===t)}function WN(){return zm.length>0}var Ise=pF.forEach,X4=uh("forEach")?[].forEach:function(e){return Ise(this,e,arguments.length>1?arguments[1]:void 0)};er({target:"Array",proto:!0,forced:[].forEach!==X4},{forEach:X4});var Nse=Sa("Array","forEach"),Pse=bs,Dse=kn,xse=P,kse=Nse,GN=Array.prototype,Lse={DOMTokenList:!0,NodeList:!0},Mse=function(e){var t=e.forEach;return e===GN||xse(GN,e)&&t===GN.forEach||Dse(Lse,Pse(e))?kse:t},Use=u(Mse),jse=Uo,J4=$i;er({target:"Object",stat:!0,forced:f(function(){J4(1)})},{keys:function(e){return J4(jse(e))}});var Vse=u(xn.Object.keys),Fse=u(cn),Bse=u(mh),Wse=er,Q4=Ts,Gse=Jn,Hse=en,Z4=W_,qse=vc,Kse=qr,zse=DO,$se=Ur,Yse=Gn,Xse=nF("slice"),Jse=$se("species"),HN=Array,Qse=Math.max;Wse({target:"Array",proto:!0,forced:!Xse},{slice:function(e,t){var r,a,c,l=Kse(this),d=qse(l),p=Z4(e,d),g=Z4(t===void 0?d:t,d);if(Q4(l)&&(r=l.constructor,(Gse(r)&&(r===HN||Q4(r.prototype))||Hse(r)&&(r=r[Jse])===null)&&(r=void 0),r===HN||r===void 0))return Yse(l,p,g);for(a=new(r===void 0?HN:r)(Qse(g-p,0)),c=0;p<g;p++,c++)p in l&&zse(a,c,l[p]);return a.length=c,a}});var Zse=Sa("Array","slice"),ece=P,tce=Zse,qN=Array.prototype,rce=function(e){var t=e.slice;return e===qN||ece(qN,e)&&t===qN.slice?tce:t},nce=u(rce);function Qe(e,t,r,a,c){var l,d,p,g={};return Use(l=Vse(a)).call(l,function(v){g[v]=a[v]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Fse(d=Bse(p=nce(r).call(r)).call(p)).call(d,function(v,y){return y(e,t,v)||v},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(ZV(e,t,g),null):g}let tw=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),KN=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),is=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Vi=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),ct=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),yr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ft=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),ht=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Ky=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),kt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Fi=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),St=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function rw(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw N.error("Invalid Channel Name ".concat(e)),new he(K.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nw(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||i3(e,1,255)))throw new he(K.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&N.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ql=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const ice={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},zN={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function $N(e,t){qn(e.url,"".concat(t,".url"),1,1e3,!1),Fr(e.x)||ur(e.x,"".concat(t,".x"),0,1e4),Fr(e.y)||ur(e.y,"".concat(t,".y"),0,1e4),Fr(e.width)||ur(e.width,"".concat(t,".width"),0,1e4),Fr(e.height)||ur(e.height,"".concat(t,".height"),0,1e4),Fr(e.zOrder)||ur(e.zOrder,"".concat(t,".zOrder"),0,255),Fr(e.alpha)||ur(e.alpha,"".concat(t,".alpha"),0,1,!1)}const ace={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let yd=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),YN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),gn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function e6(e){if(!e.channelName)throw new he(K.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new he(K.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qn(e.token,"info.token",1,2047),nw(e.uid),rw(e.channelName),!0}let Bi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Kl=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),fa=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),$m=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),nr=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Mn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),iw=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Nn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Jt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const t6=[Jt.AFRICA,Jt.ASIA,Jt.CHINA,Jt.EUROPE,Jt.GLOBAL,Jt.INDIA,Jt.JAPAN,Jt.NORTH_AMERICA,Jt.OCEANIA,Jt.OVERSEA,Jt.SOUTH_AMERICA];let li=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const aw={CHINA:{},ASIA:{CODE:li.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:li.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:li.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:li.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:li.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:li.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:li.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:li.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:li.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:li.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:li.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:li.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:li.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};gN&&(aw.CHINA={CODE:li.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let zy=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function r6(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class n6 extends kr{constructor(t,r){super(),G(this,"onICEConnectionStateChange",void 0),G(this,"onConnectionStateChange",void 0),G(this,"onDTLSTransportStateChange",void 0),G(this,"onDTLSTransportError",void 0),G(this,"onICETransportStateChange",void 0),G(this,"onFirstAudioReceived",void 0),G(this,"onFirstVideoReceived",void 0),G(this,"onFirstAudioDecoded",void 0),G(this,"onFirstVideoDecoded",void 0),G(this,"onFirstVideoDecodedTimeout",void 0),G(this,"onSelectedLocalCandidateChanged",void 0),G(this,"onSelectedRemoteCandidateChanged",void 0),G(this,"onICECandidateError",void 0),G(this,"getLocalVideoStats",void 0)}}class i6 extends n6{constructor(t,r){super(t,r),G(this,"establishPromise",void 0)}}let $e=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),ui=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),zl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const a6=["disconnected","failed"];let Ie=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),rr=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),at=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),as=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),os=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Un=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),o6=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),zc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ro=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),$s=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Ym=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Xr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Xm=function(e){return e.ABORT="abort",e}({}),Ed=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),oce=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const sce={[tw.ACCESS_POINT]:{[Vi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Vi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Vi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Vi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Vi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Vi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Vi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[tw.UNILBS]:{[is.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[is.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[is.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[is.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[is.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[is.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[is.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[is.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[is.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[is.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[is.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[is.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[tw.STRING_UID_ALLOCATOR]:{[KN.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[KN.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[KN.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Jm(e){const t=sce[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===tw.ACCESS_POINT){const a=e%1e4;if(a.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const cce={[ct.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ct.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ct.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ct.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ct.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ct.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ct.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ct.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ct.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ct.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ct.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ct.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[ct.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ct.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ct.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ct.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ct.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ct.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ct.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ct.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ct.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ct.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ct.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ct.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ct.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ct.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ct.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ct.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ct.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ct.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ct.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ct.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ct.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ct.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ct.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ct.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ct.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ct.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ct.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ct.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ct.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ct.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ct.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ct.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ct.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ct.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ct.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ct.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ct.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ct.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ct.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ct.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ct.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ct.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ct.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ct.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ct.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ct.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ct.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ct.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ct.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ct.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ct.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function $y(e){return cce[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function s6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function XN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?s6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function JN(e,t){if(typeof e=="string")return e;const{proxy:r,host:a,port:c}=e;if(t){const l=$("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(l,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const lce=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,uce=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,dce=/wss:\/\/(.+):([0-9]+)\/?/,hce=/wss:\/\/(.[^\/]+)\/?/;let pce=0;class fce{constructor(t,r){G(this,"id",0),G(this,"store",void 0),G(this,"recordIndex",void 0),G(this,"websockets",[]),G(this,"try443PortDuration",2e3),G(this,"forceCloseWSDuration",5e3),G(this,"try443PortTimeout",null),G(this,"forceCloseTimeout",null),G(this,"isTry443PortFailed",!1),G(this,"isNormalPortFailed",!1),G(this,"useDoubleDomain",!1),G(this,"useProxy",!1),G(this,"startTime",Date.now()),this.id=++pce,this.try443PortDuration=$("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const r=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];N.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,a){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:a});const c=$("GATEWAY_DOMAINS"),l=Date.now(),d=[],p=c.find(R=>{var O;return Ve(O=t.host).call(O,R)});p||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(R=>{g.push(JN(XN(XN({},t),{},{host:t.host.replace(p,R)}),r))});else{const R=XN({},t);if(r&&p){const O=c.find(V=>V!==p);O&&(R.host=R.host.replace(p,O))}g.push(JN(R,r))}try{g.forEach(R=>{const O=new WebSocket(R);O.binaryType="arraybuffer",d.push(O),this.logger("ws is connecting:",O.url)})}catch(R){if(this.logger("ws create failed"),d.forEach(O=>O.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,a);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,a);throw new he(K.WS_ERR,"init websocket failed! Error: ".concat(R.toString()))}const v=Dy();this.store&&this.store.recordJoinChannelService({urls:d.map(R=>R.url),service:"gateway"},this.recordIndex),d.forEach(R=>{R.onopen=()=>{this.logger("onopen: ws ".concat(R.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(O=>{O!==R&&(O.onopen=null,O.onclose=null,O.onmessage=null,O.close(),this.logger("close backup websocket: ".concat(O.url)))}),this.websockets.length=0,v.resolve(R)},R.onclose=O=>{this.logger("onclose: ws ".concat(R.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(R.readyState));const V=d.every(k=>k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(V)),V&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(O.reason)),v.reject({code:O.code,reason:iw.A_ROUND_WS_FAILED})):!r&&V&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),b()),r?this.isTry443PortFailed=V:this.isNormalPortFailed=V},R.onmessage=O=>this.logger("".concat(R.url," onmessage: ").concat(O.data))}),this.websockets.push(...d);const y=()=>{this.websockets.forEach(R=>R.readyState!==WebSocket.OPEN&&R.close())},b=()=>{if(v.isResolved)return y();Ht().os===On.MAC_OS&&Vr()&&y(),this.createWebSocket(t,!0,!0).then(R=>{v.resolve(R)}).catch(R=>{this.isNormalPortFailed&&v.reject(R),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,y()},this.forceCloseWSDuration)};return a||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,y()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,b()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(t,r,a,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(l){let d,p,g;return[,d,p,g]=l.match(lce)||[],d||([,p,g]=l.match(uce)||[]),p&&g||([,p,g]=l.match(dce)||[]),p&&g||([,p]=l.match(hce)||[]),p||N.warning("un-destructible url: ",l),{proxy:d,host:p,port:g||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,a&&this.useProxy&&(N.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(t,!!a,!1).finally(()=>this.clearTimeout())}}function c6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}class l6 extends kr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;Ve(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(St.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(St.CONNECTED):this._state==="closed"?this.emit(St.CLOSED):this._state==="failed"&&this.emit(St.FAILED))}resetReconnectCount(t){N.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),G(this,"_websocketUrl",null),G(this,"connectionID",0),G(this,"currentURLIndex",0),G(this,"urls",[]),G(this,"_reconnectMode","tryNext"),G(this,"reconnectReason",void 0),G(this,"_initMutex",void 0),G(this,"name",void 0),G(this,"_state","closed"),G(this,"reconnectInterrupter",void 0),G(this,"websocket",void 0),G(this,"retryConfig",void 0),G(this,"reconnectCount",0),G(this,"forceCloseTimeout",5e3),G(this,"onlineReconnectListener",void 0),G(this,"useCompress",void 0),G(this,"tryDoubleDomain",!1),G(this,"use443PortOnly",!1),G(this,"wsInflateLength",0),G(this,"wsDeflateLength",0),G(this,"closeEstablishingWs",()=>{}),G(this,"store",void 0),G(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=function(b){for(var R=1;R<arguments.length;R++){var O=arguments[R]!=null?arguments[R]:{};R%2?c6(Object(O),!0).forEach(function(V){G(b,V,O[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(O)):c6(Object(O)).forEach(function(V){Object.defineProperty(b,V,Object.getOwnPropertyDescriptor(O,V))})}return b}({},r),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=l,this._initMutex=new ci("websocket",d?d.clientId:void 0);const{timeout:p,timeoutFactor:g}=r,v=Math.max(300,Math.floor(3*p/5)),y=Math.max(1.2,Math.floor(8*g)/10);Na.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y),nn.on(Nm.NETWORK_STATE_CHANGE,(b,R)=>{b!==R&&(this.resetReconnectCount("network state change: ".concat(R," -> ").concat(b)),b===Na.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{const c=Dy(),l=this.urls[this.currentURLIndex];$("ENABLE_PREALLOC_PC")&&this.emit(o6.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(c.resolve).catch(c.reject),this.once(St.CLOSED,()=>{c.reject(new _e(K.WS_DISCONNECT))}),this.once(St.CONNECTED,c.resolve),await c.promise}catch{}finally{a()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void N.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _e(K.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(a){throw new _e(K.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const a=Dy();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=y=>{var b;(b=this.store)===null||b===void 0||b.signalChannelOpen(),N.debug("[".concat(this.name,"] websocket opened:"),y),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},l=async y=>{var b;if(N.debug("[".concat(this.name,"] websocket close ").concat((b=this.websocket)===null||b===void 0?void 0:b.url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new _e(K.WS_DISCONNECT,"websocket close: ".concat(y.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=y.reason,this.state="reconnecting");const R=za(this,St.WILL_RECONNECT,this.reconnectMode,y.reason)||this.reconnectMode,O=await this.reconnectWithAction(R);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!O)return a.reject(new _e(K.WS_DISCONNECT,"websocket reconnect failed: ".concat(y.code))),this.close(!0);a.resolve()}},d=y=>{this.emit(St.ON_MESSAGE,y)},p=y=>{N.warn("[".concat(this.connectionID,"] ws open error ").concat(y))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=$("GATEWAY_WSS_ADDRESS")),N.debug("[".concat(this.name,"] start connect, url:"),t);const g=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=JN(t);const y=await this.chooseBestWebsocketConnection(t);this.websocket=y,c&&c(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=d,this.websocket.onerror=p,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(y){const b=this.state==="closed",R=y instanceof _e,O=R&&y.code===K.WS_ABORT,V=R&&y.code===K.WS_ERR,k=R?y.message:y&&(y.reason||y.toString());N.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(k)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[y]},g),b||V?(a.reject(b?new _e(K.WS_DISCONNECT,"websocket is closed: ".concat(k)):new _e(K.WS_ERR,"init websocket failed: ".concat(k))),V&&N.error("[".concat(this.name,"] init websocket failed: ").concat(k))):l&&l(y)}return a.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;N.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||nn.isOnline||!nn.onlineWaiter||(this.onlineReconnectListener=nn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,r){const d=cN(this.reconnectCount,this.retryConfig);N.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await Ge.race([Kn(d),this.onlineReconnectListener||new Ge(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(d,p)=>{this.emit(St.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(d)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);N.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(N.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ei(this,St.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(d){var l;N.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));const p=d==null||(l=d.data)===null||l===void 0?void 0:l.desc;return Array.isArray(p)&&Ve(p).call(p,"dynamic key expired")?(this.emit(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class QN extends l6{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const a=Dy(),c=function(d,p){return new fce(d,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new _e(K.WS_ABORT,"choose best websocket aborted"))};const l=$("GATEWAY_DOMAINS");return N.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Yy extends l6{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new Ge((a,c)=>{let l=!1;const d=[];this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),d.forEach(V=>{V.onclose=null,V.onopen=null,V.onmessage=null,V.close()}),c(new _e(K.WS_ABORT,"choose best websocket aborted"))};const p=$("GATEWAY_DOMAINS");let g;const v=t.indexOf("?h="),y=p.find(V=>v!==-1?Ve(t).call(t,V,v):Ve(t).call(t,V));N.debug("[choose-best-ws] currentDomain: ",y,", domains: ",p);let b=!this.tryDoubleDomain||!y;if(!b&&y){var R;const V=Date.now();try{p.forEach(k=>{const L=v===-1?t.replace(y,k):t.substr(0,v)+t.substr(v).replace(y,k),H=new WebSocket(L);H.binaryType="arraybuffer",d.push(H),N.debug("[choose-best-ws] ws is connecting:",H.url)})}catch{for(N.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(L=>L.close());d.length;)d.pop();b=!0}(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:d.map(k=>k.url),service:"gateway"},r),d.forEach(k=>{k.onopen=()=>{if(l)return;const L=Date.now()-V;N.debug("[choose-best-ws] ws open cost ".concat(L,"ms")),d.filter(H=>H!==k).forEach(H=>{N.debug("[choose-best-ws]close backup websocket: ".concat(H.url)),H.close()}),l=!0,a(k)},k.onclose=L=>{g=L,!l&&(d.find(H=>!(H.readyState===WebSocket.CLOSED||H.readyState===WebSocket.CLOSING))||(N.debug("[choose-best-ws] all websocket is closed"),l=!0,c(g)))},k.onmessage=L=>{N.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(L.data))}}),Kn(this.forceCloseTimeout).then(()=>{d.forEach(k=>{k.readyState!==WebSocket.OPEN&&k.close()})})}if(b){var O;let V;N.debug("[choose-best-ws] use single url: ",t),(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:[t],service:"gateway"},r);try{V=new WebSocket(t),d.push(V),V.binaryType="arraybuffer"}catch(k){const L=new _e(K.WS_ERR,"init websocket failed! Error: ".concat(k.toString()));return N.error("[".concat(this.name,"]").concat(L)),void c(L)}V.onopen=()=>{a(V)},V.onclose=k=>{c(k)},V.onmessage=k=>{N.debug("[choose-best-ws]".concat(V.url," onmessage: ").concat(k.data))},Kn(this.forceCloseTimeout).then(()=>{V&&V.readyState!==WebSocket.OPEN&&V.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class mce extends kr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===yr.CONNECTED?this.emit(ft.WS_CONNECTED):t===yr.RECONNECTING?this.emit(ft.WS_RECONNECTING,this._websocketReconnectReason):t===yr.CLOSED&&this.emit(ft.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),G(this,"_disconnectedReason",void 0),G(this,"_websocketReconnectReason",void 0),G(this,"_connectionState",yr.CLOSED),G(this,"reconnectToken",void 0),G(this,"websocket",void 0),G(this,"openConnectionTime",void 0),G(this,"clientId",void 0),G(this,"lastMsgTime",Date.now()),G(this,"uploadCache",[]),G(this,"uploadCacheInterval",void 0),G(this,"rttRolling",new E3(5)),G(this,"pingpongTimer",void 0),G(this,"wsInflateDataTimer",void 0),G(this,"pingpongTimeoutCount",0),G(this,"joinResponse",void 0),G(this,"multiIpOption",void 0),G(this,"initError",void 0),G(this,"spec",void 0),G(this,"store",void 0),G(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ft.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const l="res-@".concat(c._id);this.emit(l,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===kt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===kt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(tr.UID_BANNED);break;case 15:this.close(tr.IP_BANNED);break;case 16:this.close(tr.CHANNEL_BANNED)}if(c._type===kt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case ct.ERR_LICENSE_MISSING:this.close(tr.LICENSE_MISSING);break;case ct.ERR_LICENSE_EXPIRED:this.close(tr.LICENSE_EXPIRED);break;case ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tr.LICENSE_MINUTES_EXCEEDED);break;case ct.ERR_LICENSE_PERIOD_INVALID:this.close(tr.LICENSE_PERIOD_INVALID);break;case ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tr.LICENSE_MULTIPLE_SDK_SERVICE);break;case ct.ERR_LICENSE_ILLEGAL:this.close(tr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new QN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yr.CONNECTED&&this.reconnect("retry",Zn.OFFLINE)})}async request(t,r,a,c){const l=gr(6,""),d={_id:l,_type:t,_message:r},p=this.websocket.connectionID,g=()=>new Ge((V,k)=>{if(this.connectionState===yr.CONNECTED)return V();const L=()=>{this.off(ft.WS_CLOSED,H),V()},H=()=>{this.off(ft.WS_CONNECTED,L),k(new he(K.WS_ABORT))};this.once(ft.WS_CONNECTED,L),this.once(ft.WS_CLOSED,H),t!==ht.PUBLISH&&t!==ht.PUBLISH_DATASTREAM&&t!==ht.SUBSCRIBE&&t!==ht.SUBSCRIBE_DATASTREAM&&t!==ht.UNSUBSCRIBE&&t!==ht.UNSUBSCRIBE_DATASTREAM&&t!==ht.UNPUBLISH&&t!==ht.UNPUBLISH_DATASTREAM&&t!==ht.CONTROL&&t!==ht.RESTART_ICE||this.once(ft.DISCONNECT_P2P,()=>{k(new he(K.DISCONNECT_P2P))}),t!==ht.PUBLISH&&t!==ht.RESTART_ICE||this.once(ft.ABORT_P2P_EXECUTION,()=>{k(new he(K.DISCONNECT_P2P))})});if(this.connectionState!==yr.CONNECTING&&this.connectionState!==yr.RECONNECTING||t===ht.JOIN||t===ht.REJOIN||await g(),this.websocket.sendMessage(d,!0),c)return;const v=new Ge((V,k)=>{let L=!1;const H=(te,oe)=>{L=!0,V({isSuccess:te==="success",message:oe||{}}),this.off(ft.WS_CLOSED,q),this.off(ft.WS_RECONNECTING,q),this.emit(ft.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(l),H);const q=()=>{k(new he(K.WS_ABORT,"type: ".concat(t))),this.off(ft.WS_CLOSED,q),this.off(ft.WS_RECONNECTING,q),this.off("res-@".concat(l),H)};this.once(ft.WS_CLOSED,q),this.once(ft.WS_RECONNECTING,q),Kn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||L||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ft.REQUEST_TIMEOUT,t,r))})});let y=null;try{y=await v}catch(V){if(this.connectionState===yr.CLOSED||t===ht.LEAVE)throw new he(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?V.throw():t===ht.JOIN||t===ht.REJOIN?null:(await g(),await this.request(t,r))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),R=$y(b),O=new he(K.UNEXPECTED_RESPONSE,"".concat(R.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:R.desc});return R.action==="success"?y.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(R.desc,", action: ").concat(R.action)),b===ct.ERR_TOO_MANY_BROADCASTERS?((t===ht.JOIN||t===ht.REJOIN)&&(this.initError=O,this.close()),O.throw()):R.action==="failed"?O.throw():R.action==="quit"?(this.initError=O,this.close(),O.throw()):(b===ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Zn.MULTI_IP)):this.reconnect(R.action,Zn.SERVER_ERROR),t===ht.JOIN||t===ht.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Ge(a=>{const c=l=>{(!r||r(l))&&(this.off(t,c),a(l))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ky.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const l=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yr.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const a={_type:t,_message:r};this.websocket.sendMessage(a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ge((r,a)=>{this.once(ft.WS_CONNECTED,()=>r(this.joinResponse)),this.once(ft.WS_CLOSED,c=>a(this.initError||new he(K.WS_ABORT,c))),this.connectionState=yr.CONNECTING,this.websocket.init(t).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||tr.LEAVE,this.connectionState=yr.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ft.ABORT_P2P_EXECUTION);const t=await ei(this,ft.REQUEST_JOIN_INFO),r=await this.request(ht.JOIN,t);if(!r)return this.emit(ft.REPORT_JOIN_GATEWAY,iw.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(ft.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new he(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=jy(this,ft.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(ht.REJOIN,t);return!!r&&(this.connectionState=yr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(a=>{this.emit(kt.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(kt.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(kt.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(kt.MUTE_AUDIO,{uid:a.uid}):this.emit(kt.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(kt.MUTE_VIDEO,{uid:a.uid}):this.emit(kt.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(kt.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(kt.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(kt.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(kt.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(kt.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const r=$y(t.code);if(t.code===28&&"detail"in t&&(N.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ft.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tr.UID_BANNED),void this.close()):void this.reconnect(r.action,Zn.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=$("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Zn.TIMEOUT):this.request(ht.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),$("REPORT_STATS")&&this.send(ht.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(Ky.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(St.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ft.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(St.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(St.CLOSED,()=>{this.connectionState=yr.CLOSED}),this.websocket.on(St.FAILED,()=>{this._disconnectedReason=tr.NETWORK_ERROR,this.connectionState=yr.CLOSED}),this.websocket.on(St.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===yr.CONNECTED?this.connectionState=yr.RECONNECTING:this.connectionState=yr.CONNECTING}),this.websocket.on(St.WILL_RECONNECT,(t,r,a)=>{const c=jy(this,ft.IS_P2P_DISCONNECTED),l=c||t!=="retry";c&&t==="retry"&&(N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=iw.P2P_DISCONNECTED),l&&(N.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ft.REPORT_JOIN_GATEWAY,r||iw.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ft.DISCONNECT_P2P)),a(t)}),this.websocket.on(St.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Zn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ft.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof he){if(t.code===K.UNEXPECTED_RESPONSE&&t.data.code===ct.ERR_NO_AUTHORIZED)return this.initError=new he(K.TOKEN_EXPIRE,"dynamic key expired"),void this.close(tr.TOKEN_EXPIRE);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Zn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(St.REQUEST_NEW_URLS,(t,r)=>{ei(this,ft.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(o6.PRE_CONNECT_PC,()=>{this.emit(ft.PRE_CONNECT_PC)})}}let gce=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),an=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function u6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function ow(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function Sd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat($("TURN_DOMAIN")):(N.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function ZN(e,t){e.addresses||(e.addresses=[]);const r=function(p,g){if($("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(b=>{let{ip:R,port:O}=b;return{address:"".concat(R,":").concat(O)}});const v=$("GATEWAY_DOMAINS");let y=v[1]&&Ve(g).call(g,v[1])?1:0;return p.map(b=>{let{domain_prefix:R,port:O,ip:V}=b;if(R)return{address:"".concat(R,".").concat(v[y++%v.length],":").concat(O)};const k=/^[\.\:\d]+$/.test(V),L=k?"".concat(V.replace(/[^\d]/g,"-"),".").concat(v[y++%v.length],":").concat(O):"".concat(V,":").concat(O);return k||N.debug("Cannot recognized as ip address: ".concat(V,", use as host")),{ip:V,port:O,address:L}})}(e.addresses,t),a=Array.isArray(e.detail)&&e.detail[18];if(a&&typeof a=="string"){const p=a.split(";");for(let g=0;g<p.length;g++){var c;const v=Ti(c=p[g]).call(c);r[g]&&v&&(r[g].ip6=v)}}const l=e.detail&&e.detail.candidate;let d;if(l){const[p,g]=l.split(":");p&&g&&(d={port:Number(g),ip:p,address:"".concat(p,":").concat(g)})}return{gatewayAddrs:r,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Pa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function d6(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(Pa(t.width),"x").concat(Pa(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function h6(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Xy(e,t){let r,a,c;switch(t){case an.CHOOSE_SERVER:a=4096,c="choose server";break;case an.CLOUD_PROXY:a=1048576,c="proxy";break;case an.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case an.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new he(K.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===a&&(r={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(d=>ow(ow({},d),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:ow(ow({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!r)throw new he(K.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function p6(e,t){return await Ge.all(e.addresses.map(async r=>({address:$("USE_TURN_IP")?r.ip:Sd(r.ip),tcpport:r.port,udpport:r.port,username:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ti.username,password:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await nN(t.toString()):ti.password})))}function eP(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),a=t.videoHeight||r.height,c=t.videoWidth||r.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Pa(e.height),Pa(e.width)),1):(N.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function bd(e){let{candidateType:t,relayProtocol:r,type:a,address:c,port:l,protocol:d}=e;const p={candidateType:t,relayProtocol:r,protocol:d};if(a!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),p.address=g.join("."),p.port=l}return p}function sw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$("SVC_MODE");if($("ENABLE_SVC"))return function(t){return t in UT}(e)?e:UT.L1T3}const f6={[$e.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[$e.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function cw(e,t,r){t.forEach(a=>{var c;const l=f6[e].find(p=>{var g;let{key:v}=p;return Ve(g=a.extensionName).call(g,v)});if(!l)return;const d=r.find(p=>{let{extensionName:g}=p;return Ve(g).call(g,l.key)});d&&Ve(c=d.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=d.extensionName)})}function Qm(e,t){t.forEach(r=>{var a;const c=f6[e].find(l=>{var d;let{key:p}=l;return Ve(d=r.extensionName).call(d,p)});Ve(a=r.extensionName).call(a,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)})}function m6(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ve(e).call(e,"abs-send-time")}function lw(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ve(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function g6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function _6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function Jy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:l,filterAudioFec:d,filterAudioCodec:p,filterVideoCodec:g}=t,{useXR:v}=r;let y=[],b=[],R=[],O=[],V=!1,k=!1;if(pa(e).mediaDescriptions.forEach(H=>{a&&a!==H.attributes.direction||(H.media.mediaType!=="video"||V||(b=H.attributes.payloads,O=H.attributes.extmaps,V=!0),H.media.mediaType!=="audio"||k||(y=H.attributes.payloads,R=H.attributes.extmaps,k=!0))}),!O||b.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!R||y.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(b.forEach(H=>{var q;(q=H.rtpMap)!==null&&q!==void 0&&q.clockRate&&(H.rtpMap.clockRate=parseInt(H.rtpMap.clockRate)),v&&H.rtcpFeedbacks.push({type:"rrtr"})}),y.forEach(H=>{var q;(q=H.rtpMap)!==null&&q!==void 0&&q.clockRate&&(H.rtpMap.clockRate=parseInt(H.rtpMap.clockRate)),v&&H.rtcpFeedbacks.push({type:"rrtr"})}),c&&(y=y.filter(H=>{var q;return((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"}),b=b.filter(H=>{var q;return((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"})),l&&(b=b.filter(H=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),d&&(y=y.filter(H=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(y=y.filter(H=>{var q;return Ve(p).call(p,((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const H=b.filter(q=>{var te;return Ve(g).call(g,((te=q.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())||"")});b=H.concat(c?[]:nP(H,b))}const L=$("UNSUPPORTED_VIDEO_CODEC");return L&&L.length>0&&(b=b.filter(H=>!(H.rtpMap&&Ve(L).call(L,H.rtpMap.encodingName.toLowerCase())))),{audioCodecs:y,videoCodecs:b,audioExtensions:R,videoExtensions:O}}function Td(e){const t=pa(e);let r,a;for(const c of t.mediaDescriptions){if(!r){const l=c.attributes.iceUfrag,d=c.attributes.icePwd;if(!l||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:l,icePwd:d}}if(!a){const l=c.attributes.fingerprints;l.length>0&&(a={fingerprints:l})}}if(!a&&t.attributes.fingerprints.length>0&&(a={fingerprints:t.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function v6(e,t){const r=[],a=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),c=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),l=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(d=>{var p;const g=(p=a.find(v=>v.ssrcIds[0]===d))===null||p===void 0?void 0:p.ssrcIds[1];r.push({ssrcId:d,rtx:t?g:void 0})});else if(a.length>0){const d=a[0].ssrcIds[0],p=a[0].ssrcIds[1];r.push({ssrcId:d,rtx:t?p:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:l[0].ssrcId})}return r}function y6(e,t,r){const{cname:a}=e;let c=[];t&&(c=E6(t)),c.length===0&&(c=e.iceParameters.candidates.map(y=>({foundation:y.foundation,componentId:"1",transport:y.protocol,priority:y.priority.toString(),connectionAddress:y.ip,port:y.port.toString(),type:y.type,extension:{}})),N.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(y=>({hashFunction:y.algorithm,fingerprint:y.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}const g=dw(e.rtpCapabilities),v=[];return Array.isArray(r)&&r.length>0&&r.forEach(y=>{v.push({kind:$e.VIDEO,ssrcId:y.v,rtx:y.v_rtx,mslabel:"".concat(y.v,"_").concat(y.a)},{kind:$e.AUDIO,ssrcId:y.a,mslabel:"".concat(y.v,"_").concat(y.a)})}),{dtlsParameters:l,iceParameters:d,candidates:c,rtpCapabilities:g,setup:p,cname:a,preSSRCs:v}}function E6(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],N.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),N.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function fp(e,t,r){const a=[],c=[];return e.forEach(l=>{let{ssrcId:d,rtx:p}=l;const g=gr(8,"track-"),v={ssrcId:d,attributes:_6({label:g,mslabel:r=r||gr(10,""),msid:"".concat(r," ").concat(g)},t&&{cname:t})};if(a.push(v),p!==void 0){const y={ssrcId:p,attributes:_6({label:g,mslabel:r,msid:"".concat(r," ").concat(g)},t&&{cname:t})};a.push(y),c.push({semantic:"FID",ssrcIds:[d,p]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:d}=l;return d})}),{ssrcs:a,ssrcGroups:c}}function Zm(e,t){t instanceof Gr&&e.attributes.payloads.forEach(r=>{var a;const c=(a=r.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof $("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=$("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(l.bitrate&&!Vr()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof Hy&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function tP(e){const t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function rP(e,t){var r;if(!(t instanceof Tr&&t._encoderConfig&&t._hints.indexOf(dr.SCREEN_TRACK)===-1))return;const a=t._encoderConfig;qt().supportMinBitrate&&a.bitrateMin&&e.attributes.payloads.forEach(c=>{var l,d;Ve(l=["h264","h265","vp8","vp9","av1"]).call(l,((d=c.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),qt().supportMinBitrate&&!Ve(r=t._hints).call(r,dr.LOW_STREAM)&&a.bitrateMax&&e.attributes.payloads.forEach(c=>{var l,d;Ve(l=["h264","h265","vp8","vp9","av1"]).call(l,((d=c.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat($("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function S6(e){if(e.media.mediaType!=="video")return;const t=Ht();if(t.name!==Xt.SAFARI&&t.os!==On.IOS)return;const r=e.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function uw(e,t,r){if(!t)return;let a,c;if(e.media.mediaType==="video"?(a=r.videoExtensions,c=r.videoCodecs):(a=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){const l=a.find(d=>lw(d.extensionName));if(l){const d=l.extensionName;e.attributes.extmaps.find(g=>lw(g.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:d}),function(g,v){return v.filter(y=>!!g.find(b=>b.payloadType===y.payloadType&&!!b.rtcpFeedbacks.find(R=>R.type==="transport-cc")))}(c,e.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(d=>lw(d.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(d=>{const p=d.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");p!==-1&&d.rtcpFeedbacks.splice(p,1)})}if(t.remb===!0){const l=a.find(d=>m6(d.extensionName));if(l){const d=l.extensionName;e.attributes.extmaps.find(g=>g.extensionName===d)||e.attributes.extmaps.push({entry:l.entry,extensionName:d}),function(g,v){return v.filter(y=>!!g.find(b=>b.payloadType===y.payloadType&&!!b.rtcpFeedbacks.find(R=>R.type==="goog-remb")))}(c,e.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(d=>m6(d.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(d=>{const p=d.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");p!==-1&&d.rtcpFeedbacks.splice(p,1)})}}function b6(e,t,r){if(Vr()||e.media.mediaType!=="video"||!(t instanceof Tr)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!$("SIMULCAST")||r==="vp9"&&$("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const a=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===c.ssrcId),d={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<a;p++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:Lr(c.attributes)}),d.ssrcIds.push(c.ssrcId+p),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+p,attributes:Lr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,l.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(d)}async function T6(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(await r.createOffer()).sdp,{send:c,recv:l,sendrecv:d}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const y=Jy(v,p,g,"sendonly"),b=Jy(v,p,g,"recvonly"),R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ss(y,b,"videoExtensions",R,O,V),ss(y,b,"videoCodecs",R,O,V),ss(y,b,"audioExtensions",R,O,V),ss(y,b,"audioCodecs",R,O,V),$("RAISE_H264_BASELINE_PRIORITY")){const k=[],L=[];V.videoCodecs.forEach((H,q)=>{var te;if(((te=H.rtpMap)===null||te===void 0?void 0:te.encodingName.toLocaleLowerCase())==="h264"){var oe,se;const ae=V.videoCodecs[q+1],pe=ae&&O6(H,ae),Te=(oe=H.fmtp)===null||oe===void 0?void 0:oe.parameters["profile-level-id"],Fe=(se=H.fmtp)===null||se===void 0?void 0:se.parameters["packetization-mode"];!Te||Te!==$("FIRST_H264_PROFILE_LEVEL_ID")||$("FIRST_PACKETIZATION_MODE")&&Fe!==$("FIRST_PACKETIZATION_MODE")?pe?L.push([H,ae]):L.push([H]):pe?k.push([H,ae]):k.push([H])}}),k.length>0&&L.length>0&&(N.debug("raising H264 baseline profile priority"),V.videoCodecs.forEach((H,q)=>{var te;if(((te=H.rtpMap)===null||te===void 0?void 0:te.encodingName.toLocaleLowerCase())==="h264"){const oe=O6(H,V.videoCodecs[q+1]),se=k.shift()||L.shift()||[];se.length>0&&(oe?V.videoCodecs.splice(q,2,...se):V.videoCodecs.splice(q,1,...se))}}),O.videoCodecs=O.videoCodecs.filter(H=>{var q,te;return!(((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((te=H.fmtp)===null||te===void 0?void 0:te.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID"))}),$("FILTER_SEND_H264_BASELINE")&&(R.videoCodecs=R.videoCodecs.filter(H=>{var q,te;return!(((q=H.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((te=H.fmtp)===null||te===void 0?void 0:te.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:R,recv:O,sendrecv:V}}(e,t,a);try{r.close()}catch{}return{send:c,recv:l,sendrecv:d}}function w6(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Jy(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ss(e,t,"videoExtensions",r,a,c),ss(e,t,"videoCodecs",r,a,c),ss(e,t,"audioExtensions",r,a,c),ss(e,t,"audioCodecs",r,a,c),$("RAISE_H264_BASELINE_PRIORITY")){const l=c.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const d=c.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<l){N.debug("raising H264 baseline profile priority");const p=c.videoCodecs[l];c.videoCodecs.splice(l,1),c.videoCodecs.splice(d,0,p)}d!==-1&&(a.videoCodecs=a.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:a,sendrecv:c}}function ss(e,t,r,a,c,l){if(r==="videoExtensions"||r==="audioExtensions"){const d=[];return e[r].forEach(p=>{t[r].some((g,v)=>{if(p.entry===g.entry&&p.extensionName===g.extensionName)return d.push(v),!0})?l[r].push(p):a[r].push(p)}),void t[r].forEach((p,g)=>{d.indexOf(g)===-1&&c[r].push(p)})}if(r==="videoCodecs"||r==="audioCodecs"){const d=[];return e[r].forEach(p=>{t[r].some((g,v)=>{if(p.payloadType===g.payloadType&&JSON.stringify(p)===JSON.stringify(g))return d.push(v),!0})?l[r].push(p):a[r].push(p)}),void t[r].forEach((p,g)=>{d.indexOf(g)===-1&&c[r].push(p)})}}function dw(e){const{send:t,recv:r,sendrecv:a}=e;if(!a){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,l;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...a.audioCodecs],c.videoCodecs=[...t.videoCodecs,...a.videoCodecs],c.audioExtensions=[...t.audioExtensions,...a.audioExtensions],c.videoExtensions=[...t.videoExtensions,...a.videoExtensions]):c=a,r?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...r.audioCodecs,...a.audioCodecs],l.videoCodecs=[...r.videoCodecs,...a.videoCodecs],l.audioExtensions=[...r.audioExtensions,...a.audioExtensions],l.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):l=a,{send:c,recv:l}}function eg(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Qy(e,t,r,a){let c=[];if(e===$e.VIDEO){if($("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=t.videoCodecs.filter(l=>{var d;return Ve(d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(d,a)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===$("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let l=[];const d=[],p=[],g=[];if(r.videoCodecs.forEach(v=>{const y=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";Ve(y).call(y,a)?l.push(v):Ve(y).call(y,"vp9")?d.push(v):Ve(y).call(y,"vp8")?p.push(v):Ve(y).call(y,"h264")&&g.push(v)}),l.length===0){let v="";d.length!==0?(l=d,v="vp9"):p.length!==0?(l=p,v="vp8"):g.length!==0&&(l=g,v="h264"),N.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}l.length!==0&&(c=t.videoCodecs.filter(v=>l.some(y=>y.payloadType===v.payloadType)))}if(c.length===0&&(N.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),$("USE_PUB_RTX")||$("USE_SUB_RTX")){const l=nP(c,t.videoCodecs);c=[...c,...l]}}else{c=t.audioCodecs.filter(d=>{var p;return Ve(p=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(p,a)});const l=t.audioCodecs.filter(d=>{var p;return Ve(p=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(p,"red")});c.length===0&&(N.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(d=>{var p;return Ve(p=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")})),$("ENABLE_AUDIO_RED")&&l.length!==0&&(c=[...l,...c])}return c}function nP(e,t){const r=e.map(a=>a.payloadType.toString());return t.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&Ve(r).call(r,a.fmtp&&a.fmtp.parameters.apt))}async function Zy(e,t,r){const a=t.toString(),c=C6(a,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:a});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let d=l.sdp;d=R6(d,r||{}),c==null||c(d||""),await e.setLocalDescription({type:"answer",sdp:d})}function R6(e,t,r){const a=pa(e),{useXR:c}=t;return a.mediaDescriptions.forEach(l=>{var d;l.attributes.mid&&(Array.isArray(r)&&!Ve(r).call(r,l.attributes.mid)||(l.media.mediaType==="audio"&&eg(l),c&&Ve(d=["audio","video"]).call(d,l.media.mediaType)&&l.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),vd(a)}function C6(e,t,r,a){if($("SDP_LOGGING"))return N.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(a,`
`),e),t==="offer"?c=>{C6(c,"answer",r==="local"?"remote":"local",a)}:void 0}function A6(e){const t=$("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>Ve(e).call(e,r))}function O6(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function I6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Da(e,t){return typeof $(e)===t?$(e):void 0}function _ce(){try{const e=$("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?I6(Object(a),!0).forEach(function(c){G(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):I6(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e)}catch(e){return N.debug("handle gateway attributes failed: ",e),{}}}const N6={};function wd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&N.debug("install service ".concat(e.name)),N6[e.name]=e}function $l(e){const t=N6[e];if(!t)throw new _e(K.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function P6(e,t){return $l("DataStream").create(e,t)}function hw(){return $l("InterceptFrame").create()}function D6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function $c(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const iP=new Map;class vce extends kr{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Mn.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Mn.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){N.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var a,c,l;super(),G(this,"store",void 0),G(this,"joinInfo",void 0),G(this,"key",void 0),G(this,"ntpOffset",0),G(this,"signal",void 0),G(this,"role",void 0),G(this,"inChannelInfo",{joinAt:null,duration:0}),G(this,"spec",void 0),G(this,"_state","DISCONNECTED"),G(this,"_statsCollector",void 0),G(this,"_disconnectedReason",void 0),G(this,"isSignalRecover",!1),G(this,"hasChangeBGPAddress",!1),G(this,"trafficStatsInterval",void 0),G(this,"networkQualityInterval",void 0),G(this,"_joinGatewayStartTime",0),G(this,"_signalTimeout",!1),G(this,"_clientRoleOptions",void 0),G(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(a={spec:$c($c({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(l=$l("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(l,a)):new mce($c($c({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,a){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let l=iP.get(t.cname);if(l||(l=new Map,iP.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const v=new he(K.UID_CONFLICT);throw Ze.joinGateway(t.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),v}l.set(t.uid,!0),this.joinInfo=t,this.key=r;let d=0;this.joinGatewayStartTime=c;const p=t.proxyServer;try{N.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(d));const v=t.gatewayAddrs.map(y=>{let{address:b}=y;const[R,O]=b.split(":"),V={host:R,port:O};return t.proxyServer&&(V.proxy=t.proxyServer),V});d=(await this.signal.init(v)).uid,N.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var g;throw N.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Ze.joinGateway(t.sid,{lts:c,succ:!1,ec:((g=v.data)===null||g===void 0?void 0:g.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!p,signalChannel:"0",preload:t.preload}),l.delete(t.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),N.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{N.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Mn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Mn.NETWORK_QUALITY,{uplinkNetworkQuality:h6(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:h6(this._statsCollector.trafficStats.B_dnq)}):this.emit(Mn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==tr.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==yr.CONNECTED||await function(a,c){return c===1/0?a:Ge.race([a,Woe(c)])}(this.signal.request(ht.LEAVE,void 0,!0),3e3)}catch(a){N.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(r),r!==tr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:$("PUB_EXTEND"),twcc:!!$("PUBLISH_TWCC"),rtx:!!$("USE_PUB_RTX")};try{return(await this.signal.request(ht.PUBLISH,c,!0))._message}catch(l){if(a&&l.data&&l.data.code===ct.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw l}}async publishDataChannel(t,r,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(ht.PUBLISH_DATASTREAM,l,!0)}catch(d){if(a&&d.data&&d.data.code===ct.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw d}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ht.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(a){N.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ge.all(t.map(r=>this.signal.request(ht.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){N.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX")||void 0,extend:$("SUB_EXTEND"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(ht.PRE_SUBSCRIBE,c,!0)}catch(l){if(a&&l.data&&l.data.code===ct.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,r,!1);throw l}}async subscribe(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX"),extend:$("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return(await this.signal.request(ht.SUBSCRIBE,c,!0))._message}catch(l){if(a&&l.data&&l.data.code===ct.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw l}}async subscribeDataChannel(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(ht.SUBSCRIBE_DATASTREAM,c,!0)}catch(l){if(a&&l.data&&l.data.code===ct.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw l}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!$("USE_SUB_RTX"),twcc:!!$("SUBSCRIBE_TWCC"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(ht.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(r&&c.data&&c.data.code===ct.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){const r=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,l=a.width,d=a.height,p=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(p=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(p=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,c||(p=!1)),p?{stream_type:0,width:l,height:d,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(t);if(r)return this.signal.request(ht.SET_VIDEO_PROFILE,r);N.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(ht.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(a){N.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ge.all(t.map(a=>this.signal.request(ht.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:r},!0)))}catch(a){N.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(t){try{await this.signal.request(ht.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){N.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:a,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(ht.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ht.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ht.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),$("CLIENT_ROLE_OPTIONS")&&(N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),$("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS")),N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let a,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(ht.SET_CLIENT_ROLE,{role:t,level:c,delay:a,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(ht.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ht.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(ht.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(ht.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ht.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),$c({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ht.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=iP.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:ti.username,password:ti.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push($c($c({},ti),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ht.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===r.peer_uid);a&&a.B_st!==r.B_st&&xT(()=>{this.emit(Mn.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r;if(!this.joinInfo||!this.key)throw new he(K.UNEXPECTED_ERROR,"can not generate join message, no join info");const a=Object.assign({},this.joinInfo.apResponse);let c=$("REPORT_APP_SCENARIO");if(typeof c!="string")try{c=JSON.stringify(c)}catch{c=void 0}var l;c&&c.length>128&&(c=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Mn.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,Ve(zm).call(zm,l)||zm.push(l);const d=!(Vr()||YB(87)||j3())&&typeof $("ENABLE_PRE_SUB")=="boolean"&&$("ENABLE_PRE_SUB"),p=!j3()&&Da("ENABLE_PREALLOC_PC","boolean"),g=_ce(),v=xy(87)||function(){const b=Ht();if(b.name!==Xt.SAFARI||!b.browserVersion)return!1;const R=b.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),y=$c({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:bo,browser:navigator.userAgent,process_id:$("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:a,extend:$("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:c,attributes:{userAttributes:$c($c({enableEncodedTransform:!!$("ENABLE_AUDIO_METADATA")&&v||!!$("ENABLE_AUDIO_TOPN")&&YI(Xt.CHROME,87,116)||void 0,enableAudioMetadata:!!$("ENABLE_AUDIO_METADATA")&&v,enableAudioPts:!!$("ENABLE_AUDIO_PTS_METADATA")&&v,topnSmoothLevel:$("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:$("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:$("TOPN_SWITCH_HOLD_MS"),topnAudioGain:$("TOPN_AUDIO_GAIN"),enablePublishedUserList:$("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Da("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Da("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Da("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:$("USE_PUB_RTX")===!0||$("USE_SUB_RTX")===!0||void 0,disableFEC:$("DISABLE_FEC"),enableNTPReport:!!$("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!$("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!$("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Da("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!$("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Da("USE_XR","boolean"),enableLossbasedBwe:Da("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!$("ENABLE_AUT_CC")||void 0,enableCCFallback:Da("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:p,preSubNum:d?Da("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Da("PUBLISH_TWCC","boolean"),enableSubTWCC:Da("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Da("USE_PUB_RTX","boolean"),enableSubRTX:Da("USE_SUB_RTX","boolean"),enableSubSVC:$("ENABLE_SVC")?$("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0,enableSvcExtended:$("ENABLE_SVC")&&Array.isArray($("SVC_EXTENDED"))&&$("SVC_EXTENDED").length!==0?$("SVC_EXTENDED"):void 0},g),{},{audioDuplicate:Da("ENABLE_AUDIO_RED","boolean")?(r=Da("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,$("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),a.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=a.addresses[this.signal.websocket.currentURLIndex].ticket,delete a.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new he(K.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ft.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ft.WS_RECONNECTING,t=>{this.joinInfo&&Ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Zn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ze.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ft.WS_CLOSED,t=>{let r;switch(t){case tr.LEAVE:r=Zn.LEAVE;break;case tr.UID_BANNED:case tr.IP_BANNED:case tr.CHANNEL_BANNED:case tr.SERVER_ERROR:r=Zn.SERVER_ERROR;break;case tr.FALLBACK:r=Zn.FALLBACK;break;case tr.LICENSE_MISSING:case tr.LICENSE_EXPIRED:case tr.LICENSE_MINUTES_EXCEEDED:case tr.LICENSE_PERIOD_INVALID:case tr.LICENSE_MULTIPLE_SDK_SERVICE:case tr.LICENSE_ILLEGAL:case tr.TOKEN_EXPIRE:r=t;break;default:r=Zn.NETWORK_ERROR}N.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+Zn.NETWORK_ERROR)),this.joinInfo&&Ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===tr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==tr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ft.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=$("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(N.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void N.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));sr("EVENT_REPORT_DOMAIN",t[1]),sr("EVENT_REPORT_BACKUP_DOMAIN",t[1]),sr("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(kt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ft.REQUEST_RECOVER,(t,r,a)=>{if(!this.joinInfo)return a(new he(K.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ei(this,Mn.REQUEST_NEW_GATEWAY_LIST).then(r).catch(a)}),this.signal.on(ft.REQUEST_JOIN_INFO,async(t,r,a)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const l=Lr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if($("NEW_TURN_MODE")&&l){let v=l.servers,y=l.serversFromGateway;const b=this.signal.currentURLIndex;v.length>0&&(v=[v[b%v.length]],l.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],l.serversFromGateway=y),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(b))}const{iceParameters:d,dtlsParameters:p,rtpCapabilities:g}=await ei(this,Mn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l});try{t(this.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:p,rtpCapabilities:g,version:"2"}}))}catch(v){r(v)}}),this.signal.on(ft.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ft.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let a,c="";var l;t instanceof he?(a=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,c=t.message):a=t,Ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ft.IS_P2P_DISCONNECTED,t=>{t(jy(this,Mn.IS_P2P_DISCONNECTED))}),this.signal.on(ft.DISCONNECT_P2P,()=>{this.emit(Mn.DISCONNECT_P2P)}),this.signal.on(ft.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ft.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ft.JOIN_RESPONSE,t=>{const r=this.getCurrentGatewayAddress();this.emit(Mn.JOIN_RESPONSE,t,r)}),this.signal.on(ft.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),r=$("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&r){const a=E6(t);this.emit(Mn.PRE_CONNECT_PC,{candidates:a,fingerprint:r})}}}),this.signal.on(ft.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof $("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat($("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(ht.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(a){throw N.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(ht.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(a){throw N.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(ht.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(a){throw N.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(ht.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(a){throw N.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(t){const r={users:t.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(ht.UNSUBSCRIBE_STREAMS,r,!0)}catch(a){throw N.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(t,r){const a={action:t.find(c=>c.stream_type===nr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){const a={action:t.find(c=>c.stream_type===nr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){const a={action:t===$e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){const a={action:t===$e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ht.RESTART_ICE,r,!0)}catch(a){throw N.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||Zn.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!$("GATEWAY_WSS_ADDRESS"))return $("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(N.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ht.SET_PARAMETER,{enablePublishAudioFilter:t})}}let pw=0,aP=0;function Ys(e,t,r,a){return new Ge((c,l)=>{t.timeout=t.timeout||$("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),pw+=Wc(t.data)):r&&(t.data.size?pw+=t.data.size:t.data instanceof FormData?pw+=p3(t.data):pw+=Wc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ji.request(t).then(d=>{typeof d.data=="string"?aP+=Wc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?aP+=d.data.byteLength:aP+=Wc(JSON.stringify(d.data)),a&&c({data:d.data,headers:d.headers}),c(d.data)}).catch(d=>{Ji.isCancel(d)?l(new he(K.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?l(new he(K.NETWORK_TIMEOUT,d.message)):d.response?l(new he(K.NETWORK_RESPONSE_ERROR,d.response.status)):l(new he(K.NETWORK_ERROR,d.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(we){var Le=0;return function(){return Le<we.length?{done:!1,value:we[Le++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(we,Le,Xe){return we==Array.prototype||we==Object.prototype||(we[Le]=Xe.value),we},a,c=function(we){we=[typeof globalThis=="object"&&globalThis,we,typeof window=="object"&&window,typeof self=="object"&&self,typeof s=="object"&&s];for(var Le=0;Le<we.length;++Le){var Xe=we[Le];if(Xe&&Xe.Math==Math)return Xe}throw Error("Cannot find global object")}(this);function l(we,Le){if(Le)e:{var Xe=c;we=we.split(".");for(var Re=0;Re<we.length-1;Re++){var D=we[Re];if(!(D in Xe))break e;Xe=Xe[D]}(Le=Le(Re=Xe[we=we[we.length-1]]))!=Re&&Le!=null&&r(Xe,we,{configurable:!0,writable:!0,value:Le})}}function d(we){return(we={next:we})[Symbol.iterator]=function(){return this},we}function p(we){var Le=typeof Symbol<"u"&&Symbol.iterator&&we[Symbol.iterator];return Le?Le.call(we):{next:t(we)}}if(l("Symbol",function(we){function Le(D,Q){this.A=D,r(this,"description",{configurable:!0,writable:!0,value:Q})}if(we)return we;Le.prototype.toString=function(){return this.A};var Xe="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Re=0;return function D(Q){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new Le(Xe+(Q||"")+"_"+Re++,Q)}}),l("Symbol.iterator",function(we){if(we)return we;we=Symbol("Symbol.iterator");for(var Le="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Xe=0;Xe<Le.length;Xe++){var Re=c[Le[Xe]];typeof Re=="function"&&typeof Re.prototype[we]!="function"&&r(Re.prototype,we,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return we}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var v={};try{v.__proto__={a:!0},g=v.a;break e}catch{}g=!1}a=g?function(we,Le){if(we.__proto__=Le,we.__proto__!==Le)throw new TypeError(we+" is not extensible");return we}:null}var y=a;function b(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function R(we){if(we.m)throw new TypeError("Generator is already running");we.m=!0}function O(we,Le){return we.h=3,{value:Le}}function V(we){this.g=new b,this.G=we}function k(we,Le,Xe,Re){try{var D=Le.call(we.g.j,Xe);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return we.g.m=!1,D;var Q=D.value}catch(ne){return we.g.j=null,we.g.s(ne),L(we)}return we.g.j=null,Re.call(we.g,Q),L(we)}function L(we){for(;we.g.h;)try{var Le=we.G(we.g);if(Le)return we.g.m=!1,{value:Le.value,done:!1}}catch(Xe){we.g.v=void 0,we.g.s(Xe)}if(we.g.m=!1,we.g.l){if(Le=we.g.l,we.g.l=null,Le.F)throw Le.D;return{value:Le.return,done:!0}}return{value:void 0,done:!0}}function H(we){this.next=function(Le){return we.o(Le)},this.throw=function(Le){return we.s(Le)},this.return=function(Le){return function(Xe,Re){R(Xe.g);var D=Xe.g.j;return D?k(Xe,"return"in D?D.return:function(Q){return{value:Q,done:!0}},Re,Xe.g.return):(Xe.g.return(Re),L(Xe))}(we,Le)},this[Symbol.iterator]=function(){return this}}function q(we,Le){return Le=new H(new V(Le)),y&&we.prototype&&y(Le,we.prototype),Le}if(b.prototype.o=function(we){this.v=we},b.prototype.s=function(we){this.l={D:we,F:!0},this.h=this.C||this.u},b.prototype.return=function(we){this.l={return:we},this.h=this.u},V.prototype.o=function(we){return R(this.g),this.g.j?k(this,this.g.j.next,we,this.g.o):(this.g.o(we),L(this))},V.prototype.s=function(we){return R(this.g),this.g.j?k(this,this.g.j.throw,we,this.g.o):(this.g.s(we),L(this))},l("Array.prototype.entries",function(we){return we||function(){return function(Le,Xe){Le instanceof String&&(Le+="");var Re=0,D=!1,Q={next:function(){if(!D&&Re<Le.length){var ne=Re++;return{value:Xe(ne,Le[ne]),done:!1}}return D=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}(this,function(Le,Xe){return[Le,Xe]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var te=function(we,Le){for(var Xe=0;Xe<we.length;Xe++)Le(we[Xe])},oe=function(we){return we.replace(/\r?\n|\r/g,`\r
`)},se=function(we,Le,Xe){return Le instanceof Blob?(Xe=Xe!==void 0?Xe+"":typeof Le.name=="string"?Le.name:"blob",Le.name===Xe&&Object.prototype.toString.call(Le)!=="[object Blob]"||(Le=new File([Le],Xe)),[String(we),Le]):[String(we),String(Le)]},ae=function(we,Le){if(we.length<Le)throw new TypeError(Le+" argument required, but only "+we.length+" present.")},pe=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Te=pe.FormData,Fe=pe.XMLHttpRequest&&pe.XMLHttpRequest.prototype.send,ze=pe.Request&&pe.fetch,At=pe.navigator&&pe.navigator.sendBeacon,bt=pe.Element&&pe.Element.prototype,pt=pe.Symbol&&Symbol.toStringTag;pt&&(Blob.prototype[pt]||(Blob.prototype[pt]="Blob"),"File"in pe&&!File.prototype[pt]&&(File.prototype[pt]="File"));try{new File([],"")}catch{pe.File=function(Le,Xe,Re){return Le=new Blob(Le,Re||{}),Object.defineProperties(Le,{name:{value:Xe},lastModified:{value:+(Re&&Re.lastModified!==void 0?new Date(Re.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),pt&&Object.defineProperty(Le,pt,{value:"File"}),Le}}var Er=function(we){return we.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},hr=function(we){this.i=[];var Le=this;we&&te(we.elements,function(Xe){if(Xe.name&&!Xe.disabled&&Xe.type!=="submit"&&Xe.type!=="button"&&!Xe.matches("form fieldset[disabled] *"))if(Xe.type==="file"){var Re=Xe.files&&Xe.files.length?Xe.files:[new File([],"",{type:"application/octet-stream"})];te(Re,function(D){Le.append(Xe.name,D)})}else Xe.type==="select-multiple"||Xe.type==="select-one"?te(Xe.options,function(D){!D.disabled&&D.selected&&Le.append(Xe.name,D.value)}):Xe.type==="checkbox"||Xe.type==="radio"?Xe.checked&&Le.append(Xe.name,Xe.value):(Re=Xe.type==="textarea"?oe(Xe.value):Xe.value,Le.append(Xe.name,Re))})};if((e=hr.prototype).append=function(we,Le,Xe){ae(arguments,2),this.i.push(se(we,Le,Xe))},e.delete=function(we){ae(arguments,1);var Le=[];we=String(we),te(this.i,function(Xe){Xe[0]!==we&&Le.push(Xe)}),this.i=Le},e.entries=function we(){var Le,Xe=this;return q(we,function(Re){if(Re.h==1&&(Le=0),Re.h!=3)return Le<Xe.i.length?Re=O(Re,Xe.i[Le]):(Re.h=0,Re=void 0),Re;Le++,Re.h=2})},e.forEach=function(we,Le){ae(arguments,1);for(var Xe=p(this),Re=Xe.next();!Re.done;Re=Xe.next()){var D=p(Re.value);Re=D.next().value,D=D.next().value,we.call(Le,D,Re,this)}},e.get=function(we){ae(arguments,1);var Le=this.i;we=String(we);for(var Xe=0;Xe<Le.length;Xe++)if(Le[Xe][0]===we)return Le[Xe][1];return null},e.getAll=function(we){ae(arguments,1);var Le=[];return we=String(we),te(this.i,function(Xe){Xe[0]===we&&Le.push(Xe[1])}),Le},e.has=function(we){ae(arguments,1),we=String(we);for(var Le=0;Le<this.i.length;Le++)if(this.i[Le][0]===we)return!0;return!1},e.keys=function we(){var Le,Xe,Re,D,Q=this;return q(we,function(ne){if(ne.h==1&&(Le=p(Q),Xe=Le.next()),ne.h!=3)return Xe.done?void(ne.h=0):(Re=Xe.value,D=p(Re),O(ne,D.next().value));Xe=Le.next(),ne.h=2})},e.set=function(we,Le,Xe){ae(arguments,2),we=String(we);var Re=[],D=se(we,Le,Xe),Q=!0;te(this.i,function(ne){ne[0]===we?Q&&(Q=!Re.push(D)):Re.push(ne)}),Q&&Re.push(D),this.i=Re},e.values=function we(){var Le,Xe,Re,D,Q=this;return q(we,function(ne){if(ne.h==1&&(Le=p(Q),Xe=Le.next()),ne.h!=3)return Xe.done?void(ne.h=0):(Re=Xe.value,(D=p(Re)).next(),O(ne,D.next().value));Xe=Le.next(),ne.h=2})},hr.prototype._asNative=function(){for(var we=new Te,Le=p(this),Xe=Le.next();!Xe.done;Xe=Le.next()){var Re=p(Xe.value);Xe=Re.next().value,Re=Re.next().value,we.append(Xe,Re)}return we},hr.prototype._blob=function(){var we="----formdata-polyfill-"+Math.random(),Le=[],Xe="--"+we+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Re,D){return typeof Re=="string"?Le.push(Xe+Er(oe(D))+`"\r
\r
`+oe(Re)+`\r
`):Le.push(Xe+Er(oe(D))+'"; filename="'+Er(Re.name)+`"\r
Content-Type: `+(Re.type||"application/octet-stream")+`\r
\r
`,Re,`\r
`)}),Le.push("--"+we+"--"),new Blob(Le,{type:"multipart/form-data; boundary="+we})},hr.prototype[Symbol.iterator]=function(){return this.entries()},hr.prototype.toString=function(){return"[object FormData]"},bt&&!bt.matches&&(bt.matches=bt.matchesSelector||bt.mozMatchesSelector||bt.msMatchesSelector||bt.oMatchesSelector||bt.webkitMatchesSelector||function(we){for(var Le=(we=(this.document||this.ownerDocument).querySelectorAll(we)).length;0<=--Le&&we.item(Le)!==this;);return-1<Le}),pt&&(hr.prototype[pt]="FormData"),Fe){var ra=pe.XMLHttpRequest.prototype.setRequestHeader;pe.XMLHttpRequest.prototype.setRequestHeader=function(we,Le){ra.call(this,we,Le),we.toLowerCase()==="content-type"&&(this.B=!0)},pe.XMLHttpRequest.prototype.send=function(we){we instanceof hr?(we=we._blob(),this.B||this.setRequestHeader("Content-Type",we.type),Fe.call(this,we)):Fe.call(this,we)}}ze&&(pe.fetch=function(we,Le){return Le&&Le.body&&Le.body instanceof hr&&(Le.body=Le.body._blob()),ze.call(this,we,Le)}),At&&(pe.navigator.sendBeacon=function(we,Le){return Le instanceof hr&&(Le=Le._asNative()),At.call(this,we,Le)}),pe.FormData=hr}})();const eE=()=>{const e=$("AREAS");return e.length===0&&e.push(Jt.GLOBAL),sa(e).call(e,(t,r,a)=>{const c=x6(r);return c?a===0?c:"".concat(t,",").concat(c):t},"")},x6=e=>e===Jt.OVERSEA?"".concat(li.ASIA,",").concat(li.EUROPE,",").concat(li.AFRICA,",").concat(li.NORTH_AMERICA,",").concat(li.SOUTH_AMERICA,",").concat(li.OCEANIA):li[e],yce=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{const a=aw[r],c=Object.keys(a);c&&c.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(a[l]))})}),t},fw={GLOBAL:{ASIA:[Jt.CHINA,Jt.JAPAN,Jt.INDIA,Jt.KOREA,Jt.HKMC],EUROPE:[],NORTH_AMERICA:[Jt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},mw=Object.keys(fw[Jt.GLOBAL]),oP=[Jt.CHINA,Jt.NORTH_AMERICA,Jt.EUROPE,Jt.ASIA,Jt.JAPAN,Jt.INDIA,Jt.OCEANIA,Jt.SOUTH_AMERICA,Jt.AFRICA,Jt.KOREA,Jt.HKMC,Jt.US],Ece=function(e,t){let r=[];if(Ve(e).call(e,Jt.GLOBAL)){const l=[Jt.GLOBAL,Jt.OVERSEA],d=Object.keys(aw);if(t===Jt.GLOBAL)throw new he(K.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Jt.CHINA)r=[Jt.OVERSEA];else if(c=t,Ve(mw).call(mw,c)){const p=(a=t,fw[Jt.GLOBAL][a]||[]),g=[...l,t,...p];r=d.filter(v=>!Ve(g).call(g,v))}else if(function(p){let g=!1;return mw.forEach(v=>{var y;Ve(y=fw[Jt.GLOBAL][v]).call(y,p)&&(g=!0)}),g}(t)){const p=function(v){let y;return mw.forEach(b=>{var R;Ve(R=fw[Jt.GLOBAL][b]).call(R,v)&&(y=b)}),y}(t),g=[...l,p,t];r=d.filter(v=>!Ve(g).call(g,v))}else r=e;r=function(p){const g=[];return oP.forEach(v=>{Ve(p).call(p,v)&&g.push(v)}),g.concat(p.filter(v=>!Ve(oP).call(oP,v)))}(r)}else r=e;var a,c;return r};function k6(e){var t,r;if(!e&&Ve(t=$("AREAS")).call(t,Jt.EXTENSIONS))return N.debug("update area from ap : reset"),void sP(Ose,!0);if(!Ve(r=$("AREAS")).call(r,Jt.GLOBAL)||!e)return;let a=aw.EXTENSIONS;a&&(a={CODE:x6(Jt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},N.debug("update area from ap success: ".concat(e,",config is "),a),sr("AREAS",[Jt.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?sr(c,a[c][0]):sr(c,a[c])}))}function sP(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=Ze.reportApiInvoke(null,{name:rn.SET_AREA,options:e,tag:Br.TRACER});try{let a=[];if(typeof e=="string"&&(a=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!Ve(t6).call(t6,l))throw new he(K.INVALID_PARAMS,"invalid area code")}),a=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:d}=e;if(!l)throw new he(K.INVALID_PARAMS,"area code is needed");let p=l;typeof l=="string"&&(p=[l]),a=d?Ece(p,d):p}if(!t){if(qs.AREAS){const l=new he(K.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(l),void N.warning("setArea is prohibited because of config-distribute")}if(Ve(a).call(a,Jt.GLOBAL)&&$("AREAS")===Jt.EXTENSIONS){const l=new he(K.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(l),void N.warning("setArea is prohibited because of ap extensions")}}sr("AREAS",a,t);const c=yce(a);Object.keys(c).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?sr(l,c[l][0]):sr(l,c[l])}),N.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function L6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Yc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let cP=1;function Sce(e,t,r,a,c){cP+=1;const l={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:cP,requestId:cP,version:bo,cname:r.cname},d={service_name:t,json_body:JSON.stringify(l)};let p,g,v=e[0];return Hs(async()=>{p=Date.now();const y=await Ys(v,{data:d,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-p,y.code!==0){const O=new he(K.UNEXPECTED_RESPONSE,"live streaming ap error, code"+y.code,{retry:!0,responseTime:g});throw N.error(O.toString()),O}const b=JSON.parse(y.json_body);if(b.code!==200){const O=new he(K.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:g});throw N.error(O.toString()),O}if(!b.servers||b.servers.length===0){const O=new he(K.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:b.code,responseTime:g});throw N.error(O.toString()),O}const R=function(O,V){return{addressList:O.servers.map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(k.wss,"?serviceName=").concat(encodeURIComponent(V))),workerToken:O.workerToken,vid:O.vid}}(b,t);return $("LIVE_STREAMING_ADDRESS")&&(R.addressList=$("LIVE_STREAMING_ADDRESS")instanceof Array?$("LIVE_STREAMING_ADDRESS"):[$("LIVE_STREAMING_ADDRESS")]),Yc(Yc({},R),{},{responseTime:g})},(y,b)=>(Ze.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(y.addressList),firstSuccess:b===0,responseTime:g,serverIp:e[b%e.length]}),!1),(y,b)=>(Ze.apworkerEvent(r.sid,{success:!1,sc:y.data&&y.data.code||200,serviceName:t,responseTime:g,serverIp:e[b%e.length]}),!!(y.code!==K.OPERATION_ABORTED&&y.code!==K.UNEXPECTED_RESPONSE||y.data&&y.data.retry)&&(v=e[(b+1)%e.length],!0)),c)}let lP=1;function M6(e,t,r,a){let{url:c,areaCode:l}=e;const{clientId:d,sid:p}=t,g=Date.now();let v;const y=t.role,[b,R]=dP(t,l,[an.CHOOSE_SERVER]);let O=nn.networkState;return Hs(async()=>{O&&nn.networkState===Na.OFFLINE&&nn.onlineWaiter&&await Ge.race([nn.onlineWaiter,Kn(a&&a.maxRetryTimeout||un.maxRetryTimeout)]),O=nn.networkState;const{data:V,headers:k}=await Ys(c,{data:b,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=k.http3==="1"?1:-1,Ze.reportResourceTiming(c,p),j6(V,c,t,g,[an.CHOOSE_SERVER],v);const L=Xy(V,an.CHOOSE_SERVER);return uP(L),ZN(L,c)},V=>(V&&Ze.joinChooseServer(p,{role:y,lts:g,succ:!0,csAddr:c,opid:R,serverList:V.gatewayAddrs.map(k=>k.address),ec:null,cid:V.cid.toString(),uid:V.uid.toString(),csIp:V.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:V.res.detail&&V.res.detail[38]}),!1),V=>V.code!==K.OPERATION_ABORTED&&(V.code===K.CAN_NOT_GET_GATEWAY_SERVER?V.data.retry:(Ze.joinChooseServer(p,{role:y,lts:g,succ:!1,csAddr:c,serverList:null,opid:R,ec:V.code,csIp:V.data&&V.data.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:O}),isHttp3:v,corssRegionTagReq:t.apRequestDetail}),N.warning("[".concat(d||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),V),!0)),a)}function U6(e,t,r,a){let c,{url:l,areaCode:d,serviceIds:p}=e;const g=Date.now(),v=t.role,[y,b]=dP(t,d,p);let R;return Hs(async()=>{R&&nn.networkState===Na.OFFLINE&&nn.onlineWaiter&&await Ge.race([nn.onlineWaiter,Kn(a&&a.maxRetryTimeout||un.maxRetryTimeout)]),R=nn.networkState;const{data:O,headers:V}=await Ys(l,{data:y,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=V.http3==="1"?1:-1,Ze.reportResourceTiming(l,t.sid),j6(O,l,t,g,p,c);const k=Xy(O,an.CHOOSE_SERVER),L=Xy(O,t.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK);return uP(k),{gatewayInfo:ZN(k,l),proxyInfo:L,url:l}},O=>(O.gatewayInfo&&Ze.joinChooseServer(t.sid,{role:v,lts:g,succ:!0,csAddr:l,serverList:O.gatewayInfo.gatewayAddrs.map(V=>V.address),ec:null,opid:b,cid:O.gatewayInfo.cid.toString(),uid:O.gatewayInfo.uid.toString(),csIp:O.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:O.gatewayInfo.res.detail&&O.gatewayInfo.res.detail[38]}),O.proxyInfo&&Ze.joinWebProxyAP(t.sid,{lts:g,sucess:1,apServerAddr:l,turnServerAddrList:O.proxyInfo.addresses.map(V=>V.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:p.toString()}),!1),O=>O.code!==K.OPERATION_ABORTED&&(O.code===K.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(Ze.joinWebProxyAP(t.sid,{lts:g,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:O.code,eventType:t.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:R})}),N.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),O),!0)),a)}const j6=(e,t,r,a,c,l)=>{const{sid:d,clientId:p,cloudProxyServer:g}=r,v=[],y=b=>{b.flag===4096?Ze.joinChooseServer(d,{role:r.role,lts:a,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:b.error.message,csIp:b.error.data&&b.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:l,corssRegionTagReq:r.apRequestDetail}):b.flag!==1048576&&b.flag!==4194304&&b.flag!==4194310||Ze.joinWebProxyAP(d,{lts:a,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:b.error.code,eventType:g,unilbsServerIds:c.toString()})};if(e.response_body.forEach(b=>{const R=b.buffer.code;if(b.uri===23&&R===0&&!b.buffer.edges_services)if(b.buffer.flag===4194310)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),b.buffer.edges_services=[];else{const O={error:new he(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:b.buffer.flag};v.push(O),y(O)}if(R!==0){const O=Jm(R),V={error:new he(K.CAN_NOT_GET_GATEWAY_SERVER,O.desc,{desc:O.desc,retry:O.retry,csIp:e.detail[502]}),flag:b.buffer.flag};b.buffer.flag===4194310?N.warning(V.error.toString()):v.push(V),y(V)}}),v.length)throw N.warning("[".concat(p||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(v.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message,", retry: ").concat(b.error.data.retry)).join(" | "))),new he(K.CAN_NOT_GET_GATEWAY_SERVER,v.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message)).join(" | "),{retry:!!v.find(b=>b.error.data.retry),csIp:e.detail[502],desc:[...new Set(v.map(b=>{var R;return b==null||(R=b.error)===null||R===void 0||(R=R.data)===null||R===void 0?void 0:R.desc}).filter(b=>!!b))]})},uP=e=>{var t,r,a,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new he(K.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($("AP_AREA")&&((a=e.detail)!==null&&a!==void 0&&a[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?k6(e.detail[23].toLowerCase()):k6()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const d=e.detail[19],p=d==null?void 0:d.split(";");for(let g=0;g<p.length;g++){var l;const v=Ti(l=p[g]).call(l);e.addresses[g]&&p&&(e.addresses[g].fingerprint=v)}}if($("GATEWAY_ADDRESS")&&$("GATEWAY_ADDRESS").length>0){N.debug("assign gateway address to",$("GATEWAY_ADDRESS"));const d=$("GATEWAY_ADDRESS").map(p=>{var g,v;const y=(g=(v=e.addresses.find(b=>b.ip===p.ip&&b.port===p.port))===null||v===void 0?void 0:v.fingerprint)!==null&&g!==void 0?g:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:y}});e.addresses=d}},bce=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const a=Jm(r.buffer.code);throw new he(K.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw N.debug("update ticket request received ap response without response body:",t),new he(K.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},dP=(e,t,r)=>{const a=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:a,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Yc(Yc(Yc({6:e.stringUid,11:t,12:$("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};l.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,a]},Tce=(e,t)=>{const r=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,r]};let tg=0;function rg(e){return Ge.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}const tE=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:a,allFailedhandler:c,promisesCollector:l}=e,d=0;const p=t;let g,v=0;const y=async()=>{const b=(()=>{const R=d*p,O=R+p;return r.slice(R,O).map(a)})();l&&l.push(...b);try{g=await rg(b)}catch(R){if(v+=p,d++,!(v>=r.length))return void await y();c(R)}b.forEach(R=>R.cancel())};return await y(),g},V6=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:a}=e;const c=t.length;let l=0;const d=async()=>{const p=r(t.shift());try{return await p}catch(g){if(l++,l>=c||a!=null&&a(g))throw g;return d()}};return d()};async function hP(e,t,r,a){return{gatewayInfo:await async function(l,d,p,g){let v=null;const y=[],b=async()=>{const O=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(L=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(L+"/api/v2/transpond/webrtc?v=2"):"https://".concat(L,"/api/v2/transpond/webrtc?v=2"),areaCode:eE()})),V=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),k=await tE({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(N.debug("[".concat(l.clientId,"] Connect to choose_server:"),L.url),M6(L,l,d,p)),allFailedhandler:L=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},V),L[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},V),k},R=async()=>{if(await Kn(1e3),v!==null)return v;const O=$("WEBCS_DOMAIN_BACKUP_LIST").map(L=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(L+"/api/v2/transpond/webrtc?v=2"):"https://".concat(L,"/api/v2/transpond/webrtc?v=2"),areaCode:eE()})),V=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),k=await tE({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(N.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),L.url),M6(L,l,d,p)),allFailedhandler:L=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},V),L[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},V),k};try{return v=await rg([b(),R()]),y.length&&y.forEach(O=>O.cancel&&typeof O.cancel=="function"&&O.cancel()),v}catch(O){throw O[0]}}(e,t,r,a)}}async function F6(e,t,r,a,c){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await hP(e,t,r,c);if($("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:R,proxyInfo:O}=await G6(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:R};const V=O.map(k=>({turnServerURL:k.address,tcpport:k.tcpport||ti.tcpport,udpport:k.udpport||ti.udpport,username:k.username||ti.username,password:k.password||ti.password,forceturn:!1,security:!0}));if(c.useP2P){var d;const k=(d=e.uid)!==null&&d!==void 0?d:R.uid,L="glb:".concat(k.toString()),H=await nN(L),q=O.map(te=>({turnServerURL:te.address,tcpport:te.tcpport||ti.tcpport,udpport:te.udpport||ti.udpport,username:L,password:H,forceturn:!1,security:!0}));V.push(...q)}return e.turnServer={mode:"manual",servers:V},{gatewayInfo:R}}return await hP(e,t,r,c)}const{proxyInfo:p,gatewayInfo:g}=await G6(e,t,r,c),v={gatewayInfo:g},y=p.map(R=>({turnServerURL:R.address,tcpport:l==="proxy3"?void 0:R.tcpport?R.tcpport:ti.tcpport,udpport:l==="proxy4"?void 0:R.udpport?R.udpport:ti.udpport,username:R.username||ti.username,password:R.password||ti.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(c.useP2P){var b;const R=(b=e.uid)!==null&&b!==void 0?b:g.uid,O="glb:".concat(R.toString()),V=await nN(O),k=p.map(L=>({turnServerURL:L.address,tcpport:l==="proxy3"?void 0:L.tcpport||ti.tcpport,udpport:l==="proxy4"?void 0:L.udpport||ti.udpport,username:O,password:V,forceturn:l!=="proxy4",security:l==="proxy5"}));y.push(...k)}return e.turnServer={mode:"manual",servers:y},N.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),v}async function B6(e,t,r,a,c){const l=$("ACCOUNT_REGISTER").slice(0,$("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?l.map(g=>"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1")):l.map(g=>"https://".concat(g,"/api/v1"));const p=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const g=await async function(v,y,b,R,O){const V=Date.now(),k={sid:b.sid,opid:10,appid:b.appId,string_uid:y};let L=v[0];const H=await Hs(()=>Ys(L+"".concat(L.indexOf("?")===-1?"?":"&","action=stringuid"),{data:k,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,te)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw N.error("Invalid Uint Uid ".concat(y," => ").concat(q.uid),q),Ze.reqUserAccount(k.sid,{lts:V,success:!1,serverAddr:L,stringUid:k.string_uid,uid:q.uid,errorCode:K.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new he(K.INVALID_UINT_UID_FROM_STRING_UID);return Ze.reqUserAccount(k.sid,{lts:V,success:!0,serverAddr:L,stringUid:k.string_uid,uid:q.uid,errorCode:null,extend:k}),!1}const oe=Jm(q.code);return oe.retry&&(L=v[(te+1)%v.length]),Ze.reqUserAccount(k.sid,{lts:V,success:!1,serverAddr:L,stringUid:k.string_uid,uid:q.uid,errorCode:oe.desc,extend:k}),oe.retry},(q,te)=>q.code!==K.OPERATION_ABORTED&&(Ze.reqUserAccount(k.sid,{lts:V,success:!1,serverAddr:L,stringUid:k.string_uid,uid:null,errorCode:q.code,extend:k}),L=v[(te+1)%v.length],!0),O);if(H.code!==0){const q=Jm(H.code);throw new he(K.UNEXPECTED_RESPONSE,q.desc)}return H}(d,e,t,r,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},p),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},p),g}}async function wce(e,t,r){const a=$("ACCOUNT_REGISTER");let c=[];c=t.proxyServer?a.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):a.map(l=>"https://".concat(l,"/api/v1"));try{return await V6({referenceList:c,asyncMapHandler:d=>async function(p,g,v,y){const b=Date.now(),R={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const O=await Ys(p+"".concat(p.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(O.code!==0){const V=Jm(O.code);throw new he(K.UNEXPECTED_RESPONSE,"preload sua error:".concat(V.desc),V)}if(O.uid<=0||O.uid>=Math.pow(2,32))throw new he(K.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:b,url:p,req:R,uid:O.uid,elapse:Date.now()-b}}catch(O){throw O}}(d,e,t,r),closeFn:d=>d.code===K.OPERATION_ABORTED||d.code===K.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(l){throw l}}async function Rce(e,t,r){const a=$("CDS_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=a.map(g=>function(v,y,b,R){const O=Ht(),V={flag:64,cipher_method:0,features:Yc(Yc(Yc(Yc(Yc({install_id:mN(),device:O.name,system:O.os,system_general:navigator.userAgent,vendor:y.appId,version:bo,cname:y.cname,session_id:y.sid,proxyServer:y.proxyServer,sdk_type:gce.WEB_RTC,browser_name:O.name,browser_version:O.version,user_agent:navigator.userAgent,channel_name:y.cname},y.stringUid&&{string_uid:y.stringUid}),y.uid&&{uid:y.uid+""}),O.os&&{os_name:O.os}),O.osVersion&&{os_version:O.osVersion}),{},{detail:""})};return Hs(()=>Ys(v,{data:V,timeout:1e3,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==K.OPERATION_ABORTED,R)}(g,e,t,r));let l=null,d=null,p={};try{l=await rg(c)}catch(g){if(g.code===K.OPERATION_ABORTED)throw g;d=g}if(c.forEach(g=>g.cancel()),Ze.reportApiInvoke(e.sid,{name:rn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:l}}).onSuccess(),l&&l.test_tags)try{p=function(g){if(!g.test_tags)return{};const v=g.test_tags,y=Object.keys(v),b={};return y.forEach(R=>{var O;const V=Ti(O=R.slice(4)).call(O),k=JSON.parse(v[R]),L=k[1];b[V]={tag:k[0]||"",value:L}}),b}(l)}catch{}return p}async function W6(e,t){const r=$("WEBCS_DOMAIN").concat($("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:eE(),serviceIds:[an.CHOOSE_SERVER,an.CLOUD_PROXY_FALLBACK]}));try{return await V6({referenceList:r,asyncMapHandler:c=>async function(l,d,p){let g,{url:v,areaCode:y,serviceIds:b}=l;const R=Date.now(),[O,V]=dP(d,y,b);let k=nn.networkState;try{k&&nn.networkState===Na.OFFLINE&&nn.onlineWaiter&&await Ge.race([nn.onlineWaiter,Kn(un.maxRetryTimeout)]),k=nn.networkState;const{data:L,headers:H}=await Ys(v,{data:O,cancelToken:p,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=H.http3==="1"?1:-1,(se=>{const ae=[];if(se.response_body.forEach(pe=>{const Te=pe.buffer.code;if(pe.uri===23&&Te===0&&!pe.buffer.edges_services)if(pe.buffer.flag===4194310)pe.buffer.edges_services=[];else{const Fe={error:new he(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:se.detail[502]}),flag:pe.buffer.flag};ae.push(Fe)}if(Te!==0){const Fe=Jm(Te),ze={error:new he(K.CAN_NOT_GET_GATEWAY_SERVER,Fe.desc,{desc:Fe.desc,retry:Fe.retry,csIp:se.detail[502]}),flag:pe.buffer.flag};pe.buffer.flag===4194310?N.warning(ze.error.toString()):ae.push(ze)}}),ae.length)throw new he(K.CAN_NOT_GET_GATEWAY_SERVER,ae.map(pe=>"flag: ".concat(pe.flag,", message: ").concat(pe.error.message)).join(" | "),{retry:!!ae.find(pe=>pe.error.data.retry),csIp:se.detail[502],desc:[...new Set(ae.map(pe=>{var Te;return pe==null||(Te=pe.error)===null||Te===void 0||(Te=Te.data)===null||Te===void 0?void 0:Te.desc}).filter(pe=>!!pe))]})})(L);const te=Xy(L,an.CHOOSE_SERVER),oe=Xy(L,an.CLOUD_PROXY_FALLBACK);return uP(te),{gatewayInfo:ZN(te,v),proxyInfo:oe,opid:V,requestTime:R,url:v,isHttp3:g,elapse:Date.now()-R}}catch(L){throw L}}(c,e,t),closeFn:c=>c.code===K.OPERATION_ABORTED||c.code===K.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function G6(e,t,r,a){const c=$("PROXY_SERVER_TYPE3"),l=(O,V,k)=>{let L=k||c;return Array.isArray(L)&&(L=V%2==0?c[1]:c[0]),"https://".concat(L,"/ap/?url=").concat(O)};let d=null;const p=[],g=async()=>{const O=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map((L,H)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(L,"/api/v2/transpond/webrtc?v=2"),H,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):l("".concat(L,"/api/v2/transpond/webrtc?v=2"),H),{url:q,areaCode:eE(),serviceIds:[an.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK]}}),V=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),k=await tE({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(N.debug("[".concat(e.clientId,"] Connect to choose_server:"),L.url),U6(L,e,t,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},V),L[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},V),k},v=async()=>{if(await Kn(1e3),d!==null)return d;const O=$("WEBCS_DOMAIN_BACKUP_LIST").map((L,H)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(L,"/api/v2/transpond/webrtc?v=2"),H,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):l("".concat(L,"/api/v2/transpond/webrtc?v=2"),H),{url:q,areaCode:eE(),serviceIds:[an.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK]}}),V=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),k=await tE({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(N.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),L.url),U6(L,e,t,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},V),L[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},V),k};let y,b,R;try{({gatewayInfo:y,proxyInfo:b,url:R}=await rg([g(),v()]))}catch(O){throw O[0]}if(p.length&&p.forEach(O=>O.cancel&&typeof O.cancel=="function"&&O.cancel()),!y||!b)throw new he(K.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=R,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&R){const O=/^https?:\/\/(.+?)(\/.*)?$/.exec(R)[1];Ve(c).call(c,O)&&(e.proxyServer=O,N.setProxyServer(O),Ze.setProxyServer(O))}return d={gatewayInfo:y,proxyInfo:await p6(b,y.uid)},d}async function Cce(e,t,r){const a=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),c=a.map(l=>function(d,p,g,v){const y={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:bo,cname:p.cname,uid:p.uid.toString(),requestId:lP,seq:lP};lP+=1;const b={service_name:"tele_channel",json_body:JSON.stringify(y)};return Hs(async()=>{const R=await Ys(d,{data:b,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(R.code!==0){const V=new he(K.UNEXPECTED_RESPONSE,"cross channel ap error, code"+R.code,{retry:!0});throw N.error(V.toString()),V}const O=JSON.parse(R.json_body);if(O.code!==200){const V=new he(K.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(O.code,", reason: ").concat(O.reason));throw N.error(V.toString()),V}if(!O.servers||O.servers.length===0){const V=new he(K.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw N.error(V.toString()),V}return{vid:O.vid,workerToken:O.workerToken,addressList:($("CHANNEL_MEDIA_RELAY_SERVERS")||O.servers).map(V=>"wss://".concat(V.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(V.wss))}},void 0,R=>!!(R.code!==K.OPERATION_ABORTED&&R.code!==K.UNEXPECTED_RESPONSE||R.data&&R.data.retry),v)}(l,e,t,r));try{const l=await rg(c);return c.forEach(d=>d.cancel()),l}catch(l){throw l[0]}}async function Ace(e,t,r){let a=null;const c=[],l=async d=>{const p=$(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return d&&(await Kn(1e3),a!==null)?a:await tE({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:g=>(N.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),g),function(v,y,b,R){const[O]=Tce(y,[an.CHOOSE_SERVER]);let V=nn.networkState;return Hs(async()=>{V&&nn.networkState===Na.OFFLINE&&nn.onlineWaiter&&await Ge.race([nn.onlineWaiter,Kn(R&&R.maxRetryTimeout||un.maxRetryTimeout)]),V=nn.networkState;const k=await Ys(v,{data:O,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return bce(k,v)},()=>!1,k=>k.code!==K.OPERATION_ABORTED&&(k.code===K.UPDATE_TICKET_FAILED?k.data.retry:(N.warning("[".concat(y.clientId,"] update ticket network error, retry"),k),!0)),R)}(g,e,t,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return a=await rg([l(!1),l(!0)]),c.length&&c.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),a}catch(d){throw d[0]}}function H6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function pP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class Oce extends kr{get isSuccess(){return!!this.configs}constructor(t,r){super(),G(this,"configs",void 0),G(this,"store",void 0),G(this,"joinInfo",void 0),G(this,"cancelToken",void 0),G(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),G(this,"interval",void 0),G(this,"mutex",void 0),G(this,"mutableParamsRead",!1),G(this,"configCache",{}),G(this,"limit_bitrate",void 0),this.mutex=new ci("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),$("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},$("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ze.reportApiInvoke(null,{options:void 0,name:rn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Br.TRACER}).onSuccess(JSON.stringify(qs))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void N.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await Rce(this.joinInfo,this.cancelToken,this.retryConfig),N.debug("[config-distribute] get config distribute",JSON.stringify(t));const a=function(c){var l;const d=$h(l=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(l);for(let v=0;v<d.length;v++)for(let y=d.length-1;y>v;y--){const b=d[y],R=c[b].value;if(typeof R.__priority=="number"){const O=R.__priority,V=d[y-1],k=c[V].value;if(typeof k.__priority=="number"){if(!(O>k.__priority))continue;{const L=b;d[y]=d[y-1],d[y-1]=L}}else{const L=b;d[y]=d[y-1],d[y-1]=L}}}const p=Date.now();let g={};return d.forEach(v=>{const y=c[v].value.__expires;y&&y<=p||(g[v]=c[v])}),g}(t);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new he(K.NETWORK_RESPONSE_ERROR,a);N.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){r6(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(zy.UPDATE_BITRATE_LIMIT,t):this.emit(zy.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&pP({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const r={},a=Object.keys(t),c=[];a.forEach(l=>{const d=t[l].value;r[l]=d;const p=d.__id;if(p&&this.configCache[l]&&this.configCache[l].__id===p)return;const g=d.__type,v=t[l].value,y=t[l].tag;let b=0;g?g===I3.REALTIME&&(b=1):Object.keys(v).some(R=>Object.prototype.hasOwnProperty.call(yN,R)||!WN()&&Object.prototype.hasOwnProperty.call(jT,R)?(b=1,!0):void 0),c.push({tag:y,isApplied:b,feature:l,params:JSON.stringify(d)})}),c.forEach(l=>{let{tag:d,feature:p,params:g,isApplied:v}=l;this.store.sessionId&&Ze.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:d,feature:p,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){N.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){const r=function(c){const l={};return Object.keys(c).forEach(d=>{const p=c[d].value,g=p.__expires,v=p.__type;Object.keys(p).forEach(y=>{y==="__id"||y==="__type"||y==="__priority"||y==="__expires"||Object.prototype.hasOwnProperty.call(l,y)||(l[y]=pP(pP({value:p[y]},g&&{expires:g}),v&&{type:v}))})}),l}(t);try{var a;const c=(a=r.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete r.LIMIT_BITRATE,c&&r6(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),function(p){try{const g=Date.now();Object.keys(p).forEach(v=>{const{value:y,type:b,expires:R}=p[v];R&&R<=g||((b===I3.REALTIME||Object.prototype.hasOwnProperty.call(yN,v))&&(qs[v]=y,Ar[v]=y,N.debug("Update realtime parameters from config distribute",v,y)),b||WN()||!Object.prototype.hasOwnProperty.call(jT,v)||(qs[v]=y,Ar[v]=y,N.debug("Update gateway parameters from config distribute",v,y)))})}catch(g){N.error("Error update config immediately: ".concat(p),g.message)}}(r);const l=JSON.stringify(r),d=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",d),N.debug("Caching global parameters ".concat(l))}catch(c){N.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{const r=Date.now();Object.keys(t).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ar,a)){const{value:c,expires:l}=t[a];if(l&&l<=r)return;(function(d,p){try{return typeof d=="object"&&typeof p=="object"&&JSON.stringify(d)===JSON.stringify(p)}catch{return!1}})(Ar[a],c)||(qs[a]=c,Ar[a]=c,this.emit(zy.UPDATE_CLIENT_ROLE_OPTIONS,c),N.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(r){N.error("Error handling global parameter config:",r.message)}}}class Ice extends kr{constructor(){super(...arguments),G(this,"resultStorage",new Map)}setLocalAudioStats(t,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(t,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(a))}setRemoteAudioStats(t,r){const a=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const a=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(t,r,a){if($("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(c&&(c.result.push(a),c.result.length>=5)){var l;const d=Ve(l=c.result).call(l,!0);c.isPrevNormal&&!d&&this.emit("exception",q6[t],t,r),!c.isPrevNormal&&d&&this.emit("exception",q6[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=d,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof mn&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=Pa(r._encoderConfig.frameRate));const c=t.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof mn&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const q6={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},di=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function K6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function mp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?K6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class rE{constructor(t){G(this,"store",void 0),G(this,"onStatsException",void 0),G(this,"onUploadPublishDuration",void 0),G(this,"onStatsChanged",void 0),G(this,"onVideoCodecChanged",void 0),G(this,"localStats",new Map),G(this,"remoteStats",new Map),G(this,"updateStatsInterval",void 0),G(this,"trafficStats",void 0),G(this,"trafficStatsPeerList",[]),G(this,"uplinkStats",void 0),G(this,"exceptionMonitor",void 0),G(this,"p2pChannel",void 0),G(this,"scalabilityMode",UT.L1T1),G(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Ice,this.exceptionMonitor.on("exception",(r,a,c)=>{this.onStatsException&&this.onStatsException(r,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ie.LocalAudioTrack)||mp({},wN)}getLocalVideoTrackStats(){return this.localStats.get(Ie.LocalVideoTrack)||mp({},RN)}getRemoteAudioTrackStats(t){const r=(l,d)=>{if(!this.trafficStats)return d;const p=this.trafficStats.peer_delay.find(g=>g.peer_uid===l);return p&&(d.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},a={};if(t){var c;const l=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;l&&(a[t]=r(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{audioStats:p}]=l;p&&(a[d]=r(d,p))});return a}getRemoteNetworkQualityStats(t){const r={};if(t){var a;const c=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{networkStats:d}]=c;d&&(r[l]=d)});return r}getRemoteVideoTrackStats(t){const r=(l,d)=>{if(!this.trafficStats)return d;const p=this.trafficStats.peer_delay.find(g=>g.peer_uid===l);return p&&(d.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},a={};if(t){var c;const l=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;l&&(a[t]=r(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{videoStats:p}]=l;p&&(a[d]=r(d,p))});return a}getRTCStats(){let t=0,r=0,a=0,c=0;const l=this.localStats.get(Ie.LocalAudioTrack);l&&(t+=l.sendBytes,r+=l.sendBitrate);const d=this.localStats.get(Ie.LocalVideoTrack);d&&(t+=d.sendBytes,r+=d.sendBitrate);const p=this.localStats.get(Ie.LocalVideoLowTrack);p&&(t+=p.sendBytes,r+=p.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:y,videoStats:b}=v;y&&(a+=y.receiveBytes,c+=y.receiveBitrate),b&&(a+=b.receiveBytes,c+=b.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:r,SendBytes:t,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(r.peer_uid),l=c!=null&&c.videoSSRC?di.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,d=c!=null&&c.audioSSRC?di.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,l>d?l:d),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&N.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,a){if(!t)return!1;const c=!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime,l=!a||r.framesDecodeCount>a.framesDecodeCount;return c||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[a,c]=r;switch(a){case Ie.LocalVideoTrack:case Ie.LocalVideoLowTrack:{const p=c,g=mp({},RN),v=t.getStats(),y=t.getLocalMedia(a);if(v){const b=v.videoSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(b){const R=t.getLocalVideoSize(),O=t.getEncoderConfig(Ie.LocalVideoTrack);var l;(b.codec==="H264"||b.codec==="H265"||b.codec==="VP8"||b.codec==="VP9"||b.codec==="AV1X"||b.codec==="AV1")&&(g.codecType=b.codec,(p==null?void 0:p.codecType)!==b.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,b.codec.toLocaleLowerCase()))),g.sendBytes=b.bytes,g.sendBitrate=p?8*Math.max(0,g.sendBytes-p.sendBytes):0,b.inputFrame?(g.captureFrameRate=b.inputFrame.frameRate,g.captureResolutionHeight=b.inputFrame.height,g.captureResolutionWidth=b.inputFrame.width):R&&(g.captureResolutionWidth=R.width,g.captureResolutionHeight=R.height),b.sentFrame?(g.sendFrameRate=b.sentFrame.frameRate,g.sendResolutionHeight=b.sentFrame.height,g.sendResolutionWidth=b.sentFrame.width):R&&(g.sendResolutionWidth=R.width,g.sendResolutionHeight=R.height),b.avgEncodeMs&&(g.encodeDelay=b.avgEncodeMs),O&&O.bitrateMax?g.targetSendBitrate=1e3*O.bitrateMax:b.targetBitrate&&(g.targetSendBitrate=b.targetBitrate),g.sendPackets=b.packets,g.sendPacketsLost=b.packetsLost,g.sendJitterMs=b.jitterMs,g.sendRttMs=b.rttMs,g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(b)&&(g.totalFreezeTime+=1),b.scalabilityMode&&this.scalabilityMode!==b.scalabilityMode&&(N.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(b.scalabilityMode)),this.scalabilityMode=b.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,g),((p==null?void 0:p.sendResolutionWidth)!==g.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==g.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,g);break}case Ie.LocalAudioTrack:{const p=c,g=mp({},wN),v=t.getStats(),y=t.getLocalMedia(a);if(v){const b=v.audioSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(b){if(b.codec!=="opus"&&b.codec!=="aac"&&b.codec!=="PCMU"&&b.codec!=="PCMA"&&b.codec!=="G722"||(g.codecType=b.codec),b.inputLevel)g.sendVolumeLevel=Math.round(32767*b.inputLevel);else{const R=t.getLocalAudioVolume();R&&(g.sendVolumeLevel=Math.round(32767*R))}g.sendBytes=b.bytes,g.sendPackets=b.packets,g.sendPacketsLost=b.packetsLost,g.sendJitterMs=b.jitterMs,g.sendRttMs=b.rttMs,g.sendBitrate=p?8*Math.max(0,g.sendBytes-p.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ie.LocalAudioTrack,g),g&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,g);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var a,c;let[l,{videoStats:d,audioStats:p,videoPcStats:g}]=r;const v=p,y=d,b=g,R=mp({},F3),O=mp({},B3),V=mp({},hse),{audioTrack:k,videoTrack:L,audioSSRC:H,videoSSRC:q}=t.getRemoteMedia(l);let te;te=this.store.useP2P?t.getStats(!0):t.getStats();const oe=(a=te)===null||a===void 0?void 0:a.audioRecv.find(Te=>Te.ssrc===H),se=(c=te)===null||c===void 0?void 0:c.videoRecv.find(Te=>Te.ssrc===q),ae=this.trafficStats&&this.trafficStats.peer_delay.find(Te=>Te.peer_uid===l);if(oe&&(oe.codec!=="opus"&&oe.codec!=="aac"&&oe.codec!=="PCMU"&&oe.codec!=="PCMA"&&oe.codec!=="G722"||(R.codecType=oe.codec),oe.outputLevel?R.receiveLevel=Math.round(32767*oe.outputLevel):k&&(R.receiveLevel=Math.round(32767*k.getVolumeLevel())),R.receiveBytes=oe.bytes,R.receivePackets=oe.packets,R.receivePacketsLost=oe.packetsLost,R.receivePacketsDiscarded=oe.packetsDiscarded,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost),R.receiveBitrate=v?8*Math.max(0,R.receiveBytes-v.receiveBytes):0,R.totalDuration=v?v.totalDuration+1:1,R.totalFreezeTime=v?v.totalFreezeTime:0,R.freezeRate=R.totalFreezeTime/R.totalDuration,R.receiveDelay=oe.jitterBufferMs,R.totalDuration>10&&rE.isRemoteAudioFreeze(k)&&(R.totalFreezeTime+=1)),se){var pe;se.codec!=="H264"&&se.codec!=="H265"&&se.codec!=="VP8"&&se.codec!=="VP9"&&se.codec!=="AV1X"&&se.codec!=="AV1"||(O.codecType=se.codec),O.receiveBytes=se.bytes,O.receiveBitrate=y?8*Math.max(0,O.receiveBytes-y.receiveBytes):0,O.decodeFrameRate=se.decodeFrameRate<0?0:se.decodeFrameRate,O.renderFrameRate=se.decodeFrameRate<0?0:se.decodeFrameRate,se.outputFrame&&(O.renderFrameRate=se.outputFrame.frameRate),se.receivedFrame?(O.receiveFrameRate=se.receivedFrame.frameRate,O.receiveResolutionHeight=se.receivedFrame.height,O.receiveResolutionWidth=se.receivedFrame.width):L&&(O.receiveResolutionHeight=L._videoHeight||0,O.receiveResolutionWidth=L._videoWidth||0),se.framesRateFirefox!==void 0&&(O.receiveFrameRate=Math.round(se.framesRateFirefox)),O.receivePackets=se.packets,O.receivePacketsLost=se.packetsLost,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost);const Te=y?y.totalFreezeTime:0,Fe=y?y.totalDuration:0;O.totalDuration=y?y.totalDuration+1:1,O.totalFreezeTime=(pe=se.totalFreezesDuration)!==null&&pe!==void 0?pe:Te||0,O.receiveDelay=se.jitterBufferMs||0;const ze=!!q&&t.getRemoteVideoIsReady(q);se.totalFreezesDuration===void 0&&L&&ze&&rE.isRemoteVideoFreeze(L,se,b)&&(O.totalFreezeTime+=1),O.freezeRate=Math.max(0,Math.min((O.totalFreezeTime-Te)/(O.totalDuration-Fe),1))}ae&&(R.end2EndDelay=ae.B_ad,O.end2EndDelay=ae.B_vd,R.transportDelay=ae.B_ed,O.transportDelay=ae.B_ed,R.currentPacketLossRate=ae.B_ealr4/100,O.currentPacketLossRate=ae.B_evlr4/100,V.uplinkNetworkQuality=ae.B_punq?ae.B_punq:0,V.downlinkNetworkQuality=ae.B_pdnq?ae.B_pdnq:0),this.remoteStats.set(l,{audioStats:R,videoStats:O,videoPcStats:se,networkStats:V}),k&&this.exceptionMonitor.setRemoteAudioStats(k,R),L&&this.exceptionMonitor.setRemoteVideoStats(L,O)})}}class z6{constructor(){G(this,"destChannelMediaInfos",new Map),G(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){e6(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){e6(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){rw(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function $6(e){if(!(e instanceof z6))return new he(K.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new he(K.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new he(K.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Rd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){G(this,"uid",void 0),G(this,"_uintid",void 0),G(this,"_trust_in_room_",!0),G(this,"_trust_audio_enabled_state_",!0),G(this,"_trust_video_enabled_state_",!0),G(this,"_trust_audio_mute_state_",!0),G(this,"_trust_video_mute_state_",!0),G(this,"_audio_muted_",!1),G(this,"_video_muted_",!1),G(this,"_audio_enabled_",!0),G(this,"_video_enabled_",!0),G(this,"_audio_added_",!1),G(this,"_video_added_",!1),G(this,"_is_pre_created",!1),G(this,"_video_pre_subscribed",!1),G(this,"_audio_pre_subscribed",!1),G(this,"_trust_video_stream_added_state_",!0),G(this,"_trust_audio_stream_added_state_",!0),G(this,"_audioTrack",void 0),G(this,"_videoTrack",void 0),G(this,"_dataChannels",[]),G(this,"_audioSSRC",void 0),G(this,"_videoSSRC",void 0),G(this,"_audioOrtc",void 0),G(this,"_videoOrtc",void 0),G(this,"_cname",void 0),G(this,"_rtxSsrcId",void 0),G(this,"_videoMid",void 0),G(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function Y6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function X6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Y6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const nE="9",J6=4e4;function Q6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Yl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q6(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q6(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}var ng=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(ng||{});const gw=new Map;function Z6(e,t,r,a){let{scale:c}=e;if(c===0&&a===ng.UP||c>=t.length-1&&a===ng.DOWN)return e;let l=Yl(Yl({},e),{},{scale:a===ng.DOWN?++c:--c});switch(r){case"maintain-framerate":l=Yl(Yl({},l),t[c].motion);break;case"maintain-resolution":l=Yl(Yl({},l),t[c].detail);break;case"balanced":l=Yl(Yl({},l),t[c].balanced)}return l}function eW(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:tW(t)};gw.set(e,r)}else gw.delete(e)}function tW(e){const t=Yl({},e),{bitrateMax:r,frameRate:a,scaleResolutionDownBy:c,bitrateMin:l}=t,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:y,BWE_SCALE_UP_THRESHOLD:b,BWE_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_UP_THRESHOLD:V,BALANCE_BITRATE_FACTOR:k,BALANCE_FRAMERATE_FACTOR:L,BALANCE_RESOLUTION_FACTOR:H,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:te,DETAIL_FRAMERATE_FACTOR:oe,DETAIL_BITRATE_FACTOR:se}=_N,ae=Math.min(t.frameRate,p),pe=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(R,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(O,1)*ae),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:l}}];for(let Te=1;Te<=g;Te++){const Fe={bwe_up:Math.round(Math.pow(b,Te)*r),bwe_down:Math.round(Math.pow(R,Te+1)*r),fps_up:Math.round(Math.pow(V,Te)*ae),fps_down:Math.round(Math.pow(O,Te+1)*ae)},ze={scaleResolutionDownBy:c/Math.pow(H,Te),frameRate:Math.max(Math.round(Math.pow(L,Te)*a),d),bitrateMax:Math.max(Math.round(Math.pow(k,Te)*r),y),bitrateMin:Math.max(Math.round(Math.pow(k,Te)*l),v)},At={scaleResolutionDownBy:c/Math.pow(q,Te),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(te,Te)*r),y),bitrateMin:Math.max(Math.round(Math.pow(te,Te)*l),v)},bt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(oe,Te)*a),d),bitrateMax:Math.max(Math.round(Math.pow(se,Te)*r),y),bitrateMin:Math.max(Math.round(Math.pow(se,Te)*l),v)};pe.push({scale:Te,threshold:Fe,balanced:ze,motion:At,detail:bt})}return pe}function Nce(e,t,r,a,c,l){const d=gw.get(e)||{overUse:0,underUse:0,adaptationList:tW(c)},{adaptationList:p}=d;gw.set(e,d);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:v}=_N,{scale:y}=a;let b,R;return typeof t=="number"&&t>0&&function(O,V,k,L){if(V>=k.length)return!1;let{threshold:{fps_down:H}}=k[V];return $("FORCE_AG_HIGH_FRAMERATE")&&L==="maintain-framerate"&&(H=k[0].threshold.fps_down),O<H}(t,y,p,l)&&(d.overUse++,R=Fy.CPU,d.overUse>g)||typeof r=="number"&&r>0&&function(O,V,k){if(V>=k.length)return!1;const{threshold:{bwe_down:L}}=k[V];return O<L}(r,y,p)&&(d.overUse++,R=Fy.BANDWIDTH,d.overUse>g)?(d.overUse=0,d.underUse=0,b=Z6(a,p,l,ng.DOWN),[b,R]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(O,V,k,L){if(V===0)return;let{threshold:{fps_up:H}}=k[V];return $("FORCE_AG_HIGH_FRAMERATE")&&L==="maintain-framerate"&&(H=k[1].threshold.fps_up),O>H}(t,y,p,l)&&function(O,V,k){if(V===0)return;const{threshold:{bwe_up:L}}=k[V];return O>L}(r,y,p)&&(d.underUse++,d.underUse>v&&(d.overUse=0,d.underUse=0,b=Z6(a,p,l,ng.UP),b.scale===0&&(R=Fy.NONE))),[b,R])}function rW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function fP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rW(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function Pce(e){var t;return!!$("ENABLE_AG_ADAPTATION")&&!!(e instanceof kN||Ve(t=e._hints).call(t,dr.CUSTOM_TRACK))&&(!!$("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){const a=Ht();if(a.os!==On.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])>=r}(14)&&JB(17,4)||XB(14)&&QB(17,4,!0)))}const _w=new Map;function vw(e,t){const r=_w.get(e);if(r){const{timer:a}=r;window.clearTimeout(a),_w.delete(e)}t.qualityLimitationReason=Fy.NONE,eW(e)}function Dce(e,t){var r;let a;switch(t){case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoTrack:a=Ve(r=e._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalVideoLowTrack:a=nr.Low}return a}function mP(e){const t=qt();if(e.some(r=>r._bypassWebAudio))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function gP(e,t){mP(e);const r=new mn;return e.forEach(a=>r.addAudioTrack(a)),r}const xce=!qt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&Bl();function yw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return xce?(r={spec:t,store:e},$l("PlanBConnection").create(r)):new Xc(t,e)}function _P(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function nW(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Uy(e.turnServer.servers))return!1;if($("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Ft;function iW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Xs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iW(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let Xc=(Ft=class Pp extends i6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ve(r=Object.keys(VT)).call(r,t)}))]}constructor(t,r){super(t,r),G(this,"id",gr(5,"connection-")),G(this,"store",void 0),G(this,"peerConnection",void 0),G(this,"forceTurn",!1),G(this,"remoteSDP",void 0),G(this,"initialOffer",void 0),G(this,"transportEventReceiver",void 0),G(this,"statsFilter",void 0),G(this,"extension",{useXR:$("USE_XR")}),G(this,"localCapabilities",void 0),G(this,"remoteCodecs",void 0),G(this,"localCandidateCount",0),G(this,"allCandidatesReceived",!1),G(this,"isPreallocation",!1),G(this,"preSSRCMap",new Map),G(this,"dataStreamChannelMap",new Map),G(this,"establishPromise",void 0),G(this,"recoveredDataChannelIds",[]),G(this,"currentDataChannelId",1),G(this,"supportAV1RtpSpec",!1),G(this,"mutex",void 0),G(this,"qualityLimitationReason",Fy.NONE),G(this,"isFirstConnected",!1),this.store=r,this.forceTurn=nW(t),this.mutex=new ci("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Pp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=fN(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Vr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const r=this.preSSRCMap.get(t);if(r!==void 0){const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(a)return{transceiver:a,track:a.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void N.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else N.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Td(a.sdp),l=await T6({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=dw(l),this.initialOffer=a,$("ENABLE_SVC")&&this.store.codec=="av1"){const p=await async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:UT.L1T3}]});const v=await g.createOffer();if(!v.sdp)return void g.close();const y=pa(v.sdp).mediaDescriptions[0];if(!y)return;const b=y.attributes.extmaps.find(R=>R.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return g.close(),b}catch{return}}();var t;p&&(this.supportAV1RtpSpec=!0,(t=l.send)===null||t===void 0||t.videoExtensions.push(p))}let d;return a.sdp&&A6(a.sdp)&&(d=Lr(l),(r=d).send&&(Qm($e.VIDEO,r.send.videoExtensions),Qm($e.AUDIO,r.send.audioExtensions)),r.recv&&(Qm($e.VIDEO,r.recv.videoExtensions),Qm($e.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(Qm($e.VIDEO,r.sendrecv.videoExtensions),Qm($e.AUDIO,r.sendrecv.audioExtensions))),Xs(Xs({},c),{},{rtpCapabilities:d||l,offerSDP:a.sdp})}catch(a){throw new _e(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&A6(this.initialOffer.sdp)&&(r=t.rtpCapabilities,a=this.localCapabilities,r.send&&(cw($e.VIDEO,r.send.videoExtensions,a.send.videoExtensions),cw($e.AUDIO,r.send.audioExtensions,a.send.audioExtensions)),r.recv&&(cw($e.VIDEO,r.recv.videoExtensions,a.recv.videoExtensions),cw($e.AUDIO,r.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(v){let y=arguments.length>1&&arguments[1]!==void 0&&arguments[1];G(this,"sessionDesc",void 0),G(this,"_localCapabilities",void 0),G(this,"_rtpCapabilities",void 0),G(this,"_candidates",void 0),G(this,"_originCandidates",void 0),G(this,"_iceParameters",void 0),G(this,"_isUseExtmapAllowMixed",void 0),G(this,"_dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname",void 0),G(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=y,v=Lr(v);const{iceParameters:b,dtlsParameters:R,candidates:O,rtpCapabilities:V,setup:k,localCapabilities:L,cname:H}=v;this._rtpCapabilities=V,this._candidates=O,this._originCandidates=Lr(O),this._iceParameters=b,this._dtlsParameters=R,this._localCapabilities=L,this.setup=k,this.cname=H,this.sessionDesc=this.updateRemoteRTPCapabilities(V),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const y=this.candidates,b=this.dtlsParameters,R=this.iceParameters,O=this.rtpCapabilities.send;let V=this.sessionDesc.mediaDescriptions.length-1;for(let k=1;k<v;k++){const L=2*k+2e4,H=2*k+J6,{ssrcs:q,ssrcGroups:te}=fp([{ssrcId:L}],this.cname),{ssrcs:oe,ssrcGroups:se}=fp([{ssrcId:H,rtx:$("USE_SUB_RTX")?H+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:nE,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.videoCodecs.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:R.iceUfrag,icePwd:R.icePwd,unrecognized:[],candidates:y,extmaps:O.videoExtensions,fingerprints:b.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:oe,ssrcGroups:se,rtcpFeedbackWildcards:[],payloads:O.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++V)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:nE,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.audioCodecs.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:R.iceUfrag,icePwd:R.icePwd,unrecognized:[],candidates:y,extmaps:O.audioExtensions,fingerprints:b.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:te,rtcpFeedbackWildcards:[],payloads:O.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++V)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return vd(this.sessionDesc)}send(v,y,b,R){const{ssrcs:O,ssrcGroups:V}=fp(y,this.cname,$("SYNC_GROUP")?b:void 0),k=this.findPreloadMediaDesc(O);if(k){if(Vr()&&this.firefoxSsrcMidMap.set(O[0].ssrcId,k.attributes.mid),R&&(R.twcc||R.remb)){const L=this.sessionDesc.mediaDescriptions.indexOf(k);return this.sessionDesc.mediaDescriptions[L]=this.mungSendMediaDesc(k,R),{mid:k.attributes.mid,needExchangeSDP:!0}}return{mid:k.attributes.mid,needExchangeSDP:!1}}{const L=this.findAvailableMediaIndex(v,O);let H;return L===-1||L===1&&(Qn()||function(){const q=Ht();return!(q.name!==Xt.CHROME||!q.osVersion)&&Number(q.version)<=90}()||$("ENABLE_ENCODED_TRANSFORM")&&Fl())||L===0&&$("USE_SUB_RTX")||ZB()?(H=this.createOrRecycleSendMedia(v,O,V,"sendonly",R),this.updateBundleMids()):(H=Lr(this.sessionDesc.mediaDescriptions[L]),H.attributes.direction="sendonly",H.attributes.ssrcs=O,H.attributes.ssrcGroups=V,this.sessionDesc.mediaDescriptions[L]=this.mungSendMediaDesc(H,R)),Vr()&&this.firefoxSsrcMidMap.set(O[0].ssrcId,H.attributes.mid),{mid:H.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:y}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:y}}batchSend(v){const y=v.map(O=>{let{kind:V,ssrcMsg:k,mslabel:L}=O;return this.send(V,k,L)}),b=[];let R=!1;return y.forEach(O=>{let{mid:V,needExchangeSDP:k}=O;k&&(R=!0),b.push(V)}),{mids:b,needExchangeSDP:R}}stopSending(v){const y=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&v.indexOf(b.attributes.mid)!==-1);if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");y.forEach(b=>{b.attributes.mid==="0"||Vr()||ZB()?b.attributes.ssrcs=[]:(b.attributes.ssrcs=[],b.attributes.direction="inactive",b.media.port="0")}),this.updateBundleMids()}mute(v){const y=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===v);if(!y)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));y.attributes.direction="inactive"}unmute(v){const y=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===v);if(!y)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));y.attributes.direction="sendonly"}muteRemote(v){const y=this.sessionDesc.mediaDescriptions.filter(b=>Ve(v).call(v,b.attributes.mid||""));if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach(b=>{b.attributes.direction="inactive"})}unmuteRemote(v){const y=this.sessionDesc.mediaDescriptions.filter(b=>Ve(v).call(v,b.attributes.mid||""));if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach(b=>{b.attributes.direction="recvonly"})}receive(v,y,b,R){v.forEach((O,V)=>{this.createOrRecycleRecvMedia(O,[],"recvonly",y,b,R[V])}),this.updateBundleMids()}stopReceiving(v){const y=this.sessionDesc.mediaDescriptions.filter(b=>v.indexOf(b.attributes.mid)!==-1);if(y.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");y.forEach(b=>{b.media.port="0",b.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const y=this.sessionDesc||pa((b=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(b?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var b;this._rtpCapabilities=v;const R=this.rtpCapabilities.send,O=this.localCapabilities.send;for(const V of y.mediaDescriptions){if(V.attributes.iceUfrag=this._iceParameters.iceUfrag,V.attributes.icePwd=this._iceParameters.icePwd,V.attributes.fingerprints=this._dtlsParameters.fingerprints,V.attributes.candidates=this._candidates,V.attributes.setup=this.setup,V.media.mediaType==="application"&&(V.attributes.sctpPort="5000"),V.media.mediaType==="video"){if(R.videoCodecs.length===0){const k=O.videoCodecs.filter(L=>{var H,q;return(H=L.rtpMap)===null||H===void 0?void 0:Ve(q=H.encodingName.toLowerCase()).call(q,"vp8")})||[O.videoCodecs[0]];V.media.fmts=k.map(L=>L.payloadType.toString(10)),V.attributes.payloads=k,V.attributes.extmaps=[]}else if(V.media.fmts=R.videoCodecs.map(k=>k.payloadType.toString(10)),V.attributes.payloads=R.videoCodecs,V.attributes.extmaps=R.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:k,ssrcGroups:L}=fp([{ssrcId:J6,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);V.attributes.ssrcs=k,V.attributes.ssrcGroups=L}}if(V.media.mediaType==="audio"){if(R.audioCodecs.length===0){const k=O.audioCodecs.filter(L=>{var H,q;return(H=L.rtpMap)===null||H===void 0?void 0:Ve(q=H.encodingName.toLowerCase()).call(q,"opus")})||[O.audioCodecs[0]];V.media.fmts=k.map(L=>L.payloadType.toString(10)),V.attributes.payloads=k,V.attributes.extmaps=[]}else if(V.media.fmts=R.audioCodecs.map(k=>k.payloadType.toString(10)),V.attributes.payloads=R.audioCodecs,V.attributes.extmaps=R.audioExtensions,eg(V),$("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:k,ssrcGroups:L}=fp([{ssrcId:2e4}],this.cname);V.attributes.ssrcs=k,V.attributes.ssrcGroups=L}}}return this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const y=this._originCandidates.filter(R=>R.transport==="udp"),b=[];if(y.forEach(R=>{b.push(X6(X6({},R),{},{foundation:"tcpcandidate",priority:Number(R.priority)-1+"",transport:"tcp",port:Number(R.port)+90+""}))}),y.length!==0){switch(v){case ui.TCP_RELAY:this._candidates=b;break;case ui.UDP_TCP_RELAY:case ui.RELAY:this._candidates=[...y,...b];break;default:this._candidates=y}for(const R of this.sessionDesc.mediaDescriptions)R.attributes.candidates=this.candidates}}restartICE(v){v=Lr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.iceUfrag=v.iceUfrag,y.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const y=[];for(let b=0;b<v;b++)y.push((this.currentMidIndex+b+1).toString(10));return y}findAvailableMediaIndex(v,y){return this.sessionDesc.mediaDescriptions.findIndex(b=>{const R=b.media.mediaType===v&&b.media.port!=="0"&&(b.attributes.direction==="sendonly"||b.attributes.direction==="sendrecv")&&b.attributes.ssrcs.length===0;if(Vr()){if(R){const O=this.firefoxSsrcMidMap.get(y[0].ssrcId);return!(O||b.attributes.mid!=="0"&&b.attributes.mid!=="1")||!(!O||O!==b.attributes.mid)}return!1}return R})}createOrRecycleDataChannel(){for(const b of this.sessionDesc.mediaDescriptions)if(b.media.mediaType==="application")return{mediaDesc:b,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),y={media:{mediaType:"application",port:nE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(y),{mediaDesc:y,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,y,b,R,O,V){const k=v._mediaStreamTrack.kind,L=this.rtpCapabilities.recv,H=Qy(k,L,this.localCapabilities.send,k===$e.VIDEO?R:O),q=k===$e.VIDEO?L.videoExtensions:L.audioExtensions;this.currentMidIndex+=1;const te="".concat(this.currentMidIndex);let oe={media:{mediaType:k,port:nE,protos:["UDP","TLS","RTP","SAVPF"],fmts:H.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:H,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(te)}};oe=this.mungRecvMediaDsec(oe,v,V);const se=this.findFirstClosedMedia(k);if(se){const ae=this.sessionDesc.mediaDescriptions.indexOf(se);this.sessionDesc.mediaDescriptions[ae]=oe}else this.sessionDesc.mediaDescriptions.push(oe);return oe}updateRemoteCodec(v,y,b){const R=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(oe=>oe.rtpMap&&oe.rtpMap.encodingName.toLowerCase()||"").filter(oe=>{var se;return Ve(se=Object.keys(VT)).call(se,oe)}))],O=new Set(y);if(R.every(oe=>O.has(oe)))return N.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(y)),!1;const V=this._rtpCapabilities.recv.videoCodecs.filter(oe=>y.some(se=>{var ae;return Ve(ae=oe.rtpMap&&oe.rtpMap.encodingName.toLowerCase()||"").call(ae,se)}));if(V.length===0)return N.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(R," codecs: ").concat(y)),!1;const k=[...new Set(V.map(oe=>oe.rtpMap&&oe.rtpMap.encodingName.toLowerCase()||""))];let L;if(N.debug("updateRemoteCodec, from ".concat(R," to ").concat(k)),v.length===0)L=this.sessionDesc.mediaDescriptions.filter(oe=>oe.media.mediaType==="video"&&oe.attributes.direction==="recvonly");else if(L=this.sessionDesc.mediaDescriptions.filter(oe=>oe.attributes.mid&&oe.media.mediaType==="video"&&Ve(v).call(v,oe.attributes.mid)&&oe.attributes.direction==="recvonly"),L.length!==v.length)return N.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(y)),!1;if($("USE_PUB_RTX")||$("USE_SUB_RTX")){const oe=nP(V,this.rtpCapabilities.recv.videoCodecs);V.push(...oe)}this._rtpCapabilities.recv.videoCodecs=V;const H=this.localCapabilities.send,q=this.rtpCapabilities.recv,te=Qy($e.VIDEO,q,H,b);return L.forEach(oe=>{const se=te.map(ae=>ae.payloadType.toString(10));N.debug("updateRemoteCodec mid: ".concat(oe.attributes.mid,", from"),oe.attributes.payloads,"to",te),oe.attributes.payloads=te,oe.media.fmts=se}),!0}createOrRecycleSendMedia(v,y,b,R,O){const V=this.rtpCapabilities.send,k=v===$e.VIDEO?V.videoCodecs:V.audioCodecs,L=v===$e.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const H="".concat(this.currentMidIndex);let q={media:{mediaType:v,port:nE,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(oe=>oe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:L,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(H)}};q=this.mungSendMediaDesc(q,O);const te=this.findFirstClosedMedia(v);if(te){const oe=this.sessionDesc.mediaDescriptions.indexOf(te);this.sessionDesc.mediaDescriptions[oe]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,y,b){const R=Lr(v);return tP(R),Zm(R,y),rP(R,y),S6(R),uw(R,b,this.localCapabilities.send),R}mungSendMediaDesc(v,y){const b=Lr(v);return uw(b,y,this.localCapabilities.recv),eg(b),b}updateRecvMedia(v,y){const b=this.sessionDesc.mediaDescriptions.findIndex(R=>R.attributes.mid===v);if(b!==-1){const R=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],y);this.sessionDesc.mediaDescriptions[b]=R}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(y=>Vr()?y.media.port==="0"&&y.media.mediaType===v:y.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(y=>{var b;return((b=y.attributes)===null||b===void 0||(b=b.ssrcs[0])===null||b===void 0?void 0:b.ssrcId)===v[0].ssrcId})}getSSRC(v){var y;return(y=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===v))===null||y===void 0?void 0:y.attributes.ssrcs}}(Xs(Xs({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),l=R6(this.initialOffer.sdp,this.extension),d=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),d==null||d(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),$("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia($("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const y=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(y)}const{preSSRCs:g}=t;if(Array.isArray(g)&&g.length>0){const{mids:v}=this.remoteSDP.batchSend(g.map(y=>({kind:y.kind,ssrcMsg:[{ssrcId:y.ssrcId,rtx:y.rtx}],mslabel:y.mslabel})));v.forEach((y,b)=>{this.preSSRCMap.set(g[b].ssrcId,y)}),await Zy(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var r,a}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:a}=t;if(Array.isArray(a)&&a.length>0){const{mids:c}=this.remoteSDP.batchSend(a.map(l=>Object.assign({},{kind:l.kind,ssrcMsg:[{ssrcId:l.ssrcId,rtx:l.rtx}],mslabel:l.mslabel})));c.forEach((l,d)=>{this.preSSRCMap.set(a[d].ssrcId,l)})}await Zy(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,a){var c=this;return So(function*(){const l=yield Gt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],p=sw();t.forEach(L=>{const H=c.peerConnection.addTransceiver(L._mediaStreamTrack,Xs({direction:"sendonly"},L.trackMediaType==="video"&&c.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));d.push(H),L._updateRtpTransceiver(H)}),Vr()&&$("SIMULCAST")===!0&&(yield Gt(c.applySimulcastForFirefox(d,t)));const g=yield Gt(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(t.length),y=c.mungSendOfferSDP(g.sdp,t,v),b=pa(y),R=v.map(L=>{const H=b.mediaDescriptions.find(q=>q.attributes.mid===L);if(!H)throw new Error("Cannot extract ssrc from mediaDescription.");return v6(H,$("USE_PUB_RTX"))});let O;try{O=yield R}catch(L){O=[],c.remoteSDP.receive(t,r,a,O);const H=c.remoteSDP.toString();throw yield Gt(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Gt(c.peerConnection.setRemoteDescription({type:"answer",sdp:H})),yield Gt(c.stopSending(v,!0)),L}c.remoteSDP.receive(t,r,a,O);const V=c.remoteSDP.toString(),k=c.logSDPExchange(y,"offer","local","send");return yield Gt(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Gt(c.applySimulcastEncodings(d,t)),yield Gt(c.applySendEncodings(d,t)),k==null||k(V),yield Gt(c.peerConnection.setRemoteDescription({type:"answer",sdp:V})),d.map((L,H)=>{const q=v[H];return{localSSRC:R[H],id:q,transceiver:L}})}catch(d){throw d instanceof _e?d:new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(t);if(a&&a.readyState==="open")N.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,a)}r.forEach(l=>{l._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),N.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else N.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof _e?a:new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof _e?r:new _e(K.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var v;vw(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();d==null||d(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,r,a,c);d&&(await Zy(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const p=this.peerConnection.getTransceivers().find(g=>g.mid===l);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:l,transceiver:p}}catch(l){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:a}=this.remoteSDP.batchSend(t);return a&&(await Zy(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(c=>{const l=this.peerConnection.getTransceivers().find(d=>d.mid===c);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:c,transceiver:l}})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preSSRCMap.entries()).some(d=>{let[p,g]=d;if(g===l)return this.preSSRCMap.delete(p),!0})}),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(d=>{d.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(d,p)=>{d.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return So(function*(){const a=yield Gt(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=qt().supportPCSetConfiguration,l=$("FORCE_TURN_TCP")||r.forceTurn;if(t===ui.RELAY&&!c)return;if(c&&!l){const b=t===ui.RELAY?"relay":"all",R=r.peerConnection.getConfiguration();R.iceTransportPolicy!==b&&(N.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(R.iceTransportPolicy,"] to [").concat(b,"]")),R.iceTransportPolicy=b,r.peerConnection.setConfiguration(R))}r.remoteSDP.updateCandidates(t);const d=yield Gt(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=Td(d.sdp),{remoteIceParameters:g}=yield p.iceParameters;r.remoteSDP.restartICE(g);const v=r.remoteSDP.toString(),y=r.logSDPExchange(d.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Gt(r.peerConnection.setLocalDescription(d)),y==null||y(v),yield Gt(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){N.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ui.TCP_RELAY),await Zy(this.peerConnection,this.remoteSDP,this.extension)}catch(r){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{vw(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Xs(Xs({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const l=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),d==null||d(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new _e(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(r)?Vr()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:c}=r.getSelectedCandidatePair();return{local:Xs(Xs({},Gc),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Xs(Xs({},Gc),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const a="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"";N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(t.url||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,a)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(Uy(t.turnServer.servers)?r.iceServers=t.turnServer.servers:$("NEW_TURN_MODE")&&r.iceServers?($("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...Pp.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...Pp.newTurnServerConfigToIceServers(t.turnServer.servers)),$("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...Pp.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Pp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&qt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Sd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!$("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{const c=$("NEW_TURN_MODE");c===1?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Sd(a.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Sd(a.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in c?c.error:c)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const c=r==null?void 0:r.iceTransport.state;var l;c&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:l}=a.getSelectedCandidatePair();N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a,c;if(r||(r=this.peerConnection.getSenders().find(L=>L.track===t._mediaStreamTrack)),!r)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!qt().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},d={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const p=function(k,L){return k.getTransceivers().find(H=>H.sender.track===L||H.receiver.track===L)}(this.peerConnection,t._mediaStreamTrack),g=_se(t);if(Pce(t)&&p&&r&&g&&this.getLocalVideoStats&&Ve(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const k=l.degradationPreference||(Ve(v=t._hints).call(v,dr.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(L,H,q,te,oe,se){if(vw(L,q),oe(H),te!=="balanced"&&te!=="maintain-framerate"&&te!=="maintain-resolution")return;let ae=-1;eW(L,H);const pe=window.setInterval(()=>{const Fe=_w.get(L);if(!$("ENABLE_AG_ADAPTATION")||!Fe)return vw(L,q),void oe(H);const ze=se();if(ze.sendPackets>0&&ze.OutgoingAvailableBandwidth>0){if(ae===-1)return void(ae=Date.now());if(Date.now()-ae<1e3)return;const At=ze.sendFrameRate,bt=ze.OutgoingAvailableBandwidth,[pt,Er]=Nce(L,At,bt,Fe.adaptationConfig,H,te);Er&&(q.qualityLimitationReason=Er),pt&&Fe.adaptationConfig.scale!==pt.scale&&(N.debug("[".concat(L,"] applyAdaptation: ").concat(q.qualityLimitationReason,`
           sendFps `).concat(At,", bwe ").concat(bt,", switch from ").concat(Fe.adaptationConfig.scale," to ").concat(pt.scale," ")),Fe.adaptationConfig=fP(fP({},Fe.adaptationConfig),pt),oe(pt))}},$("CHECK_LOCAL_STATS_INTERVAL")),Te=fP({},H);_w.set(L,{timer:pe,adaptationConfig:Te,originConfig:H,adaptationFunc:oe}),N.debug("[".concat(L,"] start adaptation, originConfig: ").concat(JSON.stringify(H),", degradationPreference: ").concat(te))})(this.id+p.mid,g,this,k,L=>{r&&this.updateAdaptation(r,L)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var y;const{bitrateMax:k,frameRate:L,scaleResolutionDownBy:H}=t._encoderConfig;k&&(d.maxBitrate=1e3*k),(Ve(y=t._hints).call(y,dr.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(L&&(d.maxFramerate=Pa(L)),H&&H>=1&&(d.scaleResolutionDownBy=H))}const{maxFramerate:b}=$("ENCODER_CONFIG_LIMIT");if(b&&typeof b=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,b):b),$("DSCP_TYPE")&&Bl()){var R;const k=$("DSCP_TYPE");Ve(R=["very-low","low","medium","high"]).call(R,k)&&(d.networkPriority=k)}const O=r.getParameters(),V=(c=O.encodings)===null||c===void 0?void 0:c[0];Vr()&&!V&&(l.encodings=[d]),V&&Object.assign(V,d),Object.assign(O,l),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(O.encodings))),await r.setParameters(O),await async function(k,L,H){try{var q;if(!qt().supportSetRtpSenderParameters||!function(pe){return pe==="vp9"||pe==="av1"}(k)||!$("ENABLE_SVC"))return;const te={},oe={},se=L.getParameters(),ae=(q=se.encodings)===null||q===void 0?void 0:q[0];oe.scalabilityMode=sw(H),ae&&Object.assign(ae,oe),Object.assign(se,te),await L.setParameters(se),N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(se.encodings)))}catch(te){N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",te)}}(this.store.codec,r,$("SVC_MODE"))}async updateAdaptation(t,r){var a,c;if(!t)return N.debug("[updateAdaptation] no rtpSender found");if(!qt().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:d,frameRate:p,scaleResolutionDownBy:g}=r;d&&(l.maxBitrate=1e3*d),p&&(l.maxFramerate=Pa(p)),g&&g>=1&&Ve(a=["vp8","vp9"]).call(a,this.store.codec)&&(l.scaleResolutionDownBy=g);const v=t.getParameters(),y=(c=v.encodings)===null||c===void 0?void 0:c[0];y&&Object.assign(y,l),Object.assign(v,{});try{await t.setParameters(v),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(b){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],l=r[a];l instanceof Tr&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,c.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){const c=pa(t);return r.forEach((l,d)=>{const p=a[d],g=c.mediaDescriptions.find(v=>v.attributes.mid===p);g&&(Zm(g,l),b6(g,l,this.store.codec))}),vd(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var a,c,l,d,p;const v=t[g],y=r[g];if(y instanceof Tr&&!Ve(a=y._hints).call(a,dr.LOW_STREAM)&&(c=y._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((l=y._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=y._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((p=y._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const b={},R={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:R.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:R.high}];const O=v.sender.getParameters();await v.sender.setParameters(Object.assign(O,b))}}}async applySimulcastEncodings(t,r){if(!Vr()&&t.length===r.length)for(let a=0;a<t.length;a++){const c=r[a];if(c instanceof Tr&&this.isVP8Simulcast(c)){const l=t[a],d={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const g=l.sender.getParameters();await l.sender.setParameters(Object.assign(g,d))}}}isVP8Simulcast(t){var r,a,c,l,d;return!!(t instanceof Tr&&$("SIMULCAST")&&this.store.codec==="vp8"&&!Ve(r=t._hints).call(r,dr.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,r,a,c){if($("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?l=>{this.logSDPExchange(l,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(qt().supportPCSetConfiguration){const r=Pp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Qe(Ft.prototype,"updateRemoteRTPCapabilities",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"updateRemoteRTPCapabilities"),Ft.prototype),Qe(Ft.prototype,"connect",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"connect"),Ft.prototype),Qe(Ft.prototype,"updateRemoteConnect",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"updateRemoteConnect"),Ft.prototype),Qe(Ft.prototype,"createDataChannels",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"createDataChannels"),Ft.prototype),Qe(Ft.prototype,"receive",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"receive"),Ft.prototype),Qe(Ft.prototype,"batchReceive",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"batchReceive"),Ft.prototype),Qe(Ft.prototype,"stopReceiving",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"stopReceiving"),Ft.prototype),Qe(Ft.prototype,"muteRemote",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"muteRemote"),Ft.prototype),Qe(Ft.prototype,"unmuteRemote",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"unmuteRemote"),Ft.prototype),Qe(Ft.prototype,"muteLocal",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"muteLocal"),Ft.prototype),Qe(Ft.prototype,"unmuteLocal",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"unmuteLocal"),Ft.prototype),Qe(Ft.prototype,"close",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"close"),Ft.prototype),Qe(Ft.prototype,"updateEncoderConfig",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"updateEncoderConfig"),Ft.prototype),Qe(Ft.prototype,"updateSendParameters",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"updateSendParameters"),Ft.prototype),Qe(Ft.prototype,"replaceTrack",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"replaceTrack"),Ft.prototype),Qe(Ft.prototype,"updateAdaptation",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"updateAdaptation"),Ft.prototype),Qe(Ft.prototype,"getRemoteSSRC",[Zi],Object.getOwnPropertyDescriptor(Ft.prototype,"getRemoteSSRC"),Ft.prototype),Ft);function Zi(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,l=await c.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,p=new Array(d),g=0;g<d;g++)p[g]=arguments[g];return await a.apply(this,p)}finally{l()}},r}function vP(e,t){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=Pa(t.width),a.height=Pa(t.height);const c=Pa(t.framerate||15);document.body.append(r),document.body.append(a);let l=e._mediaStreamTrack;r.srcObject=new MediaStream([l]),r.play();const d=a.getContext("2d");if(!d)throw new he(K.UNEXPECTED_ERROR,"can not get canvas context");const p=qt(),g=a.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const y=r.videoWidth,b=r.videoHeight/y,R=a.width*b;Math.abs(R-a.height)>=2&&(N.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(R)),a.height=R)}d.drawImage(r,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,r.srcObject=new MediaStream([l]))},a.stopCapture=ON(()=>a.startCapture&&a.startCapture(),c);const v=g.stop;return g.stop=()=>{v.call(g),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),N.debug("clean low stream renderer")},g}var cs=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(cs||{}),gt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(gt||{}),Yn=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Yn||{}),ea=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ea||{}),Ew=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(Ew||{});const gp=1e3,Sw=6,iE=3,kce=Math.max(Sw,iE);function lt(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function aW(e){const t={[ea.CONN_TYPE]:0,[ea.RTT]:e.rtt,[ea.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[ea.CONN_TYPE]=1),r==="tcp"&&(t[ea.CONN_TYPE]=3),r==="tls"&&(t[ea.CONN_TYPE]=4);break}case"srflx":t[ea.CONN_TYPE]=2;break;case"unknown":t[ea.CONN_TYPE]=5;break;default:t[ea.CONN_TYPE]=0}return t}function oW(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class sW extends kr{constructor(t){super(),G(this,"store",void 0),G(this,"uploadWRTCStatsTimer",void 0),G(this,"uploadOutboundDenoiserStatsTimer",void 0),G(this,"uploadExtStatsTimer",void 0),G(this,"uploadExtUsageStatsTimer",void 0),G(this,"uploadInboundExtStatsTimer",void 0),G(this,"requestStats",void 0),G(this,"requestTransportStats",void 0),G(this,"requestLocalMedia",void 0),G(this,"requestRemoteMedia",void 0),G(this,"requestAllTracks",void 0),G(this,"requestVideoIsReady",void 0),G(this,"requestUploadStats",void 0),G(this,"requestUpload",void 0),G(this,"uploadOutboundStarted",!1),G(this,"uploadInboundStarted",!1),G(this,"uploadTransportStarted",!1),G(this,"uploadBaseStatsStarted",!1),G(this,"uploadExtensionUsageStarted",!1),G(this,"lastRecvStats",void 0),G(this,"lastSendStats",void 0),G(this,"lastRefRecvStats",void 0),G(this,"lastRefSendStats",void 0),G(this,"lastNormalRecvStats",void 0),G(this,"lastNormalSendStats",void 0),G(this,"needUploadRenderFreezeTime",!0),G(this,"lastUploadCompensateTime",-1),G(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const r=t%iE==0,a=t%Sw==0;let c,l;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),c||l){var d;const p={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,l,r);v&&(p.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,a?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats);v&&(p.outbound=[v])}if(this.uploadInboundStarted&&l){this.uploadCompensateStats(t);const v=this.getInboundStats(l,a?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(p.inbound=v)}const g=(d=this.requestTransportStats)===null||d===void 0?void 0:d.call(this).connectState;g&&(Array.isArray(p.misc)?p.misc[0]&&p.misc[0].addition&&(p.misc[0].addition[Ew.RTC_PEER_CONNECTION_STATE]=pN[g]):p.misc=[{addition:{[Ew.RTC_PEER_CONNECTION_STATE]:pN[g]}}]),this.requestUploadStats(p)}this.lastRecvStats=l,this.lastSendStats=c,a&&(this.lastNormalRecvStats=l,this.lastNormalSendStats=c),r&&(this.lastRefRecvStats=l,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,a;const c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[Ew.RTC_PEER_CONNECTION_STATE]:pN[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===kce+1&&(t=1)},gp)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=t%iE==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const l=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const d={};if(this.uploadInboundStarted&&l){const p=this.requestRemoteMedia()||[],g=[];p.forEach(v=>{let[y,b]=v;const R={peer:y.uid};if(y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)&&b.has($e.VIDEO)&&y.videoTrack){const O=function(V,k,L){if(!k.videoRecv.find(q=>q.ssrc===V))return;const H={};if(L&&L._player){const q=L._player,{renderFreezeAccTime2:te,videoElementStatus:oe}=q;if(Kc.visibility==="visible"&&oe===gi.PLAYING&&qt().supportRequestVideoFrameCallback){const se=Math.min(6e3,te);q.renderFreezeAccTime2=Math.max(0,te-se),lt(H,cs.Video_Render_Freeze_Time_Render2,se),$("USE_NEW_RENDER_FREEZE_TIME")&&lt(H,cs.Video_Render_Freeze_Time_Render,se)}}return H}(y._videoSSRC,l,y.videoTrack);O&&(R.video=O)}R.video&&g.push(R)}),g.length>0&&(d.inbound=g,this.requestUploadStats(d))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,a){if(!this.requestStats)return;if(!a)return t.rtt==null?void 0:{addition:{[ea.RTT]:t.rtt,[ea.CONN_TYPE]:void 0,[ea.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const c=aW(t);if(this.store.useP2P){if(r){const l=aW(r);c[ea.CONN_TYPE]+=l[ea.CONN_TYPE]<<3}c[ea.CONN_TYPE]+=110}else c[ea.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,r,a,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let d,p,g;return l.forEach(v=>{let[y,{track:b,ssrcs:R}]=v;switch(y){case Ie.LocalVideoLowTrack:case Ie.LocalVideoTrack:if(y===Ie.LocalVideoTrack){const O=function(L,H,q,te,oe,se){const ae=H.videoSend.find(At=>At.ssrc===L);if(!ae)return;const pe={},{sentFrame:Te,inputFrame:Fe}=ae;if(te&&(lt(pe,cs.Video_Send_Qp_Sum,ae.qpSumPerFrame),Fe&&Te)){var ze;const At=Fe.frameRate,bt=Te.frameRate;pe[cs.Video_Send_Freeze]=function(pt,Er){let hr=!0;return hr=!(pt<=5)&&(pt<=10?Er<3:pt<=20?Er<4:Er<5),hr}(At,bt)?1:0,pe[cs.Video_Send_Type]=q.__className__==="CameraVideoTrack"?0:Ve(ze=q._hints).call(ze,dr.SCREEN_TRACK)?1:2}if(oe){switch(Te&&(lt(pe,gt.Video_Send_Height,Te.height),lt(pe,gt.Video_Send_Width,Te.width),lt(pe,gt.Video_Send_Frame_Rate,Te.frameRate)),pe[gt.Video_Send_Disabled]=q._originMediaStreamTrack&&!q._originMediaStreamTrack.enabled||q._mediaStreamTrack&&!q._mediaStreamTrack.enabled?1:0,ae.adaptionChangeReason){case"none":pe[gt.Video_Send_Adaptation]=0;break;case"cpu":pe[gt.Video_Send_Adaptation]=1;break;case"bandwidth":pe[gt.Video_Send_Adaptation]=2;break;case"other":pe[gt.Video_Send_Adaptation]=3}let At=0;ae.adaptionChangeReason&&(At+=oW(ae.adaptionChangeReason)),H.qualityLimitationReason&&(At+=oW(H.qualityLimitationReason)<<3),pe[gt.Video_Send_Adaptation]=At,pe[gt.Video_Send_Player_Status]=CN[q._player?q._player.videoElementStatus:"uninit"],lt(pe,gt.Video_Send_Nacks,ae.nacksCount),lt(pe,gt.Video_Send_Plis,ae.plisCount),lt(pe,gt.Video_Send_Firs,ae.firsCount),lt(pe,gt.Video_Send_Avg_Encode,ae.avgEncodeMs),lt(pe,gt.Video_Send_Huge_Frame_Sent,ae.hugeFramesSent),lt(pe,gt.Video_Send_Bytes_Retransmit,ae.retransmittedBytesSent),lt(pe,gt.Video_Send_Packages_Retransmit,ae.retransmittedPacketsSent),lt(pe,gt.Video_Send_Key_Frames_Encoded,ae.keyFramesEncoded);const bt=oe.videoSend.find(pt=>pt.ssrc===L);if(bt){let pt=gp*iE;bt.timestamp&&ae.timestamp&&(pt=ae.timestamp-bt.timestamp),bt.packets!=null&&ae.packets!=null&&lt(pe,gt.Video_Send_Package_Rate,1e3*(ae.packets-bt.packets)/pt),ae.packetsLost!=null&&bt.packetsLost!=null&&lt(pe,gt.Video_Send_Package_Lost,ae.packetsLost-bt.packetsLost),bt.bytes!=null&&ae.bytes!=null&&lt(pe,gt.Video_Send_Bitrate,8*(ae.bytes-bt.bytes)/pt)}}return pe}(R[0].ssrcId,t,b,r,a),V=b&&function(L,H,q,te){const oe=H.videoSend.find(ae=>ae.ssrc===L);if(!oe)return null;const se={};if(te){const ae=oe.inputFrame,pe=ae&&ae.height||q.videoHeight||0,Te=ae&&ae.width||q.videoWidth||0,Fe=ae&&ae.frameRate||0;lt(se,gt.Video_Capture_Height,pe),lt(se,gt.Video_Capture_Width,Te),lt(se,gt.Video_Capture_Frame_Rate,Fe)}return se}(R[0].ssrcId,t,b,!!a),k=function(L,H){const q={};return H&&(lt(q,gt.Video_Send_Retransmit,L.bitrate.retransmit),lt(q,gt.Video_Send_Target_Encoded,L.bitrate.targetEncoded),lt(q,gt.Video_Send_Actual_Encoded,L.bitrate.actualEncoded),lt(q,gt.Video_Send_Transmit,L.bitrate.transmit),lt(q,gt.Video_Send_Bandwidth,L.sendBandwidth)),q}(t,!!a);p=Object.assign({},O,V,k)}else g=function(O,V,k,L,H){const q=V.videoSend.find(oe=>oe.ssrc===O);if(!q)return;const te={};if(L){const oe=q.sentFrame;oe&&(lt(te,gt.Video_Send_Low_Height,oe.height),lt(te,gt.Video_Send_Low_Width,oe.width),lt(te,gt.Video_Send_Low_Frame_Rate,oe.frameRate));const se=L.videoSend.find(ae=>ae.ssrc===O);if(se){let ae=gp*Sw;se.timestamp&&q.timestamp&&(ae=q.timestamp-se.timestamp),se.packets!=null&&q.packets!=null&&lt(te,gt.Video_Send_Low_Package_Rate,1e3*(q.packets-se.packets)/ae),q.packetsLost!=null&&se.packetsLost!=null&&lt(te,gt.Video_Send_Low_Package_Lost,q.packetsLost-se.packetsLost),se.bytes!=null&&q.bytes!=null&&lt(te,gt.Video_Send_Low_Bitrate,8*(q.bytes-se.bytes)/ae)}}return te}(R[0].ssrcId,t,0,a);break;case Ie.LocalAudioTrack:d=b&&function(O,V,k,L,H,q){const te=V.audioSend.find(se=>se.ssrc===O);if(!te)return;const oe={};if(H){oe[gt.Audio_Send_Disabled]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0;const se=100*k._source.getAccurateVolumeLevel(),ae=te.inputLevel;if(ae!=null){const Te=Math.ceil(50*Math.log10(100*ae+1));lt(oe,gt.Audio_Send_Level,Te)}lt(oe,gt.Audio_Capture_PCM_Level,se),lt(oe,gt.Audio_Send_AEC_Return_Loss,te.aecReturnLoss),lt(oe,gt.Audio_Send_AEC_Return_Loss_Enhancement,te.aecReturnLossEnhancement),lt(oe,gt.Audio_Send_Bytes_Retransmit,te.retransmittedBytesSent),lt(oe,gt.Audio_Send_Packages_Retransmit,te.retransmittedPacketsSent),oe[gt.Audio_Send_Freeze]=0;const pe=H.audioSend.find(Te=>Te.ssrc===O);if(pe){let Te=gp*Sw;pe.timestamp&&te.timestamp&&(Te=te.timestamp-pe.timestamp),pe.bytes!=null&&te.bytes!=null&&lt(oe,gt.Audio_Send_Bitrate,8*(te.bytes-pe.bytes)/Te),pe.packets!=null&&te.packets!=null&&lt(oe,gt.Audio_Send_Package_Rate,1e3*(te.packets-pe.packets)/Te)}}return oe}(R[0].ssrcId,t,b,0,a)}}),{high:p,low:g,audio:d}}getInboundStats(t,r,a,c){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],d=[];return l.forEach(p=>{let[g,v]=p;const y={peer:g.uid};if(v.has($e.VIDEO)&&g.videoTrack){const b=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,R=g.videoTrack?function(O,V,k,L,H,q,te,oe){const se=V.videoRecv.find(pt=>pt.ssrc===O);if(!se)return;const ae={},{receivedFrame:pe,outputFrame:Te,decodeFrameRate:Fe}=se;lt(ae,Yn.Video_Render_Frame_Rate_Decode,Fe),se.framesRateFirefox&&lt(ae,Yn.Video_Recv_Frame_Rate,se.framesRateFirefox),pe&&lt(ae,Yn.Video_Recv_Frame_Rate,pe.frameRate),lt(ae,Yn.Video_Recv_Frame_Dropped,se.framesDroppedCount),lt(ae,Yn.Video_Recv_Bytes_Retransmit,se.retransmittedBytesReceived),lt(ae,Yn.Video_Recv_Packages_Retransmit,se.retransmittedPacketsReceived),lt(ae,Yn.Video_Recv_Packages_Discarded,se.packetsDiscarded),lt(ae,Yn.Video_Recv_Avg_Decode,se.avgDecodeMs),lt(ae,Yn.Video_Recv_Avg_Processing_Delay,se.avgProcessingDelayMs),lt(ae,Yn.Video_Recv_Avg_Assembly_Time,se.avgFramesAssembledFromMultiplePacketsMs),lt(ae,Yn.Video_Recv_Avg_Inter_Frame_Delay,se.avgInterFrameDelayMs),lt(ae,Yn.Video_Recv_Key_Frames_Decoded,se.keyFramesDecoded);const ze=oe&&oe.videoRecv.find(pt=>pt.ssrc===O);if(ze){const pt=V.timestamp-oe.timestamp||gp;se.packetsLost!=null&&ze.packetsLost!=null&&lt(ae,Yn.Video_Recv_Package_Lost,se.packetsLost-ze.packetsLost),ze.bytes!=null&&se.bytes!=null&&lt(ae,Yn.Video_Recv_Bitrate,8*(se.bytes-ze.bytes)/pt),ze.packets!=null&&se.packets!=null&&lt(ae,Yn.Video_Recv_Package_Rate,1e3*(se.packets-ze.packets)/pt)}const At=q&&q.videoRecv.find(pt=>pt.ssrc===O);if(At&&(lt(ae,cs.Video_Recv_Qp_Sum,se.qpSumPerFrame),ae[cs.Video_Recv_Freeze]=L&&rE.isRemoteVideoFreeze(k,se,At)?1:0),te){var bt;const pt=te.videoRecv.find(hr=>hr.ssrc===O);pe?(lt(ae,gt.Video_Recv_Height,pe.height),lt(ae,gt.Video_Recv_Width,pe.width)):k&&(lt(ae,gt.Video_Recv_Height,k._videoHeight||0),lt(ae,gt.Video_Recv_Width,k._videoWidth||0)),Te&&lt(ae,gt.Video_Recv_Frame_Rate_Output,Te.frameRate);const Er=(bt=k._player)===null||bt===void 0?void 0:bt.rendFrameRate.toFixed(0);if(Er&&lt(ae,gt.Video_Render_Frame_Rate_Render,+Er),lt(ae,gt.Video_Recv_Jitter_Buffer,se.jitterBufferMs),lt(ae,gt.Video_Recv_Current_Delay,se.currentDelayMs),lt(ae,gt.Video_Recv_Firs,se.firsCount),lt(ae,gt.Video_Recv_Nacks,se.nacksCount),lt(ae,gt.Video_Recv_Plis,se.plisCount),k){ae[gt.Video_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;const hr=k._player;if(hr){const{freezeTimeCounterList:ra,renderFreezeAccTime:we,renderFreezeAccTime2:Le,videoElementStatus:Xe}=hr;if(ra&&ra.length>0&&lt(ae,cs.Video_Render_Freeze_Time,ra.splice(0,1)[0]),H&&Kc.visibility==="visible"&&Xe===gi.PLAYING&&qt().supportRequestVideoFrameCallback){const Re=Math.min(6e3,Le);hr.renderFreezeAccTime2=Math.max(0,Le-Re),lt(ae,cs.Video_Render_Freeze_Time_Render2,Re);const D=Math.min(6e3,we);hr.renderFreezeAccTime=Math.max(0,we-D),lt(ae,cs.Video_Render_Freeze_Time_Render,$("USE_NEW_RENDER_FREEZE_TIME")?Re:D)}if(typeof se.totalFreezesDuration=="number"){const Re=pt&&pt.totalFreezesDuration?se.totalFreezesDuration-pt.totalFreezesDuration:se.totalFreezesDuration;lt(ae,gt.Video_Render_Freeze_Duration,1e3*Re)}}}if(ae[gt.Video_Recv_Player_Status]=CN[k._player?k._player.videoElementStatus:"uninit"],pt&&se.totalInterFrameDelay!==void 0&&se.totalSquaredInterFrameDelay!==void 0&&pt.totalInterFrameDelay!==void 0&&pt.totalSquaredInterFrameDelay!==void 0){const hr=se.totalInterFrameDelay-pt.totalInterFrameDelay,ra=se.totalSquaredInterFrameDelay-pt.totalSquaredInterFrameDelay,we=se.framesDecodeCount-pt.framesDecodeCount,Le=hr/we*1e3,Xe=Math.round(1e3*Math.sqrt((ra-Math.pow(hr,2)/we)/we));!isNaN(Xe)&&Le+Xe>Math.max(3*Le,Le+150)&&(ae[gt.Video_Recv_I_Frame_Delay]=Xe)}}return ae}(g._videoSSRC,t,g.videoTrack,b===!0,this.needUploadRenderFreezeTime,r,a,c):void 0;R&&(y.video=R)}if(v.has($e.AUDIO)&&g.audioTrack){const b=g.audioTrack?function(R,O,V,k,L,H){const q=O.audioRecv.find(ae=>ae.ssrc===R);if(!q)return;const te={};lt(te,Yn.Audio_Recv_Jitter,q.jitterMs),lt(te,Yn.Audio_Recv_Bytes_Retransmit,q.retransmittedBytesReceived),lt(te,Yn.Audio_Recv_Packages_Retransmit,q.retransmittedPacketsReceived),lt(te,Yn.Audio_Recv_Packages_Discarded,q.packetsDiscarded),lt(te,Yn.Audio_Recv_Avg_Processing_Delay,q.avgProcessingDelayMs);const oe=H&&H.audioRecv.find(ae=>ae.ssrc===R);if(oe){const ae=gp;q.packets!=null&&oe.packets!=null&&lt(te,Yn.Audio_Recv_Package_Rate,1e3*(q.packets-oe.packets)/ae),q.packetsLost!=null&&oe.packetsLost!=null&&lt(te,Yn.Audio_Recv_Package_Lost,q.packetsLost-oe.packetsLost)}if(k){const{receivedFrames:ae,droppedFrames:pe}=q;ae!=null&&pe!=null&&(te[cs.Audio_Recv_Freeze]=(se=ae)===0||100*pe/se>20?1:0)}var se;if(L){const ae=100*V._source.getAccurateVolumeLevel(),pe=q.outputLevel;if(pe!=null){const Fe=Math.ceil(50*Math.log10(100*pe+1));lt(te,gt.Audio_Render_Level,Fe)}lt(te,gt.Audio_Recv_PCM_Level,ae),V&&(te[gt.Audio_Recv_Disabled]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1),lt(te,gt.Audio_Recv_Jitter_Buffer,q.jitterBufferMs),lt(te,gt.Audio_Recv_Current_Delay,q.jitterBufferMs),te[gt.Audio_Recv_Player_Status]=CN[Qi.getPlayerState(V.getTrackId())];const Te=L.audioRecv.find(Fe=>Fe.ssrc===R);if(Te){Te.bytes!=null&&q.bytes!=null&&lt(te,gt.Audio_Recv_Bitrate,8*(q.bytes-Te.bytes)/(gp*iE));const Fe=q.concealedSamples-Te.concealedSamples;Fe>0&&lt(te,gt.Audio_Recv_Concealed_Samples,Fe);const ze=q.totalSamplesReceived-Te.totalSamplesReceived;ze>0&&lt(te,gt.Audio_Recv_Total_Samples_Received,ze);const At=q.freezeSamples80-Te.freezeSamples80;At>0&&lt(te,gt.Audio_Render_Freeze_Samples_80ms,At);const bt=q.freezeSamples200-Te.freezeSamples200;bt>0&&lt(te,gt.Audio_Render_Freeze_Samples_200ms,bt);const pt=q.freezeMs80-Te.freezeMs80;lt(te,gt.Audio_Render_Freeze_Time_80ms,pt<0?0:pt);const Er=q.freezeMs200-Te.freezeMs200;lt(te,gt.Audio_Render_Freeze_Time_200ms,Er<0?0:Er)}}return te}(g._audioSSRC,t,g.audioTrack,r,a,c):void 0;b&&(y.audio=b)}(y.video||y.audio)&&d.push(y)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(r=>r instanceof Hy);if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(Ky.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,a]=t;a.has($e.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has($e.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r=Date.now(),a={connectionInterval:$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of l)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,y]of d)y.has($e.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),y.has($e.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(v,y){const b={};for(const{id:k,value:L,level:H,direction:q}of v){var R;const te=(R=y.get(k))!==null&&R!==void 0?R:0,oe=L===2?te+$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:te;var O,V;y.set(k,oe),b[k]?(L===2&&(b[k].value=L),H>b[k].level&&(b[k].level=H),q==="remote"&&(b[k].remoteUidCount+=1),b[k].totalTs=(O=y.get(k))!==null&&O!==void 0?O:0):b[k]={value:L,level:H,remoteUidCount:q==="local"?0:1,totalTs:(V=y.get(k))!==null&&V!==void 0?V:0}}return Object.keys(b).map(k=>{const{level:L,value:H,totalTs:q}=b[k];return{id:k,level:L,value:H,totalTs:q}})}(c,t);const p=Date.now(),g=p>r?p:r+1;this.requestUpload&&this.requestUpload(Ky.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:g})},$("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Lce=$("ICE_RESTART_INTERVAL");let bw=new Map,ig=new Map,Cd=[ui.UDP_TCP_RELAY,ui.TCP_RELAY,ui.RELAY],yP=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&qt().supportPCSetConfiguration;function cW(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=bw.get(e.id);r&&(window.clearTimeout(r),bw.delete(e.id));const a=ig.get(e.id);t&&a&&a.index===Cd.length-1&&(N.debug("[".concat(e.id,"] reset ICE restart policy")),ig.delete(e.id))}function lW(e,t,r){if(bw.size===0&&ig.size===0&&(Array.isArray($("RESTART_SEQUENCE"))&&$("RESTART_SEQUENCE").length>0&&!function(p,g){if(p.length!==g.length)return!1;for(let v=0;v<p.length;v+=1){const y=p[v];if(p.filter(b=>b===y).length!==g.filter(b=>b===y).length)return!1}return!0}(Cd,$("RESTART_SEQUENCE"))&&(Cd=$("RESTART_SEQUENCE").filter(p=>{var g;if(Ve(g=Object.values(ui)).call(g,p))return!0}),N.debug("use reconnection policy from config distribution, queues: ".concat(Cd.join(" => ")))),yP=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&qt().supportPCSetConfiguration),Cd.length===0)return void r();let a,{index:c=0,type:l}=ig.get(e.id)||{};if(yP&&l===ui.RELAY)return void r();let d=l&&c>=Cd.length-1;if(yP)l=ui.RELAY;else{if(d)return void r();l?(c++,l=Cd[c]):(l=Cd[0],c=0)}N.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(c)),t(l),ig.set(e.id,{index:c,type:l}),a=window.setTimeout(()=>lW(e,t,r),Lce),bw.set(e.id,a)}var Nt;function uW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Jc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uW(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function dW(e){var t,r,a,c=2;for(typeof Symbol<"u"&&(r=BI,a=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new Tw(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function Tw(e){function t(r){if(Object(r)!==r)return Ge.reject(new TypeError(r+" is not an object."));var a=r.done;return Ge.resolve(r.value).then(function(c){return{value:c,done:a}})}return Tw=function(r){this.s=r,this.n=r.next},Tw.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Ge.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Ge.reject(r):t(a.apply(this.s,arguments))}},new Tw(e)}let aE=(Nt=class extends kr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(at.StateChange,t,this._state)}constructor(e,t){super(),G(this,"isPlanB",void 0),G(this,"store",void 0),G(this,"statsUploader",void 0),G(this,"connection",void 0),G(this,"localTrackMap",new Map),G(this,"remoteUserMap",new Map),G(this,"localDataChannels",[]),G(this,"remoteDataChannelMap",new Map),G(this,"pendingLocalTracks",[]),G(this,"pendingRemoteTracks",[]),G(this,"pendingLocalDataChannels",[]),G(this,"pendingRemoteDataChannels",[]),G(this,"statsCollector",void 0),G(this,"shouldForwardP2PCreation",void 0),G(this,"iceFailedCount",0),G(this,"dtlsFailedCount",0),G(this,"mutex",void 0),G(this,"_state",rr.Disconnected),G(this,"_pcStatsUploadType",$("NEW_ICE_RESTART")?zl.FIRST_CONNECTION:zl.OLD_FIRST_CONNECTION),G(this,"_isStartRestartIce",!1),G(this,"_restartTimer",void 0),G(this,"_isTryConnecting",!1),G(this,"_iceError",null),G(this,"_forceTurn",!1),G(this,"_isWaitPcToRePub",!1),G(this,"handleMuteLocalTrack",async(r,a,c)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==rr.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const d=this.filterTobeMutedTracks(r);if(d.length===0)return void a();const p=d.find(v=>v[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(d.map(v=>{let[,{id:y}]=v;return y}));const g=this.createMuteMessage(d);await pr(this,at.RequestMuteLocal,g),a()}catch(d){c(d)}finally{l()}}),G(this,"handleUnmuteLocalTrack",async(r,a,c)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==rr.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const d=this.filterTobeUnmutedTracks(r);if(d.length===0)return void a();const p=d.find(v=>v[0]==="videoLowTrack");if(p){const v=p[1];if(v.track._originMediaStreamTrack.stop(),!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&qt().supportDualStreamEncoding){const y=r._mediaStreamTrack.clone();v.track._mediaStreamTrack=y,v.track._originMediaStreamTrack=y}else{const y=vP(r,jy(this,at.RequestLowStreamParameter));v.track._mediaStreamTrack=y,v.track._originMediaStreamTrack=y}await new Ge((y,b)=>{this.handleReplaceTrack(v.track,y,b,!0)})}await this.connection.unmuteLocal(d.map(v=>{let[,{id:y}]=v;return y}));const g=this.createUnmuteMessage(d);await pr(this,at.RequestUnmuteLocal,g),a()}catch(d){c(d)}finally{l()}}),G(this,"handleUpdateVideoEncoder",async(r,a,c,l)=>{let d;l||(d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.connection||!g||g.track!==r||this.state!==rr.Connected)return void a();const{id:v,track:y}=g;await this.connection.updateSendParameters(v,y),await this.connection.updateEncoderConfig(v,y),this.emit(at.UpdateVideoEncoder,y),a()}catch(g){c(g)}finally{var p;(p=d)===null||p===void 0||p()}}),G(this,"handleUpdateVideoSendParameters",async(r,a,c)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.connection||!d||d.track!==r||this.state!==rr.Connected)return void a();const{id:p,track:g}=d;await this.connection.updateSendParameters(p,g),a()}catch(d){c(d)}finally{l()}}),G(this,"handleReplaceMixingTrack",async(r,a,c,l)=>{if(!this.connection||this.state!==rr.Connected)return void a();const d=gP([r]);let p;N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof l=="boolean"&&l||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,d),a()}catch(v){c(v)}finally{var g;(g=p)===null||g===void 0||g()}}),G(this,"handleReplaceTrack",async(r,a,c,l)=>{let d;N.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof l=="boolean"&&l||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;const v=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:b}]=y;return r===b});if(!this.connection||!v||this.state!==rr.Connected)return void a();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(r,v[1].id)),this.isPlanB){const y=v[1];y.id=r._mediaStreamTrack.id,this.localTrackMap.set(v[0],y)}if(v[0]===Ie.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&qt().supportDualStreamEncoding){const y=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(y){const b=r._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b,await new Ge((R,O)=>{this.handleReplaceTrack(y.track,R,O,!0)})}}a()}catch(v){c(v)}finally{var g;(g=d)===null||g===void 0||g()}}),G(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),G(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),G(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),G(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),G(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sW(this.store),this.bindStatsUploaderEvents(),this.mutex=new ci("P2PChannel-mutex",this.store.clientId),this.isPlanB=!qt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&Bl(),this.shouldForwardP2PCreation=$("FORWARD_P2P_CREATION")&&qt().supportPCSetConfiguration&&ZI(),this.shouldForwardP2PCreation&&(this.connection=yw(this.store),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=rr.New,this._forceTurn=nW(e),N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=yw(this.store,e),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$("NEW_ICE_RESTART")?zl.FIRST_CONNECTION:zl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");$("ENABLE_PREALLOC_PC")&&this.state===rr.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=rr.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(c=>{var l;let[d]=c;return Ve(l=[Ie.LocalVideoLowTrack,Ie.LocalVideoTrack]).call(l,d)}),r=t.map(c=>{let[,{id:l}]=c;return l}),a=t.map(c=>{let[l]=c;return l});if(this.connection instanceof Xc){if(Ze.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ve(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(l=>Ve(e).call(e,l));c&&(this.store.codec=c,N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof Xc&&this.connection.peerConnectionState!=="closed"&&Ve(e=[rr.New,rr.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==rr.Connected){if(this.state===rr.Disconnected)throw new _e(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var a;Ve(a=this.pendingLocalDataChannels).call(a,r)||this.pendingLocalDataChannels.push(r)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{const a=Date.now();this.store.publish(r.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);const a=Date.now();this.store.publish(r.id+"","datachannel",void 0,a)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var a=this;return So(function*(){const c=yield Gt(a.mutex.lock("From P2PChannel.publish"));try{var l;const d=a.connection&&Ve(l=["disconnected","failed"]).call(l,a.connection.peerConnectionState);if(!a.connection||a.state!==rr.Connected||d){if(a.state===rr.Disconnected)throw new _e(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(e);const g=e.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(g),void(d&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,di.markPublishStart(a.store.clientId,a.store.pubId);const p=a.filterTobePublishedTracks(e,t,r);if(p.length===0)return void(yield Gt(a.tryToUnmuteAudio(e)));yield*yT(dW(a.doPublish(a.connection,p)))}finally{c()}})()}doPublish(e,t){var r=this;return So(function*(){t.forEach(R=>{let{track:O,type:V}=R;const k=Date.now();r.store.publish(O.getTrackId(),V===Ie.LocalAudioTrack?"audio":"video",k)}),r.bindLocalTrackEvents(t);const a=t.map(R=>{let{track:O}=R;return O}),c=yield Gt(e.send(a,r.store.codec,r.store.audioCodec)),l=(yield Gt(c.next())).value,d=r.createGatewayPublishMessage(t,l);let p;try{p=yield d}catch(R){throw c.throw(R),(R==null?void 0:R.code)===K.WS_ABORT&&t.forEach(O=>{let{track:V}=O;r.pendingLocalTracks.indexOf(V)===-1&&r.pendingLocalTracks.push(V)}),r.unbindLocalTrackEvents(t),R}const g=r.mapPubResToRemoteConfig(d,p,a),v=(yield Gt(c.next(g))).value;if(r.state===rr.Disconnected)throw new _e(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");$("ENABLE_VIDEO_SEI");const y=$("ENABLE_ENCODED_TRANSFORM"),b=$("ENABLE_AUDIO_METADATA");a.forEach(async R=>{const O=R.getRTCRtpTransceiver();if(!O||!y)return;const{interceptLocalVideoFrame:V,interceptLocalAudioFrame:k}=hw();R.trackMediaType===$e.VIDEO?await V(O.sender,R):R.trackMediaType===$e.AUDIO&&await k(O.sender,{metadata:b?()=>{const L=R.metadata.shift();return L&&L.value}:void 0})}),t.forEach(R=>{let{type:O}=R;r.statsCollector.addLocalStats(O)}),r.assignLocalTracks(t,v),r.statsUploader.startUploadOutboundStats(),t.forEach(R=>{let{track:O,type:V}=R;const k=Date.now();r.store.publish(O.getTrackId(),V===Ie.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof Tr))return N.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=r,c=function(l,d){const p={};return l.height&&l.width&&(p.scaleResolutionDownBy=eP(l,d)),p.maxFramerate=l.framerate?Pa(l.framerate):void 0,p.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,p}(e,a);if(a._encoderConfig||(a._encoderConfig={}),t!==Ie.LocalVideoLowTrack||!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&qt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const l=a._originMediaStreamTrack;if(!l.canvas)return N.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(d,p){const g=d.canvas;p.width&&(g.width=Pa(p.width)),p.height&&(g.height=Pa(p.height)),p.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=ON(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Pa(p.framerate)))})(l,e)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),N.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(e){var t=this;return So(function*(){if(!t.connection||t.state!==rr.Connected)return;const r=yield Gt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=t.localTrackMap.get(Ie.LocalVideoTrack);if(!c)throw new _e(K.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ie.LocalVideoLowTrack))throw new _e(K.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(c.track,e),type:Ie.LocalVideoLowTrack}];if(yield*yT(dW(t.doPublish(t.connection,l))),c.track.muted||!c.track.enabled){var a;const d=(a=t.localTrackMap.get(Ie.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;d!==void 0&&(yield Gt(t.connection.muteLocal([d])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,at.RequestRePublish,this.pendingLocalTracks),this.emit(at.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(N.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ei(this,at.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:a}=this.pendingRemoteTracks[t];(a!==$e.AUDIO||r._audio_added_&&r._audioSSRC)&&(a!==$e.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ei(this,at.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===$e.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(at.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==rr.Connected)return void e.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(a=>a[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==rr.Connected)return void e.forEach(r=>{const a=this.pendingLocalDataChannels.indexOf(r);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{const a=this.localDataChannels.indexOf(r);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==rr.Connected)return;const e=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Ie.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[c,{track:l}]=a;return{type:c,track:l}})),t.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==rr.Connected)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(a.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(a=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(e,new Map([[a.id,a]]));const l=this.pendingRemoteDataChannels.findIndex(d=>{let{user:p,id:g}=d;return p.uid===e.uid&&g===a.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),r.map(a=>a.id)}async subscribe(e,t,r,a,c){var l;if(!this.connection||this.state!==rr.Connected)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let d,p,g;const v=this.connection.getPreMedia(r);if(v)N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),g=v.transceiver,d=v.track,p=v.id;else if(c){const R=c.find(V=>{let{stream_type:k}=V;return k===t});if(!R)throw new _e(K.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const O=await this.connection.receive(t,R.ssrcs,String(e._uintid),R.attributes);this.connection instanceof Xc&&(g=O.transceiver),d=O.track,p=O.id}else{const R=await this.connection.receive(t,[{ssrcId:r,rtx:a}],String(e._uintid),void 0);this.connection instanceof Xc&&(g=R.transceiver),d=R.track,p=R.id}if(t===$e.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new qm(d,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new Hm(d,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack)),g&&$("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:O}=hw();t==$e.VIDEO?await R(g.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(V=>{var k;return(k=e._videoTrack)===null||k===void 0?void 0:k._onSei(V)})}):t==$e.AUDIO&&await O(g.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),onMetadata:V=>{this.safeEmit(at.AudioMetadata,V)}})}const y=this.remoteUserMap.get(e);y?y.set(t,p):this.remoteUserMap.set(e,new Map([[t,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const b=this.pendingRemoteTracks.findIndex(R=>{let{user:O,kind:V}=R;return O.uid===e.uid&&t===V});b!==-1&&(this.pendingRemoteTracks.splice(b,1),this.emit(at.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==rr.Connected)throw new _e(K.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var l;let{user:d,mediaType:p}=c;return!((l=this.remoteUserMap.get(d))!==null&&l!==void 0&&l.has(p))});const t=[],r=new Map;e.forEach(c=>{if(!this.connection)return;const l=this.connection.getPreMedia(c.ssrcId);l?r.set(c.ssrcId,l):t.push(c)});const a=await this.connection.batchReceive(t.map(c=>{let{user:l,mediaType:d,ssrcId:p,rtxSsrcId:g}=c;return{kind:d,ssrcMsg:[{ssrcId:p,rtx:g}],mslabel:String(l._uintid)}}));t.forEach((c,l)=>{r.set(c.ssrcId,a[l])});for(const{user:c,mediaType:l,ssrcId:d}of e){const p=r.get(d);if(!p)return void N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(l,", ").concat(d));const{track:g,id:v,transceiver:y}=p;if(y&&$("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:V}=hw();l==$e.VIDEO?await O(y.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(k=>{var L;return(L=c._videoTrack)===null||L===void 0?void 0:L._onSei(k)})}):l==$e.AUDIO&&await V(y.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),onMetadata:k=>{this.safeEmit(at.AudioMetadata,k)}})}if(l===$e.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new qm(g,c.uid,c._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),y&&c._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new Hm(g,c.uid,c._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),y&&c._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(c,c._videoTrack)),$("ENABLE_VIDEO_SEI")&&y){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:V}=hw();l==$e.VIDEO?await O(y.receiver,{onSei:k=>{var L;(L=c._videoTrack)===null||L===void 0||L._onSei(k)}}):l==$e.AUDIO&&await V(y.receiver)}const b=this.remoteUserMap.get(c);b?b.set(l,v):this.remoteUserMap.set(c,new Map([[l,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(O=>{let{user:V,kind:k}=O;return V.uid===c.uid&&l===k});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(at.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){const a=this.pendingRemoteTracks.filter(d=>{let{user:p,kind:g}=d;return t!==void 0?p.uid===e.uid&&t===g:p.uid===e.uid});if(a.forEach(d=>{const p=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===rr.Connected||r||a.forEach(d=>{let{kind:p}=d;var g;if(p===$e.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(p===$e.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==rr.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(d=>{let[,{id:p}]=d;return p}));const l=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(d=>{let[p,{kind:g}]=d;var v,y;if(g===$e.VIDEO&&p._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),g===$e.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),r||((y=p._videoTrack)===null||y===void 0||y._destroy(),p._videoTrack=void 0);else if(g===$e.AUDIO){var b;this.unbindRemoteTrackEvents(p._audioTrack),!r&&((b=p._audioTrack)===null||b===void 0||b._destroy(),p._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{const l=this.pendingRemoteDataChannels.findIndex(d=>d.id===c.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(e);return r.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:c,mediaType:l}of e){const d=this.pendingRemoteTracks.filter(p=>{let{user:g,kind:v}=p;return l!==void 0?g.uid===c.uid&&l===v:g.uid===c.uid});d.forEach(p=>{const g=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(g,1)}),t=t.concat(d)}if(!this.connection||this.state!==rr.Connected)return void t.forEach(c=>{let{user:l,kind:d}=c;var p;if(d===$e.AUDIO)(p=l._audioTrack)===null||p===void 0||p._destroy(),l._audioTrack=void 0;else if(d===$e.VIDEO){var g;(g=l._videoTrack)===null||g===void 0||g._destroy(),l._videoTrack=void 0}});const r=sa(e).call(e,(c,l)=>{let{user:d,mediaType:p}=l;const g=this.filterTobeUnSubscribedTracks(d,p);return c.concat(g)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var p,g;if(d===$e.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===$e.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(g=l._videoTrack)===null||g===void 0||g._destroy(),l._videoTrack=void 0;else if(d===$e.AUDIO){var v;this.unbindRemoteTrackEvents(l._audioTrack),(v=l._audioTrack)===null||v===void 0||v._destroy(),l._audioTrack=void 0}}),a}isPreSubScribe(e){return!this.connection||this.state!==rr.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const a=t===$e.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Ie.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Ie.LocalAudioTrack);if((t==null?void 0:t.track)instanceof mn){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ie.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===Ie.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[a]=r;return!(e&&a===Ie.LocalVideoLowTrack)}).map(r=>{let[,{track:a}]=r;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,a,c){if(e){const d=this.localTrackMap.get(Ie.LocalAudioTrack),p=a?this.localTrackMap.get(Ie.LocalVideoLowTrack):this.localTrackMap.get(Ie.LocalVideoTrack);Ze.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!d,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var l;r||(r=[]);const d=r.find(g=>g instanceof Gr),p=a?(l=this.localTrackMap.get(Ie.LocalVideoTrack))===null||l===void 0?void 0:l.track:r.find(g=>g instanceof Tr);Ze.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!d,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,a){const c=a===$e.VIDEO?r._videoSSRC:r._audioSSRC;c&&Ze.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===$e.VIDEO,audio:a===$e.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:di.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ci("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=yw(this.store),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ie.LocalAudioTrack);if((e==null?void 0:e.track)instanceof mn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=rr.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ie.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Tr||t&&t.track instanceof Gr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Ya(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[a]=r;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Ie.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=$h(e).call(e,(r,a)=>r.level-a.level),e}async disconnectForReconnect(){this.connection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=rr.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=yw(this.store),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:a}]=e;switch(r){case Ie.LocalVideoTrack:Ve(t=a._hints).call(t,dr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ie.LocalAudioTrack:a instanceof mn?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ie.LocalVideoLowTrack:}}),this.emit(at.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ya(r).call(r)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(at.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ya(r).call(r)).forEach(a=>{this.setPendingRemoteDataChannel(t,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:a,id:c}=r;if((e instanceof Rd?e.uid:e)===a.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:a,kind:c}=r;if((e instanceof Rd?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return So(function*(){if(!t.connection||t.state!==rr.Connected)return;const r=yield Gt(t.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield Gt(t.connection.restartICE(e));const l=yield Gt(a.next());if(l.done)return;const d=l.value,p=yield d;switch(_P(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case ui.UDP_TCP_RELAY:t._pcStatsUploadType=zl.UDP_TCP_RESTART;break;case ui.TCP_RELAY:t._pcStatsUploadType=zl.TCP_RESTART;break;case ui.RELAY:t._pcStatsUploadType=zl.RELAY_RESTART;break;default:t._pcStatsUploadType=zl.OLD_RESTART}t._isTryConnecting=!0,a.next(p)}catch(l){var c;(c=a)===null||c===void 0||c.throw(l)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalAudioTrack),a=e.videoSend.find(O=>O.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(O=>O.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!a||!c)return 1;const l=za(this,at.NeedSignalRTT),d=a?a.rttMs:void 0,p=c?c.rttMs:void 0,g=d&&p?(d+p)/2:d||p,v=(g&&l?(g+l)/2:g||l)||0,y=100*e.sendPacketLossRate*.7/50+.3*v/1500,b=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,R=t==null?void 0:t.track;if(R&&R._encoderConfig&&R._hints.indexOf(dr.SCREEN_TRACK)===-1){const O=R._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(O&&V){const k=(1e3*O-V)/(1e3*O);return Y4[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[a]=r;const c=a._audioSSRC,l=a._videoSSRC,d=e.audioRecv.find(V=>V.ssrc===c),p=e.videoRecv.find(V=>V.ssrc===l);if(!d&&!p)return void(t+=1);const g=za(this,at.NeedSignalRTT),v=e.rtt,y=(v&&g?(v+g)/2:v||g)||0,b=d?d.jitterMs:void 0,R=e.recvPacketLossRate;let O=.7*R*100/50+.3*y/1500;b&&(O=.6*R*100/50+.2*y/1500+.2*b/400),t+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ge((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(N.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==rr.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return e===d});if(!a)return;const c=a[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),a[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,a[1].id)),this.isPlanB){const l=a[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,l)}if(c===Ie.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&qt().supportDualStreamEncoding){const l=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(l){const d=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d,await new Ge((p,g)=>{this.handleReplaceTrack(l.track,p,g,!0)})}}}filterTobePublishedTracks(e,t,r){const a=[],c=this.getAllTracks();e=Pm(e=e.filter(g=>c.indexOf(g)===-1));let l,d=!1;const p=this.localTrackMap.get(Ie.LocalAudioTrack);for(const g of e){if(g instanceof Tr&&(this.localTrackMap.has(Ie.LocalVideoTrack)||d?new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Ie.LocalVideoTrack}),d=!0),t)){const v=this.getLowVideoTrack(g,r);a.push({track:v,type:Ie.LocalVideoLowTrack})}if(g instanceof Gr)if(p){const v=p.track;if(v instanceof mn)mP([g]),v.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const y=gP([v,g]);N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(y.getTrackId(),"]")),this.replaceTrack(v,y)}}else l instanceof mn?(mP([g]),l.addAudioTrack(g)):l||!g._useAudioElement&&qt().webAudioMediaStreamDest&&!g._bypassWebAudio?l=gP(l?[g,l]:[g]):l=g}return l&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),a.push({track:l,type:Ie.LocalAudioTrack})),a}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=Pm(e=e.filter(a=>r.indexOf(a)!==-1));for(const a of e){if(a instanceof Gr){const c=this.localTrackMap.get(Ie.LocalAudioTrack);if(!c)continue;c.track instanceof mn?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([Ie.LocalAudioTrack,c]),c.track.close())):t.push([Ie.LocalAudioTrack,c])}if(a instanceof Tr){const c=this.localTrackMap.get(Ie.LocalVideoTrack);if(!c)continue;t.push([Ie.LocalVideoTrack,c]);const l=this.localTrackMap.get(Ie.LocalVideoLowTrack);l&&t.push([Ie.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=Pm(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Pm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.addListener(Je.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Je.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof mn?e.trackList.forEach(r=>{r.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:a}]=t;return{track:a,type:r}})),e.forEach(t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.off(Je.GET_STATS,this.handleGetLocalVideoStats),r.off(Je.GET_RTC_STATS,this.handleGetRTCStats),r.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof mn?e.trackList.forEach(t=>{t.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Je.GET_STATS,this.handleGetLocalAudioStats),t.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Je.GET_STATS,this.handleGetLocalAudioStats),e.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Hm&&t.addListener(Je.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof qm&&t.addListener(Je.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has($e.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has($e.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,a)=>{var c;let l,d,{track:p,type:g}=r;switch(g){case Ie.LocalAudioTrack:l=nr.Audio,d={dtx:p instanceof Hy&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ie.LocalVideoTrack:l=Ve(c=p._hints).call(c,dr.SCREEN_TRACK)?nr.Screen:nr.High,d=Jc(Jc({},d6(p)),{},{codec:this.store.codec,svc_mode:sw()});break;case Ie.LocalVideoLowTrack:l=nr.Low,d=Jc(Jc({},d6(p)),{},{codec:this.store.codec,svc_mode:sw()})}return{stream_type:l,attributes:d,ssrcs:t[a]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let a,[c,{track:l,ssrcs:d,id:p}]=t;switch(c){case Ie.LocalVideoTrack:a=Ve(r=l._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoLowTrack:a=nr.Low}return{stream_type:a,ssrcs:d,mid:p}})}assignLocalTracks(e,t){e.forEach((r,a)=>{let{track:c,type:l}=r;this.localTrackMap.set(l,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(at.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Xc&&!Vr()&&$("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},$("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Xc&&cW(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=zl.DISCONNECTED_OR_FAILED,za(this,at.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Ze.reportApiInvoke(this.store.sessionId,{name:rn.REPUB_AFTER_PC_CONNECTED,options:r.concat(a),tag:Br.TRACER}).onSuccess(),this.republish()}if($("NEW_ICE_RESTART")&&e instanceof Xc&&!Vr()&&!this._forceTurn){if(Ve(a6).call(a6,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{_P(e)&&(N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),za(this,at.QueryClientConnectionState)==="CONNECTED"&&this.emit(at.RequestRestartICE,c))},a=()=>{_P(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),N.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(at.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{lW(e,r,a)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&$("ICE_RESTART")&&za(this,at.QueryClientConnectionState)==="CONNECTED"&&this.emit(at.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(at.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(at.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Br.TRACER}).onSuccess(),this.emit(at.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const a=Array.from(Ya(r=this.remoteUserMap).call(r)).find(l=>l._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Vm.FIRST_FRAME_DECODED),Ze.firstRemoteFrame(this.store.sessionId,In.FIRST_AUDIO_DECODE,Ir.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const a=Array.from(Ya(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,In.FIRST_AUDIO_RECEIVED,Ir.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,a)=>{this.reportVideoFirstFrameDecoded(t,r,a)},e.onFirstVideoReceived=t=>{var r;const a=Array.from(Ya(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,In.FIRST_VIDEO_RECEIVED,Ir.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const a=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&a===c||this.emit(at.ConnectionTypeChange,a),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(r))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(r))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Jc(Jc({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Xc&&function(t){ig.delete(t.id),cW(t)}(e),e.close(),this.emit(at.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Gr&&(r==null?void 0:r.track)instanceof mn)return r.track.isActive||t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(a&&(t.push(a),a[0]===Ie.LocalVideoTrack)){const c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Gr&&(r==null?void 0:r.track)instanceof mn)return r.track.isActive&&t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(a)if(a[0]===Ie.LocalVideoTrack){t.push(a);const c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var r;let a,[c,{track:l,ssrcs:d,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoTrack:a=Ve(r=l._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalVideoLowTrack:a=nr.Low}return{stream_type:a,ssrcs:d,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var r;let a,[c,{track:l,ssrcs:d,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoTrack:a=Ve(r=l._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalVideoLowTrack:a=nr.Low}return{stream_type:a,ssrcs:d,mid:p}})}filterTobeUnSubscribedTracks(e,t){const r=[],a=this.remoteUserMap.get(e);if(!a)return r;if(t){const c=a.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[l,d]=c;r.push([e,{kind:l,id:d}])});return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(a.id)&&r.push(a)}),r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[a,{kind:c,id:l}]=r;switch(c){case $e.VIDEO:return void(a._videoSSRC&&t.push({stream_type:$e.VIDEO,ssrcId:a._videoSSRC}));case $e.AUDIO:return void(a._audioSSRC&&t.push({stream_type:$e.AUDIO,ssrcId:a._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(r=>{let[a,{kind:c}]=r;if(t.has(a)){let l=t.get(a);c===$e.VIDEO?l|=Nn.Video:l|=Nn.Audio,t.set(a,l)}else c===$e.VIDEO?t.set(a,Nn.Video):t.set(a,Nn.Audio)}),{users:Array.from(t.entries()).map(r=>{let[a,c]=r;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:a}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ge((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ge((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,r){return e.map((a,c)=>{var l;let{stream_type:d}=a;const p=(l=t.find(g=>{let{stream_type:v}=g;return d===v}))===null||l===void 0?void 0:l.attributes;if(p&&$("DISABLE_SCREEN_SHARE_REMB")){const g=r[c]._hints;(Ve(g).call(g,dr.SCREEN_TRACK)||Ve(g).call(g,dr.SCREEN_LOW_TRACK))&&(p.remb=!1,N.debug("disable remb for screen share, hints:",g))}return p})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Gr){var t;const a=this.filterTobeUnmutedTracks(e[r]);if(a.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(a.map(l=>{let[,{id:d}]=l;return d})));const c=this.createUnmuteMessage(a);return void await pr(this,at.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(at.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(at.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Kn(cN(this.dtlsFailedCount,un)),this.emit(at.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ei(this,at.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(at.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ie.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Tr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Tr).length>1)throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Gr).length>1&&(e.some(t=>t instanceof Gr&&t._bypassWebAudio)||!qt().webAudioMediaStreamDest))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Tr&&this.pendingLocalTracks.some(r=>r instanceof Tr))throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Gr&&this.pendingLocalTracks.some(r=>r instanceof Gr)&&(!qt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Gr&&r._bypassWebAudio)))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const a=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&qt().supportDualStreamEncoding,c=Jc(Jc({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=a?e._mediaStreamTrack.clone():vP(e,c);const d=gr(8,"track-low-"),p=new Tr(l,Jc(Jc({},a&&{scaleResolutionDownBy:eP(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,d);return p.on(sp.TRANSCEIVER_UPDATED,g=>{e._updateRtpTransceiver(g,Um.LOW_STREAM)}),p._hints.push(dr.LOW_STREAM),Ve(r=e._hints).call(r,dr.SCREEN_TRACK)&&p._hints.push(dr.SCREEN_LOW_TRACK),e.on("sei-to-send",g=>{p.emit("sei-to-send",g)}),e.addListener(Je.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Xc){var c,l,d,p;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:y,peerConnectionState:b}=this.connection,{local:R,remote:O}=await this.connection.getSelectedCandidatePair();Ze.pcStats(this.store.sessionId,{startTime:g,eventElapse:e-g||0,iceconnectionsate:v,dtlsstate:y,connectionstate:b,intSucc:t?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=R==null?void 0:R.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(l=R.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(R.address,":").concat(R.port),selectedRemoteCandidateProtocol:(d=O.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(p=O.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(O.address,":").concat(O.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,r,a){var c;const l=Array.from(Ya(c=this.remoteUserMap).call(c)).find(d=>d._videoSSRC===e);if(l){a||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,p=d.subscribe.find(g=>g.userId===l.uid&&g.type==="video");Ze.firstRemoteVideoDecode(this.store.sessionId,In.FIRST_VIDEO_DECODE,Ir.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:r,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:a?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const a=this.remoteUserMap.get(e);if(!a)return!1;const c=a.get(t);if(!c)return!1;const l=await this.connection.getRemoteSSRC(c);return l!==void 0&&l!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Ie.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Um.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Qe(Nt.prototype,"startP2PConnection",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"startP2PConnection"),Nt.prototype),Qe(Nt.prototype,"connect",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"connect"),Nt.prototype),Qe(Nt.prototype,"updateRemoteRTPCapabilities",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"updateRemoteRTPCapabilities"),Nt.prototype),Qe(Nt.prototype,"publishDataChannel",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"publishDataChannel"),Nt.prototype),Qe(Nt.prototype,"unpublish",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"unpublish"),Nt.prototype),Qe(Nt.prototype,"unpublishDataChannel",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"unpublishDataChannel"),Nt.prototype),Qe(Nt.prototype,"unpublishLowStream",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"unpublishLowStream"),Nt.prototype),Qe(Nt.prototype,"subscribeDataChannel",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"subscribeDataChannel"),Nt.prototype),Qe(Nt.prototype,"subscribe",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"subscribe"),Nt.prototype),Qe(Nt.prototype,"massSubscribe",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"massSubscribe"),Nt.prototype),Qe(Nt.prototype,"unsubscribe",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"unsubscribe"),Nt.prototype),Qe(Nt.prototype,"unsubscribeDataChannel",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"unsubscribeDataChannel"),Nt.prototype),Qe(Nt.prototype,"massUnsubscribe",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"massUnsubscribe"),Nt.prototype),Qe(Nt.prototype,"muteRemote",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"muteRemote"),Nt.prototype),Qe(Nt.prototype,"unmuteRemote",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteRemote"),Nt.prototype),Qe(Nt.prototype,"hasRemoteMediaWithLock",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"hasRemoteMediaWithLock"),Nt.prototype),Qe(Nt.prototype,"disconnectForReconnect",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"disconnectForReconnect"),Nt.prototype),Qe(Nt.prototype,"updateBitrateLimit",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"updateBitrateLimit"),Nt.prototype),Qe(Nt.prototype,"remoteMediaSsrcChanged",[Ri],Object.getOwnPropertyDescriptor(Nt.prototype,"remoteMediaSsrcChanged"),Nt.prototype),Nt);function Ri(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,l=await c.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,p=new Array(d),g=0;g<d;g++)p[g]=arguments[g];return await a.apply(this,p)}finally{l()}},r}function hW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function pW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hW(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const Mce=Date.now(),Uce=20,EP=new Map,ww=new Map;async function fW(e){const t=EP.get(e),r=Array.isArray(t)&&t[t.length-1],a=ww.get(e);if(!r)return void(a.isSyncing=!1);const c={uid:r.uid,payload:r.payload};a.firstRecvTs===0&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const l=r.sendTs-a.firstSendTs,d=l-(Date.now()-a.firstRecvTs);d>0&&(a.firstRecvTs=Date.now()-l);let p=r.mediaDelay+d;p<=0?(t.pop(),mW(r.context,c),p=0):p=Math.min(p,Uce),setTimeout(()=>t.length&&fW(e),p)}function mW(e,t){e.safeEmit(Dt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function jce(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return mW(r,{uid:e.uid,payload:e.payload});const a="".concat(r.id,"-").concat(e.uid),c=EP.get(a)||[],l=c.findIndex(v=>e.sendTs>=v.sendTs),d=pW(pW({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});l===-1?c.push(d):c.splice(l,0,d),EP.set(a,c);let p=!1;var g;ww.has(a)?p=!((g=ww.get(a))===null||g===void 0||!g.isSyncing):ww.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||fW(a)}const Vce=Ht().name;function gW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function _W(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gW(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gW(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const ag="websdk_ng_cache_parameter",Fce=$("MAX_PRELOAD_ASYNC_LENGTH"),Bce=1e4,_p=new Map,vp=[];let SP=null,bP=0,TP=0;const Rw=new Map,Wce=function(e,t){const r=[];let a=0;const c=async()=>{const l=r.shift();l&&await l(),r.length>0&&a<t?c():a--};return async function(){for(var l=arguments.length,d=new Array(l),p=0;p<l;p++)d[p]=arguments[p];return new Ge(async(g,v)=>{r.push(async()=>{try{const y=await e(...d);g(y)}catch(y){v(y)}}),a<t&&(a++,c())})}}(vW,Fce),wP=Ji.CancelToken.source();async function vW(e,t,r,a,c,l){try{if(!$("ENABLE_PRELOAD"))return;if(!qt().supportWebCrypto)return void gd(()=>{N.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new _e(K.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qn(r,"token",1,2047),qn(e,"appid",1,2047),rw(t),a&&nw(a);const d=ap();N.debug("preload channel ".concat(t,", uid is ").concat(a));const p={appId:e,cname:t,token:r||e,uid:typeof a!="string"?a:null,sid:d,proxyServer:c};let g,v;typeof a=="string"?(p.stringUid=a,[v,g]=await Ge.all([wce(a,{sid:d,appId:e},wP.token),W6(_W(_W({},p),{},{token:r||e,uid:0}),wP.token)]),p.uid=v.uid,g.gatewayInfo.uid=p.uid,g.gatewayInfo.res.uid=p.uid):(l&&(p.stringUid=l),g=await W6(p,wP.token));const y={sid:d,appId:e,cname:t,token:r||e,uid:p.stringUid||a,intUid:p.uid||g.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:v,ap:g};await async function(b){let R;try{b.uid&&EW({appId:b.appId,cname:b.cname,token:b.token,uid:b.uid,stringUid:b.stringUid});const O=wW(b),V=await async function(L,H){try{const q=await window.crypto.subtle.importKey("raw",d3(H),"AES-GCM",!1,["encrypt"]),te=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},q,ip(window.btoa(JSON.stringify(L))));return _d(new Uint8Array(te))}catch{return}}(b,b.token||b.appId);if(!V)return;R=TW(ag);const k=R?JSON.parse(R):[];k.push({[O]:V}),k.length>$("AP_CACHE_NUM")&&k.shift(),Cw(ag,JSON.stringify(k))}catch(O){N.warn("Error caching server parameters:",O.message),Cw(ag,"")}}(y),bP++}catch(d){throw TP++,function(p){SP||(SP=window.setTimeout(()=>{let v="";Rw.forEach((y,b)=>{v+="".concat(b,": ").concat(y," ;")}),Ze.reportApiInvoke(null,{name:rn.PRELOAD,options:{success:bP,failed:TP,err:v}}).onError(p),bP=0,TP=0,Rw.clear(),SP=null},Bce));const g=Rw.get(p.code)||0;Rw.set(p.code,g+1)}(d),d}}async function yW(e){try{if($("AP_REQUEST_DETAIL")||$("ENABLE_ROLE_SELECT_EDGE"))return;const t=EW(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await async function(a,c){try{const l=await window.crypto.subtle.importKey("raw",d3(c),"AES-GCM",!1,["decrypt"]),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},l,ip(a));return JSON.parse(window.atob(_d(new Uint8Array(d))))}catch{return}}(t,e.token||e.appId);if(!r||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<$("AP_CACHE_LIFETIME"))return r}catch(t){N.warn("Error get preloadInfo",t.message)}}function EW(e){let t;try{if(t=TW(ag),!t)return;const r=JSON.parse(t),a=wW(e),c=function(d,p){for(let g=d.length-1;g>=0;g--)if(p(d[g]))return g;return-1}(r,d=>a in d);if(c===-1)return;const l=r.splice(c,1)[0];return Cw(ag,JSON.stringify(r)),l[a]}catch(r){N.warn("Error delete preload info: ".concat(t),r.message),Cw(ag,"")}}function RP(e){if(e){let t=_p.get(e);t&&(window.clearTimeout(t),t=null,_p.delete(e)),Ve(vp).call(vp,e)||e.cloudProxyServer!=="disabled"||vp.push(e)}if(_p.size<$("AP_CACHE_NUM")&&vp.length>0){const t=vp.shift();_p.set(t,window.setTimeout(async()=>{const{appId:r,cname:a,token:c,stringUid:l,uid:d,proxyServer:p}=t;try{await Wce(r,a,c,d,p,l),_p.has(t)&&RP(t)}catch(g){N.warn("update preload failed",g.message),SW(t)}},$("AP_UPDATE_INTERVAL")))}}function SW(e){const t=vp.indexOf(e);t!==-1&&vp.splice(t,1);let r=_p.get(e);r&&(window.clearTimeout(r),r=null,_p.delete(e),RP())}function bW(e,t){const r=e.sua,a=e.ap;t&&r&&Ze.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),Ze.reportResourceTiming(e.ap.url,e.sid),Ze.joinWebProxyAP(e.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[an.CHOOSE_SERVER,an.CLOUD_PROXY_FALLBACK].toString()}),Ze.joinChooseServer(e.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function TW(e){return window.atob(window.localStorage.getItem(e)||"")}function Cw(e,t){window.localStorage.setItem(e,window.btoa(t))}function wW(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),v3(t)}function Gce(e){let t=function(){const r=Kce.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let c=r.appId;c!==void 0&&(on(a,10),Ad(a,c));let l=r.cid;l!==void 0&&(on(a,16),on(a,l));let d=r.cname;d!==void 0&&(on(a,26),Ad(a,d));let p=r.deviceId;p!==void 0&&(on(a,34),Ad(a,p));let g=r.elapse;g!==void 0&&(on(a,40),Od(a,g));let v=r.fileSize;v!==void 0&&(on(a,48),Od(a,og(v)));let y=r.height;y!==void 0&&(on(a,56),Od(a,og(y)));let b=r.jpg;b!==void 0&&(on(a,66),on(a,b.length),CW(a,b));let R=r.networkType;R!==void 0&&(on(a,72),Od(a,og(R)));let O=r.osType;O!==void 0&&(on(a,80),Od(a,og(O)));let V=r.requestId;V!==void 0&&(on(a,90),Ad(a,V));let k=r.sdkVersion;k!==void 0&&(on(a,98),Ad(a,k));let L=r.sequence;L!==void 0&&(on(a,104),Od(a,og(L)));let H=r.sid;H!==void 0&&(on(a,114),Ad(a,H));let q=r.timestamp;q!==void 0&&(on(a,120),Od(a,q));let te=r.uid;te!==void 0&&(on(a,128),on(a,te));let oe=r.vid;oe!==void 0&&(on(a,136),on(a,oe));let se=r.width;se!==void 0&&(on(a,144),Od(a,og(se)));let ae=r.service;ae!==void 0&&(on(a,152),on(a,ae));let pe=r.callbackData;pe!==void 0&&(on(a,162),on(a,pe.length),CW(a,pe));let Te=r.ticket;Te!==void 0&&(on(a,170),Ad(a,Te));let Fe=r.vendorConfigs;Fe!==void 0&&(on(a,178),Ad(a,Fe))}(e,t),function(r){let a=r.bytes,c=r.limit;return a.length===c?a:a.subarray(0,c)}(t)}function Hce(e){return function(r){let a={};e:for(;!zce(r);){let c=oE(r);switch(c>>>3){case 0:break e;case 1:a.code=oE(r);break;case 2:a.msg=AW(r,oE(r));break;case 3:a.requestId=AW(r,oE(r));break;case 4:a.timestamp=$ce(r,!1);break;default:qce(r,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function qce(e,t){switch(t){case 0:for(;128&ls(e););break;case 2:CP(e,oE(e));break;case 5:CP(e,4);break;case 1:CP(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function og(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Kce=[];function CP(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function zce(e){return e.offset>=e.limit}function Aw(e,t){let r=e.bytes,a=e.offset,c=e.limit,l=a+t;if(l>r.length){let d=new Uint8Array(2*l);d.set(r),e.bytes=d}return e.offset=l,l>c&&(e.limit=l),a}function RW(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function CW(e,t){let r=Aw(e,t.length);e.bytes.set(t,r)}function AW(e,t){let r=RW(e,t),a=String.fromCharCode,c=e.bytes,l="�",d="";for(let p=0;p<t;p++){let g,v,y,b,R=c[p+r];(128&R)==0?d+=a(R):(224&R)==192?p+1>=t?d+=l:(g=c[p+r+1],(192&g)!=128?d+=l:(b=(31&R)<<6|63&g,b<128?d+=l:(d+=a(b),p++))):(240&R)==224?p+2>=t?d+=l:(g=c[p+r+1],v=c[p+r+2],(49344&(g|v<<8))!=32896?d+=l:(b=(15&R)<<12|(63&g)<<6|63&v,b<2048||b>=55296&&b<=57343?d+=l:(d+=a(b),p+=2))):(248&R)==240?p+3>=t?d+=l:(g=c[p+r+1],v=c[p+r+2],y=c[p+r+3],(12632256&(g|v<<8|y<<16))!=8421504?d+=l:(b=(7&R)<<18|(63&g)<<12|(63&v)<<6|63&y,b<65536||b>1114111?d+=l:(b-=65536,d+=a(55296+(b>>10),56320+(1023&b)),p+=3))):d+=l}return d}function Ad(e,t){let r=t.length,a=0;for(let d=0;d<r;d++){let p=t.charCodeAt(d);p>=55296&&p<=56319&&d+1<r&&(p=(p<<10)+t.charCodeAt(++d)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}on(e,a);let c=Aw(e,a),l=e.bytes;for(let d=0;d<r;d++){let p=t.charCodeAt(d);p>=55296&&p<=56319&&d+1<r&&(p=(p<<10)+t.charCodeAt(++d)-56613888),p<128?l[c++]=p:(p<2048?l[c++]=p>>6&31|192:(p<65536?l[c++]=p>>12&15|224:(l[c++]=p>>18&7|240,l[c++]=p>>12&63|128),l[c++]=p>>6&63|128),l[c++]=63&p|128)}}function ls(e){return e.bytes[RW(e,1)]}function OW(e,t){let r=Aw(e,1);e.bytes[r]=t}function oE(e){let t,r=0,a=0;do t=ls(e),r<32&&(a|=(127&t)<<r),r+=7;while(128&t);return a}function on(e,t){for(t>>>=0;t>=128;)OW(e,127&t|128),t>>>=7;OW(e,t)}function $ce(e,t){let r,a=0,c=0,l=0;return r=ls(e),a=127&r,128&r&&(r=ls(e),a|=(127&r)<<7,128&r&&(r=ls(e),a|=(127&r)<<14,128&r&&(r=ls(e),a|=(127&r)<<21,128&r&&(r=ls(e),c=127&r,128&r&&(r=ls(e),c|=(127&r)<<7,128&r&&(r=ls(e),c|=(127&r)<<14,128&r&&(r=ls(e),c|=(127&r)<<21,128&r&&(r=ls(e),l=127&r,128&r&&(r=ls(e),l|=(127&r)<<7))))))))),{low:a|c<<28,high:c>>>4|l<<24,unsigned:t}}function Od(e,t){let r=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,l=c===0?a===0?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,d=Aw(e,l),p=e.bytes;switch(l){case 10:p[d+9]=c>>>7&1;case 9:p[d+8]=l!==9?128|c:127&c;case 8:p[d+7]=l!==8?a>>>21|128:a>>>21&127;case 7:p[d+6]=l!==7?a>>>14|128:a>>>14&127;case 6:p[d+5]=l!==6?a>>>7|128:a>>>7&127;case 5:p[d+4]=l!==5?128|a:127&a;case 4:p[d+3]=l!==4?r>>>21|128:r>>>21&127;case 3:p[d+2]=l!==3?r>>>14|128:r>>>14&127;case 2:p[d+1]=l!==2?r>>>7|128:r>>>7&127;case 1:p[d]=l!==1?128|r:127&r}}const IW={},NW={},Ow=4294967296,Yce=Ow*Ow,Xce=Yce/2;DW(0,!0);const PW=DW(0),Jce=sE(0,-2147483648,!1),Qce=sE(-1,2147483647,!1);function DW(e,t){let r,a,c;return t?(c=0<=(e>>>=0)&&e<256)&&(a=NW[e],a)?a:(r=sE(e,0,!0),c&&(NW[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(a=IW[e],a)?a:(r=sE(e,e<0?-1:0,!1),c&&(IW[e]=r),r)}function sE(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function xW(e,t){if(isNaN(e))return PW;{if(e<=-9223372036854776e3)return Jce;if(e+1>=Xce)return Qce}return e<0?PW:sE(e%Ow|0,e/Ow|0,t)}function kW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}class AP extends kr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit($s.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),G(this,"name","AgoraRTCImageModeration"),G(this,"_connectionState",Ro.CONNECTING),G(this,"_sequence",0),G(this,"_moderationStartTime",void 0),G(this,"_workerConnection",void 0),G(this,"_workerMessageLengthLimit",void 0),G(this,"_qualityRatio",void 0),G(this,"_connectInfo",void 0),G(this,"_cancelTokenSource",Ji.CancelToken.source()),G(this,"_retryConfig",void 0),G(this,"_moderationInterval",void 0),G(this,"_moderationTimer",null),G(this,"_moderationMode",1),G(this,"_quality",1),G(this,"_qualityTimer",null),G(this,"_ticket",void 0),G(this,"_moderationIntervalMinimum",void 0),G(this,"_uploadFailedNum",0),G(this,"_uploadNum",0),G(this,"_uploadTimer",null),G(this,"_extraInfo",void 0),G(this,"_vendor",""),G(this,"_encoder",new TextEncoder),G(this,"_moderationId",void 0),G(this,"inspectImage",()=>{if(this.connectionState!==Ro.CONNECTED)throw new he(K.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ro.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=gr(5,"image-moderation-"),this._workerMessageLengthLimit=$("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=$("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Yy("worker-"+this._moderationId,un),this.on($s.STATE_CHANGE,(a,c)=>{N.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ym[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,r){this.emit($s.STATE_CHANGE,Ym.CONNECT_AP),this._connectInfo=t;const a=this._cancelTokenSource.token;return this._retryConfig=r,new Ge((c,l)=>{this.on($s.CONNECTION_STATE_CHANGE,(d,p)=>{d===Ro.CONNECTED&&c()}),this.requestAP(t,a,r).then(d=>{this.connectWorker(d)}).catch(d=>{l(d)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),N.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Ro.CONNECTED&&this.inspectImage()}async requestAP(t,r,a){const c=$("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),l=await function(g,v,y,b){let{appId:R,areaCode:O,cname:V,sid:k,token:L,uid:H}=v;tg++;const q="moderation_plugin",te={service_name:q,json_body:JSON.stringify({appId:R,areaCode:O,cname:V,command:"allocateEdge",requestId:tg,seq:tg,sid:k,appToken:L,ts:Date.now(),uid:H+""})};let oe,se,ae=g[0];return Hs(async()=>{oe=Date.now();const pe=await Ys(ae,{data:te,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(se=Date.now()-oe,pe.code!==0){const ze=new he(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+pe.code,{retry:!0,responseTime:se});throw N.error(ze.toString()),ze}const Te=JSON.parse(pe.json_body);if(Te.code!==200){const ze=new he(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Te.code,", reason: ").concat(Te.reason),{code:Te.code,responseTime:se});throw N.error(ze.toString()),ze}if(!Te.servers||!Array.isArray(Te.servers)||Te.servers.length===0){const ze=new he(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Te.code,responseTime:se});throw N.error(ze.toString()),ze}if(!Te.servers.some(ze=>!!ze.wss)){const ze=new he(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Te.code,responseTime:se});throw N.error(ze.toString()),ze}const Fe=$("IMAGE_MODERATION_WORKER_HOST");return{addressList:Te.servers.map(ze=>{let{address:At,wss:bt}=ze;if(At&&bt)return"wss://".concat(At.replace(/\./g,"-"),".").concat(Fe,":").concat(bt,"/moderation")}).filter(ze=>!!ze),workerToken:Te.workerToken,vid:Te.vid,ticket:Te.appTicket,responseTime:se}},(pe,Te)=>(Ze.apworkerEvent(k,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(pe.addressList),firstSuccess:Te===0,responseTime:se,serverIp:g[Te%g.length]}),!1),(pe,Te)=>(Ze.apworkerEvent(k,{success:!1,sc:pe.data&&pe.data.code||200,serviceName:q,responseTime:se,serverIp:g[Te%g.length]}),!!(pe.code!==K.OPERATION_ABORTED&&pe.code!==K.UNEXPECTED_RESPONSE||pe.data&&pe.data.retry)&&(ae=g[(Te+1)%g.length],!0)),b)}(c,t,r,a);this.emit($s.STATE_CHANGE,Ym.AP_CONNECTED);const{addressList:d,ticket:p}=l;return this._ticket=p,d}async connectWorker(t){this.emit($s.STATE_CHANGE,Ym.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(St.CONNECTED,async()=>{this.emit($s.STATE_CHANGE,Ym.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ro.CONNECTED}),this._workerConnection.on(St.CLOSED,()=>{this.connectionState=Ro.CLOSED}),this._workerConnection.on(St.FAILED,()=>{this.connectionState=Ro.CLOSED}),this._workerConnection.on(St.RECONNECTING,()=>{this.connectionState=this.connectionState===Ro.CONNECTED?Ro.RECONNECTING:Ro.CONNECTING}),this._workerConnection.on(St.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=Hce(new Uint8Array(t.data));$("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,N.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ze.reportApiInvoke(this._connectInfo.sid||null,{name:rn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Br.TRACER}).onError(new he(K.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},$("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else N.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(St.WILL_RECONNECT,(t,r,a)=>{t==="recover"&&a(t),a("tryNext")}),this._workerConnection.on(St.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=za(this,$s.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(t,r);this._workerConnection.sendMessage(a,!0,!0)}else $("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:a,cname:c,cid:l,vid:d,sid:p,uid:g}=r;const v=Date.now(),y=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await s5(y,a,c),R=this._sequence+"-"+l+"-"+g+"-"+v+"-"+gr(12,""),O={appId:a,cid:l,cname:c,deviceId:"",elapse:AP.intToLong(Number(v-this._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:R,sdkVersion:"4.23.4",sequence:this._sequence,sid:p,timestamp:xW(v),uid:g,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete O.callbackData;const V=Gce(O);if(V.byteLength<this._workerMessageLengthLimit){if($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const k=function(L){for(var H=1;H<arguments.length;H++){var q=arguments[H]!=null?arguments[H]:{};H%2?kW(Object(q),!0).forEach(function(te){G(L,te,q[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(q)):kW(Object(q)).forEach(function(te){Object.defineProperty(L,te,Object.getOwnPropertyDescriptor(q,te))})}return L}({},O);delete k.jpg,N.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(k))}return V}{const k=this.quality*this._qualityRatio;return this.quality=k,await this.generateRequestData(t,{appId:a,cname:c,cid:l,vid:d,sid:p,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ji.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ro.CLOSED,this.emit($s.STATE_CHANGE,Ym.CLOSED)}}function LW(e){if(ur(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new he(K.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new he(K.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Zce={name:"ImageModeration",create:function(e){let{config:t}=e;return LW(t),new AP(t)}};var MW,UW,jW,VW,FW,BW,WW,GW,HW,qW,KW,zW,$W,YW,XW,JW,QW,ZW,eG,tG,rG,nG,iG,aG,oG,sG,cG,lG,uG,dG,hG,pG,fG,mG,gG,_G,vG,yG,EG,SG,bG,qe;function TG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function us(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TG(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TG(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}ci.setLogger(N);let ele=(MW=ut(),UW=ut({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Bm))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),jW=ut({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Fm.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),VW=ut({argsMap:(e,t,r,a)=>[typeof t=="object"?t.uid:t,r,a]}),FW=ut({argsMap:(e,t,r)=>[t,r]}),BW=ut({argsMap:(e,t)=>t.map(r=>{let{user:a,mediaType:c}=r;return[a==null?void 0:a.uid,c]})}),WW=ut({argsMap:(e,t,r,a)=>[typeof t=="object"?t.uid:t,r,a]}),GW=ut({argsMap:(e,t)=>t.map(r=>{let{user:a,mediaType:c}=r;return{uid:a==null?void 0:a.uid,mediaType:c}})}),HW=ut(),qW=ut(),KW=ut(),zW=ut(),$W=ut(),YW=ut(),XW=ut(),JW=ut(),QW=ut(),ZW=ut(),eG=ut(),tG=ut(),rG=ut(),nG=ut(),iG=ut(),aG=ut({argsMap:(e,t)=>[t]}),oG=ut(),sG=ut(),cG=ut(),lG=ut(),uG=ut(),dG=ut(),hG=ut(),pG=ut(),fG=ut({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),mG=ut(),gG=ut(),_G=ut(),vG=ut(),yG=ut(),EG=ut(),SG=ut({reportResult:!0}),bG=ut(),qe=class extends kr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),G(this,"store",void 0),G(this,"_uid",void 0),G(this,"_channelName",void 0),G(this,"_uintUid",void 0),G(this,"_users",[]),G(this,"_config",void 0),G(this,"_clientId",void 0),G(this,"_appId",void 0),G(this,"_sessionId",null),G(this,"_key",void 0),G(this,"_rtmConfig",{}),G(this,"_joinInfo",void 0),G(this,"_gateway",void 0),G(this,"_statsCollector",void 0),G(this,"_configDistribute",void 0),G(this,"_leaveMutex",void 0),G(this,"_publishMutex",void 0),G(this,"_renewTokenMutex",void 0),G(this,"_subscribeMutex",void 0),G(this,"_encryptionMode","none"),G(this,"_encryptionSecret",null),G(this,"_encryptionSalt",null),G(this,"_encryptDataStream",!1),G(this,"_encryptDataStreamKey",null),G(this,"_encryptDataStreamIv",null),G(this,"_proxyServer",void 0),G(this,"_turnServer",{servers:[],mode:"auto"}),G(this,"_cloudProxyServerMode","disabled"),G(this,"_isDualStreamEnabled",!1),G(this,"_defaultStreamFallbackType",void 0),G(this,"_lowStreamParameter",void 0),G(this,"_streamFallbackTypeCacheMap",new Map),G(this,"_remoteStreamTypeCacheMap",new Map),G(this,"_axiosCancelSource",Ji.CancelToken.source()),G(this,"_audioVolumeIndicationInterval",void 0),G(this,"_networkQualityInterval",void 0),G(this,"_userOfflineTimeout",void 0),G(this,"_streamRemovedTimeout",void 0),G(this,"_liveTranscodeStreamingClient",void 0),G(this,"_liveRawStreamingClient",void 0),G(this,"_channelMediaRelayClient",void 0),G(this,"_networkQualitySensitivity","normal"),G(this,"_p2pChannel",void 0),G(this,"_useLocalAccessPoint",!1),G(this,"_setLocalAPVersion",void 0),G(this,"_joinAndNotLeaveYet",!1),G(this,"_numberOfJoinCount",0),G(this,"_remoteDefaultVideoStreamType",void 0),G(this,"_inspect",void 0),G(this,"_moderation",void 0),G(this,"_license",void 0),G(this,"_pendingPublishedUsers",[]),G(this,"ntpAlignErrorCount",0),G(this,"remoteInboundOffset",0),G(this,"_peerConnectionState",void 0),G(this,"_handleLocalTrackEnable",(c,l,d)=>{this.publish(c,!1).then(l).catch(d)}),G(this,"_handleLocalTrackDisable",(c,l,d)=>{this.unpublish(c).then(l).catch(d)}),G(this,"_handleUserOnline",c=>{if($("BLOCK_LOCAL_CLIENT")&&pp(c.uid,this.channelName))return void N.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&N.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(d=>d.uid===c.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(Dt.USER_JOINED,l));else{const d=new Rd(c.uid,c.uint_id||c.uid);this._users.push(d),N.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(Dt.USER_JOINED,d)}}),G(this,"_handleUserOffline",c=>{if($("BLOCK_LOCAL_CLIENT")&&pp(c.uid,this.channelName))return;const l=this._users.find(d=>d.uid===c.uid);l&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:DT(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),N.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Dt.USER_LEAVED,l,c.reason))}),G(this,"_handleAddAudioOrVideoStream",(c,l,d,p,g,v,y)=>{if($("BLOCK_LOCAL_CLIENT")&&pp(l,this.channelName))return;const b=this._users.find(O=>O.uid===l);if(!b)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(c)),this.store.subscribe(b.uid,c,void 0,void 0,void 0,Date.now());const R=c==="audio"?b.hasAudio:b.hasVideo;b._uintid||(b._uintid=g||l),c==="audio"?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,c==="audio"?(b._audio_added_=!0,d!==void 0&&(b._audioSSRC=d),p!==void 0&&(b._cname=p),v&&(b._audioOrtc=v)):(b._video_added_=!0,d!==void 0&&(b._videoSSRC=d),p!==void 0&&(b._cname=p),y!==void 0&&(b._rtxSsrcId=y),v&&(b._videoOrtc=v)),(c==="audio"?b.hasAudio:b.hasVideo)&&!R&&(N.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(c)),this.safeEmit(Dt.USER_PUBLISHED,b,c)),c==="video"?Ze.onGatewayStream(this._sessionId,In.ON_ADD_VIDEO_STREAM,Ir.ON_ADD_VIDEO_STREAM,{peer:g||l,ssrc:b._videoSSRC}):Ze.onGatewayStream(this._sessionId,In.ON_ADD_AUDIO_STREAM,Ir.ON_ADD_AUDIO_STREAM,{peer:g||l,ssrc:b._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(b,c,d).then(O=>{if(O&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(b.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof aE))return this._p2pChannel.unsubscribe(b,c,!0).then(()=>this._subscribe(b,c,!0).catch(V=>{N.error("[".concat(this._clientId,"] resubscribe error"),V.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(b,c)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,c,!0).catch(O=>{N.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),G(this,"_handleRemoveStream",c=>{if($("BLOCK_LOCAL_CLIENT")&&pp(c.uid,this.channelName))return;const l=this._users.find(p=>p.uid===c.uid);if(!l)return void N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));N.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let d=()=>{};l.hasAudio&&l.hasVideo?d=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Dt.USER_UNPUBLISHED,l,"audio"),N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Dt.USER_UNPUBLISHED,l,"video")}:l.hasVideo?d=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Dt.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(d=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Dt.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof aE&&this._p2pChannel.unsubscribe(l).then(p=>{if(p)return this._gateway.unsubscribe(p,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),Ze.onGatewayStream(this._sessionId,In.ON_REMOVE_STREAM,Ir.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),d()}),G(this,"_handleSetStreamLocalEnable",(c,l,d)=>{if($("BLOCK_LOCAL_CLIENT")&&pp(l,this.channelName))return;const p=this._users.find(y=>y.uid===l);if(!p)return void N.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));N.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(d?"enabled":"disabled"," with uid ").concat(l));const g=c==="audio"?p.hasAudio:p.hasVideo;if(c==="audio"){p._trust_audio_enabled_state_=!0;const y=p._audio_enabled_;if(p._audio_enabled_=d,p._audio_enabled_===y)return;{const b=p._audio_enabled_?"enable-local-audio":"disable-local-audio";N.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit(Dt.USER_INFO_UPDATED,l,b)}}else{p._trust_video_enabled_state_=!0;const y=p._video_enabled_;if(p._video_enabled_=d,p._video_enabled_===y)return;{const b=p._video_enabled_?"enable-local-video":"disable-local-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit(Dt.USER_INFO_UPDATED,l,b)}}const v=c==="audio"?p.hasAudio:p.hasVideo;return g!==v?!g&&v?(N.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(c)),void this.safeEmit(Dt.USER_PUBLISHED,p,c)):(c==="video"&&p._videoTrack&&p._videoTrack._destroy(),c==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,c),N.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(c)),void this.safeEmit(Dt.USER_UNPUBLISHED,p,c)):void 0}),G(this,"_handleMuteStream",(c,l,d)=>{if($("BLOCK_LOCAL_CLIENT")&&pp(c,this.channelName))return;N.debug("[".concat(this._clientId,"] receive mute message"),c,l,d);const p=this._users.find(y=>y.uid===c);if(!p)return void N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=l==="audio"?p.hasAudio:p.hasVideo;if(l==="audio"){p._trust_audio_mute_state_=!0;const y=p._audio_muted_;if(p._audio_muted_=d,p._audio_muted_===y)return;{const b=p._audio_muted_?"mute-audio":"unmute-audio";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(b)),this.safeEmit(Dt.USER_INFO_UPDATED,c,b)}}else{p._trust_video_mute_state_=!0;const y=p._video_muted_;if(p._video_muted_=d,p._video_muted_===y)return;{const b=p._video_muted_?"mute-video":"unmute-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(b)),this.safeEmit(Dt.USER_INFO_UPDATED,c,b)}}const v=l==="audio"?p.hasAudio:p.hasVideo;if(g!==v){if(!g&&v)return(l==="audio"?p._audioSSRC:p._videoSSRC)?(N.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(l)),void this.safeEmit(Dt.USER_PUBLISHED,p,l)):void N.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),l==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,l),N.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(l)),this.safeEmit(Dt.USER_UNPUBLISHED,p,l)}}),G(this,"_handleP2PLost",async c=>{N.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():N.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),G(this,"_handleTokenWillExpire",()=>{N.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Dt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),G(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),N.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),G(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Dt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Dt.NETWORK_QUALITY,c)}),G(this,"_handleP2PAddAudioOrVideoStream",(c,l,d,p)=>{const g=this._users.find(y=>y.uid===l);if(!g)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,d!==void 0&&(g._audioSSRC=d),p!==void 0&&(g._audioMid=p)):(g._video_added_=!0,d!==void 0&&(g._videoSSRC=d),p!==void 0&&(g._videoMid=p)),(c==="audio"?g.hasAudio:g.hasVideo)&&!v&&(N.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Dt.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(y=>{N.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._config=e,this._clientId=t||gr(5,"client-"),this.store=new class{constructor(c,l,d,p){mt(this,"state",void 0),this.state={codec:c,audioCodec:l,mode:d,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:op.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(l,d){switch(d.type){case jt.SET_SESSION_ID:return Ye(Ye({},l),{},{sessionId:d.sessionId});case jt.SET_P2P_ID:return Ye(Ye({},l),{},{p2pId:d.p2pId});case jt.SET_UID:return Ye(Ye({},l),{},{uid:d.uid});case jt.SET_INT_UID:return Ye(Ye({},l),{},{intUid:d.intUid});case jt.SET_PUB_ID:return Ye(Ye({},l),{},{pubId:d.pubId});case jt.KEY_METRIC_CLIENT_CREATED:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{clientCreated:d.metric})});case jt.KEY_METRIC_JOIN_START:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{joinStart:d.metric})});case jt.KEY_METRIC_JOIN_END:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{joinEnd:d.metric})});case jt.KEY_METRIC_REQUEST_AP_START:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{requestAPStart:d.metric})});case jt.KEY_METRIC_REQUEST_AP_END:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{requestAPEnd:d.metric})});case jt.KEY_METRIC_JOIN_GATEWAY_START:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{joinGatewayStart:d.metric})});case jt.KEY_METRIC_JOIN_GATEWAY_END:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{joinGatewayEnd:d.metric})});case jt.KEY_METRIC_PEER_CONNECTION_START:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{peerConnectionStart:d.metric})});case jt.KEY_METRIC_PEER_CONNECTION_END:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{peerConnectionEnd:d.metric})});case jt.KEY_METRIC_DESCRIPTION_START:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{descriptionStart:d.metric})});case jt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{signalChannelOpen:d.metric})});case jt.KEY_METRIC_ICE_CONNECTION_END:return Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{iceConnectionEnd:d.metric})});case jt.KEY_METRIC_PUBLISH:{const p=l.keyMetrics.publish,g=p.findIndex(v=>v.trackId===d.metric.trackId);return g!==-1?(p[g]=Ye(Ye({},p[g]),d.metric),Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{publish:[...p]})})):Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,d.metric]})})}case jt.KEY_METRIC_SUBSCRIBE:{const p=l.keyMetrics.subscribe,g=p.findIndex(v=>v.userId===d.metric.userId&&v.type===d.metric.type);return g!==-1?(p[g]=Ye(Ye({},p[g]),d.metric),Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{subscribe:[...p]})})):Ye(Ye({},l),{},{keyMetrics:Ye(Ye({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,d.metric]})})}case jt.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=d.mode,l;case jt.RECORD_JOIN_CHANNEL_SERVICE:return typeof d.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,d.record]:(l.joinChannelServiceRecords[d.index]=Ye(Ye({},l.joinChannelServiceRecords[d.index]),d.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case jt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case jt.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[]},l;case jt.SET_USE_P2P:return Ye(Ye({},l),{},{useP2P:d.val});case jt.SET_TRANSPORT_TYPE:return Ye(Ye({},l),{},{p2pTransport:d.val});default:return l}}(this.state,c)}set sessionId(c){this.dispatch({type:jt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:jt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:jt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:jt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:jt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:jt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:jt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:jt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:jt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:jt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:jt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:jt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:jt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:jt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:jt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:jt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:jt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:jt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:jt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:jt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:jt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,l,d,p){this.dispatch({type:jt.KEY_METRIC_PUBLISH,metric:Ye(Ye({trackId:c,type:l},d&&{publishStart:d}),p&&{publishEnd:p})})}subscribe(c,l,d,p,g,v,y){this.dispatch({type:jt.KEY_METRIC_SUBSCRIBE,metric:Ye(Ye(Ye(Ye(Ye({userId:c,type:l},d&&{subscribeStart:d}),p&&{subscribeEnd:p}),g&&{firstFrame:g}),v&&{streamAdded:v}),y&&{firstDecoded:y})})}massSubscribe(c,l,d,p){c.forEach(g=>{this.dispatch({type:jt.KEY_METRIC_SUBSCRIBE,metric:Ye(Ye(Ye({userId:g.userId,type:g.type},l&&{subscribeStart:l}),d&&{subscribeEnd:d}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,l){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(d=>d.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:jt.RECORD_JOIN_CHANNEL_SERVICE,record:Ye(Ye({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:jt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:jt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:jt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new ci("client-leave",this._clientId),this._publishMutex=new ci("client-publish",this._clientId),this._renewTokenMutex=new ci("client-renewtoken",this._clientId),this._subscribeMutex=new ci("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),N.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(bo," build: ").concat(vN,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{iN(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){N.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new rE(this.store),this._statsCollector.onStatsException=(c,l,d)=>{N.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(l,", uid: ").concat(d)),this.safeEmit(Dt.EXCEPTION,{code:c,msg:l,uid:d})},this._statsCollector.onUploadPublishDuration=(c,l,d,p)=>{const g=this._users.find(v=>v.uid===c);g&&Ze.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:l,videoPublishDuration:d,peer:g._uintid})},this._statsCollector.onVideoCodecChanged=c=>{if($("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const l=this.localTracks.find(d=>d instanceof Tr);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(c==="h264"?$("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new vce(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||un,httpRetryConfig:e.httpRetryConfig||un,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new Oce(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},$l("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new aE(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,a,c){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],d=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sr("JOIN_GATEWAY_USE_443PORT_ONLY",l),sr("JOIN_GATEWAY_USE_DUAL_DOMAIN",d);const p=this._gateway.signal.websocket;return p instanceof QN&&(p.use443PortOnly=l,p.tryDoubleDomain=d),async function(g,v,y){AT.get(g)||AT.set(g,[]),OT.get(g)||OT.set(g,v),Bc.get(g)||Bc.set(g,0);const b=AT.get(g),R=OT.get(g);if(!b||!R)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Bc.get(g)===R){const H=Dy();b.push(H),await H.promise}Bc.set(g,Bc.get(g)+1);for(var O=arguments.length,V=new Array(O>3?O-3:0),k=3;k<O;k++)V[k-3]=arguments[k];const L=await y(...V);return Bc.set(g,Bc.get(g)-1),Bc.get(g)===R-1&&b.length>0&&(b[0].resolve(),b.shift()),Bc.get(g)===0&&(AT.set(g,[]),OT.set(g,0),Bc.set(g,0)),L}("client.join",$("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,a,c)}async join(e,t,r,a,c){const l=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const d=(LT||LT||(LT=(window.location.protocol.split(":")[0]||"").toUpperCase(),LT))==="HTTPS",p=S3()?window.isSecureContext:"Browser Not Support";(!S3()&&!d||!window.isSecureContext)&&N.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),Ze.setAppId(e);try{if(!r&&r!==null)throw new he(K.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qn(r,"token",1,2047),qn(e,"appid",1,2047),rw(t),a&&nw(a),c&&qn(c,"optionalInfo",1,2047)}catch(k){throw Ze.reportApiInvoke(ap(),{name:rn.JOIN,options:[e,t,r,a],states:{isHttps:d,isSecureContext:p},tag:Br.TRACER}).onError(k),k}if(this._leaveMutex.isLocked&&(N.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),N.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const k=new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ze.reportApiInvoke(ap(),{name:rn.JOIN,options:[e,t,r,a],states:{isHttps:d,isSecureContext:p},tag:Br.TRACER}).onError(k),k}this._gateway.state="CONNECTING";const g=await yW({appId:e,cname:t,uid:a,stringUid:typeof a=="string"?a:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(g==null?void 0:g.sid)||ap();N.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const y=Ze.reportApiInvoke(v,{id:this._clientId,name:rn.JOIN,options:[e,t,r,a],states:{isHttps:d,isSecureContext:p},tag:Br.TRACER}),b=us(us(us({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!g},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:$("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(b.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(b.stringUid=a,this._uintUid?(b.uid=this._uintUid,this._uintUid=void 0):b.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(b.aesmode=this._encryptionMode,b.aespassword=await(async k=>{const L=function(oe){const se=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ae=new Uint8Array(new ArrayBuffer(se.length));for(let pe=0;pe<se.length;pe+=1)ae[pe]=se.charCodeAt(pe);return ae}(),H=await window.crypto.subtle.importKey("spki",L,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),q=rN(k),te=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},H,q);return function(oe){let se="";for(let ae=0;ae<oe.length;ae+=1)se+=String.fromCharCode(oe[ae]);return window.btoa(se)}(new Uint8Array(te))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(b.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const k=new TextEncoder,L=$("USE_PURE_ENCRYPTION_MASTER_KEY")?k.encode(b.appId+this._encryptionSecret+this._encryptionSecret):k.encode(b.appId+b.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(H,q,te){const oe=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),se=H==="aes-128-gcm2"?128:256,ae=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:P3,hash:"SHA-256",salt:te},oe,se+zoe);return new Uint8Array(ae).subarray(se/8)}(this._encryptionMode,L,ip(this._encryptionSalt)),this._encryptDataStreamKey=await async function(H,q,te){const oe=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),se=H==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:P3,hash:"SHA-256",salt:te},oe,{name:"AES-GCM",length:se},!0,["encrypt","decrypt"])}(this._encryptionMode,L,ip(this._encryptionSalt))}else p?N.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):N.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,N.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:b.stringUid});const R=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&R===this._sessionId&&Ze.joinChannelTimeout(this._sessionId,5)},5e3);try{var O;let k;const L=b.cloudProxyServer;if(Ve(O=["proxy3","proxy4","proxy5"]).call(O,L)){const se=$("PROXY_SERVER_TYPE3");Array.isArray(se)?b.proxyServer=se[0]:b.proxyServer=se}if(Ze.setProxyServer(b.proxyServer),N.setProxyServer(b.proxyServer),this.store.requestAPStart(),g){if(N.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(b.stringUid?", ".concat(b.stringUid," => ").concat(g.intUid):""," ")),b.stringUid&&!b.uid&&(b.uid=g.intUid),k={gatewayInfo:g.ap.gatewayInfo},$("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&b.turnServer.mode==="auto")if(g.ap.proxyInfo.addresses.length===0)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const se=(await p6(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||ti.tcpport,udpport:ae.udpport||ti.udpport,username:ae.username||ti.username,password:ae.password||ti.password,forceturn:!1,security:!0}));b.turnServer={mode:"manual",servers:se}}bW(g,b.stringUid)}else{if(b.stringUid&&!b.uid){let se;[se,k]=await Ge.all([B6(b.stringUid,b,this._axiosCancelSource.token,this._config.httpRetryConfig||un,this.store),F6(b,this._axiosCancelSource.token,this._config.httpRetryConfig||un,!0,this.store)]),N.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(se)),b.uid=se,k.gatewayInfo.uid=se,k.gatewayInfo.res.uid=se}else k=await F6(b,this._axiosCancelSource.token,this._config.httpRetryConfig||un,!0,this.store);if(!this._joinAndNotLeaveYet)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(b,this._axiosCancelSource.token),this._configDistribute.on(zy.UPDATE_BITRATE_LIMIT,se=>{this._p2pChannel.updateBitrateLimit(se)}),this._configDistribute.on(zy.UPDATE_CLIENT_ROLE_OPTIONS,se=>{this._setClientRoleOptions(se)})},0),this._key=r||e;const H=k.gatewayInfo,q=b.uid?b.uid:H.uid;this._joinInfo=us(us({},b),{},{cid:H.cid,uid:q,vid:H.vid,apResponse:H.res,apGatewayAddress:H.apGatewayAddress,uni_lbs_ip:H.uni_lbs_ip,gatewayAddrs:H.gatewayAddrs}),this.store.intUid=q,this.store.cid=H.cid;const te=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));y.onSuccess(te),this._appId=e,this._channelName=b.cname,this._uid=te,this.store.uid=te,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Qn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const oe=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(this._uid);return N.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(oe)),setTimeout(()=>{N.startUpload()},5e3),this.store.joinEnd(),V=this,Ve(hp).call(hp,V)||hp.push(V),this._cloudProxyServerMode==="disabled"&&qt().supportWebCrypto&&$("ENABLE_PRELOAD")&&RP(this._joinInfo),te}catch(k){const L=Array.isArray(k)?k[0]:k;throw L&&L.code===K.OPERATION_ABORTED?N.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),L):N.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),L),L.code!==K.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),y.onError(L),L}var V}_joinGateway(){if(!this._joinInfo||!this._key)throw new he(K.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!$("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){N.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Qn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const r=hp.indexOf(t);r!==-1&&hp.splice(r,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return N.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",tr.LEAVE),N.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Bm))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new he(K.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new he(K.INVALID_OPERATION,"audience can not publish stream");for(const c of r){if(!(c instanceof Bm))throw new he(K.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new he(K.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}N.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(c=>{const l=this._configDistribute.getBitrateLimit();c instanceof Tr&&l&&c.setBitrateLimit(l.uplink)});try{await this._publishHighStream(r),N.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw N.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(e){ur(e.id,"id",0,65535,!0),Wl(e.ordered,"ordered"),qn(e.metadata,"metadata",0,512),N.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new he(K.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new he(K.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new he(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=function(c){return P6(c,!1)}(e),a=await this._p2pChannel.publishDataChannel([r]);if(a.length>0){if(typeof r._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new he(K.CREATE_DATACHANNEL_ERROR);try{await Ge.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await r._waitTillOpen()}catch(c){if(c.code!==K.DISCONNECT_P2P)throw c}}return N.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw N.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new he(K.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Bm))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);N.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(a=>"".concat(a.getTrackId()," "))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(t);a&&await this._gateway.sendExtensionMessage(Xr.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(t);a&&await this._gateway.unpublish(a,this._uid),N.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw N.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),N.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),N.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(a=>"".concat(a.id))))}catch(r){throw N.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Rd)){const a=this.remoteUsers.find(c=>c.uid===e);if(!a)throw new he(K.INVALID_REMOTE_USER,"user is not in the channel");e=a}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(Sn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new he(K.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new he(K.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===$e.AUDIO,a=t===$e.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:d,rtxSsrcId:p,cname:g,uint_id:v}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new he(K.UNEXPECTED_RESPONSE,"no ssrc id");let y=this._users.find(R=>R.uid===e);y||(y=new Rd(e,v||e),y._is_pre_created=!0,this._users.push(y)),g&&(y._cname=g),y._uintid||(y._uintid=v||e),r&&(y._audioSSRC=l,y._audio_pre_subscribed=!0,d&&(y._audioOrtc=d)),a&&(y._videoSSRC=l,y._video_pre_subscribed=!0,d&&(y._videoOrtc=d),p!=null&&(y._rtxSsrcId=p)),N.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(y,t,l,p,d);const b=r?y._audioTrack:y._videoTrack;if(!b)throw new he(K.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),a&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),b}catch(l){throw N.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{c()}}async _subscribeDataChannel(e,t){var r;if(ur(t,"channelId",0,65535,!0),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e))throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new he(K.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new he(K.INVALID_REMOTE_USER,"user is not published");const c=(r=e._dataChannels)===null||r===void 0?void 0:r.find(p=>p.id===t);if(!c)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new he(K.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const p=await this._p2pChannel.subscribeDataChannel(e,[c]);if(p&&Ve(p).call(p,c.id))try{var d;if(typeof c._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new he(K.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(d=c.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),g;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{l()}}async _p2pSubscribe(e,t,r){if(Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new he(K.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new he(K.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new he(K.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const c=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const d=t==="audio"?e._audioSSRC:e._videoSSRC,p=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,p)}catch(d){throw d}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new he(K.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{c()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===e)){const v=new he(K.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new he(K.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new he(K.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),v}let c=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,p={stream_type:t==="audio"?$e.AUDIO:$e.VIDEO,ssrcId:c};const g=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const y=t==="audio"?e._audioSSRC:e._videoSSRC;y!==void 0&&y!==c&&(c=y,l=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,p={stream_type:t==="audio"?$e.AUDIO:$e.VIDEO,ssrcId:c}),di.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,c,d,l);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,p,!0)}catch(b){if((b==null?void 0:b.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),b;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(y){throw this._p2pChannel.reportSubscribeEvent(!1,y==null?void 0:y.code,e,t),y}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(y=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),y)});const v=t==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new he(K.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{g()}}async massSubscribe(e){if(Gl(e,"subscribeList"),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,a=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:g,mediaType:v}=p;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(v)}).join("; ")));const c=(e=[...e]).map(p=>{let{user:g,mediaType:v}=p;return{user:g,mediaType:v}}),l=await this._p2pChannel.globalLock();try{var d;for(let g=e.length-1;g>=0;g--){const v=e[g],{user:y,mediaType:b}=v;if(Sn(b,"mediaType",["audio","video"]),!y){const k=new he(K.INVALID_PARAMS,"user property does not exist in subscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),k}if(!this._users.find(k=>k===y)){const k=new he(K.INVALID_REMOTE_USER,"user is not in the channel");N.error("[".concat(this._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),c[g].error=k,e.splice(g,1);continue}if(b==="audio"&&(!y.hasAudio||y._audioSSRC===void 0)||b==="video"&&(!y.hasVideo||y._videoSSRC===void 0)){const k=new he(K.REMOTE_USER_IS_NOT_PUBLISHED);N.error("[".concat(this._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(b,", remote user is not published")),c[g].error=k,e.splice(g,1);continue}const O=Nn.Video|Nn.LwoVideo,V=r.get(y);if(V){if(b==="video"?V&O:V&Nn.Audio){e.splice(g,1),N.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(b," twice"));continue}r.set(y,V|(b==="video"?O:Nn.Audio))}else r.set(y,b==="video"?O:Nn.Audio)}for(let g=e.length-1;g>=0;g--){const v=e[g],{user:y,mediaType:b}=v,R=Nn.Video|Nn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(y,b)){await this._p2pChannel.unmuteRemoteNoLock(y,b);const O=r.get(y);r.set(y,b==="video"?O^R:O^Nn.Audio),e.splice(g,1)}}this.store.massSubscribe(e.map(g=>({userId:g.user.uid,type:g.mediaType})),t);let p=sa(d=Array.from(r.entries())).call(d,(g,v)=>{let[y,b]=v;if(b===0)return g;const R={stream_id:y.uid,stream_type:b};return b&Nn.Audio&&(R.audio_ssrc=y._audioSSRC),b&Nn.Video&&(R.video_ssrc=y._videoSSRC),g.push(R),g},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(v=>{let{user:y,mediaType:b}=v;return{user:y,mediaType:b,ssrcId:b===$e.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:b===$e.VIDEO?y._rtxSsrcId:void 0}}));const g=new Map;if(p=p.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),p.length>0){const v=await this._gateway.subscribeAll(p,!0);((v==null?void 0:v.users)||[]).forEach(y=>{let{stream_id:b,video_error_code:R,audio_error_code:O,error_code:V}=y;(R||O||V)&&g.set(b,{video_error_code:R,audio_error_code:O,error_code:V})})}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach(y=>{let[b,R]=y;const O=this.remoteUsers.find(V=>V.uid===b);if(O){let V;R.error_code||R.video_error_code&&R.audio_error_code?V=void 0:R.video_error_code?V=$e.VIDEO:R.audio_error_code&&(V=$e.AUDIO),v.push({user:O,mediaType:V})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const y=g.get(v.user.uid);if(y){const b=y.error_code||v.mediaType==="audio"&&y.audio_error_code||v.mediaType==="video"&&y.video_error_code;if(b){const R=$y(b);N.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(R.desc)),v.error=new he(K.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(R.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var y;Ze.subscribe(this.store.sessionId,{succ:!!v.error,ec:((y=v.error)===null||y===void 0?void 0:y.code)||null,video:v.mediaType===$e.VIDEO,audio:v.mediaType===$e.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===$e.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),N.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(v=>{let{user:y,mediaType:b}=v;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(b)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(e),g}}finally{l(),a()}}async unsubscribe(e,t,r){if(!(e instanceof Rd)){const l=this.remoteUsers.find(d=>d.uid===e);if(!l)throw new he(K.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new he(K.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&DT(this._users,e),N.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===K.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{c()}}async _unsubscribeDataChannel(e,t){if(t&&ur(t,"id",0,65535,!0),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new he(K.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let a;if(typeof t=="number"){const c=e._dataChannels.find(l=>l.id===t);c&&(a=[c])}else a=e._dataChannels;if(a===void 0){const c=new he(K.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),c}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,a);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),N.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===K.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Gl(e,"unsubscribeList"),!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");N.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:a,mediaType:c}=r;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:a,mediaType:c}=e[r];if(!a){const p=new he(K.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),p}if(Sn(c,"mediaType",["video","audio",void 0]),!this._users.find(p=>p===a)){N.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),e.splice(r,1);continue}const d=Nn.Video|Nn.LwoVideo;if(t.has(a)){const p=t.get(a);let g;switch(c){case"video":g=p&d;break;case"audio":g=p&Nn.Audio;break;default:g=p&(Nn.Audio|d)}if(g){N.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(a,p|Nn.Audio):c==="video"&&t.set(a,p|d):t.set(a,p|Nn.Audio|d)}else c?c==="audio"?t.set(a,Nn.Audio):c==="video"&&t.set(a,d):t.set(a,Nn.Audio|d)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),N.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(a=>{let{user:c,mediaType:l}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(l,";")}).join()))}catch(r){if(r.code===K.DISCONNECT_P2P)return void N.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw N.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new _e(K.INVALID_PARAMS);Fr(r.width)||eN(r.width,"streamParameter.width"),Fr(r.height)||eN(r.height,"streamParameter.height"),Fr(r.framerate)||eN(r.framerate,"streamParameter.framerate"),Fr(r.bitrate)||ur(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&N.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),N.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ie.LocalVideoLowTrack)}async enableDualStream(){if(!qt().supportDualStream)throw Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new he(K.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new he(K.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),N.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new he(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ie.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),N.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(a){Sn(a,"role",["audience","host"])}(e),t&&iN(t),this.mode==="rtc"||this.mode==="p2p")throw N.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new he(K.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new he(K.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new he(K.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&$("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Zn.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),N.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&iN(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{N.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(qn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new he(K.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new he(K.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ze.setProxyServer(this._proxyServer),N.setProxyServer(this._proxyServer),N.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new he(K.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new he(K.INVALID_OPERATION,"You have already set the proxy")}if(Uy(e))return this._turnServer={servers:e,mode:"original-manual"},void N.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>l3(r)),this._turnServer={servers:e,mode:"manual"},N.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new he(K.INVALID_OPERATION,"you should set license before join channel");if(qn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new he(K.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,N.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new he(K.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new he(K.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new he(K.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new he(K.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new he(K.INVALID_OPERATION,"Stop proxy server after leave channel");Ze.setProxyServer(),N.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new he(K.INVALID_PARAMS,"accessPoints is required.");Gl(e.accessPoints.serverList,"accessPoints.serverList"),qn(e.accessPoints.domain,"accessPoints.domain");const t=(R,O)=>{ur(R,O,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new he(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$("CLOSE_AFB_FOR_LOCAL_AP")&&(sr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,l=e.accessPoints.serverList.map(R=>a.test(R)?"".concat(R.replace(/\./g,"-"),".").concat(c):R),d=l.map(R=>"".concat(R,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sr("WEBCS_DOMAIN",d),sr("WEBCS_DOMAIN_BACKUP_LIST",d),sr("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Gl(e.report.hostname,"report.hostname"),sr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(sr("EVENT_REPORT_DOMAIN",l[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let p=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),p=e.report.port),sr("STATS_COLLECTOR_PORT",p),e.report?sr("ENABLE_EVENT_REPORT",!0):sr("ENABLE_EVENT_REPORT",!1);let g="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Gl(e.log.hostname,"log.hostname"),g=e.log.hostname[0]):g=l[0];let v=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),v=e.log.port),sr("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let y=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Gl(e.cds.hostname,"cds.hostname"),y=e.cds.hostname):y=l;let b=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),b=e.cds.port),sr("CDS_AP",y.map(R=>"".concat(R,":").concat(b))),e.cds?sr("ENABLE_CONFIG_DISTRIBUTE",!0):sr("ENABLE_CONFIG_DISTRIBUTE",!1),N.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Gl(e,"serverList"),qn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new he(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(a=>r.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(t):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sr("WEBCS_DOMAIN",e),sr("WEBCS_DOMAIN_BACKUP_LIST",e),sr("GATEWAY_DOMAINS",[t]),sr("EVENT_REPORT_DOMAIN",e[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),sr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),N.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Sn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw N.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else N.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Sn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const r=this._users.find(a=>a.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw N.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}N.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Sn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw N.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}N.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,a){(function(l){Sn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),qn(t,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Ve(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new he(K.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new he(K.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(Wl(a,"encryptDataStream"),!Ve(c).call(c,e))throw new he(K.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||N.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=_d(r))}async renewToken(e){if(qn(e,"token",1,2047),!this._key||!this._joinInfo)throw new he(K.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if($("USE_NEW_TOKEN")){N.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await Ace(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||un);N.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:a})}else N.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});N.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=t,this._joinInfo.token=t,N.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?N.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Dt.VOLUME_INDICATOR,e)},$("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new he(K.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new he(K.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new he(K.LIVE_STREAMING_TASK_CONFLICT);const r=t?ql.TRANSCODE:ql.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(ql.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new he(K.INVALID_PARAMS,"can not find live streaming url to stop");await Ge.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){$6(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){$6(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof aE&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new he(K.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(a=!0,e.payload=await async function(c,l,d){var p;const g=sa(p=Array.from(d)).call(p,(k,L)=>k+L,0),v={serverTs:0,seq:$oe++,length:d.length,checkSum:g},y=new Uint8Array(_3(g,2)),b=new ArrayBuffer(km),R=new DataView(b);R.setUint32(0,v.serverTs),R.setUint16(4,v.seq),R.setUint16(6,v.length),R.setUint16(8,v.checkSum);const O=16-d.length%16;d=h3(d,new Uint8Array(O));const V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:N3,additionalData:y},l,d);return h3(new Uint8Array(b),new Uint8Array(V))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new he(K.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ht.DATA_STREAM,{payload:_d(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Mce},!r)}sendMetadata(e){if(!this._joinInfo)throw new he(K.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new he(K.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ht.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:_d(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(nse),!this._joinInfo)throw new he(K.INVALID_OPERATION,"can not send custom report, not joined");await Ze.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Sn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Sn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw N.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(Wl(t,"apRTM"),ur(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,N.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(N.debug("[".concat(this._clientId,"] reset client")),function(e){const t=zm.indexOf(e);t!==-1&&zm.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ji.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&SW(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ze.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ci("client-publish",this._clientId),this._subscribeMutex=new ci("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const a=e||ap();e?N.debug("[".concat(this._clientId,"] new Session ").concat(a)):N.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=e?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,Ze.addSid(a);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Ze.sessionInit(this._sessionId,us({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new he(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new he(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");N.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await r.next()).value;if(a){try{await this._gateway.sendExtensionMessage(Xr.PUBLISH,a,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await r.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(l){if(l.code!==K.DISCONNECT_P2P)throw r.throw(l),l}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof Tr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(l=>{N.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===K.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new he(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));N.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await r.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(l){if(l.code!==K.DISCONNECT_P2P)throw r.throw(l),l}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===K.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new he(K.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},$l("LiveStreaming").create(a));var a;return r.onLiveStreamError=(c,l)=>{Ze.reportApiInvoke(this._sessionId,{name:rn.ON_LIVE_STREAM_ERROR,options:[c,l],tag:Br.TRACER}).onSuccess(),this.safeEmit(Dt.LIVE_STREAMING_ERROR,c,l)},r.onLiveStreamWarning=(c,l)=>{Ze.reportApiInvoke(this._sessionId,{name:rn.ON_LIVE_STREAM_WARNING,options:[c,l],tag:Br.TRACER}).onSuccess(),this.safeEmit(Dt.LIVE_STREAMING_WARNING,c,l)},r.on(YN.REQUEST_WORKER_MANAGER_LIST,(c,l,d)=>{if(!this._joinInfo)return d(new he(K.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,g,v,y){const b=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(R=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(R+"/api/v1?action=uap"):"https://".concat(R,"/api/v1?action=uap"));return await Sce(b,p,g,v,y)})(c,this._joinInfo,this._axiosCancelSource.token,un).then(l).catch(d)}),r};return e===ql.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new he(K.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),a=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},$l("ChannelMediaRelay").create(e));a.on("state",c=>{c===fa.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Dt.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(Dt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,l)=>{var d;c==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:a}=e,c=[];if(t){const l=[];this._users.forEach(d=>{d._dataChannels.forEach(p=>{r.every(g=>g.uid!==d._uintid||g.stream_id!==p.id)&&l.push({uid:d._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(r)&&r.length>0&&r.forEach(l=>{const{uid:d,stream_id:p,ordered:g,max_retrans_times:v,metadata:y}=l,b=this._users.find(R=>R._uintid===d);if(!b)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(N.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),Ve(c).call(c,b)||c.push(b),b._uintid||(b._uintid=d),b._dataChannels.findIndex(R=>R.id===l.stream_id)===-1){const R={id:p,ordered:!!g,maxRetransmits:v,metadata:y},O=function(V){return P6(V,!0)}(R);b._dataChannels.push(O),N.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),t||this.safeEmit(Dt.USER_PUBLISHED,b,"datachannel",R)}this._p2pChannel.hasPendingRemoteDataChannel(b,l.stream_id)&&(N.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,l.stream_id).catch(R=>{N.error("[".concat(this._clientId,"] resubscribe datachannel error"),R.toString())}))}),t&&(this.safeEmit(Dt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(l=>{const{uid:d,stream_id:p}=l,g=this._users.find(y=>y._uintid===d);if(!g)return void N.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find(y=>y.id===l.stream_id);v&&(N.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then(y=>{if(g._dataChannels=g._dataChannels.filter(b=>b!==v),y)return this._gateway.unsubscribeDataChannel(y,g.uid)}),N.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Dt.USER_UNPUBLISHED,g,"datachannel",v._config))})}_handleRemoveDataChannels(e){const t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){N.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(a=>{this.safeEmit(Dt.USER_UNPUBLISHED,t,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,t.uid)}),r()}}else N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Mn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(a=>{const{value:c,type:l,expires:d}=t[a];d&&d<=r||l||WN()||!Object.prototype.hasOwnProperty.call(jT,a)||(qs[a]=c,Ar[a]=c,N.debug("Update gateway parameters from config distribute",a,c))})}catch(t){N.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Mn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Mn.CONNECTION_STATE_CHANGE,(e,t,r)=>{var a;if(r===tr.FALLBACK)return;const c=()=>{this.safeEmit(Dt.CONNECTION_STATE_CHANGE,e,t,r)};if(Ze.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:rn.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Br.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),N.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((d,p)=>{this._gateway.setStreamFallbackOption(p,d).catch(g=>{N.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((d,p)=>{this._gateway.setRemoteVideoStreamType(p,d).catch(g=>{N.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{N.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{N.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{N.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,$e.AUDIO,!1)),d._trust_video_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,$e.VIDEO,!1)),d._trust_audio_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(N.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}c()}),this._gateway.on(Mn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new he(K.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const a=await yW(us(us({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(r=a.ap,bW(a),this._joinInfo.preload=!0):(r=await hP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||un,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const c=[];r.gatewayInfo.gatewayAddrs.forEach(l=>{let{address:d}=l;const[p,g]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:p,port:g}):c.push({host:p,port:g})}),e(c)}catch(r){t(r)}}),this._gateway.on(Mn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Dt.NETWORK_QUALITY,e)}),this._gateway.on(Mn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Dt.STREAM_TYPE_CHANGED,e,t),Ze.reportApiInvoke(this._sessionId,{name:rn.STREAM_TYPE_CHANGE,options:[e,t],tag:Br.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Mn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Mn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let a=await this._p2pChannel.getEstablishParams();$("ENABLE_PREALLOC_PC")&&a||(a=await this._p2pChannel.startP2PConnection(e)),t(a)}catch(a){r(a)}}),this._gateway.on(Mn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;e.attributes?r=e.attributes.userAttributes.preSubSsrcs:N.debug("no attributes in joinResponse");const a=y6(e.ortc,t,r);this._p2pChannel.connect(a)}),this._gateway.on(Mn.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var a;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:l}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(c),icePwd:"".concat(l,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=$("FINGERPRINT"))!==null&&a!==void 0?a:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(kt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(kt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(kt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(kt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(kt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(kt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(kt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(kt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(kt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,$e.AUDIO,!0)),this._gateway.signal.on(kt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,$e.AUDIO,!1)),this._gateway.signal.on(kt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,$e.VIDEO,!0)),this._gateway.signal.on(kt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,$e.VIDEO,!1)),this._gateway.signal.on(kt.RECEIVE_METADATA,e=>{const t=ip(e.metadata);this.safeEmit(Dt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(kt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=ip(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<km)throw new he(K.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(km));r=await async function(l,d,p){const g=p.subarray(0,km),v=g.slice(8,km),y=(v[0]<<8)+v[1],b=(g[6]<<8)+g[7],R=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:N3,additionalData:new Uint8Array(_3(y,2))},d,p.subarray(km));return new Uint8Array(R).subarray(0,b)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let a=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),l=this.remoteUsers.find(p=>p.uid===e.uid),d=c==null?void 0:c.audioRecv.find(p=>p.ssrc===(l==null?void 0:l._audioSSRC));a=d==null?void 0:d.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),jce(us(us({},e),{},{payload:r}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(kt.ON_CRYPT_ERROR,()=>{gd(()=>{N.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Dt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(kt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{N.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,tr.TOKEN_EXPIRE),this.safeEmit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(kt.ON_STREAM_FALLBACK_UPDATE,e=>{N.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Dt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(kt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),N.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(kt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(kt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ft.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ht.PUBLISH:{if(!t)return;const c=t.ortc;if(c){var r,a;const l=c.some(g=>{let{stream_type:v}=g;return v===nr.Audio}),d=c.some(g=>{let{stream_type:v}=g;return v!==nr.Audio}),p=c.some(g=>{let{stream_type:v}=g;return v===nr.Screen||v===nr.ScreenLow});t.state==="offer"&&Ze.publish(this._joinInfo.sid,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:K.TIMEOUT,audio:l,video:d,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:l?(r=c.find(g=>{let{stream_type:v}=g;return v===nr.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:d?(a=c.find(g=>{let{stream_type:v}=g;return v!==nr.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case ht.SUBSCRIBE:t&&Ze.subscribe(this._joinInfo.sid,{succ:!1,ec:K.TIMEOUT,audio:t.stream_type===$e.AUDIO,video:t.stream_type===$e.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:di.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(kt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(kt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;$("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(a=>!pp(a.string_id||a.stream_id,this.channelName)));const t=[],r=[];for(const a of e.users){let c=this._users.find(y=>y._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new Rd(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.getListeners(Dt.PUBLISHED_USER_LIST).length===0&&(N.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Dt.USER_JOINED,c)));const l=Nn.Audio&a.stream_type,d=(Nn.Video|Nn.LwoVideo)&a.stream_type,p=(65280&a.stream_type)!=0,g=l&&c.hasAudio,v=d&&c.hasVideo;d&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),l&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),l&&!g&&this.getListeners(Dt.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Dt.USER_PUBLISHED,c,"audio")),d&&!v&&this.getListeners(Dt.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Dt.USER_PUBLISHED,c,"video")),(l&&!g||d&&!v||p)&&t.push(c),d&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(N.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(a=>{N.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Dt.PUBLISHED_USER_LIST).length>0?$("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(N.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(a=>a.uid).join(", "))),this.safeEmit(Dt.PUBLISHED_USER_LIST,t)):N.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(kt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof aE&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var a;return Ve(a=Object.keys(VT)).call(a,r)}))})}_handleP2PEvents(){this._gateway.signal.on(kt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Xr.PUBLISH,(e,t,r)=>{const{uid:a}=e;e.forEach(c=>{const{kind:l,ssrcs:d,mid:p,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(l,a,d[0].ssrcId,p);const v=this._users.find(y=>y.uid===a);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,l,d[0].ssrcId,p).then(()=>{t()}).catch(r):t(),this._handleMuteStream(a,l,!!g)})}),this._gateway.signal.on(Xr.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var a;t(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},e))}catch(c){r(c)}}),this._gateway.signal.on(ft.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Xr.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=e,l=this._users.find(d=>d.uid===c);if(!l)return N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{a.forEach(async d=>{let{stream_type:p}=d;const g=p===nr.Audio?$e.AUDIO:$e.VIDEO;await this._p2pChannel.unsubscribe(l,g),this._handleMuteStream(c,g,!0)}),t()}catch(d){r(d)}}}),this._gateway.signal.on(Xr.CONTROL,async(e,t)=>{const{action:r}=e;switch(r){case Ed.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,$e.VIDEO,!0);break;case Ed.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,$e.AUDIO,!0);break;case Ed.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,$e.VIDEO,!1);break;case Ed.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,$e.AUDIO,!1)}}),this._gateway.signal.on(Xr.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=e;a!==Fi.SEND_ONLY||c?t(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),t())}catch(a){r(a)}}),this._gateway.signal.on(Xr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(at.RequestP2PRestartICE,async(e,t,r)=>{try{const{direction:a}=e;t(await this._gateway.sendExtensionMessage(Xr.RESTART_ICE,e,a===Fi.SEND_ONLY))}catch(a){r(a)}}),this._p2pChannel.on(at.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Xr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(at.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(Xr.CONTROL,e,!0),t()}catch(a){r(a)}}),this._p2pChannel.on(at.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(at.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(at.StateChange,(e,t)=>{t===rr.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(at.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Dt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(at.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(at.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():r(a)}else t()}),this._p2pChannel.on(at.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(at.RequestRePublishDataChannel,(e,t,r)=>{Ge.all(e.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==K.DISCONNECT_P2P)throw l}})).then(t).catch(r)}),this._p2pChannel.on(at.RequestReSubscribe,async(e,t,r)=>{try{for(const{user:a,kind:c}of e)c===$e.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");t()}catch(a){r(a)}}),this._p2pChannel.on(at.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(at.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(at.MediaReconnectStart,e=>{this.safeEmit(Dt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(at.MediaReconnectEnd,e=>{this.safeEmit(Dt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(at.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(at.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const a=r.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(d){return void t.throw(d)}const{iceParameters:l}=function(d){const p=d.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(c);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(at.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(at.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:a}),d=y6(c,l);await this._p2pChannel.connect(d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(at.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(at.P2PLost,()=>{this.safeEmit(Dt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(at.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(at.ConnectionTypeChange,e=>{this.safeEmit(Dt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(at.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(at.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(at.AudioMetadata,e=>{this.safeEmit(Dt.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},$l("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:a,cname:c,sid:l,token:d,uid:p,cid:g,vid:v}=this._joinInfo;await r.init({appId:a,areaCode:"",cname:c,sid:l,token:d,uid:p,cid:g,vid:v?Number(v):0},un)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Un.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Dt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===as.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Dt.CONTENT_INSPECT_ERROR,new he(K.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Un.INSPECT_RESULT,(t,r)=>{var a;if((r==null?void 0:r.code)===K.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return N.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Dt.CONTENT_INSPECT_RESULT,t,r)}),e.on(Un.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Wl(e,"enabled"),e){if(!t)throw new he(K.INVALID_PARAMS,"config is required");if(LW(t),!this._joinInfo)throw new he(K.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const a=(r={config:t},$l("ImageModeration").create(r));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:l,sid:d,token:p,uid:g,cid:v,vid:y}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:l,sid:d,token:p,uid:g,cid:v,vid:y?Number(y):0},un)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var r;if(!this._moderation)throw new he(K.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(e){e.on($s.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Dt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===Ro.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new he(K.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on($s.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Sn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new he(K.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,N.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return N.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Wl(e,"enabled"),sr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Qe(qe.prototype,"leave",[MW],Object.getOwnPropertyDescriptor(qe.prototype,"leave"),qe.prototype),Qe(qe.prototype,"publish",[UW],Object.getOwnPropertyDescriptor(qe.prototype,"publish"),qe.prototype),Qe(qe.prototype,"unpublish",[jW],Object.getOwnPropertyDescriptor(qe.prototype,"unpublish"),qe.prototype),Qe(qe.prototype,"subscribe",[VW],Object.getOwnPropertyDescriptor(qe.prototype,"subscribe"),qe.prototype),Qe(qe.prototype,"presubscribe",[FW],Object.getOwnPropertyDescriptor(qe.prototype,"presubscribe"),qe.prototype),Qe(qe.prototype,"massSubscribe",[BW],Object.getOwnPropertyDescriptor(qe.prototype,"massSubscribe"),qe.prototype),Qe(qe.prototype,"unsubscribe",[WW],Object.getOwnPropertyDescriptor(qe.prototype,"unsubscribe"),qe.prototype),Qe(qe.prototype,"massUnsubscribe",[GW],Object.getOwnPropertyDescriptor(qe.prototype,"massUnsubscribe"),qe.prototype),Qe(qe.prototype,"setLowStreamParameter",[HW],Object.getOwnPropertyDescriptor(qe.prototype,"setLowStreamParameter"),qe.prototype),Qe(qe.prototype,"enableDualStream",[qW],Object.getOwnPropertyDescriptor(qe.prototype,"enableDualStream"),qe.prototype),Qe(qe.prototype,"disableDualStream",[KW],Object.getOwnPropertyDescriptor(qe.prototype,"disableDualStream"),qe.prototype),Qe(qe.prototype,"setClientRole",[zW],Object.getOwnPropertyDescriptor(qe.prototype,"setClientRole"),qe.prototype),Qe(qe.prototype,"_setClientRoleOptions",[$W],Object.getOwnPropertyDescriptor(qe.prototype,"_setClientRoleOptions"),qe.prototype),Qe(qe.prototype,"setProxyServer",[YW],Object.getOwnPropertyDescriptor(qe.prototype,"setProxyServer"),qe.prototype),Qe(qe.prototype,"setTurnServer",[XW],Object.getOwnPropertyDescriptor(qe.prototype,"setTurnServer"),qe.prototype),Qe(qe.prototype,"setLicense",[JW],Object.getOwnPropertyDescriptor(qe.prototype,"setLicense"),qe.prototype),Qe(qe.prototype,"startProxyServer",[QW],Object.getOwnPropertyDescriptor(qe.prototype,"startProxyServer"),qe.prototype),Qe(qe.prototype,"stopProxyServer",[ZW],Object.getOwnPropertyDescriptor(qe.prototype,"stopProxyServer"),qe.prototype),Qe(qe.prototype,"setLocalAccessPointsV2",[eG],Object.getOwnPropertyDescriptor(qe.prototype,"setLocalAccessPointsV2"),qe.prototype),Qe(qe.prototype,"setLocalAccessPoints",[tG],Object.getOwnPropertyDescriptor(qe.prototype,"setLocalAccessPoints"),qe.prototype),Qe(qe.prototype,"setRemoteDefaultVideoStreamType",[rG],Object.getOwnPropertyDescriptor(qe.prototype,"setRemoteDefaultVideoStreamType"),qe.prototype),Qe(qe.prototype,"setRemoteVideoStreamType",[nG],Object.getOwnPropertyDescriptor(qe.prototype,"setRemoteVideoStreamType"),qe.prototype),Qe(qe.prototype,"setStreamFallbackOption",[iG],Object.getOwnPropertyDescriptor(qe.prototype,"setStreamFallbackOption"),qe.prototype),Qe(qe.prototype,"setEncryptionConfig",[aG],Object.getOwnPropertyDescriptor(qe.prototype,"setEncryptionConfig"),qe.prototype),Qe(qe.prototype,"renewToken",[oG],Object.getOwnPropertyDescriptor(qe.prototype,"renewToken"),qe.prototype),Qe(qe.prototype,"enableAudioVolumeIndicator",[sG],Object.getOwnPropertyDescriptor(qe.prototype,"enableAudioVolumeIndicator"),qe.prototype),Qe(qe.prototype,"startLiveStreaming",[cG],Object.getOwnPropertyDescriptor(qe.prototype,"startLiveStreaming"),qe.prototype),Qe(qe.prototype,"setLiveTranscoding",[lG],Object.getOwnPropertyDescriptor(qe.prototype,"setLiveTranscoding"),qe.prototype),Qe(qe.prototype,"stopLiveStreaming",[uG],Object.getOwnPropertyDescriptor(qe.prototype,"stopLiveStreaming"),qe.prototype),Qe(qe.prototype,"startChannelMediaRelay",[dG],Object.getOwnPropertyDescriptor(qe.prototype,"startChannelMediaRelay"),qe.prototype),Qe(qe.prototype,"updateChannelMediaRelay",[hG],Object.getOwnPropertyDescriptor(qe.prototype,"updateChannelMediaRelay"),qe.prototype),Qe(qe.prototype,"stopChannelMediaRelay",[pG],Object.getOwnPropertyDescriptor(qe.prototype,"stopChannelMediaRelay"),qe.prototype),Qe(qe.prototype,"sendCustomReportMessage",[fG],Object.getOwnPropertyDescriptor(qe.prototype,"sendCustomReportMessage"),qe.prototype),Qe(qe.prototype,"pickSVCLayer",[mG],Object.getOwnPropertyDescriptor(qe.prototype,"pickSVCLayer"),qe.prototype),Qe(qe.prototype,"setRTMConfig",[gG],Object.getOwnPropertyDescriptor(qe.prototype,"setRTMConfig"),qe.prototype),Qe(qe.prototype,"enableContentInspect",[_G],Object.getOwnPropertyDescriptor(qe.prototype,"enableContentInspect"),qe.prototype),Qe(qe.prototype,"disableContentInspect",[vG],Object.getOwnPropertyDescriptor(qe.prototype,"disableContentInspect"),qe.prototype),Qe(qe.prototype,"setImageModeration",[yG],Object.getOwnPropertyDescriptor(qe.prototype,"setImageModeration"),qe.prototype),Qe(qe.prototype,"setP2PTransport",[EG],Object.getOwnPropertyDescriptor(qe.prototype,"setP2PTransport"),qe.prototype),Qe(qe.prototype,"getJoinChannelServiceRecords",[SG],Object.getOwnPropertyDescriptor(qe.prototype,"getJoinChannelServiceRecords"),qe.prototype),Qe(qe.prototype,"setPublishAudioFilterEnabled",[bG],Object.getOwnPropertyDescriptor(qe.prototype,"setPublishAudioFilterEnabled"),qe.prototype),qe);class cE{constructor(t,r){G(this,"id",0),G(this,"element",void 0),G(this,"peerPair",void 0),G(this,"context",void 0),G(this,"audioPlayerElement",void 0),G(this,"audioTrack",void 0),cE.count+=1,this.id=cE.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(a,c)=>{const l=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(l),a.iceGatheringState==="complete"?a.localDescription:new Ge(d=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&d(a.localDescription)}})},r=async(a,c)=>await a.setRemoteDescription(c);try{const a=await t(this.peerPair[0],"offer");await r(this.peerPair[1],a);const c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(a){throw new he(K.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new he(K.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new he(K.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=r.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){N.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var wG,Iw;G(cE,"count",0);const tle=window.AudioContext||window.webkitAudioContext,rle=new(wG=ut({report:Ze}),Qe((Iw=class{constructor(){G(this,"units",[]),G(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return N.debug("the system does not need to process local aec"),-1;this.context||(this.context=new tle);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new cE(e,this.context),this.units.push(t)),t.startEchoCancellation(),N.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ht().name!==Xt.SAFARI}}).prototype,"processExternalMediaAEC",[wG],Object.getOwnPropertyDescriptor(Iw.prototype,"processExternalMediaAEC"),Iw.prototype),Iw);function RG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function CG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RG(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RG(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}const OP=window||document;function AG(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!OP)return;const r=dn._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const a=c=>{if(!(c&&c.blockedURI&&(dn.onSecurityPolicyViolation||dn.getListeners(zc.SECURITY_POLICY_VIOLATION).length>0)))return;const l=c.blockedURI;$("CSP_DETECTED_HOSTNAME_LIST").some(d=>Ve(l).call(l,d))&&(dn.onSecurityPolicyViolation&&typeof dn.onSecurityPolicyViolation=="function"&&dn.onSecurityPolicyViolation(c),dn.getListeners(zc.SECURITY_POLICY_VIOLATION).length>0&&dn.safeEmit(zc.SECURITY_POLICY_VIOLATION,c))};r&&OP.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||dn.getListeners(zc.SECURITY_POLICY_VIOLATION).length>0)&&OP.addEventListener("securitypolicyviolation",a),dn._cspEventHandlerPointer=a}var nle=P,ile=dB,OG=RegExp.prototype,ale=function(e){return e===OG||nle(OG,e)?ile(e):e.flags},Ci=u(ale);function sg(e){let t=e.length;for(;--t>=0;)e[t]=0}const IP=256,IG=286,lE=30,uE=15,NP=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Nw=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ole=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),NG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xl=new Array(576);sg(Xl);const dE=new Array(60);sg(dE);const hE=new Array(512);sg(hE);const pE=new Array(256);sg(pE);const PP=new Array(29);sg(PP);const Pw=new Array(lE);function DP(e,t,r,a,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=a,this.max_length=c,this.has_stree=e&&e.length}let PG,DG,xG;function xP(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}sg(Pw);const kG=e=>e<256?hE[e]:hE[256+(e>>>7)],fE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},no=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,fE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Qc=(e,t,r)=>{no(e,r[2*t],r[2*t+1])},LG=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},MG=(e,t,r)=>{const a=new Array(16);let c,l,d=0;for(c=1;c<=uE;c++)d=d+r[c-1]<<1,a[c]=d;for(l=0;l<=t;l++){let p=e[2*l+1];p!==0&&(e[2*l]=LG(a[p]++,p))}},UG=e=>{let t;for(t=0;t<IG;t++)e.dyn_ltree[2*t]=0;for(t=0;t<lE;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},jG=e=>{e.bi_valid>8?fE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},VG=(e,t,r,a)=>{const c=2*t,l=2*r;return e[c]<e[l]||e[c]===e[l]&&a[t]<=a[r]},kP=(e,t,r)=>{const a=e.heap[r];let c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&VG(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!VG(t,a,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=a},FG=(e,t,r)=>{let a,c,l,d,p=0;if(e.sym_next!==0)do a=255&e.pending_buf[e.sym_buf+p++],a+=(255&e.pending_buf[e.sym_buf+p++])<<8,c=e.pending_buf[e.sym_buf+p++],a===0?Qc(e,c,t):(l=pE[c],Qc(e,l+IP+1,t),d=NP[l],d!==0&&(c-=PP[l],no(e,c,d)),a--,l=kG(a),Qc(e,l,r),d=Nw[l],d!==0&&(a-=Pw[l],no(e,a,d)));while(p<e.sym_next);Qc(e,256,t)},LP=(e,t)=>{const r=t.dyn_tree,a=t.stat_desc.static_tree,c=t.stat_desc.has_stree,l=t.stat_desc.elems;let d,p,g,v=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<l;d++)r[2*d]!==0?(e.heap[++e.heap_len]=v=d,e.depth[d]=0):r[2*d+1]=0;for(;e.heap_len<2;)g=e.heap[++e.heap_len]=v<2?++v:0,r[2*g]=1,e.depth[g]=0,e.opt_len--,c&&(e.static_len-=a[2*g+1]);for(t.max_code=v,d=e.heap_len>>1;d>=1;d--)kP(e,r,d);g=l;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],kP(e,r,1),p=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=p,r[2*g]=r[2*d]+r[2*p],e.depth[g]=(e.depth[d]>=e.depth[p]?e.depth[d]:e.depth[p])+1,r[2*d+1]=r[2*p+1]=g,e.heap[1]=g++,kP(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((y,b)=>{const R=b.dyn_tree,O=b.max_code,V=b.stat_desc.static_tree,k=b.stat_desc.has_stree,L=b.stat_desc.extra_bits,H=b.stat_desc.extra_base,q=b.stat_desc.max_length;let te,oe,se,ae,pe,Te,Fe=0;for(ae=0;ae<=uE;ae++)y.bl_count[ae]=0;for(R[2*y.heap[y.heap_max]+1]=0,te=y.heap_max+1;te<573;te++)oe=y.heap[te],ae=R[2*R[2*oe+1]+1]+1,ae>q&&(ae=q,Fe++),R[2*oe+1]=ae,oe>O||(y.bl_count[ae]++,pe=0,oe>=H&&(pe=L[oe-H]),Te=R[2*oe],y.opt_len+=Te*(ae+pe),k&&(y.static_len+=Te*(V[2*oe+1]+pe)));if(Fe!==0){do{for(ae=q-1;y.bl_count[ae]===0;)ae--;y.bl_count[ae]--,y.bl_count[ae+1]+=2,y.bl_count[q]--,Fe-=2}while(Fe>0);for(ae=q;ae!==0;ae--)for(oe=y.bl_count[ae];oe!==0;)se=y.heap[--te],se>O||(R[2*se+1]!==ae&&(y.opt_len+=(ae-R[2*se+1])*R[2*se],R[2*se+1]=ae),oe--)}})(e,t),MG(r,v,e.bl_count)},BG=(e,t,r)=>{let a,c,l=-1,d=t[1],p=0,g=7,v=4;for(d===0&&(g=138,v=3),t[2*(r+1)+1]=65535,a=0;a<=r;a++)c=d,d=t[2*(a+1)+1],++p<g&&c===d||(p<v?e.bl_tree[2*c]+=p:c!==0?(c!==l&&e.bl_tree[2*c]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,l=c,d===0?(g=138,v=3):c===d?(g=6,v=3):(g=7,v=4))},WG=(e,t,r)=>{let a,c,l=-1,d=t[1],p=0,g=7,v=4;for(d===0&&(g=138,v=3),a=0;a<=r;a++)if(c=d,d=t[2*(a+1)+1],!(++p<g&&c===d)){if(p<v)do Qc(e,c,e.bl_tree);while(--p!=0);else c!==0?(c!==l&&(Qc(e,c,e.bl_tree),p--),Qc(e,16,e.bl_tree),no(e,p-3,2)):p<=10?(Qc(e,17,e.bl_tree),no(e,p-3,3)):(Qc(e,18,e.bl_tree),no(e,p-11,7));p=0,l=c,d===0?(g=138,v=3):c===d?(g=6,v=3):(g=7,v=4)}};let GG=!1;const HG=(e,t,r,a)=>{no(e,0+(a?1:0),3),jG(e),fE(e,r),fE(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var sle=e=>{GG||((()=>{let t,r,a,c,l;const d=new Array(16);for(a=0,c=0;c<28;c++)for(PP[c]=a,t=0;t<1<<NP[c];t++)pE[a++]=c;for(pE[a-1]=c,l=0,c=0;c<16;c++)for(Pw[c]=l,t=0;t<1<<Nw[c];t++)hE[l++]=c;for(l>>=7;c<lE;c++)for(Pw[c]=l<<7,t=0;t<1<<Nw[c]-7;t++)hE[256+l++]=c;for(r=0;r<=uE;r++)d[r]=0;for(t=0;t<=143;)Xl[2*t+1]=8,t++,d[8]++;for(;t<=255;)Xl[2*t+1]=9,t++,d[9]++;for(;t<=279;)Xl[2*t+1]=7,t++,d[7]++;for(;t<=287;)Xl[2*t+1]=8,t++,d[8]++;for(MG(Xl,287,d),t=0;t<lE;t++)dE[2*t+1]=5,dE[2*t]=LG(t,5);PG=new DP(Xl,NP,257,IG,uE),DG=new DP(dE,Nw,0,lE,uE),xG=new DP(new Array(0),ole,0,19,7)})(),GG=!0),e.l_desc=new xP(e.dyn_ltree,PG),e.d_desc=new xP(e.dyn_dtree,DG),e.bl_desc=new xP(e.bl_tree,xG),e.bi_buf=0,e.bi_valid=0,UG(e)},cle=(e,t,r,a)=>{let c,l,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let g,v=4093624447;for(g=0;g<=31;g++,v>>>=1)if(1&v&&p.dyn_ltree[2*g]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(g=32;g<IP;g++)if(p.dyn_ltree[2*g]!==0)return 1;return 0})(e)),LP(e,e.l_desc),LP(e,e.d_desc),d=(p=>{let g;for(BG(p,p.dyn_ltree,p.l_desc.max_code),BG(p,p.dyn_dtree,p.d_desc.max_code),LP(p,p.bl_desc),g=18;g>=3&&p.bl_tree[2*NG[g]+1]===0;g--);return p.opt_len+=3*(g+1)+5+5+4,g})(e),c=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=c&&(c=l)):c=l=r+5,r+4<=c&&t!==-1?HG(e,t,r,a):e.strategy===4||l===c?(no(e,2+(a?1:0),3),FG(e,Xl,dE)):(no(e,4+(a?1:0),3),((p,g,v,y)=>{let b;for(no(p,g-257,5),no(p,v-1,5),no(p,y-4,4),b=0;b<y;b++)no(p,p.bl_tree[2*NG[b]+1],3);WG(p,p.dyn_ltree,g-1),WG(p,p.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),FG(e,e.dyn_ltree,e.dyn_dtree)),UG(e),a&&jG(e)},lle=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(pE[r]+IP+1)]++,e.dyn_dtree[2*kG(t)]++),e.sym_next===e.sym_end),ule=e=>{no(e,2,3),Qc(e,256,Xl),(t=>{t.bi_valid===16?(fE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},dle={_tr_init:sle,_tr_stored_block:HG,_tr_flush_block:cle,_tr_tally:lle,_tr_align:ule},mE=(e,t,r,a)=>{let c=65535&e|0,l=e>>>16&65535|0,d=0;for(;r!==0;){d=r>2e3?2e3:r,r-=d;do c=c+t[a++]|0,l=l+c|0;while(--d);c%=65521,l%=65521}return c|l<<16|0};const hle=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Wi=(e,t,r,a)=>{const c=hle,l=a+r;e^=-1;for(let d=a;d<l;d++)e=e>>>8^c[255&(e^t[d])];return-1^e},yp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Dw={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ple,_tr_stored_block:MP,_tr_flush_block:fle,_tr_tally:Id,_tr_align:mle}=dle,{Z_NO_FLUSH:Nd,Z_PARTIAL_FLUSH:gle,Z_FULL_FLUSH:_le,Z_FINISH:ds,Z_BLOCK:qG,Z_OK:ta,Z_STREAM_END:KG,Z_STREAM_ERROR:Zc,Z_DATA_ERROR:vle,Z_BUF_ERROR:UP,Z_DEFAULT_COMPRESSION:yle,Z_FILTERED:Ele,Z_HUFFMAN_ONLY:xw,Z_RLE:Sle,Z_FIXED:ble,Z_DEFAULT_STRATEGY:Tle,Z_UNKNOWN:wle,Z_DEFLATED:kw}=Dw,jP=286,Rle=30,Cle=19,Ale=2*jP+1,Ole=15,Ep=258,el=262,cg=42,Sp=113,gE=666,bp=(e,t)=>(e.msg=yp[t],t),zG=e=>2*e-(e>4?9:0),Pd=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Ile=e=>{let t,r,a,c=e.w_size;t=e.hash_size,a=t;do r=e.head[--a],e.head[a]=r>=c?r-c:0;while(--t);t=c,a=t;do r=e.prev[--a],e.prev[a]=r>=c?r-c:0;while(--t)};let Dd=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Co=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Ao=(e,t)=>{fle(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Co(e.strm)},zr=(e,t)=>{e.pending_buf[e.pending++]=t},_E=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},VP=(e,t,r,a)=>{let c=e.avail_in;return c>a&&(c=a),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=mE(e.adler,t,c,r):e.state.wrap===2&&(e.adler=Wi(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},$G=(e,t)=>{let r,a,c=e.max_chain_length,l=e.strstart,d=e.prev_length,p=e.nice_match;const g=e.strstart>e.w_size-el?e.strstart-(e.w_size-el):0,v=e.window,y=e.w_mask,b=e.prev,R=e.strstart+Ep;let O=v[l+d-1],V=v[l+d];e.prev_length>=e.good_match&&(c>>=2),p>e.lookahead&&(p=e.lookahead);do if(r=t,v[r+d]===V&&v[r+d-1]===O&&v[r]===v[l]&&v[++r]===v[l+1]){l+=2,r++;do;while(v[++l]===v[++r]&&v[++l]===v[++r]&&v[++l]===v[++r]&&v[++l]===v[++r]&&v[++l]===v[++r]&&v[++l]===v[++r]&&v[++l]===v[++r]&&v[++l]===v[++r]&&l<R);if(a=Ep-(R-l),l=R-Ep,a>d){if(e.match_start=t,d=a,a>=p)break;O=v[l+d-1],V=v[l+d]}}while((t=b[t&y])>g&&--c!=0);return d<=e.lookahead?d:e.lookahead},lg=e=>{const t=e.w_size;let r,a,c;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-el)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Ile(e),a+=t),e.strm.avail_in===0)break;if(r=VP(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Dd(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Dd(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<el&&e.strm.avail_in!==0)},YG=(e,t)=>{let r,a,c,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,p=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,a=e.strstart-e.block_start,r>a+e.strm.avail_in&&(r=a+e.strm.avail_in),r>c&&(r=c),r<l&&(r===0&&t!==ds||t===Nd||r!==a+e.strm.avail_in)))break;d=t===ds&&r===a+e.strm.avail_in?1:0,MP(e,0,0,d),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Co(e.strm),a&&(a>r&&(a=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,r-=a),r&&(VP(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(d===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:t!==Nd&&t!==ds&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(VP(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,l=c>e.w_size?e.w_size:c,a=e.strstart-e.block_start,(a>=l||(a||t===ds)&&t!==Nd&&e.strm.avail_in===0&&a<=c)&&(r=a>c?c:a,d=t===ds&&e.strm.avail_in===0&&r===a?1:0,MP(e,e.block_start,r,d),e.block_start+=r,Co(e.strm)),d?3:1)},FP=(e,t)=>{let r,a;for(;;){if(e.lookahead<el){if(lg(e),e.lookahead<el&&t===Nd)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Dd(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-el&&(e.match_length=$G(e,r)),e.match_length>=3)if(a=Id(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Dd(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Dd(e,e.ins_h,e.window[e.strstart+1]);else a=Id(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Ao(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ds?(Ao(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ao(e,!1),e.strm.avail_out===0)?1:2},ug=(e,t)=>{let r,a,c;for(;;){if(e.lookahead<el){if(lg(e),e.lookahead<el&&t===Nd)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Dd(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-el&&(e.match_length=$G(e,r),e.match_length<=5&&(e.strategy===Ele||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,a=Id(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Dd(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Ao(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(a=Id(e,0,e.window[e.strstart-1]),a&&Ao(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=Id(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ds?(Ao(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ao(e,!1),e.strm.avail_out===0)?1:2};function tl(e,t,r,a,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=a,this.func=c}const vE=[new tl(0,0,0,0,YG),new tl(4,4,8,4,FP),new tl(4,5,16,8,FP),new tl(4,6,32,32,FP),new tl(4,4,16,16,ug),new tl(8,16,32,32,ug),new tl(8,16,128,128,ug),new tl(8,32,128,256,ug),new tl(32,128,258,1024,ug),new tl(32,258,258,4096,ug)];function Nle(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kw,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Ale),this.dyn_dtree=new Uint16Array(2*(2*Rle+1)),this.bl_tree=new Uint16Array(2*(2*Cle+1)),Pd(this.dyn_ltree),Pd(this.dyn_dtree),Pd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Ole+1),this.heap=new Uint16Array(2*jP+1),Pd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jP+1),Pd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const yE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==cg&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Sp&&t.status!==gE?1:0},XG=e=>{if(yE(e))return bp(e,Zc);e.total_in=e.total_out=0,e.data_type=wle;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?cg:Sp,e.adler=t.wrap===2?0:1,t.last_flush=-2,ple(t),ta},JG=e=>{const t=XG(e);return t===ta&&(r=>{r.window_size=2*r.w_size,Pd(r.head),r.max_lazy_match=vE[r.level].max_lazy,r.good_match=vE[r.level].good_length,r.nice_match=vE[r.level].nice_length,r.max_chain_length=vE[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},QG=(e,t,r,a,c,l)=>{if(!e)return Zc;let d=1;if(t===yle&&(t=6),a<0?(d=0,a=-a):a>15&&(d=2,a-=16),c<1||c>9||r!==kw||a<8||a>15||t<0||t>9||l<0||l>ble||a===8&&d!==1)return bp(e,Zc);a===8&&(a=9);const p=new Nle;return e.state=p,p.strm=e,p.status=cg,p.wrap=d,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=t,p.strategy=l,p.method=r,JG(e)};var Ple=(e,t)=>{if(yE(e)||t>qG||t<0)return e?bp(e,Zc):Zc;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===gE&&t!==ds)return bp(e,e.avail_out===0?UP:Zc);const a=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Co(e),e.avail_out===0)return r.last_flush=-1,ta}else if(e.avail_in===0&&zG(t)<=zG(a)&&t!==ds)return bp(e,UP);if(r.status===gE&&e.avail_in!==0)return bp(e,UP);if(r.status===cg&&r.wrap===0&&(r.status=Sp),r.status===cg){let c=kw+(r.w_bits-8<<4)<<8,l=-1;if(l=r.strategy>=xw||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=l<<6,r.strstart!==0&&(c|=32),c+=31-c%31,_E(r,c),r.strstart!==0&&(_E(r,e.adler>>>16),_E(r,65535&e.adler)),e.adler=1,r.status=Sp,Co(e),r.pending!==0)return r.last_flush=-1,ta}if(r.status===57){if(e.adler=0,zr(r,31),zr(r,139),zr(r,8),r.gzhead)zr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),zr(r,255&r.gzhead.time),zr(r,r.gzhead.time>>8&255),zr(r,r.gzhead.time>>16&255),zr(r,r.gzhead.time>>24&255),zr(r,r.level===9?2:r.strategy>=xw||r.level<2?4:0),zr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(zr(r,255&r.gzhead.extra.length),zr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Wi(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(zr(r,0),zr(r,0),zr(r,0),zr(r,0),zr(r,0),zr(r,r.level===9?2:r.strategy>=xw||r.level<2?4:0),zr(r,3),r.status=Sp,Co(e),r.pending!==0)return r.last_flush=-1,ta}if(r.status===69){if(r.gzhead.extra){let c=r.pending,l=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+l>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=Wi(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=p,Co(e),r.pending!==0)return r.last_flush=-1,ta;c=0,l-=p}let d=new Uint8Array(r.gzhead.extra);r.pending_buf.set(d.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending+=l,r.gzhead.hcrc&&r.pending>c&&(e.adler=Wi(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,l=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>l&&(e.adler=Wi(e.adler,r.pending_buf,r.pending-l,l)),Co(e),r.pending!==0)return r.last_flush=-1,ta;l=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,zr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>l&&(e.adler=Wi(e.adler,r.pending_buf,r.pending-l,l)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,l=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>l&&(e.adler=Wi(e.adler,r.pending_buf,r.pending-l,l)),Co(e),r.pending!==0)return r.last_flush=-1,ta;l=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,zr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>l&&(e.adler=Wi(e.adler,r.pending_buf,r.pending-l,l))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Co(e),r.pending!==0))return r.last_flush=-1,ta;zr(r,255&e.adler),zr(r,e.adler>>8&255),e.adler=0}if(r.status=Sp,Co(e),r.pending!==0)return r.last_flush=-1,ta}if(e.avail_in!==0||r.lookahead!==0||t!==Nd&&r.status!==gE){let c=r.level===0?YG(r,t):r.strategy===xw?((l,d)=>{let p;for(;;){if(l.lookahead===0&&(lg(l),l.lookahead===0)){if(d===Nd)return 1;break}if(l.match_length=0,p=Id(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,p&&(Ao(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,d===ds?(Ao(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(Ao(l,!1),l.strm.avail_out===0)?1:2})(r,t):r.strategy===Sle?((l,d)=>{let p,g,v,y;const b=l.window;for(;;){if(l.lookahead<=Ep){if(lg(l),l.lookahead<=Ep&&d===Nd)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(v=l.strstart-1,g=b[v],g===b[++v]&&g===b[++v]&&g===b[++v])){y=l.strstart+Ep;do;while(g===b[++v]&&g===b[++v]&&g===b[++v]&&g===b[++v]&&g===b[++v]&&g===b[++v]&&g===b[++v]&&g===b[++v]&&v<y);l.match_length=Ep-(y-v),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(p=Id(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(p=Id(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),p&&(Ao(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,d===ds?(Ao(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(Ao(l,!1),l.strm.avail_out===0)?1:2})(r,t):vE[r.level].func(r,t);if(c!==3&&c!==4||(r.status=gE),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),ta;if(c===2&&(t===gle?mle(r):t!==qG&&(MP(r,0,0,!1),t===_le&&(Pd(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Co(e),e.avail_out===0))return r.last_flush=-1,ta}return t!==ds?ta:r.wrap<=0?KG:(r.wrap===2?(zr(r,255&e.adler),zr(r,e.adler>>8&255),zr(r,e.adler>>16&255),zr(r,e.adler>>24&255),zr(r,255&e.total_in),zr(r,e.total_in>>8&255),zr(r,e.total_in>>16&255),zr(r,e.total_in>>24&255)):(_E(r,e.adler>>>16),_E(r,65535&e.adler)),Co(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?ta:KG)},Dle=(e,t)=>{let r=t.length;if(yE(e))return Zc;const a=e.state,c=a.wrap;if(c===2||c===1&&a.status!==cg||a.lookahead)return Zc;if(c===1&&(e.adler=mE(e.adler,t,r,0)),a.wrap=0,r>=a.w_size){c===0&&(Pd(a.head),a.strstart=0,a.block_start=0,a.insert=0);let g=new Uint8Array(a.w_size);g.set(t.subarray(r-a.w_size,r),0),t=g,r=a.w_size}const l=e.avail_in,d=e.next_in,p=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,lg(a);a.lookahead>=3;){let g=a.strstart,v=a.lookahead-2;do a.ins_h=Dd(a,a.ins_h,a.window[g+3-1]),a.prev[g&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=g,g++;while(--v);a.strstart=g,a.lookahead=2,lg(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=d,e.input=p,e.avail_in=l,a.wrap=c,ta},EE={deflateInit:(e,t)=>QG(e,t,kw,15,8,Tle),deflateInit2:QG,deflateReset:JG,deflateResetKeep:XG,deflateSetHeader:(e,t)=>yE(e)||e.state.wrap!==2?Zc:(e.state.gzhead=t,ta),deflate:Ple,deflateEnd:e=>{if(yE(e))return Zc;const t=e.state.status;return e.state=null,t===Sp?bp(e,vle):ta},deflateSetDictionary:Dle,deflateInfo:"pako deflate (from Nodeca project)"};const xle=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Lw={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const a in r)xle(r,a)&&(e[a]=r[a])}}return e},flattenChunks:e=>{let t=0;for(let a=0,c=e.length;a<c;a++)t+=e[a].length;const r=new Uint8Array(t);for(let a=0,c=0,l=e.length;a<l;a++){let d=e[a];r.set(d,c),c+=d.length}return r}};let ZG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ZG=!1}const SE=new Uint8Array(256);for(let e=0;e<256;e++)SE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;SE[254]=SE[254]=1;var bE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,a,c,l,d=e.length,p=0;for(c=0;c<d;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<d&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(r=65536+(r-55296<<10)+(a-56320),c++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(p),l=0,c=0;l<p;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<d&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(r=65536+(r-55296<<10)+(a-56320),c++)),r<128?t[l++]=r:r<2048?(t[l++]=192|r>>>6,t[l++]=128|63&r):r<65536?(t[l++]=224|r>>>12,t[l++]=128|r>>>6&63,t[l++]=128|63&r):(t[l++]=240|r>>>18,t[l++]=128|r>>>12&63,t[l++]=128|r>>>6&63,t[l++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let a,c;const l=new Array(2*r);for(c=0,a=0;a<r;){let d=e[a++];if(d<128){l[c++]=d;continue}let p=SE[d];if(p>4)l[c++]=65533,a+=p-1;else{for(d&=p===2?31:p===3?15:7;p>1&&a<r;)d=d<<6|63&e[a++],p--;p>1?l[c++]=65533:d<65536?l[c++]=d:(d-=65536,l[c++]=55296|d>>10&1023,l[c++]=56320|1023&d)}}return((d,p)=>{if(p<65534&&d.subarray&&ZG)return String.fromCharCode.apply(null,d.length===p?d:d.subarray(0,p));let g="";for(let v=0;v<p;v++)g+=String.fromCharCode(d[v]);return g})(l,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+SE[e[r]]>t?r:t}},e8=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const t8=Object.prototype.toString,{Z_NO_FLUSH:kle,Z_SYNC_FLUSH:Lle,Z_FULL_FLUSH:Mle,Z_FINISH:Ule,Z_OK:Mw,Z_STREAM_END:jle,Z_DEFAULT_COMPRESSION:Vle,Z_DEFAULT_STRATEGY:Fle,Z_DEFLATED:Ble}=Dw;function Uw(e){this.options=Lw.assign({level:Vle,method:Ble,chunkSize:16384,windowBits:15,memLevel:8,strategy:Fle},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new e8,this.strm.avail_out=0;let r=EE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Mw)throw new Error(yp[r]);if(t.header&&EE.deflateSetHeader(this.strm,t.header),t.dictionary){let a;if(a=typeof t.dictionary=="string"?bE.string2buf(t.dictionary):t8.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=EE.deflateSetDictionary(this.strm,a),r!==Mw)throw new Error(yp[r]);this._dict_set=!0}}function Wle(e,t){const r=new Uw(t);if(r.push(e,!0),r.err)throw r.msg||yp[r.err];return r.result}Uw.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize;let c,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?Ule:kle,typeof e=="string"?r.input=bE.string2buf(e):t8.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(l===Lle||l===Mle)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=EE.deflate(r,l),c===jle)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=EE.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===Mw;if(r.avail_out!==0){if(l>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},Uw.prototype.onData=function(e){this.chunks.push(e)},Uw.prototype.onEnd=function(e){e===Mw&&(this.result=Lw.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Gle={deflate:Wle};const jw=16209;var Hle=function(e,t){let r,a,c,l,d,p,g,v,y,b,R,O,V,k,L,H,q,te,oe,se,ae,pe,Te,Fe;const ze=e.state;r=e.next_in,Te=e.input,a=r+(e.avail_in-5),c=e.next_out,Fe=e.output,l=c-(t-e.avail_out),d=c+(e.avail_out-257),p=ze.dmax,g=ze.wsize,v=ze.whave,y=ze.wnext,b=ze.window,R=ze.hold,O=ze.bits,V=ze.lencode,k=ze.distcode,L=(1<<ze.lenbits)-1,H=(1<<ze.distbits)-1;e:do{O<15&&(R+=Te[r++]<<O,O+=8,R+=Te[r++]<<O,O+=8),q=V[R&L];t:for(;;){if(te=q>>>24,R>>>=te,O-=te,te=q>>>16&255,te===0)Fe[c++]=65535&q;else{if(!(16&te)){if((64&te)==0){q=V[(65535&q)+(R&(1<<te)-1)];continue t}if(32&te){ze.mode=16191;break e}e.msg="invalid literal/length code",ze.mode=jw;break e}oe=65535&q,te&=15,te&&(O<te&&(R+=Te[r++]<<O,O+=8),oe+=R&(1<<te)-1,R>>>=te,O-=te),O<15&&(R+=Te[r++]<<O,O+=8,R+=Te[r++]<<O,O+=8),q=k[R&H];r:for(;;){if(te=q>>>24,R>>>=te,O-=te,te=q>>>16&255,!(16&te)){if((64&te)==0){q=k[(65535&q)+(R&(1<<te)-1)];continue r}e.msg="invalid distance code",ze.mode=jw;break e}if(se=65535&q,te&=15,O<te&&(R+=Te[r++]<<O,O+=8,O<te&&(R+=Te[r++]<<O,O+=8)),se+=R&(1<<te)-1,se>p){e.msg="invalid distance too far back",ze.mode=jw;break e}if(R>>>=te,O-=te,te=c-l,se>te){if(te=se-te,te>v&&ze.sane){e.msg="invalid distance too far back",ze.mode=jw;break e}if(ae=0,pe=b,y===0){if(ae+=g-te,te<oe){oe-=te;do Fe[c++]=b[ae++];while(--te);ae=c-se,pe=Fe}}else if(y<te){if(ae+=g+y-te,te-=y,te<oe){oe-=te;do Fe[c++]=b[ae++];while(--te);if(ae=0,y<oe){te=y,oe-=te;do Fe[c++]=b[ae++];while(--te);ae=c-se,pe=Fe}}}else if(ae+=y-te,te<oe){oe-=te;do Fe[c++]=b[ae++];while(--te);ae=c-se,pe=Fe}for(;oe>2;)Fe[c++]=pe[ae++],Fe[c++]=pe[ae++],Fe[c++]=pe[ae++],oe-=3;oe&&(Fe[c++]=pe[ae++],oe>1&&(Fe[c++]=pe[ae++]))}else{ae=c-se;do Fe[c++]=Fe[ae++],Fe[c++]=Fe[ae++],Fe[c++]=Fe[ae++],oe-=3;while(oe>2);oe&&(Fe[c++]=Fe[ae++],oe>1&&(Fe[c++]=Fe[ae++]))}break}}break}}while(r<a&&c<d);oe=O>>3,r-=oe,O-=oe<<3,R&=(1<<O)-1,e.next_in=r,e.next_out=c,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=c<d?d-c+257:257-(c-d),ze.hold=R,ze.bits=O};const Vw=15,qle=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Kle=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),zle=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$le=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var TE=(e,t,r,a,c,l,d,p)=>{const g=p.bits;let v,y,b,R,O,V,k=0,L=0,H=0,q=0,te=0,oe=0,se=0,ae=0,pe=0,Te=0,Fe=null;const ze=new Uint16Array(16),At=new Uint16Array(16);let bt,pt,Er,hr=null;for(k=0;k<=Vw;k++)ze[k]=0;for(L=0;L<a;L++)ze[t[r+L]]++;for(te=g,q=Vw;q>=1&&ze[q]===0;q--);if(te>q&&(te=q),q===0)return c[l++]=20971520,c[l++]=20971520,p.bits=1,0;for(H=1;H<q&&ze[H]===0;H++);for(te<H&&(te=H),ae=1,k=1;k<=Vw;k++)if(ae<<=1,ae-=ze[k],ae<0)return-1;if(ae>0&&(e===0||q!==1))return-1;for(At[1]=0,k=1;k<Vw;k++)At[k+1]=At[k]+ze[k];for(L=0;L<a;L++)t[r+L]!==0&&(d[At[t[r+L]]++]=L);if(e===0?(Fe=hr=d,V=20):e===1?(Fe=qle,hr=Kle,V=257):(Fe=zle,hr=$le,V=0),Te=0,L=0,k=H,O=l,oe=te,se=0,b=-1,pe=1<<te,R=pe-1,e===1&&pe>852||e===2&&pe>592)return 1;for(;;){bt=k-se,d[L]+1<V?(pt=0,Er=d[L]):d[L]>=V?(pt=hr[d[L]-V],Er=Fe[d[L]-V]):(pt=96,Er=0),v=1<<k-se,y=1<<oe,H=y;do y-=v,c[O+(Te>>se)+y]=bt<<24|pt<<16|Er|0;while(y!==0);for(v=1<<k-1;Te&v;)v>>=1;if(v!==0?(Te&=v-1,Te+=v):Te=0,L++,--ze[k]==0){if(k===q)break;k=t[r+d[L]]}if(k>te&&(Te&R)!==b){for(se===0&&(se=te),O+=H,oe=k-se,ae=1<<oe;oe+se<q&&(ae-=ze[oe+se],!(ae<=0));)oe++,ae<<=1;if(pe+=1<<oe,e===1&&pe>852||e===2&&pe>592)return 1;b=Te&R,c[b]=te<<24|oe<<16|O-l|0}}return Te!==0&&(c[O+Te]=k-se<<24|64<<16|0),p.bits=te,0};const{Z_FINISH:r8,Z_BLOCK:Yle,Z_TREES:Fw,Z_OK:Tp,Z_STREAM_END:Xle,Z_NEED_DICT:Jle,Z_STREAM_ERROR:hs,Z_DATA_ERROR:n8,Z_MEM_ERROR:i8,Z_BUF_ERROR:Qle,Z_DEFLATED:a8}=Dw,Bw=16180,Ww=16190,Jl=16191,BP=16192,WP=16194,Gw=16199,Hw=16200,GP=16206,jn=16209,o8=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Zle(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const wp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Bw||t.mode>16211?1:0},s8=e=>{if(wp(e))return hs;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Bw,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Tp},c8=e=>{if(wp(e))return hs;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,s8(e)},l8=(e,t)=>{let r;if(wp(e))return hs;const a=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?hs:(a.window!==null&&a.wbits!==t&&(a.window=null),a.wrap=r,a.wbits=t,c8(e))},u8=(e,t)=>{if(!e)return hs;const r=new Zle;e.state=r,r.strm=e,r.window=null,r.mode=Bw;const a=l8(e,t);return a!==Tp&&(e.state=null),a};let HP,qP,d8=!0;const eue=e=>{if(d8){HP=new Int32Array(512),qP=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(TE(1,e.lens,0,288,HP,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;TE(2,e.lens,0,32,qP,0,e.work,{bits:5}),d8=!1}e.lencode=HP,e.lenbits=9,e.distcode=qP,e.distbits=5},h8=(e,t,r,a)=>{let c;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),a>=l.wsize?(l.window.set(t.subarray(r-l.wsize,r),0),l.wnext=0,l.whave=l.wsize):(c=l.wsize-l.wnext,c>a&&(c=a),l.window.set(t.subarray(r-a,r-a+c),l.wnext),(a-=c)?(l.window.set(t.subarray(r-a,r),0),l.wnext=a,l.whave=l.wsize):(l.wnext+=c,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=c))),0};var tue=(e,t)=>{let r,a,c,l,d,p,g,v,y,b,R,O,V,k,L,H,q,te,oe,se,ae,pe,Te=0;const Fe=new Uint8Array(4);let ze,At;const bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wp(e)||!e.output||!e.input&&e.avail_in!==0)return hs;r=e.state,r.mode===Jl&&(r.mode=BP),d=e.next_out,c=e.output,g=e.avail_out,l=e.next_in,a=e.input,p=e.avail_in,v=r.hold,y=r.bits,b=p,R=g,pe=Tp;e:for(;;)switch(r.mode){case Bw:if(r.wrap===0){r.mode=BP;break}for(;y<16;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(2&r.wrap&&v===35615){r.wbits===0&&(r.wbits=15),r.check=0,Fe[0]=255&v,Fe[1]=v>>>8&255,r.check=Wi(r.check,Fe,2,0),v=0,y=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",r.mode=jn;break}if((15&v)!==a8){e.msg="unknown compression method",r.mode=jn;break}if(v>>>=4,y-=4,ae=8+(15&v),r.wbits===0&&(r.wbits=ae),ae>15||ae>r.wbits){e.msg="invalid window size",r.mode=jn;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&v?16189:Jl,v=0,y=0;break;case 16181:for(;y<16;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(r.flags=v,(255&Ci(r))!==a8){e.msg="unknown compression method",r.mode=jn;break}if(57344&Ci(r)){e.msg="unknown header flags set",r.mode=jn;break}r.head&&(r.head.text=v>>8&1),512&Ci(r)&&4&r.wrap&&(Fe[0]=255&v,Fe[1]=v>>>8&255,r.check=Wi(r.check,Fe,2,0)),v=0,y=0,r.mode=16182;case 16182:for(;y<32;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}r.head&&(r.head.time=v),512&Ci(r)&&4&r.wrap&&(Fe[0]=255&v,Fe[1]=v>>>8&255,Fe[2]=v>>>16&255,Fe[3]=v>>>24&255,r.check=Wi(r.check,Fe,4,0)),v=0,y=0,r.mode=16183;case 16183:for(;y<16;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}r.head&&(r.head.xflags=255&v,r.head.os=v>>8),512&Ci(r)&&4&r.wrap&&(Fe[0]=255&v,Fe[1]=v>>>8&255,r.check=Wi(r.check,Fe,2,0)),v=0,y=0,r.mode=16184;case 16184:if(1024&Ci(r)){for(;y<16;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}r.length=v,r.head&&(r.head.extra_len=v),512&Ci(r)&&4&r.wrap&&(Fe[0]=255&v,Fe[1]=v>>>8&255,r.check=Wi(r.check,Fe,2,0)),v=0,y=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Ci(r)&&(O=r.length,O>p&&(O=p),O&&(r.head&&(ae=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(l,l+O),ae)),512&Ci(r)&&4&r.wrap&&(r.check=Wi(r.check,a,O,l)),p-=O,l+=O,r.length-=O),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Ci(r)){if(p===0)break e;O=0;do ae=a[l+O++],r.head&&ae&&r.length<65536&&(r.head.name+=String.fromCharCode(ae));while(ae&&O<p);if(512&Ci(r)&&4&r.wrap&&(r.check=Wi(r.check,a,O,l)),p-=O,l+=O,ae)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Ci(r)){if(p===0)break e;O=0;do ae=a[l+O++],r.head&&ae&&r.length<65536&&(r.head.comment+=String.fromCharCode(ae));while(ae&&O<p);if(512&Ci(r)&&4&r.wrap&&(r.check=Wi(r.check,a,O,l)),p-=O,l+=O,ae)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Ci(r)){for(;y<16;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(4&r.wrap&&v!==(65535&r.check)){e.msg="header crc mismatch",r.mode=jn;break}v=0,y=0}r.head&&(r.head.hcrc=Ci(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Jl;break;case 16189:for(;y<32;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}e.adler=r.check=o8(v),v=0,y=0,r.mode=Ww;case Ww:if(r.havedict===0)return e.next_out=d,e.avail_out=g,e.next_in=l,e.avail_in=p,r.hold=v,r.bits=y,Jle;e.adler=r.check=1,r.mode=Jl;case Jl:if(t===Yle||t===Fw)break e;case BP:if(r.last){v>>>=7&y,y-=7&y,r.mode=GP;break}for(;y<3;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}switch(r.last=1&v,v>>>=1,y-=1,3&v){case 0:r.mode=16193;break;case 1:if(eue(r),r.mode=Gw,t===Fw){v>>>=2,y-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=jn}v>>>=2,y-=2;break;case 16193:for(v>>>=7&y,y-=7&y;y<32;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",r.mode=jn;break}if(r.length=65535&v,v=0,y=0,r.mode=WP,t===Fw)break e;case WP:r.mode=16195;case 16195:if(O=r.length,O){if(O>p&&(O=p),O>g&&(O=g),O===0)break e;c.set(a.subarray(l,l+O),d),p-=O,l+=O,g-=O,d+=O,r.length-=O;break}r.mode=Jl;break;case 16196:for(;y<14;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(r.nlen=257+(31&v),v>>>=5,y-=5,r.ndist=1+(31&v),v>>>=5,y-=5,r.ncode=4+(15&v),v>>>=4,y-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=jn;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;y<3;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}r.lens[bt[r.have++]]=7&v,v>>>=3,y-=3}for(;r.have<19;)r.lens[bt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,ze={bits:r.lenbits},pe=TE(0,r.lens,0,19,r.lencode,0,r.work,ze),r.lenbits=ze.bits,pe){e.msg="invalid code lengths set",r.mode=jn;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;Te=r.lencode[v&(1<<r.lenbits)-1],L=Te>>>24,H=Te>>>16&255,q=65535&Te,!(L<=y);){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(q<16)v>>>=L,y-=L,r.lens[r.have++]=q;else{if(q===16){for(At=L+2;y<At;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(v>>>=L,y-=L,r.have===0){e.msg="invalid bit length repeat",r.mode=jn;break}ae=r.lens[r.have-1],O=3+(3&v),v>>>=2,y-=2}else if(q===17){for(At=L+3;y<At;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}v>>>=L,y-=L,ae=0,O=3+(7&v),v>>>=3,y-=3}else{for(At=L+7;y<At;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}v>>>=L,y-=L,ae=0,O=11+(127&v),v>>>=7,y-=7}if(r.have+O>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=jn;break}for(;O--;)r.lens[r.have++]=ae}}if(r.mode===jn)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=jn;break}if(r.lenbits=9,ze={bits:r.lenbits},pe=TE(1,r.lens,0,r.nlen,r.lencode,0,r.work,ze),r.lenbits=ze.bits,pe){e.msg="invalid literal/lengths set",r.mode=jn;break}if(r.distbits=6,r.distcode=r.distdyn,ze={bits:r.distbits},pe=TE(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,ze),r.distbits=ze.bits,pe){e.msg="invalid distances set",r.mode=jn;break}if(r.mode=Gw,t===Fw)break e;case Gw:r.mode=Hw;case Hw:if(p>=6&&g>=258){e.next_out=d,e.avail_out=g,e.next_in=l,e.avail_in=p,r.hold=v,r.bits=y,Hle(e,R),d=e.next_out,c=e.output,g=e.avail_out,l=e.next_in,a=e.input,p=e.avail_in,v=r.hold,y=r.bits,r.mode===Jl&&(r.back=-1);break}for(r.back=0;Te=r.lencode[v&(1<<r.lenbits)-1],L=Te>>>24,H=Te>>>16&255,q=65535&Te,!(L<=y);){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(H&&(240&H)==0){for(te=L,oe=H,se=q;Te=r.lencode[se+((v&(1<<te+oe)-1)>>te)],L=Te>>>24,H=Te>>>16&255,q=65535&Te,!(te+L<=y);){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}v>>>=te,y-=te,r.back+=te}if(v>>>=L,y-=L,r.back+=L,r.length=q,H===0){r.mode=16205;break}if(32&H){r.back=-1,r.mode=Jl;break}if(64&H){e.msg="invalid literal/length code",r.mode=jn;break}r.extra=15&H,r.mode=16201;case 16201:if(r.extra){for(At=r.extra;y<At;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,y-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;Te=r.distcode[v&(1<<r.distbits)-1],L=Te>>>24,H=Te>>>16&255,q=65535&Te,!(L<=y);){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if((240&H)==0){for(te=L,oe=H,se=q;Te=r.distcode[se+((v&(1<<te+oe)-1)>>te)],L=Te>>>24,H=Te>>>16&255,q=65535&Te,!(te+L<=y);){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}v>>>=te,y-=te,r.back+=te}if(v>>>=L,y-=L,r.back+=L,64&H){e.msg="invalid distance code",r.mode=jn;break}r.offset=q,r.extra=15&H,r.mode=16203;case 16203:if(r.extra){for(At=r.extra;y<At;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,y-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=jn;break}r.mode=16204;case 16204:if(g===0)break e;if(O=R-g,r.offset>O){if(O=r.offset-O,O>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=jn;break}O>r.wnext?(O-=r.wnext,V=r.wsize-O):V=r.wnext-O,O>r.length&&(O=r.length),k=r.window}else k=c,V=d-r.offset,O=r.length;O>g&&(O=g),g-=O,r.length-=O;do c[d++]=k[V++];while(--O);r.length===0&&(r.mode=Hw);break;case 16205:if(g===0)break e;c[d++]=r.length,g--,r.mode=Hw;break;case GP:if(r.wrap){for(;y<32;){if(p===0)break e;p--,v|=a[l++]<<y,y+=8}if(R-=g,e.total_out+=R,r.total+=R,4&r.wrap&&R&&(e.adler=r.check=Ci(r)?Wi(r.check,c,R,d-R):mE(r.check,c,R,d-R)),R=g,4&r.wrap&&(Ci(r)?v:o8(v))!==r.check){e.msg="incorrect data check",r.mode=jn;break}v=0,y=0}r.mode=16207;case 16207:if(r.wrap&&Ci(r)){for(;y<32;){if(p===0)break e;p--,v+=a[l++]<<y,y+=8}if(4&r.wrap&&v!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=jn;break}v=0,y=0}r.mode=16208;case 16208:pe=Xle;break e;case jn:pe=n8;break e;case 16210:return i8;default:return hs}return e.next_out=d,e.avail_out=g,e.next_in=l,e.avail_in=p,r.hold=v,r.bits=y,(r.wsize||R!==e.avail_out&&r.mode<jn&&(r.mode<GP||t!==r8))&&h8(e,e.output,e.next_out,R-e.avail_out),b-=e.avail_in,R-=e.avail_out,e.total_in+=b,e.total_out+=R,r.total+=R,4&r.wrap&&R&&(e.adler=r.check=Ci(r)?Wi(r.check,c,R,e.next_out-R):mE(r.check,c,R,e.next_out-R)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Jl?128:0)+(r.mode===Gw||r.mode===WP?256:0),(b===0&&R===0||t===r8)&&pe===Tp&&(pe=Qle),pe},Ql={inflateReset:c8,inflateReset2:l8,inflateResetKeep:s8,inflateInit:e=>u8(e,15),inflateInit2:u8,inflate:tue,inflateEnd:e=>{if(wp(e))return hs;let t=e.state;return t.window&&(t.window=null),e.state=null,Tp},inflateGetHeader:(e,t)=>{if(wp(e))return hs;const r=e.state;return(2&r.wrap)==0?hs:(r.head=t,t.done=!1,Tp)},inflateSetDictionary:(e,t)=>{const r=t.length;let a,c,l;return wp(e)?hs:(a=e.state,a.wrap!==0&&a.mode!==Ww?hs:a.mode===Ww&&(c=1,c=mE(c,t,r,0),c!==a.check)?n8:(l=h8(e,t,r,r),l?(a.mode=16210,i8):(a.havedict=1,Tp)))},inflateInfo:"pako inflate (from Nodeca project)"},rue=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const p8=Object.prototype.toString,{Z_NO_FLUSH:nue,Z_FINISH:iue,Z_OK:wE,Z_STREAM_END:KP,Z_NEED_DICT:zP,Z_STREAM_ERROR:aue,Z_DATA_ERROR:f8,Z_MEM_ERROR:oue}=Dw;function qw(e){this.options=Lw.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new e8,this.strm.avail_out=0;let r=Ql.inflateInit2(this.strm,t.windowBits);if(r!==wE)throw new Error(yp[r]);if(this.header=new rue,Ql.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=bE.string2buf(t.dictionary):p8.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Ql.inflateSetDictionary(this.strm,t.dictionary),r!==wE)))throw new Error(yp[r])}function sue(e,t){const r=new qw(t);if(r.push(e),r.err)throw r.msg||yp[r.err];return r.result}qw.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let l,d,p;if(this.ended)return!1;for(d=t===~~t?t:t===!0?iue:nue,p8.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),l=Ql.inflate(r,d),l===zP&&c&&(l=Ql.inflateSetDictionary(r,c),l===wE?l=Ql.inflate(r,d):l===f8&&(l=zP));r.avail_in>0&&l===KP&&r.state.wrap>0&&e[r.next_in]!==0;)Ql.inflateReset(r),l=Ql.inflate(r,d);switch(l){case aue:case f8:case zP:case oue:return this.onEnd(l),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(r.avail_out===0||l===KP))if(this.options.to==="string"){let g=bE.utf8border(r.output,r.next_out),v=r.next_out-g,y=bE.buf2string(r.output,g);r.next_out=v,r.avail_out=a-v,v&&r.output.set(r.output.subarray(g,g+v),0),this.onData(y)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(l!==wE||p!==0){if(l===KP)return l=Ql.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},qw.prototype.onData=function(e){this.chunks.push(e)},qw.prototype.onEnd=function(e){e===wE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Lw.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var cue={inflate:sue};const{deflate:lue}=Gle,{inflate:uue}=cue;var due=lue,hue=uue,m8=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(m8||{});class pue{constructor(){G(this,"_sequence",0),G(this,"_startTime",Date.now()),G(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const g={id:0,length:4,data:p.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};r.commonPacketHeader.extension=1,r.extension=v,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;$("SHOW_DATASTREAM2_LOG")&&N.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const a=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(a),l=new DataView(a);let d=0;if(l.setUint16(d,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),d+=2,l.setUint32(d,r.commonPacketHeader.sequence,!0),d+=4,l.setUint16(d,r.commonStreamHeader,!0),d+=2,r.extension){const p=this.serializeExtension(r.extension);c.set(new Uint8Array(p),d),d+=p.byteLength}if(c.set(new Uint8Array(r.payload),d),d+=r.payload.byteLength,d!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let a=0;const c=r.getUint16(a,!0);a+=2;const l={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(a+2,!0)<<16|r.getUint16(a,!0)};let d,p;if(a+=4,$("SHOW_DATASTREAM2_LOG")&&N.debug("receive data header: ".concat(JSON.stringify(l))),r.getUint16(a,!0),a+=2,l.extension){p=this.deserializeExtension(t.slice(a)),a+=2+p.length,d=t.slice(a);let g=!1;if(p.datas.length>0){const v=p.datas.find(y=>y.id===0);v&&(g=(1&new DataView(v.data).getUint32(0,!0))==1)}d=g?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){const{profile:r,length:a,datas:c}=t,l=new ArrayBuffer(a+2),d=new Uint8Array(l),p=new DataView(l);let g=0;if(p.setUint8(g++,r),p.setUint8(g++,a),c.forEach(v=>{r?(p.setUint8(g++,v.id),p.setUint8(g++,v.length),d.set(new Uint8Array(v.data),g),g+=v.data.byteLength):(p.setUint8(g++,v.id|v.length<<4),d.set(new Uint8Array(v.data),g),g+=v.data.byteLength)}),g!==a+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(a+2));return l}deserializeExtension(t){const r=new DataView(t);let a=0;const c=r.getUint8(a);a++;const l=r.getUint8(a);a++;const d=c===m8.TWO_BYTE,p=[],g=new DataView(t,2);let v=0;for(;v<l;){let y=0,b=0,R=new ArrayBuffer(0);d?(y=g.getUint8(v),v++,b=g.getUint8(v),v++):(y=15&g.getUint8(v),b=g.getUint8(v)>>4,v++),b>0&&(R=g.buffer.slice(v+2,v+2+b),v+=R.byteLength),p.push({id:y,length:b,data:R})}if(v!==l)throw Error("parse error");return{profile:c,length:l,datas:p}}decompress(t){return hue(new Uint8Array(t))}compress(t){return due(new Uint8Array(t))}}const fue={name:"DataStream",create:(e,t)=>{const r=t?new Ese(e):new Sse(e);return r.useDataStream(new pue),r}};class mue extends kr{constructor(t,r,a){super(),G(this,"ws",void 0),G(this,"requestId",1),G(this,"heartBeatTimer",void 0),G(this,"joinInfo",void 0),G(this,"clientId",void 0),G(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),G(this,"onClose",c=>{this.emit("close"),this.dispose()}),G(this,"onMessage",c=>{const l=JSON.parse(c.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=r,this.ws=new Yy("cross-channel-".concat(this.clientId),a),this.ws.on(St.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(St.CONNECTED,this.onOpen),this.ws.on(St.ON_MESSAGE,this.onMessage),this.ws.on(St.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new Ge((r,a)=>{const c=window.setTimeout(()=>{a(new he(K.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(c),l.state&&l.state!==0?a(new he(K.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new he(K.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new he(K.WS_DISCONNECT);const r=()=>new Ge((d,p)=>{this.ws.once(St.CLOSED,()=>p(new he(K.WS_ABORT))),this.ws.once(St.CONNECTED,d)});this.ws.state!=="connected"&&await r();const a=this.sendMessage(t),c=new Ge((d,p)=>{const g=()=>{p(new he(K.WS_ABORT))};this.ws.once(St.RECONNECTING,g),this.ws.once(St.CLOSED,g),this.once("req_".concat(a),d),Kn(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(St.RECONNECTING,g),this.ws.off(St.CLOSED,g),p(new he(K.TIMEOUT,"cross channel ws request timeout"))})}),l=await c;if(!l||l.code!==200)throw new he(K.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(St.REQUEST_NEW_URLS),this.ws.on(St.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class gue extends kr{set state(t){t!==this._state&&(t!==fa.RELAY_STATE_FAILURE&&(this.errorCode=$m.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,a,c,l){super(),G(this,"joinInfo",void 0),G(this,"sid",void 0),G(this,"clientId",void 0),G(this,"cancelToken",Ji.CancelToken.source()),G(this,"workerToken",void 0),G(this,"requestId",0),G(this,"signal",void 0),G(this,"prevChannelMediaConfig",void 0),G(this,"httpRetryConfig",void 0),G(this,"_resolution",void 0),G(this,"_state",fa.RELAY_STATE_IDLE),G(this,"errorCode",$m.RELAY_OK),G(this,"onStatus",d=>{N.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",Kl.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",Kl.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=$m.SRC_TOKEN_EXPIRED,this.state=fa.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=$m.DEST_TOKEN_EXPIRED,this.state=fa.RELAY_STATE_FAILURE))}),G(this,"onReconnect",async()=>{N.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Kl.NETWORK_DISCONNECTED),this.state=fa.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==fa.RELAY_STATE_IDLE&&(N.error("auto restart channel media relay failed",d.toString()),this.errorCode=$m.SERVER_CONNECTION_LOST,this.state=fa.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=ap(),this.signal=new mue(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==fa.RELAY_STATE_IDLE)throw new he(K.INVALID_OPERATION);this.state=fa.RELAY_STATE_CONNECTING,await this.connect(),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new he(K.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new he(K.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new he(K.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==fa.RELAY_STATE_RUNNING)throw new he(K.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==fa.RELAY_STATE_RUNNING)throw new he(K.INVALID_OPERATION);const r=this.genMessage(Bi.SetVideoProfile);await this.signal.request(r),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),N.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=fa.RELAY_STATE_IDLE,this.dispose()}dispose(){N.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ji.CancelToken.source(),this.state=fa.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Cce(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Kl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(Bi.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(Bi.SetSdkProfile,t);await this.signal.request(a),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Bi.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Kl.PACKET_JOINED_SRC_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const l=this.genMessage(Bi.SetSourceUserId,t);await this.signal.request(l),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Bi.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Kl.PACKET_JOINED_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(Bi.StartPacketTransfer,t);await this.signal.request(p),this.emit("event",Kl.PACKET_SENT_TO_DEST_CHANNEL),this.state=fa.RELAY_STATE_RUNNING,N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage(Bi.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Kl.PACKET_UPDATE_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Bi.StopPacketTransfer);await this.signal.request(t),N.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const a=[],c=[],l=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:bo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.23.4"&&(d.sdkVersion="0.0.1");let p=null,g=null;switch(t){case Bi.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Bi.SetSourceChannel:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new he(K.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},d;case Bi.SetSourceUserId:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new he(K.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:g.uid+""},d;case Bi.SetDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new he(K.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),l.push(v.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:l},d;case Bi.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Bi.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Bi.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Bi.UpdateDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new he(K.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),l.push(v.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:l},d;case Bi.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}const _ue={name:"ChannelMediaRelay",create:function(e){return new gue(e.joinInfo,e.clientId,e.websocketRetryConfig||un,e.httpRetryConfig||un,e.resolution)}};function g8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function RE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g8(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g8(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class vue extends kr{constructor(t,r,a,c){super(),G(this,"spec",void 0),G(this,"token",void 0),G(this,"websocket",void 0),G(this,"pingpongTimer",void 0),G(this,"reconnectMode","retry"),G(this,"serviceMode",void 0),G(this,"reqId",0),G(this,"commandReqId",0),G(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),G(this,"handleWebSocketMessage",l=>{if(!l.data)return;const d=JSON.parse(l.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(Ze.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===ql.TRANSCODE?1:2}),this.emit(yd.PUBLISH_STREAM_STATUS,d))}),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new Yy("live-streaming",a),this.websocket.on(St.CONNECTED,this.handleWebSocketOpen),this.websocket.on(St.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(St.REQUEST_NEW_URLS,(l,d)=>{ei(this,yd.REQUEST_NEW_ADDRESS).then(l).catch(d)}),this.websocket.on(St.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,a,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new he(K.UNEXPECTED_ERROR);const p=RE({command:t,sdkVersion:bo==="4.23.4"?"0.0.1":bo,seq:d,requestId:d,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new he(K.WS_DISCONNECT);const g=()=>new Ge((R,O)=>{this.websocket.once(St.CLOSED,()=>O(new he(K.WS_ABORT))),this.websocket.once(St.CONNECTED,R)});this.websocket.state!=="connected"&&await g(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const v=new Ge((R,O)=>{const V=()=>{O(new he(K.WS_ABORT))};this.websocket.once(St.RECONNECTING,V),this.websocket.once(St.CLOSED,V),this.once("@".concat(d,"-").concat(this.spec.sid),k=>{R(k)})});c&&Ze.workerEvent(this.spec.sid,RE(RE({},c),{},{requestId:l,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const y=Date.now();this.websocket.sendMessage(p);let b=null;try{b=await v}catch(R){if(this.websocket.state==="closed")throw R;return await g(),await this.request(t,r,a)}return c&&Ze.workerEvent(this.spec.sid,RE(RE({},c),{},{requestId:l,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:b.code===200,responseTime:Date.now()-y})),b.code!==200&&this.handleResponseError(b),b}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=bo==="4.23.4"?"0.0.1":bo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case gn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void N.warning("live stream response already exists stream");case gn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case gn.LIVE_STREAM_RESPONSE_BAD_STREAM:case gn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new he(K.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case gn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new he(K.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new he(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(yd.WARNING,r,t.serverResponse.url)}case gn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new he(K.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(yd.WARNING,r,t.serverResponse.url)}case gn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case gn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new he(K.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new he(K.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(yd.WARNING,r,t.serverResponse.url)}case gn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case gn.LIVE_STREAM_RESPONSE_WORKER_LOST:case gn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case gn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case gn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new he(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(kT)},6e3)}}function _8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function ma(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_8(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_8(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class yue extends kr{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:un,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:un;super(),G(this,"onLiveStreamWarning",void 0),G(this,"onLiveStreamError",void 0),G(this,"spec",void 0),G(this,"retryTimeout",1e4),G(this,"connection",void 0),G(this,"httpRetryConfig",void 0),G(this,"wsRetryConfig",void 0),G(this,"streamingTasks",new Map),G(this,"isStartingStreamingTask",!1),G(this,"taskMutex",new ci("live-streaming")),G(this,"cancelToken",Ji.CancelToken.source()),G(this,"transcodingConfig",void 0),G(this,"uapResponse",void 0),G(this,"lastTaskId",1),G(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=a,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=ma(ma({},ace),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(N.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(d=>ma(ma(ma({},ice),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){Fr(d.width)||ur(d.width,"config.width",0,1e4),Fr(d.height)||ur(d.height,"config.height",0,1e4),Fr(d.videoBitrate)||ur(d.videoBitrate,"config.videoBitrate",1,1e6),Fr(d.videoFrameRate)||ur(d.videoFrameRate,"config.videoFrameRate"),Fr(d.lowLatency)||Wl(d.lowLatency,"config.lowLatency"),Fr(d.audioSampleRate)||Sn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Fr(d.audioBitrate)||ur(d.audioBitrate,"config.audioBitrate",1,128),Fr(d.audioChannels)||Sn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),Fr(d.videoGop)||ur(d.videoGop,"config.videoGop"),Fr(d.videoCodecProfile)||Sn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Fr(d.userCount)||ur(d.userCount,"config.userCount",0,17),Fr(d.backgroundColor)||ur(d.backgroundColor,"config.backgroundColor",0,16777215),Fr(d.userConfigExtraInfo)||qn(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!Fr(d.transcodingUsers)&&(Gl(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((p,g)=>{nw(p.uid),Fr(p.x)||ur(p.x,"transcodingUser[".concat(g,"].x"),0,1e4),Fr(p.y)||ur(p.y,"transcodingUser[".concat(g,"].y"),0,1e4),Fr(p.width)||ur(p.width,"transcodingUser[".concat(g,"].width"),0,1e4),Fr(p.height)||ur(p.height,"transcodingUser[".concat(g,"].height"),0,1e4),Fr(p.zOrder)||ur(p.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),Fr(p.alpha)||ur(p.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),Fr(d.watermark)||$N(d.watermark,"watermark"),Fr(d.backgroundImage)||$N(d.backgroundImage,"backgroundImage"),d.images&&!Fr(d.images)&&(Gl(d.images,"config.images"),d.images.forEach((p,g)=>{$N(p,"images[".concat(g,"]"))}))}(r);const a=[];r.images&&a.push(...r.images.map(d=>ma(ma(ma({},zN),d),{},{zOrder:255}))),r.backgroundImage&&(a.push(ma(ma(ma({},zN),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(a.push(ma(ma(ma({},zN),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=a,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(d=>ma({},d)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const c=(r.userConfigs||[]).map(d=>typeof d.uid=="number"?Ge.resolve(d.uid):B6(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ge.all(c)).forEach((d,p)=>{r.userConfigs&&r.userConfigs[p]&&(r.userConfigs[p].uid=d)}),this.transcodingConfig=r,this.connection)try{var l;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Aa(l=this.streamingTasks).call(l)).map(p=>p.taskId).join("#")});N.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{N.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,d).then(()=>{N.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(g=>{N.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,g)})})}}async startLiveStreamingTask(t,r,a){if(!this.transcodingConfig&&r===ql.TRANSCODE)throw new he(K.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};N.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const l=await this.taskMutex.lock();if(!this.connection&&a)return void l();if(this.streamingTasks.get(t)&&!a)return l(),new he(K.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(p){throw l(),p}switch(r){case ql.TRANSCODE:c.transcodingConfig=ma({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const d=this.lastTaskId++;try{const p=new Ge((v,y)=>{Kn(this.retryTimeout).then(()=>{if(a)return y(a);const b=this.statusError.get(t);return b?(this.statusError.delete(t),y(b)):void 0})}),g=await Ge.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===ql.TRANSCODE?1:2,requestByUser:!a,tid:d.toString()}),p]);this.isStartingStreamingTask=!1,N.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:d}),l()}catch(p){if(l(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||a)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,p)):await this.startLiveStreamingTask(t,r,p)}}stopLiveStreamingTask(t){return new Ge((r,a)=>{const c=this.streamingTasks.get(t);if(!c||!this.connection)return new he(K.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=c.mode;c.abortTask=()=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:l===ql.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(a)})}resetAllTask(){var t;const r=Array.from(Aa(t=this.streamingTasks).call(t));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ji.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new he(K.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await ei(this,YN.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new vue(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(yd.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(yd.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(yd.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new he(K.UNEXPECTED_ERROR,"can not get new live streaming address list"));ei(this,YN.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,a(l.addressList)}).catch(c)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),c=t.reason;switch(t.code){case gn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new he(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(a)return N.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,d);if(!this.isStartingStreamingTask)return;this.statusError.set(r,d)}case gn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new he(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,d)}case gn.LIVE_STREAM_RESPONSE_WORKER_LOST:case gn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(Aa(l=this.streamingTasks).call(l));for(const p of d)p.abortTask?p.abortTask():(N.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new he(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{N.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(g=>{N.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,g)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Eue={name:"LiveStreaming",create:function(e){return new yue(e.joinInfo,e.websocketRetryConfig||un,e.httpRetryConfig||un)}};function Sue(e){let t=E8();return function(r,a){let c=r.appId;c!==void 0&&(ar(a,10),rl(a,c));let l=r.cid;l!==void 0&&(ar(a,16),ar(a,l));let d=r.cname;d!==void 0&&(ar(a,26),rl(a,d));let p=r.deviceId;p!==void 0&&(ar(a,34),rl(a,p));let g=r.elapse;g!==void 0&&(ar(a,40),xd(a,g));let v=r.fileSize;v!==void 0&&(ar(a,48),xd(a,dg(v)));let y=r.height;y!==void 0&&(ar(a,56),xd(a,dg(y)));let b=r.jpg;b!==void 0&&(ar(a,66),ar(a,b.length),function(ra,we){let Le=hg(ra,we.length);ra.bytes.set(we,Le)}(a,b));let R=r.networkType;R!==void 0&&(ar(a,72),xd(a,dg(R)));let O=r.osType;O!==void 0&&(ar(a,80),xd(a,dg(O)));let V=r.requestId;V!==void 0&&(ar(a,90),rl(a,V));let k=r.sdkVersion;k!==void 0&&(ar(a,98),rl(a,k));let L=r.sequence;L!==void 0&&(ar(a,104),xd(a,dg(L)));let H=r.sid;H!==void 0&&(ar(a,114),rl(a,H));let q=r.timestamp;q!==void 0&&(ar(a,120),xd(a,q));let te=r.uid;te!==void 0&&(ar(a,128),ar(a,te));let oe=r.vid;oe!==void 0&&(ar(a,136),ar(a,oe));let se=r.width;se!==void 0&&(ar(a,144),xd(a,dg(se)));let ae=r.service;ae!==void 0&&(ar(a,152),ar(a,ae));let pe=r.callbackData;pe!==void 0&&(ar(a,162),rl(a,pe));let Te=r.jpgEncryption;Te!==void 0&&(ar(a,168),ar(a,Te));let Fe=r.requestType;Fe!==void 0&&(ar(a,176),ar(a,Fe));let ze=r.scorePorn;ze!==void 0&&(ar(a,185),QP(a,ze));let At=r.scoreSexy;At!==void 0&&(ar(a,193),QP(a,At));let bt=r.scoreNeutral;bt!==void 0&&(ar(a,201),QP(a,bt));let pt=r.scene;pt!==void 0&&(ar(a,208),ar(a,pt));let Er=r.ossFilePrefix;Er!==void 0&&(ar(a,218),rl(a,Er));let hr=r.serviceVendor;if(hr!==void 0)for(let ra of hr){ar(a,226);let we=E8();wue(ra,we),ar(a,we.limit),Oue(a,we),Aue(we)}}(e,t),function(r){let a=r.bytes,c=r.limit;return a.length===c?a:a.subarray(0,c)}(t)}function bue(e){return function(r){let a={};e:for(;!S8(r);){let c=nl(r);switch(c>>>3){case 0:break e;case 1:a.code=nl(r);break;case 2:a.msg=b8(r,nl(r));break;case 3:{let l=Rue(r);a.data=Tue(r),r.limit=l;break}default:v8(r,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function Tue(e){let t={};e:for(;!S8(e);){let r=nl(e);switch(r>>>3){case 0:break e;case 1:t.requestId=b8(e,nl(e));break;case 2:t.requestType=nl(e)>>>0;break;case 3:t.scorePorn=JP(e);break;case 4:t.scoreSexy=JP(e);break;case 5:t.scoreNeutral=JP(e);break;case 6:t.requestScene=nl(e)>>>0;break;case 7:t.scene=nl(e)>>>0;break;default:v8(e,7&r)}}return t}function wue(e,t){let r=e.service;r!==void 0&&(ar(t,8),ar(t,r));let a=e.vendor;a!==void 0&&(ar(t,16),ar(t,a));let c=e.token;c!==void 0&&(ar(t,26),rl(t,c));let l=e.callbackUrl;l!==void 0&&(ar(t,34),rl(t,l))}function Rue(e){let t=nl(e),r=e.limit;return e.limit=e.offset+t,r}function v8(e,t){switch(t){case 0:for(;128&T8(e););break;case 2:YP(e,nl(e));break;case 5:YP(e,4);break;case 1:YP(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Cue=new Float32Array(1);new Uint8Array(Cue.buffer);let $P=new Float64Array(1),ga=new Uint8Array($P.buffer);function dg(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let y8=[];function E8(){const e=y8.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Aue(e){y8.push(e)}function YP(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function S8(e){return e.offset>=e.limit}function hg(e,t){let r=e.bytes,a=e.offset,c=e.limit,l=a+t;if(l>r.length){let d=new Uint8Array(2*l);d.set(r),e.bytes=d}return e.offset=l,l>c&&(e.limit=l),a}function XP(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function b8(e,t){let r=XP(e,t),a=String.fromCharCode,c=e.bytes,l="�",d="";for(let p=0;p<t;p++){let g,v,y,b,R=c[p+r];(128&R)==0?d+=a(R):(224&R)==192?p+1>=t?d+=l:(g=c[p+r+1],(192&g)!=128?d+=l:(b=(31&R)<<6|63&g,b<128?d+=l:(d+=a(b),p++))):(240&R)==224?p+2>=t?d+=l:(g=c[p+r+1],v=c[p+r+2],(49344&(g|v<<8))!=32896?d+=l:(b=(15&R)<<12|(63&g)<<6|63&v,b<2048||b>=55296&&b<=57343?d+=l:(d+=a(b),p+=2))):(248&R)==240?p+3>=t?d+=l:(g=c[p+r+1],v=c[p+r+2],y=c[p+r+3],(12632256&(g|v<<8|y<<16))!=8421504?d+=l:(b=(7&R)<<18|(63&g)<<12|(63&v)<<6|63&y,b<65536||b>1114111?d+=l:(b-=65536,d+=a(55296+(b>>10),56320+(1023&b)),p+=3))):d+=l}return d}function rl(e,t){let r=t.length,a=0;for(let d=0;d<r;d++){let p=t.charCodeAt(d);p>=55296&&p<=56319&&d+1<r&&(p=(p<<10)+t.charCodeAt(++d)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}ar(e,a);let c=hg(e,a),l=e.bytes;for(let d=0;d<r;d++){let p=t.charCodeAt(d);p>=55296&&p<=56319&&d+1<r&&(p=(p<<10)+t.charCodeAt(++d)-56613888),p<128?l[c++]=p:(p<2048?l[c++]=p>>6&31|192:(p<65536?l[c++]=p>>12&15|224:(l[c++]=p>>18&7|240,l[c++]=p>>12&63|128),l[c++]=p>>6&63|128),l[c++]=63&p|128)}}function Oue(e,t){let r=hg(e,t.limit),a=e.bytes,c=t.bytes;for(let l=0,d=t.limit;l<d;l++)a[l+r]=c[l]}function T8(e){return e.bytes[XP(e,1)]}function w8(e,t){let r=hg(e,1);e.bytes[r]=t}function JP(e){let t=XP(e,8),r=e.bytes;return ga[0]=r[t++],ga[1]=r[t++],ga[2]=r[t++],ga[3]=r[t++],ga[4]=r[t++],ga[5]=r[t++],ga[6]=r[t++],ga[7]=r[t++],$P[0]}function QP(e,t){let r=hg(e,8),a=e.bytes;$P[0]=t,a[r++]=ga[0],a[r++]=ga[1],a[r++]=ga[2],a[r++]=ga[3],a[r++]=ga[4],a[r++]=ga[5],a[r++]=ga[6],a[r++]=ga[7]}function nl(e){let t,r=0,a=0;do t=T8(e),r<32&&(a|=(127&t)<<r),r+=7;while(128&t);return a}function ar(e,t){for(t>>>=0;t>=128;)w8(e,127&t|128),t>>>=7;w8(e,t)}function xd(e,t){let r=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,l=c===0?a===0?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,d=hg(e,l),p=e.bytes;switch(l){case 10:p[d+9]=c>>>7&1;case 9:p[d+8]=l!==9?128|c:127&c;case 8:p[d+7]=l!==8?a>>>21|128:a>>>21&127;case 7:p[d+6]=l!==7?a>>>14|128:a>>>14&127;case 6:p[d+5]=l!==6?a>>>7|128:a>>>7&127;case 5:p[d+4]=l!==5?128|a:127&a;case 4:p[d+3]=l!==4?r>>>21|128:r>>>21&127;case 3:p[d+2]=l!==3?r>>>14|128:r>>>14&127;case 2:p[d+1]=l!==2?r>>>7|128:r>>>7&127;case 1:p[d]=l!==1?128|r:127&r}}function R8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}const Iue=new Map([["moderation",1],["supervise",2]]);class Nue extends kr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Un.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=sa(r=t.map(a=>Iue.get(a)||0)).call(r,(a,c)=>a+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),G(this,"name","AgoraRTCVideoContentInspect"),G(this,"_connectionState",as.CONNECTING),G(this,"_innerConnectionState",void 0),G(this,"sequence",0),G(this,"inspectStartTime",void 0),G(this,"workerManagerConnection",void 0),G(this,"workerConnection",void 0),G(this,"workerMessageLengthLimit",void 0),G(this,"inspectIntervalMinimum",void 0),G(this,"qualityRatio",void 0),G(this,"_connectInfo",void 0),G(this,"_cancelTokenSource",Ji.CancelToken.source()),G(this,"_retryConfig",void 0),G(this,"wmSequence",0),G(this,"inspectInterval",void 0),G(this,"inspectTimer",null),G(this,"ossFilePrefix",void 0),G(this,"extraInfo",void 0),G(this,"_inspectType",void 0),G(this,"_inspectMode",void 0),G(this,"_quality",1),G(this,"qualityTimer",null),G(this,"_inspectId",void 0),G(this,"_needWorkUrlOnly",!1),G(this,"inspectImage",()=>{if(this.connectionState!==as.CONNECTED)throw new he(K.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===as.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=gr(5,"inspect-"),this.workerMessageLengthLimit=$("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Yy("worker-manager-"+this._inspectId,un),this.on(Un.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,N.debug("[".concat(this._inspectId,"] Inspect operation :").concat(os[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Yy("worker-"+this._inspectId,un),this.handleWorkerEvents()}async init(t,r){this.emit(Un.STATE_CHANGE,os.CONNECT_AP),this._connectInfo=t;const a=this._cancelTokenSource.token;return this._retryConfig=r,new Ge((c,l)=>{this.on(Un.CONNECTION_STATE_CHANGE,(d,p)=>{p===as.CONNECTED&&c()}),this.requestAP(t,a,r).then(d=>{this.connectWorkerManager(d)}).catch(d=>{l(d)})})}async requestAP(t,r,a){const c=$("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),l=await function(p,g,v,y){let{appId:b,areaCode:R,cname:O,sid:V,token:k,uid:L}=g;tg++;const H="image_moderation_api",q={service_name:H,json_body:JSON.stringify({appId:b,areaCode:R,cname:O,command:"allocateEdge",requestId:tg,seq:tg,sid:V,token:k,ts:Date.now(),uid:L+""})};let te,oe,se=p[0];return Hs(async()=>{te=Date.now();const ae=await Ys(se,{data:q,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(oe=Date.now()-te,ae.code!==0){const ze=new he(K.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ae.code,{retry:!0,responseTime:oe});throw N.error(ze.toString()),ze}const pe=JSON.parse(ae.json_body);if(pe.code!==200){const ze=new he(K.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(pe.code,", reason: ").concat(pe.reason),{code:pe.code,responseTime:oe});throw N.error(ze.toString()),ze}if(!pe.servers||!Array.isArray(pe.servers)||pe.servers.length===0){const ze=new he(K.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:pe.code,responseTime:oe});throw N.error(ze.toString()),ze}const Te=$("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Fe=$("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:pe.servers.map(ze=>{let{address:At,wss:bt}=ze;if(At&&bt)return"wss://".concat(At.replace(/\./g,"-"),".").concat(Te,":").concat(Fe||bt)}).filter(ze=>!!ze),workerToken:pe.workerToken,vid:pe.vid,responseTime:oe}},(ae,pe)=>(Ze.apworkerEvent(V,{success:!0,sc:200,serviceName:H,responseDetail:JSON.stringify(ae.addressList),firstSuccess:pe===0,responseTime:oe,serverIp:p[pe%p.length]}),!1),(ae,pe)=>(Ze.apworkerEvent(V,{success:!1,sc:ae.data&&ae.data.code||200,serviceName:H,responseTime:oe,serverIp:p[pe%p.length]}),!!(ae.code!==K.OPERATION_ABORTED&&ae.code!==K.UNEXPECTED_RESPONSE||ae.data&&ae.data.retry)&&(se=p[(pe+1)%p.length],!0)),y)}(c,t,r,a);this.emit(Un.STATE_CHANGE,os.AP_CONNECTED);const{addressList:d}=l;return this.wmSequence++,d}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Un.STATE_CHANGE,os.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(St.CONNECTED,async()=>{this.emit(Un.STATE_CHANGE,os.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.4",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(St.CLOSED,()=>{this._innerConnectionState<os.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(St.FAILED,()=>{this._innerConnectionState<os.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(St.RECONNECTING,()=>{this._innerConnectionState<os.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(St.ON_MESSAGE,async t=>{this.emit(Un.STATE_CHANGE,os.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(t.data);if(a.code!==200)throw N.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new he(K.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&r))throw N.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new he(K.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=$("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,l=r.replace(/:\d+\/?$/,":".concat(c));this.emit(Un.STATE_CHANGE,os.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(Un.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(St.WILL_RECONNECT,(t,r,a)=>{a(t)}),this.workerManagerConnection.on(St.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(St.CONNECTED,async()=>{this.emit(Un.STATE_CHANGE,os.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=as.CONNECTED}),this.workerConnection.on(St.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const a=bue(new Uint8Array(t.data));if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&N.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Un.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var r;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},l=sa(r=Object.keys(c)).call(r,(p,g)=>c[p]>c[g]?p:g,"porn"),d=Object.keys(c).find(p=>p===l);this.emit(Un.INSPECT_RESULT,d)}else this.emit(Un.INSPECT_RESULT,void 0,new he(K.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(Un.INSPECT_RESULT,void 0,new he(K.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else N.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Un.INSPECT_RESULT,void 0,new he(K.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(St.CLOSED,()=>{this.connectionState=as.CLOSED}),this.workerConnection.on(St.FAILED,()=>{this.connectionState=as.CLOSED}),this.workerConnection.on(St.RECONNECTING,()=>{this.connectionState=this.connectionState===as.CONNECTED?as.RECONNECTING:as.CONNECTING}),this.workerConnection.on(St.WILL_RECONNECT,(t,r,a)=>{t==="recover"&&a(t),a("tryNext")}),this.workerConnection.on(St.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(Un.REQUEST_NEW_WORKER_URL,a=>{t([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{r(a)})})}async requestToInspectImage(){this.sequence++;const t=za(this,Un.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Un.INSPECT_RESULT,void 0,new he(K.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(t,r);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(Un.INSPECT_RESULT,void 0,new he(K.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:a,cname:c,cid:l,vid:d,sid:p,uid:g}=r;const v=Date.now(),y=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await s5(y,a,c),R=this.sequence+"-"+l+"-"+g+"-"+v+"-"+gr(12,""),O={appId:a,cid:l,cname:c,deviceId:"",elapse:(V=Number(v-this.inspectStartTime),{low:V|=0,high:V>>31,unsigned:V>=0}),fileSize:b.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:R,sdkVersion:"4.23.4",sequence:this.sequence,sid:p,timestamp:xW(v),uid:g,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var V;this.extraInfo===void 0&&delete O.callbackData,this.ossFilePrefix===void 0&&delete O.ossFilePrefix;const k=Sue(O);if(k.byteLength<this.workerMessageLengthLimit){if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const L=function(H){for(var q=1;q<arguments.length;q++){var te=arguments[q]!=null?arguments[q]:{};q%2?R8(Object(te),!0).forEach(function(oe){G(H,oe,te[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(te)):R8(Object(te)).forEach(function(oe){Object.defineProperty(H,oe,Object.getOwnPropertyDescriptor(te,oe))})}return H}({},O);delete L.jpg,N.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(L))}return k}{const L=this.quality*this.qualityRatio;return this.quality=L,await this.generateRequestData(t,{appId:a,cname:c,cid:l,vid:d,sid:p,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ji.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=as.CLOSED,this.emit(Un.STATE_CHANGE,os.CLOSED)}}const Pue={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new he(K.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new he(K.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(r.inspectType)];a.forEach(c=>{var l;if(!Ve(l=["supervise","moderation"]).call(l,c))throw new he(K.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),r.inspectType=a}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new he(K.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Nue(t)}};var C8=u(xn.Object.getOwnPropertySymbols),Due=er,xue=pf.indexOf,kue=uh,ZP=Oe([].indexOf),A8=!!ZP&&1/ZP([1],1,-0)<0;Due({target:"Array",proto:!0,forced:A8||!kue("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return A8?ZP(this,e,t)||0:xue(this,e,t)}});var Lue=Sa("Array","indexOf"),Mue=P,Uue=Lue,eD=Array.prototype,jue=function(e){var t=e.indexOf;return e===eD||Mue(eD,e)&&t===eD.indexOf?Uue:t},O8=u(jue);function Vue(e,t){if(e==null)return{};var r,a,c=function(d,p){if(d==null)return{};var g={};for(var v in d)if({}.hasOwnProperty.call(d,v)){if(O8(p).call(p,v)!==-1)continue;g[v]=d[v]}return g}(e,t);if(C8){var l=C8(e);for(a=0;a<l.length;a++)r=l[a],O8(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let I8=class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(e){G(this,"sessionDesc",void 0),G(this,"_localCapabilities",void 0),G(this,"_rtpCapabilities",void 0),G(this,"_candidates",void 0),G(this,"_iceParameters",void 0),G(this,"_dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname","o/i14u9pJrxRKAsu"),G(this,"firefoxSsrcMidMap",new Map),e=Lr(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:c,localCapabilities:l,direction:d,setup:p,videoCodec:g,audioCodec:v}=e;let y;this.setup=p,y=d===Fi.RECEIVE_ONLY?pa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):pa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=l;const b=d===Fi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,R=d===Fi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,O=d===Fi.RECEIVE_ONLY?c.send.videoCodecs:Qy($e.VIDEO,b,R,g),V=d===Fi.RECEIVE_ONLY?c.send.audioCodecs:Qy($e.AUDIO,b,R,v);for(const k of y.mediaDescriptions)k.attributes.iceUfrag=t.iceUfrag,k.attributes.icePwd=t.icePwd,k.attributes.fingerprints=r.fingerprints,k.attributes.candidates=a,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"&&(k.media.fmts=O.map(L=>L.payloadType.toString(10)),k.attributes.payloads=O,k.attributes.extmaps=b.videoExtensions),k.media.mediaType==="audio"&&(k.media.fmts=V.map(L=>L.payloadType.toString(10)),k.attributes.payloads=V,k.attributes.extmaps=b.audioExtensions,eg(k));this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return vd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,a,c){r=r.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:d}=fp(t,this.cname,$("SYNC_GROUP")?r:void 0),p=this.findPreloadMediaDesc(l);if(p){if(Vr()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(e,l,a);let v;return g===-1?(v=this.createOrRecycleSendMedia(e,l,d,"sendonly",a,c),this.updateBundleMids()):(v=Lr(this.sessionDesc.mediaDescriptions[g]),v.attributes.direction="sendonly",v.attributes.ssrcs=l,v.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(v,c)),Vr()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){const a=[];return e.forEach(c=>{const l=c._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(l);let p,g=!1;d===-1?(g=!0,p=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(p=Lr(this.sessionDesc.mediaDescriptions[d]),p.attributes.direction="recvonly"),a.push({mid:p.attributes.mid,needCreateTransceiver:g})}),a}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:a,port:c,type:l,relatedAddress:d,relatedPort:p,priority:g}=new RTCIceCandidate(e),v={foundation:t??"",componentId:"1",transport:r??"",priority:g?g+"":"",connectionAddress:a??"",port:c?c+"":"",type:l?l+"":"",relAddr:d??"",relPort:p?p+"":"",extension:{}};this.candidates.some(y=>y.priority===v.priority&&y.connectionAddress===v.connectionAddress&&y.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,a,c){const l=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,p=Qy(l,d,this.localCapabilities.send,l===$e.AUDIO?c:a),g=l===$e.VIDEO?d.videoExtensions:d.audioExtensions,v="".concat(++this.currentMidIndex);let y={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};y=this.mungRecvMediaDsec(y,e);const b=this.findFirstClosedMedia(l);if(b){const R=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>Ve(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>Ve(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===e&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(Vr()){if(c){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!l||l!==a.attributes.mid)}return!1}return c&&a.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Lr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,a,c,l){const d=this.rtpCapabilities.send,p=e===$e.VIDEO?d.videoCodecs:d.audioCodecs,g=e===$e.VIDEO?d.videoExtensions:d.audioExtensions;Vr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,l);const y=this.findFirstClosedMedia(e);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,t,r){const a=Lr(e);return tP(a),Zm(a,t),rP(a,t),S6(a),uw(a,r,this.localCapabilities.send),a}mungSendMediaDesc(e,t){const r=Lr(e);return uw(r,t,this.localCapabilities.recv),eg(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===e);if(r!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Vr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Fue=["sdp"];var wr;function N8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function kd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N8(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N8(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let P8=(wr=class vg extends n6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,a){super(t,r),G(this,"direction",void 0),G(this,"name",void 0),G(this,"store",void 0),G(this,"spec",void 0),G(this,"peerConnection",void 0),G(this,"initialOffer",void 0),G(this,"transport",void 0),G(this,"statsFilter",void 0),G(this,"localCandidateCount",0),G(this,"_isInRestartIce",!1),G(this,"mutex",void 0),G(this,"onLocalCandidate",void 0),G(this,"remoteSDP",void 0),G(this,"pendingCandidates",[]),G(this,"localCapabilities",void 0),G(this,"isReady",!1),G(this,"restartCnt",0),G(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new ci("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(vg.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Fi.SEND_ONLY,this.name=this.direction===Fi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=fN(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Vr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await T6();if(this.localCapabilities=dw(r),t){const{sdp:a}=t,c=Vue(t,Fue),l=function(){const y={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},b=Jy(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ss(b,y,"videoExtensions",R,O,V),ss(b,y,"videoCodecs",R,O,V),ss(b,y,"audioExtensions",R,O,V),ss(b,y,"audioCodecs",R,O,V),$("RAISE_H264_BASELINE_PRIORITY")){const k=V.videoCodecs.findIndex(L=>L.rtpMap&&L.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&L.fmtp&&L.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){const L=V.videoCodecs.findIndex(H=>H.rtpMap&&H.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(L<k){N.debug("raising H264 baseline profile priority");const H=V.videoCodecs[k];V.videoCodecs.splice(k,1),V.videoCodecs.splice(L,0,H)}L!==-1&&$("FILTER_SEND_H264_BASELINE")&&(R.videoCodecs=R.videoCodecs.filter(H=>!(H.rtpMap&&H.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&H.fmtp&&H.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:R,recv:O,sendrecv:V}}({},{},a);this.remoteSDP=new I8({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const p=Td(d.sdp);await this.peerConnection.setLocalDescription(d);const g=await w6({},{},d.sdp);this.localCapabilities=dw(g);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),kd(kd({},p),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Td(a.sdp);return this.initialOffer=a,kd(kd({},c),{},{sdp:a.sdp})}}catch(r){throw new _e(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:a,dtlsParameters:c}=t,l=await w6({},{},r);this.remoteSDP=new I8({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new _e(K.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,a){var c=this;return So(function*(){const l=yield Gt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],p=c.remoteSDP.receive(t,r,a);t.forEach((L,H)=>{if(p[H].needCreateTransceiver){const q=c.peerConnection.addTransceiver(L._mediaStreamTrack,{direction:"sendonly"});d.push(q),L._updateRtpTransceiver(q)}else{const q=c.peerConnection.getTransceivers().find(te=>te.mid===p[H].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[H].mid));d.push(q),L._updateRtpTransceiver(q)}}),Vr()&&$("SIMULCAST")===!0&&(yield Gt(c.applySimulcastForFirefox(d,t)));const g=p.map(L=>L.mid),v=yield Gt(c.peerConnection.createOffer()),y=c.mungSendOfferSDP(v.sdp,t,g),b=pa(y),R=g.map(L=>{const H=b.mediaDescriptions.find(q=>q.attributes.mid===L);if(!H)throw new Error("Cannot extract ssrc from mediaDescription.");return v6(H,$("USE_PUB_RTX"))}),O=d.map((L,H)=>{const q=g[H];return{localSSRC:R[H],id:q}});yield Gt(c.peerConnection.setLocalDescription({type:"offer",sdp:y}));try{yield O}catch(L){const H=c.remoteSDP.toString();throw yield Gt(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Gt(c.peerConnection.setRemoteDescription({type:"answer",sdp:H})),yield Gt(c.stopSending(g,!0)),L}yield Gt(c.applySimulcastEncodings(d,t)),yield Gt(c.applySendEncodings(d,t));const V=c.remoteSDP.toString(),k=c.logSDPExchange(y,"offer","local","send");return k==null||k(V),yield Gt(c.setRemoteDescription({type:"answer",sdp:V})),d.map((L,H)=>{const q=g[H];return{localSSRC:R[H],id:q}})}catch(d){throw d instanceof _e?d:new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var v;g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();d==null||d(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,r,a,c);if(d){const g=this.remoteSDP.toString(),v=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const y=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(y.sdp,l,t);v==null||v(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(g=>g.mid===l);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(l){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:d}=this.remoteSDP.send(t,r,a,c);if(d){const p=this.remoteSDP.toString(),g=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const v=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(v.sdp,l,t);g==null||g(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===op.Auto&&(this.store.p2pTransport=op.SdRtn,qt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vg.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,qt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vg.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=Td(r.sdp);return this.store.descriptionStart(),this.direction===Fi.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Fi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=Td(r.sdp);return await this.peerConnection.setLocalDescription(r),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const l=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),d==null||d(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new _e(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(r)?Vr()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:c}=r.getSelectedCandidatePair();return{local:kd(kd({},Gc),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:kd(kd({},Gc),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;Ve(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var l;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Uy(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...vg.turnServerConfigToIceServers(t.turnServer.servers,r,a)),$("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...vg.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,a)),Ve(l=[op.Relay,op.SdRtn]).call(l,r)&&(c.iceTransportPolicy="relay"),$("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(c.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&qt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),N.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],l=t.filter(p=>p.tcpport);N.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(a));const d=l.length>a?l[a]:l[0];switch(r){case op.SdRtn:const p=t.filter(v=>{var y;return Ve(y=v.username).call(y,"glb:")&&v.turnServerURL==v.turnServerURL}),g=p.length>a?p[a]:p[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Sd(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Sd(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case op.Relay:d&&(c.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),c.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Sd(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(c.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),c.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Sd(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),c.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var a;t!=null&&t.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,t.state))},t.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const a=t==null?void 0:t.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:a,remote:c}=r.getSelectedCandidatePair();N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a;if(r||(r=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!r)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!qt().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},l={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var d;const{bitrateMax:y,frameRate:b,scaleResolutionDownBy:R}=t._encoderConfig;y&&(l.maxBitrate=1e3*y),Ve(d=t._hints).call(d,dr.LOW_STREAM)&&(b&&(l.maxFramerate=Pa(b)),R&&R>=1&&(l.scaleResolutionDownBy=R))}if($("DSCP_TYPE")&&Bl()){var p;const y=$("DSCP_TYPE");Ve(p=["very-low","low","medium","high"]).call(p,y)&&(l.networkPriority=y)}const g=r.getParameters(),v=(a=g.encodings)===null||a===void 0?void 0:a[0];Vr()&&!v&&(c.encodings=[l]),v&&Object.assign(v,l),Object.assign(g,c),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await r.setParameters(g)}async applySendEncodings(t,r){try{if(!qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],l=r[a];l instanceof Tr&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,c.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){const c=pa(t);return r.forEach((l,d)=>{const p=a[d],g=c.mediaDescriptions.find(v=>v.attributes.mid===p);g&&(Zm(g,l),b6(g,l,this.store.codec))}),vd(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var a,c,l,d,p;const v=t[g],y=r[g];if(y instanceof Tr&&!Ve(a=y._hints).call(a,dr.LOW_STREAM)&&(c=y._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((l=y._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=y._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((p=y._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const b={},R={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:R.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:R.high}];const O=v.sender.getParameters();await v.sender.setParameters(Object.assign(O,b))}}}async applySimulcastEncodings(t,r){if(!Vr()&&t.length===r.length)for(let a=0;a<t.length;a++){const c=r[a];if(c instanceof Tr&&this.isVP8Simulcast(c)){const l=t[a],d={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const g=l.sender.getParameters();await l.sender.setParameters(Object.assign(g,d))}}}isVP8Simulcast(t){var r,a,c,l,d;return!!(t instanceof Tr&&$("SIMULCAST")&&this.store.codec==="vp8"&&!Ve(r=t._hints).call(r,dr.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,r,a,c){if($("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?l=>{this.logSDPExchange(l,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(d=>{d.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async d=>{d.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var a;if(r=r??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;const l=(c=pa(r).mediaDescriptions.find(d=>d.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),Ve(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,a){const c=pa(t),l=c.mediaDescriptions.find(d=>d.attributes.mid===r);return l&&a===$e.AUDIO&&l.media.mediaType==="audio"&&eg(l),vd(c)}},Qe(wr.prototype,"establish",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"establish"),wr.prototype),Qe(wr.prototype,"connect",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"connect"),wr.prototype),Qe(wr.prototype,"receive",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"receive"),wr.prototype),Qe(wr.prototype,"mockReceive",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"mockReceive"),wr.prototype),Qe(wr.prototype,"stopReceiving",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"stopReceiving"),wr.prototype),Qe(wr.prototype,"restartICE",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"restartICE"),wr.prototype),Qe(wr.prototype,"close",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"close"),wr.prototype),Qe(wr.prototype,"updateEncoderConfig",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"updateEncoderConfig"),wr.prototype),Qe(wr.prototype,"updateSendParameters",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"updateSendParameters"),wr.prototype),Qe(wr.prototype,"replaceTrack",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"replaceTrack"),wr.prototype),Qe(wr.prototype,"muteLocal",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"muteLocal"),wr.prototype),Qe(wr.prototype,"unmuteLocal",[ps],Object.getOwnPropertyDescriptor(wr.prototype,"unmuteLocal"),wr.prototype),wr);function ps(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,l=await c.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,p=new Array(d),g=0;g<d;g++)p[g]=arguments[g];return await a.apply(this,p)}finally{l()}},r}let Js=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var D8,x8,k8,L8,M8,U8,j8,V8,F8,B8,W8,Pr;function G8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function Kw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G8(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G8(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let Bue=(D8=Qs(Js.SEND_ONLY),x8=Qs(Js.SEND_ONLY),k8=Qs(),L8=Qs(Js.RECEIVE_ONLY),M8=Qs(Js.RECEIVE_ONLY),U8=Qs(Js.RECEIVE_ONLY),j8=Qs(Js.RECEIVE_ONLY),V8=Qs(Js.RECEIVE_ONLY),F8=Qs(Js.RECEIVE_ONLY),B8=Qs(),W8=Qs(Js.RECEIVE_ONLY),Pr=class extends kr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(at.StateChange,t,this._state)}constructor(e,t){super(),G(this,"isPlanB",!1),G(this,"store",void 0),G(this,"statsUploader",void 0),G(this,"sendConnection",void 0),G(this,"recvConnection",void 0),G(this,"localTrackMap",new Map),G(this,"remoteUserMap",new Map),G(this,"localDataChannels",[]),G(this,"pendingLocalTracks",[]),G(this,"pendingRemoteTracks",[]),G(this,"statsCollector",void 0),G(this,"dtlsFailedCount",0),G(this,"sendMutex",void 0),G(this,"recvMutex",void 0),G(this,"_state",rr.Disconnected),G(this,"_restartStates",["disconnected","failed"]),G(this,"reconnectInterval",void 0),G(this,"uploadUnplinkStarted",!1),G(this,"uploadDownlinkStarted",!1),G(this,"uplinkStateUploadInterval",void 0),G(this,"downlinkStatsUploadInterval",void 0),G(this,"handleMuteLocalTrack",async(r,a,c)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==rr.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(r);if(g.length===0)return void a();const v=g.find(O=>O[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(O=>{let[,{id:V}]=O;return V}));let y=!1;var d,p;r.trackMediaType==="video"?y=!((d=this.localTrackMap.get(Ie.LocalAudioTrack))===null||d===void 0||!d.track._muted):y=((p=this.localTrackMap.get(Ie.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;const b=this.createMuteMessage(g);await pr(this,at.RequestMuteLocal,b);const R=r.trackMediaType==="video"?Ed.MUTE_LOCAL_VIDEO:Ed.MUTE_LOCAL_AUDIO;await pr(this,at.RequestP2PMuteLocal,{action:R,message:b,isMuteAll:y}),a()}catch(g){c(g)}finally{l()}}),G(this,"handleUnmuteLocalTrack",async(r,a,c)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==rr.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const d=this.filterTobeUnmutedTracks(r);if(d.length===0)return void a();await this.sendConnection.unmuteLocal(d.map(v=>{let[,{id:y}]=v;return y}));const p=this.createUnmuteMessage(d),g=r.trackMediaType==="video"?Ed.UNMUTE_LOCAL_VIDEO:Ed.UNMUTE_LOCAL_AUDIO;await pr(this,at.RequestP2PMuteLocal,{action:g,message:p}),a()}catch(d){c(d)}finally{l()}}),G(this,"handleUpdateVideoEncoder",async(r,a,c,l)=>{let d;typeof l=="boolean"&&l||(d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==r||this.state!==rr.Connected)return void a();const{id:v,track:y}=g;v&&(await this.sendConnection.updateSendParameters(v,y),await this.sendConnection.updateEncoderConfig(v,y),this.emit(at.UpdateVideoEncoder,y)),a()}catch(g){c(g)}finally{var p;(p=d)===null||p===void 0||p()}}),G(this,"handleUpdateVideoSendParameters",async(r,a,c)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==r||this.state!==rr.Connected)return void a();const{id:p,track:g}=d;p&&await this.sendConnection.updateSendParameters(p,g),a()}catch(d){c(d)}finally{l()}}),G(this,"handleReplaceTrack",async(r,a,c,l)=>{let d;N.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof l=="boolean"&&l||(d=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;const v=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:b}]=y;return r===b});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==rr.Connected)return void a();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(r,v[1].id)),v[0]===Ie.LocalVideoTrack&&qt().supportDualStreamEncoding){const y=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(y){const b=r._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b,await new Ge((R,O)=>{this.handleReplaceTrack(y.track,R,O,!0)})}}a()}catch(v){c(v)}finally{var g;(g=d)===null||g===void 0||g()}}),G(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),G(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),G(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),G(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sW(e),this.bindStatsUploaderEvents(),this.sendMutex=new ci("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ci("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},$("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new P8(e,this.store,Fi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(t);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=rr.New,this.sendConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new P8(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=rr.Connected}async addRemoteCandidate(e,t){if(t===Fi.RECEIVE_ONLY){if(!this.sendConnection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var a=this;return So(function*(){const c=yield Gt(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==rr.Connected){a.throwIfTrackTypeNotMatch(e);const v=e.filter(y=>a.pendingLocalTracks.indexOf(y)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,di.markPublishStart(a.store.clientId,a.store.pubId);const l=a.filterTobePublishedTracks(e,t,r);if(l.length===0)return void(yield Gt(a.tryToUnmuteAudio(e)));l.forEach(v=>{let{track:y,type:b}=v;const R=Date.now();a.store.publish(y.getTrackId(),b===Ie.LocalAudioTrack?"audio":"video",R)}),a.bindLocalTrackEvents(l);const d=yield Gt(a.sendConnection.send(l.map(v=>{let{track:y}=v;return y}),a.store.codec,a.store.audioCodec)),p=(yield Gt(d.next())).value,g=a.createGatewayPublishMessage(l,p);try{yield g}catch(v){throw d.throw(v),(v==null?void 0:v.code)===K.WS_ABORT&&l.forEach(y=>{let{track:b}=y;a.pendingLocalTracks.indexOf(b)===-1&&a.pendingLocalTracks.push(b)}),a.unbindLocalTrackEvents(l),v}yield Gt(d.next()),l.forEach(v=>{let{type:y}=v;a.statsCollector.addLocalStats(y)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(l,p),l.forEach(v=>{let{track:y,type:b}=v;const R=Date.now();a.store.publish(y.getTrackId(),b===Ie.LocalAudioTrack?"audio":"video",void 0,R)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==rr.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Ve(e).call(e,c)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(c=>c[0]==="videoLowTrack");r&&r[1].track.close();const a=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:l}]=c;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[l,{track:d}]=c;return{type:l,track:d}})),t.forEach(c=>{let[l]=c;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===rr.Connected)return r&&r[1].track.close(),a;e.forEach(c=>{const l=this.pendingLocalTracks.indexOf(c);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:l,ssrcs:d}]=a;const p={stream_type:Dce(l,c),ssrcs:d};l._muted||!l._enabled?t.push(p):r.push(p)}),t.length>0&&t.forEach(a=>{pr(this,at.RequestMuteLocal,[a])}),r.length>0&&r.forEach(a=>{pr(this,at.RequestUnmuteLocal,[a])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return So(function*(){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,at.RequestRePublish,this.pendingLocalTracks),this.emit(at.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,a){var c;if(!this.recvConnection)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;const{track:l,mid:d,transceiver:p}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),a);t===$e.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new qm(l,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Hm(l,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));const g=this.remoteUserMap.get(e);g?g.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:b,kind:R}=y;return b.uid===e.uid&&t===R});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(at.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,a){if(!this.recvConnection)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),a)}async unsubscribe(e,t,r){const a=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:p}=l;return t!==void 0?d.uid===e.uid&&t===p:d.uid===e.uid});if(a.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||r||a.forEach(l=>{let{kind:d}=l;var p;if(d===$e.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(d===$e.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(l=>{let[,{id:d}]=l;return d})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(l=>{let[d,{kind:p}]=l;var g,v;if(p===$e.VIDEO&&d._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),p===$e.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),r||((v=d._videoTrack)===null||v===void 0||v._destroy(),d._videoTrack=void 0);else if(p===$e.AUDIO){var y;this.unbindRemoteTrackEvents(d._audioTrack),!r&&((y=d._audioTrack)===null||y===void 0||y._destroy(),d._audioTrack=void 0)}}),c.forEach(l=>{let[,{kind:d}]=l;pr(this,at.RequestP2PMuteRemote,d)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[$e.VIDEO,$e.AUDIO].forEach(a=>{r.has(a)?pr(this,at.RequestP2PUnmuteRemote,a):pr(this,at.RequestP2PMuteRemote,a)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const a=t===$e.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Ie.LocalAudioTrack);if((t==null?void 0:t.track)instanceof mn){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ie.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===Ie.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[a]=r;return!(e&&a===Ie.LocalVideoLowTrack)}).map(r=>{let[,{track:a}]=r;return a})}reportPublishEvent(e,t,r,a,c){if(e){const d=this.localTrackMap.get(Ie.LocalAudioTrack),p=a?this.localTrackMap.get(Ie.LocalVideoLowTrack):this.localTrackMap.get(Ie.LocalVideoTrack);Ze.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!d,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var l;r||(r=[]);const d=r.find(g=>g instanceof Gr),p=a?(l=this.localTrackMap.get(Ie.LocalVideoTrack))===null||l===void 0?void 0:l.track:r.find(g=>g instanceof Tr);Ze.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!d,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,a){const c=a===$e.VIDEO?r._videoSSRC:r._audioSSRC;c&&Ze.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===$e.VIDEO,audio:a===$e.AUDIO,peerid:r.uid,subscribeRequestid:a===$e.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:di.measureFromSubscribeStart(this.store.clientId,c)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ci("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ci("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ie.LocalAudioTrack);if((e==null?void 0:e.track)instanceof mn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=rr.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ie.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Tr||t&&t.track instanceof Gr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Ya(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[a]=r;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Ie.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=$h(e).call(e,(r,a)=>r.level-a.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=rr.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:a}]=e;switch(r){case Ie.LocalVideoTrack:Ve(t=a._hints).call(t,dr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ie.LocalAudioTrack:a instanceof mn?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ie.LocalVideoLowTrack:}}),this.emit(at.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ya(r).call(r)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(at.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:a,kind:c}=r;if((e instanceof Rd?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,a;if(e===Fi.SEND_ONLY){if(!this.sendConnection)throw new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(t){const c=await a.restartICE(t);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const l=await ei(this,at.RequestP2PRestartICE,{direction:Fi.RECEIVE_ONLY,iceParameter:c});await a.restartICE(l),a.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalAudioTrack),a=e.videoSend.find(O=>{var V;return O.ssrc===(t==null||(V=t.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)}),c=e.audioSend.find(O=>{var V;return O.ssrc===(r==null||(V=r.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)});if(!a||!c)return 1;const l=za(this,at.NeedSignalRTT),d=a?a.rttMs:void 0,p=c?c.rttMs:void 0,g=d&&p?(d+p)/2:d||p,v=(g&&l?(g+l)/2:g||l)||0,y=100*e.sendPacketLossRate*.7/50+.3*v/1500,b=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,R=t==null?void 0:t.track;if(R&&R._encoderConfig&&R._hints.indexOf(dr.SCREEN_TRACK)===-1){const O=R._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(O&&V){const k=(1e3*O-V)/(1e3*O);return Y4[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[a]=r;const c=a._audioSSRC,l=a._videoSSRC,d=e.audioRecv.find(V=>V.ssrc===c),p=e.videoRecv.find(V=>V.ssrc===l);if(!d&&!p)return void(t+=1);const g=za(this,at.NeedSignalRTT),v=e.rtt,y=(v&&g?(v+g)/2:v||g)||0,b=d?d.jitterMs:void 0,R=e.recvPacketLossRate;let O=.7*R*100/50+.3*y/1500;b&&(O=.6*R*100/50+.2*y/1500+.2*b/400),t+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ge((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){const a=[],c=qt(),l=this.getAllTracks();e=Pm(e=e.filter(g=>l.indexOf(g)===-1));let d=!1,p=!1;for(const g of e){if(g instanceof Tr&&(this.localTrackMap.has(Ie.LocalVideoTrack)||d?new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Ie.LocalVideoTrack}),d=!0),t)){const v=this.getLowVideoTrack(g,r);a.push({track:v,type:Ie.LocalVideoLowTrack})}if(g instanceof Gr){const v=this.localTrackMap.get(Ie.LocalAudioTrack);if(v){if(!(v.track instanceof mn))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(p){const y=a.find(b=>{let{type:R}=b;return R===Ie.LocalAudioTrack});if(!(y.track instanceof mn))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof mn||g._bypassWebAudio)a.push({track:g,type:Ie.LocalAudioTrack});else{const y=new mn;y.addAudioTrack(g),a.push({track:y,type:Ie.LocalAudioTrack})}p=!0}}}return a}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=Pm(e=e.filter(a=>r.indexOf(a)!==-1));for(const a of e){if(a instanceof Gr){const c=this.localTrackMap.get(Ie.LocalAudioTrack);if(!c)continue;c.track instanceof mn?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([Ie.LocalAudioTrack,c]),c.track.close())):t.push([Ie.LocalAudioTrack,c])}if(a instanceof Tr){const c=this.localTrackMap.get(Ie.LocalVideoTrack);if(!c)continue;t.push([Ie.LocalVideoTrack,c]);const l=this.localTrackMap.get(Ie.LocalVideoLowTrack);l&&t.push([Ie.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.addListener(Je.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof mn?e.trackList.forEach(r=>{r.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Je.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:a}]=t;return{track:a,type:r}})),e.forEach(t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.off(Je.GET_STATS,this.handleGetLocalVideoStats),r.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(Je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof mn?e.trackList.forEach(t=>{t.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Je.GET_STATS,this.handleGetLocalAudioStats),t.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Je.GET_STATS,this.handleGetLocalAudioStats),e.off(Je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Hm&&t.addListener(Je.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof qm&&t.addListener(Je.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has($e.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has($e.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,a)=>{var c;let l,{track:d,type:p}=r;switch(p){case Ie.LocalAudioTrack:l=nr.Audio;break;case Ie.LocalVideoTrack:l=Ve(c=d._hints).call(c,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalVideoLowTrack:l=nr.Low}return{kind:p===Ie.LocalAudioTrack?$e.AUDIO:$e.VIDEO,stream_type:l,mid:t[a].id,ssrcs:t[a].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let a,[c,{track:l,ssrcs:d,id:p}]=t;switch(c){case Ie.LocalVideoTrack:a=Ve(r=l._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoLowTrack:a=nr.Low}return{stream_type:a,ssrcs:d,mid:p}})}assignLocalTracks(e,t){e.forEach((r,a)=>{let{track:c,type:l}=r;this.localTrackMap.set(l,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(at.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ve(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Kn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Br.TRACER}).onSuccess(),this.emit(at.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const a=Array.from(Ya(r=this.remoteUserMap).call(r)).find(l=>l._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Vm.FIRST_FRAME_DECODED),Ze.firstRemoteFrame(this.store.sessionId,In.FIRST_AUDIO_DECODE,Ir.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const a=Array.from(Ya(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,In.FIRST_AUDIO_RECEIVED,Ir.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,a)=>{this.reportVideoFirstFrameDecoded(t,r,a)},e.onFirstVideoReceived=t=>{var r;const a=Array.from(Ya(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,In.FIRST_VIDEO_RECEIVED,Ir.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const a=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&a===c||this.emit(at.ConnectionTypeChange,a),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(r))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(r))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(at.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Fi.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,N.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Fi.SEND_ONLY?this.restartICE(e):ei(this,at.RequestP2PRestartICE,{direction:Fi.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Gr&&(r==null?void 0:r.track)instanceof mn)return r.track.isActive||t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(a&&(t.push(a),a[0]===Ie.LocalVideoTrack)){const c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Gr&&(r==null?void 0:r.track)instanceof mn)return r.track.isActive&&t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(a)if(a[0]===Ie.LocalVideoTrack){t.push(a);const c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var r;let a,[c,{track:l,ssrcs:d,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoTrack:a=Ve(r=l._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalVideoLowTrack:a=nr.Low}return{stream_type:a,ssrcs:d,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var r;let a,[c,{track:l,ssrcs:d,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=nr.Audio;break;case Ie.LocalVideoTrack:a=Ve(r=l._hints).call(r,dr.SCREEN_TRACK)?nr.Screen:nr.High;break;case Ie.LocalVideoLowTrack:a=nr.Low}return{stream_type:a,ssrcs:d,mid:p}})}filterTobeUnSubscribedTracks(e,t){const r=[],a=this.remoteUserMap.get(e);if(!a)return r;if(t){const c=a.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[l,d]=c;r.push([e,{kind:l,id:d}])});return r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[a,{kind:c,id:l}]=r;switch(c){case $e.VIDEO:return void(a._videoSSRC&&t.push({stream_type:$e.VIDEO,ssrcId:a._videoSSRC}));case $e.AUDIO:return void(a._audioSSRC&&t.push({stream_type:$e.AUDIO,ssrcId:a._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:a}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ge((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ge((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Gr){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const a=this.createUnmuteMessage(r);return void await pr(this,at.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(at.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(at.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Kn(cN(this.dtlsFailedCount,un)),this.emit(at.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ie.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Tr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Tr).length>1)throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Gr).length>1&&(e.some(t=>t instanceof Gr&&t._bypassWebAudio)||!qt().webAudioMediaStreamDest))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Tr&&this.pendingLocalTracks.some(r=>r instanceof Tr))throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Gr&&this.pendingLocalTracks.some(r=>r instanceof Gr)&&(!qt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Gr&&r._bypassWebAudio)))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&qt().supportDualStreamEncoding,a=Kw(Kw({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=r?e._mediaStreamTrack.clone():vP(e,a);const l=gr(8,"track-low-"),d=new Tr(c,Kw(Kw({},r&&{scaleResolutionDownBy:eP(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,l);return d.on(sp.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,Um.LOW_STREAM)}),d._hints.push(dr.LOW_STREAM),e.addListener(Je.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,a){var c;const l=Array.from(Ya(c=this.remoteUserMap).call(c)).find(d=>d._videoSSRC===e);if(l){a||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,p=d.subscribe.find(g=>g.userId===l.uid&&g.type==="video");Ze.firstRemoteVideoDecode(this.store.sessionId,In.FIRST_VIDEO_DECODE,Ir.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:r,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(e);if(!a)return!1;const c=a.get(t);if(!c)return!1;const l=await this.recvConnection.getRemoteSSRC(c);return l!==void 0&&l!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _e(K.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _e(K.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}async preConnect(e){throw new _e(K.NOT_SUPPORTED)}getEstablishParams(){throw new _e(K.NOT_SUPPORTED)}async reSubscribe(e){throw new _e(K.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new _e(K.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Ie.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Um.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Qe(Pr.prototype,"p2pConnect",[D8],Object.getOwnPropertyDescriptor(Pr.prototype,"p2pConnect"),Pr.prototype),Qe(Pr.prototype,"unpublish",[x8],Object.getOwnPropertyDescriptor(Pr.prototype,"unpublish"),Pr.prototype),Qe(Pr.prototype,"unpublishLowStream",[k8],Object.getOwnPropertyDescriptor(Pr.prototype,"unpublishLowStream"),Pr.prototype),Qe(Pr.prototype,"subscribe",[L8],Object.getOwnPropertyDescriptor(Pr.prototype,"subscribe"),Pr.prototype),Qe(Pr.prototype,"mockSubscribe",[M8],Object.getOwnPropertyDescriptor(Pr.prototype,"mockSubscribe"),Pr.prototype),Qe(Pr.prototype,"unsubscribe",[U8],Object.getOwnPropertyDescriptor(Pr.prototype,"unsubscribe"),Pr.prototype),Qe(Pr.prototype,"muteRemote",[j8],Object.getOwnPropertyDescriptor(Pr.prototype,"muteRemote"),Pr.prototype),Qe(Pr.prototype,"unmuteRemote",[V8],Object.getOwnPropertyDescriptor(Pr.prototype,"unmuteRemote"),Pr.prototype),Qe(Pr.prototype,"hasRemoteMediaWithLock",[F8],Object.getOwnPropertyDescriptor(Pr.prototype,"hasRemoteMediaWithLock"),Pr.prototype),Qe(Pr.prototype,"disconnectForReconnect",[B8],Object.getOwnPropertyDescriptor(Pr.prototype,"disconnectForReconnect"),Pr.prototype),Qe(Pr.prototype,"remoteMediaSsrcChanged",[W8],Object.getOwnPropertyDescriptor(Pr.prototype,"remoteMediaSsrcChanged"),Pr.prototype),Pr);function Qs(e){return function(t,r,a){const c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var l=arguments.length,d=new Array(l),p=0;p<l;p++)d[p]=arguments[p];switch(e){case Js.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,d)}finally{g()}}case Js.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,d)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(r)),v=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,d)}finally{g(),v()}}}},a}}class Rp extends kr{constructor(t,r){super(),G(this,"signal",void 0),G(this,"token",void 0),G(this,"tokenTimeout",void 0),G(this,"tokenInterval",void 0),G(this,"_sequence",0),G(this,"userMap",new Map),G(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const a=()=>{this.signal.connectionState===yr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*$("P2P_TOKEN_INTERVAL"))};a()}async send(t,r,a,c,l){var d;if(this.userMap.size===0)return;const p=Array.from(Aa(d=this.userMap).call(d))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??gr(6,""),l=l??this._sequence++;const g={_id:c,_type:t,_seq:l,_message:r,token:"".concat(this.token,"_").concat(p)};$("SHOW_P2P_LOG")&&N.debug("send message",g,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(g)).forEach(y=>{this.signal.request(ht.DATA_STREAM,{payload:_d(this.encoder.encode(y))})});const v=new Ge((y,b)=>{const R=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),O),this.off("res-@".concat(c),k),this.off(Xm.ABORT,V),N.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?b(new _e(K.INVALID_REMOTE_USER)):b(new _e(K.TIMEOUT))},$("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),O=()=>{R&&window.clearTimeout(R),this.off(Xm.ABORT,V),a&&y()},V=()=>{R&&window.clearTimeout(R),this.off("res-@".concat(c,"_ack"),O),this.off("res-@".concat(c),k),b(new _e(K.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(Xm.ABORT,V),this.once("res-@".concat(c,"_ack"),O);const k=(H,q)=>{L=!0,R&&window.clearTimeout(R),this.off("res-@".concat(c,"_ack"),O),this.off(Xm.ABORT,V),H==="success"?y(q):b(new _e(K.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))};let L=!1;a||(this.once("res-@".concat(c),k),Kn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{L||N.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(g))}))});try{return await v}catch(y){if(y.code===K.TIMEOUT)return await this.send(t,r,a,c,l);throw y}}onMessage(t){var r;const{_uid:a}=t;let c,l=this.userMap.get(a);if(l)c=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Xr.CHECK)return;const{token:v}=t;c=new Map,l={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,l),this.signal.emit(kt.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in t&&"total"in t){var d;const{id:v,total:y}=t,b=(d=c.get(v))!==null&&d!==void 0?d:[];if(b.push(t),c.has(v)||c.set(v,b),b.length!==y)return;{const R=$h(b).call(b,(O,V)=>O.index-V.index).map(O=>O.payload).join("");c.delete(v),(t=JSON.parse(R))._uid=a}}const{_type:p,token:g}=t;if(Ve(r=[Xr.ACK,Xr.CHECK]).call(r,p))return p===Xr.CHECK&&this.handleCheckToken(l,g),void this.receiveMessage(t);g==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):N.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:gr(6,""),token:this.token,_type:Xr.CHECK};$("SHOW_P2P_LOG")&&N.debug("send message",t),this.signal.request(ht.DATA_STREAM,{payload:_d(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:Xr.ACK,token:this.token};$("SHOW_P2P_LOG")&&N.debug("send message",r),this.signal.request(ht.DATA_STREAM,{payload:_d(this.encoder.encode(JSON.stringify(r)))})}response(t,r,a){this.send(Xr.RESPONSE,JSON.stringify({success:!a,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:y,nextExpectedSequenceNumber:b}=v;for(;y.has(b);){const R=y.get(b);y.delete(b),this.receiveMessage(R),v.nextExpectedSequenceNumber++}})};if(!t)return void r();const{_uid:a,_seq:c}=t,l=this.userMap.get(a),{receivedMessagesMap:d,isStart:p,nextExpectedSequenceNumber:g}=l;if(c<g)return this.ack(t._id),void N.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));d.set(c,t),p&&c===g&&(this.receiveMessage(t),d.delete(g),l.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:a,_message:c,_uid:l}=t;if($("SHOW_P2P_LOG")&&N.debug("receive message",t),r){let d;switch(t._type!==Xr.ACK&&(c&&(d=JSON.parse(c)),this.ack(t._id)),t._type){case Xr.CANDIDATE:case Xr.CONTROL:this.signal.emit(a,d,l);break;case Xr.PUBLISH:case Xr.UNPUBLISH:case Xr.RESTART_ICE:case Xr.CALL:d.uid=l,ei(this.signal,a,d).then(p=>{this.response(t._id,p)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Xr.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case Xr.RESPONSE:{const{success:p,message:g}=d;this.emit("res-@".concat(r),p?"success":"failed",g);break}}}}splitMessage(t){if(t.length<Rp.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:a}=JSON.parse(t),c=gr(6,"");let l=0,d=800;const p=Math.ceil(t.length/d);for(;t.length>0;){l++;const g={id:c,index:l,total:p,payload:t.slice(0,d),token:"".concat(this.token,"_").concat(a)};JSON.stringify(g).length>Rp.MAX_MESSAGE_SIZE?d-=50:(r.push(g),t=t.slice(d))}return r.map(g=>JSON.stringify(g))}handleCheckToken(t,r){return t.token!==r?(N.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{N.debug("token timeout, ".concat(r)),this.reset(t.uid)},$("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ei(this.signal,Xr.CALL,void 0),r=await this.send(Xr.CALL,t);this.signal.emit(ft.P2P_CONNECTION,r,!0)}async reset(t,r){const a=this.userMap.get(t);a&&(this.emit(Xm.ABORT),this.signal.emit(kt.ON_USER_OFFLINE,{uid:a.uid,reason:oce.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(N.debug("change local token from ".concat(r," to ").concat(r)),this.token=gr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Xm.ABORT)}}G(Rp,"MAX_SIZE",1),G(Rp,"MAX_MESSAGE_SIZE",1024);class Wue extends kr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===yr.CONNECTED?this.emit(ft.WS_CONNECTED):t===yr.RECONNECTING?this.emit(ft.WS_RECONNECTING,this._websocketReconnectReason):t===yr.CLOSED&&this.emit(ft.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),G(this,"_disconnectedReason",void 0),G(this,"_websocketReconnectReason",void 0),G(this,"_connectionState",yr.CLOSED),G(this,"reconnectToken",void 0),G(this,"p2pToken",void 0),G(this,"websocket",void 0),G(this,"openConnectionTime",void 0),G(this,"clientId",void 0),G(this,"lastMsgTime",Date.now()),G(this,"uploadCache",[]),G(this,"uploadCacheInterval",void 0),G(this,"rttRolling",new E3(5)),G(this,"pingpongTimer",void 0),G(this,"pingpongTimeoutCount",0),G(this,"joinResponse",void 0),G(this,"multiIpOption",void 0),G(this,"initError",void 0),G(this,"spec",void 0),G(this,"store",void 0),G(this,"_external_signal",void 0),G(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ft.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const l="res-@".concat(c._id);this.emit(l,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case kt.ON_DATA_STREAM:return void this.handleDataStream(c._message);case kt.MUTE_AUDIO:case kt.MUTE_VIDEO:case kt.ON_P2P_LOST:case kt.ON_USER_ONLINE:return;case kt.ON_USER_OFFLINE:const{uid:l}=c._message;return N.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(c._type,c._message),c._type===kt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===kt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(tr.UID_BANNED);break;case 15:this.close(tr.IP_BANNED);break;case 16:this.close(tr.CHANNEL_BANNED)}if(c._type===kt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case ct.ERR_LICENSE_MISSING:this.close(tr.LICENSE_MISSING);break;case ct.ERR_LICENSE_EXPIRED:this.close(tr.LICENSE_EXPIRED);break;case ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tr.LICENSE_MINUTES_EXCEEDED);break;case ct.ERR_LICENSE_PERIOD_INVALID:this.close(tr.LICENSE_PERIOD_INVALID);break;case ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tr.LICENSE_MULTIPLE_SDK_SERVICE);break;case ct.ERR_LICENSE_ILLEGAL:this.close(tr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new QN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yr.CONNECTED&&this.reconnect("retry",Zn.OFFLINE)}),this.p2pToken=gr(6,""),this._external_signal=new Rp(this,this.p2pToken)}async request(t,r,a,c){const l=gr(6,""),d={_id:l,_type:t,_message:r},p=this.websocket.connectionID,g=()=>new Ge((V,k)=>{if(this.connectionState===yr.CONNECTED)return V();const L=()=>{this.off(ft.WS_CLOSED,H),V()},H=()=>{this.off(ft.WS_CONNECTED,L),k(new _e(K.WS_ABORT))};this.once(ft.WS_CONNECTED,L),this.once(ft.WS_CLOSED,H)});if(this.connectionState!==yr.CONNECTING&&this.connectionState!==yr.RECONNECTING||t===ht.JOIN||t===ht.REJOIN||await g(),this.websocket.sendMessage(d,!0),c)return;const v=new Ge((V,k)=>{let L=!1;const H=(te,oe)=>{L=!0,V({isSuccess:te==="success",message:oe||{}}),this.off(ft.WS_CLOSED,q),this.off(ft.WS_RECONNECTING,q),this.emit(ft.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(l),H);const q=()=>{k(new _e(K.WS_ABORT,"type: ".concat(t))),this.off(ft.WS_CLOSED,q),this.off(ft.WS_RECONNECTING,q),this.off("res-@".concat(l),H)};this.once(ft.WS_CLOSED,q),this.once(ft.WS_RECONNECTING,q),Kn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||L||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ft.REQUEST_TIMEOUT,t,r))})});let y=null;try{y=await v}catch(V){if(this.connectionState===yr.CLOSED||t===ht.LEAVE)throw new _e(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?V.throw():t===ht.JOIN||t===ht.REJOIN?null:(await g(),await this.request(t,r))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),R=$y(b),O=new _e(K.UNEXPECTED_RESPONSE,"".concat(R.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:R.desc});return R.action==="success"?y.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(R.desc,", action: ").concat(R.action)),b===ct.ERR_TOO_MANY_BROADCASTERS?((t===ht.JOIN||t===ht.REJOIN)&&(this.initError=O,this.close()),O.throw()):R.action==="failed"?O.throw():R.action==="quit"?(this.initError=O,this.close(),O.throw()):(b===ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Zn.MULTI_IP)):this.reconnect(R.action,Zn.SERVER_ERROR),t===ht.JOIN||t===ht.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Ge(a=>{const c=l=>{(!r||r(l))&&(this.off(t,c),a(l))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ky.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const l=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yr.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const a={_type:t,_message:r};this.websocket.sendMessage(a)}async sendExtensionMessage(t,r,a){return await this._external_signal.send(t,r,a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ge((r,a)=>{this.once(ft.WS_CONNECTED,()=>r(this.joinResponse)),this.once(ft.WS_CLOSED,()=>a(this.initError||new _e(K.WS_ABORT))),this.connectionState=yr.CONNECTING,this.websocket.init(t).catch(a)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||tr.LEAVE,this.connectionState=yr.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=gr(6,""),this._external_signal.clear(),this._external_signal=new Rp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ft.ABORT_P2P_EXECUTION);const t=await ei(this,ft.REQUEST_JOIN_INFO),r=await this.request(ht.JOIN,t);if(!r)return this.emit(ft.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(ft.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleDataStream(t){try{var r;const a=ip(t.payload),c=new TextDecoder().decode(a),l=JSON.parse(c);"total"in l&&"id"in l||Ve(r=Object.values(Xr)).call(r,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(kt.ON_DATA_STREAM,t)}catch{this.emit(kt.ON_DATA_STREAM,t)}}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const r=$y(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tr.UID_BANNED),void this.close()):void this.reconnect(r.action,Zn.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=$("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Zn.TIMEOUT):this.request(ht.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),$("REPORT_STATS")&&this.send(ht.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(St.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ft.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(St.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(St.CLOSED,()=>{this.connectionState=yr.CLOSED}),this.websocket.on(St.FAILED,()=>{this._disconnectedReason=tr.NETWORK_ERROR,this.connectionState=yr.CLOSED}),this.websocket.on(St.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===yr.CONNECTED?this.connectionState=yr.RECONNECTING:this.connectionState=yr.CONNECTING}),this.websocket.on(St.WILL_RECONNECT,(t,r,a)=>{t!=="retry"?(N.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):N.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(t)}),this.websocket.on(St.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ft.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof _e&&t.code===K.UNEXPECTED_RESPONSE&&t.data.code===ct.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Zn.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Zn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(St.REQUEST_NEW_URLS,(t,r)=>{ei(this,ft.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Gue={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new Bue(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new Wue(r,t)}};function H8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function q8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H8(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H8(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}class Hue{constructor(t){G(this,"sessionDesc",void 0),G(this,"localCapabilities",void 0),G(this,"rtpCapabilities",void 0),G(this,"candidates",void 0),G(this,"_originCandidates",void 0),G(this,"iceParameters",void 0),G(this,"dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname",void 0),t=Lr(t);const{iceParameters:r,dtlsParameters:a,candidates:c,rtpCapabilities:l,setup:d,localCapabilities:p,sdkCodec:g,cname:v}=t,y=pa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=c,this._originCandidates=Lr(c),this.iceParameters=r,this.dtlsParameters=a,this.setup=d,this.localCapabilities=p,this.cname=v;for(let b=0;b<y.mediaDescriptions.length;b++){const R=y.mediaDescriptions[b];if(R.attributes.iceUfrag=r.iceUfrag,R.attributes.icePwd=r.icePwd,R.attributes.fingerprints=a.fingerprints,R.attributes.candidates=c,R.attributes.setup=d,R.media.mediaType==="video"){R.media.fmts=l.videoCodecs.map(V=>V.payloadType.toString(10));let O=l.videoCodecs.filter(V=>{var k,L;return(k=V.rtpMap)===null||k===void 0?void 0:Ve(L=k.encodingName.toLowerCase()).call(L,g)});O.length===0&&(O=l.videoCodecs),R.attributes.payloads=O,R.attributes.extmaps=l.videoExtensions}R.media.mediaType==="audio"&&(R.media.fmts=l.audioCodecs.map(O=>O.payloadType.toString(10)),R.attributes.payloads=l.audioCodecs,R.attributes.extmaps=l.audioExtensions),y.mediaDescriptions[b]=this.mungMediaDesc(R)}this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return vd(this.sessionDesc)}send(t,r,a){const{ssrcs:c,ssrcGroups:l}=fp(r,this.cname),d=this.sessionDesc.mediaDescriptions.find(v=>t===$e.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),p=c[0].attributes.label,g=c[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(c),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(l),{id:p,mslabel:g}}batchSend(t){return t.map(r=>{let{kind:a,ssrcMsg:c}=r;return this.send(a,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{const a=[],c=[],l=[];r.attributes.ssrcs.forEach(d=>{Ve(t).call(t,d.attributes.label||"")?l.push(d):a.push(d)}),r.attributes.ssrcGroups.forEach(d=>{var p;Ve(p=l.map(g=>g.ssrcId)).call(p,d.ssrcIds[0])||c.push(d)}),r.attributes.ssrcs=a,r.attributes.ssrcGroups=c})}mute(t){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,a){t.forEach((c,l)=>{const d=c._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===d.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],c);this.sessionDesc.mediaDescriptions[p]=g})}stopReceiving(t){}updateCandidates(t){const r=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(r.forEach(c=>{a.push(q8(q8({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),r.length!==0){switch(t){case ui.TCP_RELAY:this.candidates=a;break;case ui.UDP_TCP_RELAY:case ui.RELAY:this.candidates=[...r,...a];break;default:this.candidates=r}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=Lr(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let a=0;a<t;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}mungRecvMediaDsec(t,r){const a=Lr(t);return Zm(a,r),rP(a,r),a}updateRecvMedia(t,r){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,a){const c=this.sessionDesc.mediaDescriptions.find(d=>t===$e.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(c){const d=c.attributes.ssrcs.find(p=>p.attributes.label===r);var l;d&&(d.attributes.label=a,(l=d.attributes.msid)===null||l===void 0||l.replace(r,a))}}mungMediaDesc(t){const r=Lr(t);return tP(r),function(a){const c=a.attributes.extmaps.find(l=>lw(l.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(l=>{const d=l.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");d!==-1&&l.rtcpFeedbacks.splice(d,1)})}(r),r}getSSRC(t){for(const r of this.sessionDesc.mediaDescriptions)for(const a of r.attributes.ssrcs)if(a.attributes.label===t)return[a]}}var fr;function K8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,a)}return r}function zw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?K8(Object(r),!0).forEach(function(a){G(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K8(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}let que=(fr=class UE extends i6{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ve(r=Object.keys(VT)).call(r,t)}))]}constructor(t,r){super(t,r),G(this,"store",void 0),G(this,"peerConnection",void 0),G(this,"remoteSDP",void 0),G(this,"initialOffer",void 0),G(this,"statsFilter",void 0),G(this,"useRTX",!1),G(this,"localCapabilities",void 0),G(this,"localCandidateCount",0),G(this,"allCandidatesReceived",!1),G(this,"establishPromise",void 0),G(this,"mutex",void 0),this.store=r,this.mutex=new ci("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(UE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=fN(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Vr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Td(t.sdp),a=Jy(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=t,zw(zw({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:t.sdp})}catch(t){throw new _e(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Hue(zw(zw({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new _e(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var a=this;return So(function*(){const c=yield Gt(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(R=>a.peerConnection.addTrack(R._mediaStreamTrack)),d=yield Gt(a.peerConnection.createOffer()),p=pa(d.sdp),g=t.map(R=>{const O=R._mediaStreamTrack,V=p.mediaDescriptions.find(k=>k.attributes.mid===O.kind);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,L,H){const q=k.attributes.ssrcs.filter(oe=>oe.attributes.label===L),te=k.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(te&&q.length>1){const oe=te.find(se=>se.ssrcIds.indexOf(q[0].ssrcId)!==-1);return oe?[{ssrcId:oe.ssrcIds[0],rtx:H?oe.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]}(V,O.id,a.useRTX)});let v;try{v=yield g}catch(R){throw l.forEach(O=>{Qn()&&O.replaceTrack(null),a.peerConnection.removeTrack(O)}),R}const y=a.mungSendOfferSDP(d.sdp,t);a.remoteSDP.receive(t,r,v);const b=a.remoteSDP.toString();return yield Gt(a.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Gt(a.applySendEncodings(l,t)),yield Gt(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),t.map((R,O)=>{const V=R._mediaStreamTrack.id;return{localSSRC:g[O],id:V}})}catch(l){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter(l=>{var d;return t.indexOf(((d=l.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(l=>{Qn()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:d}=this.remoteSDP.send(t,r,c),p=new Ge((y,b)=>{const R=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(l)))},1e4),O=V=>{const k=Ht();if((k.name==="Safari"&&Number(k.version)===11||Ui())&&V.track.id!==l&&V.streams[0].id===d){var L;const H=V.streams[0].getTracks()[0];return(L=this.remoteSDP)===null||L===void 0||L.updateTrackLabel(t,l,V.track.id),this.peerConnection.removeEventListener("track",O),clearTimeout(R),void y(H)}if(V.track.id===l)return this.peerConnection.removeEventListener("track",O),clearTimeout(R),void y(V.track)};this.peerConnection.addEventListener("track",O)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await p,id:l}}catch(l){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(a=>{if(Qn()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!1),a.setParameters(c)}})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(l=>{var d;return t.indexOf(((d=l.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async l=>{if(Qn()&&l.track)l.track.enabled=!0;else{const d=l.getParameters();d.encodings.forEach(p=>p.active=!0),await l.setParameters(d)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return So(function*(){const a=yield Gt(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=qt().supportPCSetConfiguration;if(t===ui.RELAY&&!c)return;if(c){const v=r.peerConnection.getConfiguration(),y=t===ui.RELAY?"relay":"all";v.iceTransportPolicy!==y&&(N.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(y,"]")),v.iceTransportPolicy=y,r.peerConnection.setConfiguration(v))}t!==ui.RELAY&&r.remoteSDP.updateCandidates(t);const l=yield Gt(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Td(l.sdp),{remoteIceParameters:p}=yield d.iceParameters;r.remoteSDP.restartICE(p);const g=r.remoteSDP.toString();yield Gt(r.peerConnection.setLocalDescription(l)),yield Gt(r.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){N.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new _e(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getSenders().filter(c=>{var l;return((l=c.track)===null||l===void 0?void 0:l.id)===t});a.length===1&&await this.applySendEncodings(a,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getSenders().find(c=>{var l;return((l=c.track)===null||l===void 0?void 0:l.id)===r});a&&await a.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new _e(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new _e(K.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Uy(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...UE.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...UE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var a;if(r||(r=this.peerConnection.getSenders().find(v=>{var y;return((y=v.track)===null||y===void 0?void 0:y.id)===t._mediaStreamTrack.id})),!r)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!qt().supportSetRtpSenderParameters)return N.warn("Browser not support set rtp-sender parameters");const c={},l={};if(t instanceof Tr)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if($("DSCP_TYPE")&&Bl()){var d;const v=$("DSCP_TYPE");Ve(d=["very-low","low","medium","high"]).call(d,v)&&(l.networkPriority=v)}const p=r.getParameters(),g=(a=p.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,l),Object.assign(p,c),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await r.setParameters(p)}async applySendEncodings(t,r){try{if(!qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const c=t[a],l=r[a];c&&l&&await this.updateRtpSenderEncodings(l,c)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const a=pa(t);return r.forEach((c,l)=>{const d=c._mediaStreamTrack,p=a.mediaDescriptions.find(g=>g.attributes.mid===d.kind);p&&Zm(p,c)}),vd(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map((l,d)=>{let{id:p,mslabel:g}=l;const{kind:v}=t[d];return new Ge((y,b)=>{const R=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(p)))},1e4),O=V=>{const k=Ht();if(k.name==="Safari"&&Number(k.version)===11&&V.track.id!==p&&V.streams[0].id===g){var L;const H=V.streams[0].getTracks()[0];return(L=this.remoteSDP)===null||L===void 0||L.updateTrackLabel(v,p,V.track.id),this.peerConnection.removeEventListener("track",O),clearTimeout(R),void y({track:H,id:p})}if(V.track.id===p)return this.peerConnection.removeEventListener("track",O),clearTimeout(R),void y({track:V.track,id:p})};this.peerConnection.addEventListener("track",O)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Ge.all(r)}catch(r){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(qt().supportPCSetConfiguration){const r=UE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Qe(fr.prototype,"connect",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"connect"),fr.prototype),Qe(fr.prototype,"stopSending",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"stopSending"),fr.prototype),Qe(fr.prototype,"receive",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"receive"),fr.prototype),Qe(fr.prototype,"stopReceiving",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"stopReceiving"),fr.prototype),Qe(fr.prototype,"muteRemote",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"muteRemote"),fr.prototype),Qe(fr.prototype,"unmuteRemote",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteRemote"),fr.prototype),Qe(fr.prototype,"muteLocal",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"muteLocal"),fr.prototype),Qe(fr.prototype,"unmuteLocal",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteLocal"),fr.prototype),Qe(fr.prototype,"close",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"close"),fr.prototype),Qe(fr.prototype,"updateEncoderConfig",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"updateEncoderConfig"),fr.prototype),Qe(fr.prototype,"updateSendParameters",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"updateSendParameters"),fr.prototype),Qe(fr.prototype,"replaceTrack",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"replaceTrack"),fr.prototype),Qe(fr.prototype,"getRemoteSSRC",[Oo],Object.getOwnPropertyDescriptor(fr.prototype,"getRemoteSSRC"),fr.prototype),fr);function Oo(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,l=await c.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,p=new Array(d),g=0;g<d;g++)p[g]=arguments[g];return await a.apply(this,p)}finally{l()}},r}const Kue={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new que(r,t)}},zue={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qt().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(zT.has(e)||!e.track)return;const r={track:e.track};if(Fl()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(d){return void N.error("create audio-encoded-streams error",d&&d.message)}const l=new TransformStream({transform(d,p){r.controller||(r.controller=p),e.track&&e.track.id!==r.track.id&&(N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const g=t.metadata&&t.metadata();g?function(v,y){const{chunk:b,controller:R}=y,O=$("ENABLE_AUDIO_PTS_METADATA")?Hl.AUDIO_64_BIT_PTS:Hl.METADATA;b.data=function(V,k,L){const H=L.byteLength,q=H+jN+G4,te=MN+UN+q,oe=new ArrayBuffer(V.byteLength+te),se=new DataView(oe);se.setUint8(0,W4),se.setUint16(1,q),se.setUint8(3,k),se.setUint16(4,H);for(let pe=0;pe<H;pe++)se.setUint8(6+pe,L[pe]);const ae=new Uint8Array(se.buffer);return ae.set(new Uint8Array(V),te),ae.buffer}(b.data,O,v),R.enqueue(b)}(g,{chunk:d,controller:p}):p.enqueue(d)}});c.readable.pipeThrough(l).pipeTo(c.writable)}else if(Qn()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=KT(),l=new MessageChannel;await new Ge(p=>c.onmessage=g=>{g.data==="registered"&&p(void 0)});const d=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=d,await new Ge(p=>c.onmessage=g=>{g.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var g;if(p.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id)N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a);else if(p.data.getMetadata){const v=t.metadata&&t.metadata();v&&l.port1.postMessage({metadata:v})}},r.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}const c=zT.get(e);if(c){zT.delete(e);try{var l,d;(l=c.controller)===null||l===void 0||l.terminate(),(d=c.worker)===null||d===void 0||d.terminate()}catch(p){N.warning(p&&p.message)}}}zT.set(e,r),e.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qt().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(ZT.has(e))return;const r={track:e.track,onMetadata:t.onMetadata};if(Fl()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");YI(Xt.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(d){return void N.error("create audio-encoded-streams error",d&&d.message)}const l=new TransformStream({transform(d,p){r.controller||(r.controller=p),e.track&&e.track.id!==r.track.id&&(N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)),t.enableTopn?function(g,v,y){var b;const R=H4(new DataView(v.data));if(!R)return y.enqueue(v);const O=g.track.id;Cse.set(O,g.track);const V=(b=R.tlv.find(oe=>oe.tag===Hl.AUDIO_LEVEL))===null||b===void 0?void 0:b.value;let k=0;typeof V=="number"&&(k=127-V);const L=Math.round(Math.pow(10,k/60)-1),{selected:H,speaker:q}=function(oe,se){let ae=Km.get(oe);if(ae||(ae=function(pe){const Te=new K4;return Km.set(pe,Te),Ks||(Ks=new wse($("TOPN_SILENCE_THRESHOLD")||500),Ks.on("ActiveSpeakerChanged",Fe=>{Fe!=null&&(XT=Fe)})),Ks.addSpeakers([Te]),Te}(oe)),Km.size<=z4)return{selected:!0,speaker:ae};if(!Ks)throw new Error("no active speaker detector");return Ks.levelChanged(ae.id,se),dp=Ks.loudest.map(pe=>pe.id),XT&&!Ve(dp).call(dp,XT)&&dp.length>=z4&&dp.pop(),{selected:Ve(dp).call(dp,ae.id)||ae.id===XT,speaker:ae}}(g,L),te=function(oe,se,ae){const pe=zs.get(oe)||new Rse(oe,se);return pe.score=ae,zs.set(oe,pe),function(Te){if(JT.set(Te,!0),!QT)return void(QT=Date.now());const Fe=Date.now();Fe-QT>1e3&&(JT.get(Te)?JT.set(Te,!1):($4(Te),JT.delete(Te)),QT=Fe)}(oe),pe}(O,g.track,q.energyScore);te.addSample(H),te.active&&(v.data=R.frame.buffer,y.enqueue(v))}(e,d,p):t.enableMetadata?function(g,v,y){const b=H4(new DataView(g.data));if(!b)return v.enqueue(g);const R=b.tlv.find(O=>O.tag===Hl.METADATA||O.tag===Hl.AUDIO_64_BIT_PTS);R&&y&&R.value instanceof Uint8Array&&y(R.value),g.data=b.frame.buffer,v.enqueue(g)}(d,p,t.onMetadata):p.enqueue(d)}});c.readable.pipeThrough(l).pipeTo(c.writable)}else if(Qn()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=KT(),l=new MessageChannel;await new Ge(p=>c.onmessage=g=>{g.data==="registered"&&p(void 0)});const d=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=d,await new Ge(p=>c.onmessage=g=>{g.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var g;p.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)):p.data.metadata&&r.onMetadata&&r.onMetadata(p.data.metadata)},r.worker=c}function a(){e.track.removeEventListener("ended",a),function(c){const l=ZT.get(c);if(l){(function(g){const v=Km.get(g);v&&(Km.delete(g),Ks&&(Ks.removeSpeakers([v]),Km.size===0&&(Ks.destroy(),Ks=null)))})(c),$4(c.track.id),ZT.delete(c);try{var d,p;(d=l.controller)===null||d===void 0||d.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(g){N.warning(g&&g.message)}}}(e)}ZT.set(e,r),e.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(e,t){if(!qt().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(ew.has(e)||!e.track)return;const r={track:e.track};if(Fl()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(p){return void N.error("create video-encoded-streams error",p&&p.message)}const l=[];t.on("sei-to-send",p=>{l.push(p)});const d=new TransformStream({transform(p,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const v=l.shift();v&&(p.data=function(y,b){const R=function(q){const te=q.length;let oe=[],se=0;for(;se<te;)se+2<te&&q[se]===0&&q[se+1]===0&&(q[se+2]===0||q[se+2]===1||q[se+2]===2||q[se+2]===3)?(oe.push(q[se],q[se+1],3,q[se+2]),se+=3):(oe.push(q[se]),se++);return new Uint8Array(oe)}(b),O=R.length,V=Math.floor(O/255),k=O%255,L=new Uint8Array(6+V+1+O+y.byteLength);L[0]=0,L[1]=0,L[2]=0,L[3]=1,L[4]=6,L[5]=101;let H=0;for(;H<V;)L[6+H]=255,H++;return L[6+H]=k,H++,L.set(R,6+H),L.set(new Uint8Array(y),6+H+O),L.buffer}(p.data,v)),g.enqueue(p)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(!Qn())return;{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=KT(),l=new MessageChannel;await new Ge(p=>c.onmessage=g=>{g.data==="registered"&&p(void 0)});const d=new RTCRtpScriptTransform(c,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=d,await new Ge(p=>c.onmessage=g=>{g.data==="started"&&p(void 0)}),t.on("sei-to-send",p=>{l.port1.postMessage({sei:p})}),l.port1.onmessage=p=>{var g;p.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id&&(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a))},r.worker=c}}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}const c=ew.get(e);if(c){ew.delete(e);try{var l,d;(l=c.controller)===null||l===void 0||l.terminate(),(d=c.worker)===null||d===void 0||d.terminate()}catch(p){N.warning(p&&p.message)}}}ew.set(e,r),e.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qt().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(!e.track)return;if(qy.has(e)){const c=qy.get(e);return void(c&&(c.onSei=t.onSei))}const r={track:e.track,onSei:t.onSei};if(Fl()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(d){return void N.error("create video-encoded-streams error",d&&d.message)}const l=new TransformStream({transform(d,p){r.controller||(r.controller=p),e.track&&e.track.id!==r.track.id&&(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const g=function(v){const y=new DataView(v.data);let b=0;for(;b+4<v.data.byteLength;){if(y.getUint8(b+0)===0&&y.getUint8(b+1)===0&&y.getUint8(b+2)===0&&y.getUint8(b+3)===1&&y.getUint8(b+4)===6){let R=b+6,O=0,V=0;for(;(V=y.getUint8(R++))===255;)O+=255;O+=V;const k=Ase(v.data,R,O);return new Uint8Array(k)}b++}return null}(d);g&&r.onSei&&r.onSei(g),p.enqueue(d)}});c.readable.pipeThrough(l).pipeTo(c.writable)}else if(Qn()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=KT(),l=new MessageChannel;await new Ge(p=>c.onmessage=g=>{g.data==="registered"&&p(void 0)});const d=new RTCRtpScriptTransform(c,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=d,await new Ge(p=>c.onmessage=g=>{g.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var g;p.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)):p.data.sei&&r.onSei&&r.onSei(p.data.sei)},r.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}(function(c){const l=qy.get(c);if(l){qy.delete(c);try{var d,p;(d=l.controller)===null||d===void 0||d.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(g){N.warning(g&&g.message)}}})(e)}qy.set(e,r),e.track.addEventListener("ended",a)}},$ue={name:"InterceptFrame",create:()=>zue};mN(),sr("PROCESS_ID","process-".concat(gr(8,""),"-").concat(gr(4,""),"-").concat(gr(4,""),"-").concat(gr(4,""),"-").concat(gr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();N.debug("Loading global parameters from cache",t),Object.keys(t).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Ar,a)){const{value:c,expires:l}=t[a];if(l&&l<=r)return;qs[a]=c,Ar[a]=c}})}catch(t){N.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(qs.AREAS)&&qs.AREAS.length>0&&sP(qs.AREAS,!0);const z8=(e,t,r)=>{N.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),sr(e,t,r)};wd(_ue,!1),wd(Eue,!1),wd(Zce,!1),wd(Pue,!1),wd(fue,!1),wd(Gue,!1),wd(Kue,!1),wd($ue,!1);const dn=function(e){const t=new kr,r=e,a={getListeners:t.getListeners.bind(t),on:(c,l)=>(function(d,p){d===zc.SECURITY_POLICY_VIOLATION&&AG(p,!0)}(c,l),t.on.bind(t)(c,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return CG(CG({},r),a)}({__TRACK_LIST__:Mm,VERSION:bo,BUILD:vN,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:z8,getParameter:$,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await async function(a){let c;return qt().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!r)return e;t.close(),t=null,e=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(r)}catch(t){throw new he(K.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=Ze.reportApiInvoke(null,{name:rn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Br.TRACER});let t=!1;try{const l=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;t=!!(l&&d&&p),t&&ZI()&&YB(75)&&new l().close()}catch(l){return N.error("check system requirement failed: ",l),!1}let r=!1;const a=Ht();a.name===Xt.CHROME&&Number(a.version)>=58&&(Gs.engine.name!=="WebKit"||function(){const l=Ht();if(NT()){if(l.os===On.MAC_OS)return!0;if(l.os===On.IOS){const d=Gs.os.version&&Gs.os.version.split(".");if(d&&Number(d[0])===14&&d[1]&&Number(d[1])>=3||d&&Number(d[0])>14)return!0}}return!1}())&&(r=!0),(a.name===Xt.FIREFOX&&Number(a.version)>=56||a.name===Xt.OPERA&&Number(a.version)>=45||a.name===Xt.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Ui()||es())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||t3()||Ht().name===Xt.QQ)&&(r=!0),N.debug("checkSystemRequirements, api:",t,"browser",r);const c=t&&r;return e.onSuccess(c),c},getDevices:function(e){return eo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return eo.getRecordingDevices(e)},getCameras:function(e){return eo.getCamerasDevices(e)},getElectronScreenSources:Y3,getPlaybackDevices:function(e){return eo.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=gr(5,"client-"),a=Ze.reportApiInvoke(null,{id:r,name:rn.CREATE_CLIENT,options:[t],tag:Br.TRACER});try{(function(c){Sn(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Sn(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Sn(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&qn(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&l3(c.turnServer),c.httpRetryConfig!==void 0&&c3(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&c3(c.websocketRetryConfig)})(t)}catch(c){throw a.onError(c),c}return(JB(16,0)||QB(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",N.debug("browser not support vp9, force use vp8")),sr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),a.onSuccess(),new ele(us(us({forceWaitGatewayResponse:!0},t),{},{role:Ve(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=$("CAMERA_CAPTURE_CONFIG"),r=gr(8,"track-cam-"),a=Ze.reportApiInvoke(null,{id:r,tag:Br.TRACER,name:rn.CREATE_CAM_VIDEO_TRACK,options:[Nr({},e),t]});t&&(e.encoderConfig=t);const c=qT(e);let l=null;N.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{l=(await Za({video:c},r)).getVideoTracks()[0]||null}catch(p){throw a.onError(p),p}if(!l){const p=new _e(K.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(p),p.throw(N)}if(e.optimizationMode&&LN(r,l,e,ns(e.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){const p=ns(e.encoderConfig);e.encoderConfig=p,delete p.bitrateMax,delete p.bitrateMin}const d=new kN(l,e,c,e.scalabiltyMode?BT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return a.onSuccess(d.getTrackId()),N.info("create camera video success, trackId:",r),d},createCustomVideoTrack:function(e){const t=gr(8,"track-cus-"),r=Ze.reportApiInvoke(null,{id:t,tag:Br.TRACER,name:rn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});$("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const a=new Tr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?BT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[dr.CUSTOM_TRACK]);return r.onSuccess(a.getTrackId()),N.info("create custom video track success with config",e,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof t=="object"?function(R){return a5(R)}(t):void 0;r&&(t="auto");const a=gr(8,"track-scr-v-"),c=Ze.reportApiInvoke(null,{id:a,tag:Br.TRACER,name:rn.CREATE_SCREEN_VIDEO_TRACK,options:[Nr({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(R){const O={};R.screenSourceType&&(O.mediaSource=R.screenSourceType),R.extensionId&&Fl()&&(O.extensionId=R.extensionId);const{displaySurface:V,selfBrowserSurface:k,surfaceSwitching:L,systemAudio:H,preferCurrentTab:q}=R;(xy(107)||XI(107)||JI(93))&&(V&&(Sn(V,"displaySurface",["browser","window","monitor"]),O.displaySurface=V),k?(Sn(k,"selfBrowserSurface",["exclude","include"]),O.selfBrowserSurface=k):O.selfBrowserSurface="include",L&&(Sn(L,"surfaceSwitching",["exclude","include"]),O.surfaceSwitching=L)),(xy(105)||XI(105)||JI(91))&&H&&(Sn(H,"systemAudio",["exclude","include"]),O.systemAudio=H),(xy(94)||XI(94)||JI(80))&&q&&(O.preferCurrentTab=!0),R.electronScreenSourceId&&(O.sourceId=R.electronScreenSourceId);const te=R.encoderConfig?TN(R.encoderConfig):null;return O.mandatory={chromeMediaSource:"desktop",maxWidth:te?te.width:void 0,maxHeight:te?te.height:void 0},te&&(te.frameRate&&(typeof te.frameRate=="number"?(O.mandatory.maxFrameRate=te.frameRate,O.mandatory.minFrameRate=te.frameRate):(O.mandatory.maxFrameRate=te.frameRate.max||te.frameRate.ideal||te.frameRate.exact||void 0,O.mandatory.minFrameRate=te.frameRate.min||te.frameRate.ideal||te.frameRate.exact||void 0),O.frameRate=te.frameRate),te.width&&(O.width=te.width),te.height&&(O.height=te.height)),O}(e);let d=null,p=null;const g=qt();if(!g.supportShareAudio&&t==="enable"){const R=new _e(K.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(R),R.throw(N)}N.info("start create screen video track with config",e,"withAudio",t,"trackId",a);const v=g.supportShareAudio&&t!=="disable";try{const R=await Za({screen:l,screenAudio:v?r||!0:void 0},a);d=R.getVideoTracks()[0]||null,p=R.getAudioTracks()[0]||null}catch(R){throw c.onError(R),R}if(!d){const R=new _e(K.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(R),R.throw(N)}if(!p&&t==="enable"){d&&d.stop();const R=new _e(K.SHARE_AUDIO_NOT_ALLOWED);return c.onError(R),R.throw(N)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(LN(a,d,e,e.encoderConfig&&TN(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const y=new Tr(d,e.encoderConfig?TN(e.encoderConfig):{},e.scalabiltyMode?BT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[dr.SCREEN_TRACK]);if(!p)return c.onSuccess(y.getTrackId()),N.info("create screen video track success","video:",y.getTrackId()),y;const b=new Gr(p,void 0,gr(8,"track-scr-a-"),!1);return c.onSuccess([y.getTrackId(),b.getTrackId()]),N.info("create screen video track success","video:",y.getTrackId(),"audio:",b.getTrackId()),[y,b]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=$("CAMERA_CAPTURE_CONFIG"),a=gr(8,"track-mic-"),c=gr(8,"track-cam-"),l=Ze.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:Br.TRACER,name:rn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const d=qT(t),p=o5(e);let g=null,v=null;N.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const R=await Za({audio:p,video:d},"".concat(a,"-").concat(c));g=R.getAudioTracks()[0],v=R.getVideoTracks()[0]}catch(R){throw l.onError(R),R}if(!g||!v){const R=new _e(K.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(R),R.throw(N)}if(t.optimizationMode&&LN(c,v,t,ns(t.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){const R=ns(t.encoderConfig);t.encoderConfig=R,delete R.bitrateMax,delete R.bitrateMin}const y=new Hy(g,e,p,a),b=new kN(v,t,d,t.scalabiltyMode?BT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return l.onSuccess([y.getTrackId(),b.getTrackId()]),N.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[y,b]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=gr(8,"track-mic-"),r=Ze.reportApiInvoke(null,{id:t,tag:Br.TRACER,name:rn.CREATE_MIC_AUDIO_TRACK,options:[e]}),a=o5(e);let c=null;N.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await Za({audio:a},t)).getAudioTracks()[0]||null}catch(d){throw r.onError(d),d}if(!c){const d=new _e(K.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(d),d.throw(N)}const l=new Hy(c,e,a,t);return r.onSuccess(l.getTrackId()),N.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:function(e){const t=gr(8,"track-cus-"),r=Ze.reportApiInvoke(null,{id:t,tag:Br.TRACER,name:rn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),a=new Gr(e.mediaStreamTrack,e.encoderConfig?WT(e.encoderConfig):{},t,!1);return N.info("create custom audio track success with config",e,"trackId",a.getTrackId()),r.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:a}=e;let{source:c}=e;const l={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:a},d=gr(8,"track-buf-"),p=Ze.reportApiInvoke(null,{id:d,tag:Br.TRACER,name:rn.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if($("DISABLE_WEBAUDIO"))throw new _e(K.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");N.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",d);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(b,R){let O=null;if(typeof b=="string"){const k=K5.get(b);if(k)return N.debug("use cached audio resource: ",b),k;try{O=(await Hs(()=>Ji.get(b,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(L){throw new _e(K.FETCH_AUDIO_FILE_FAILED,L.toString())}}else O=await new Ge((L,H)=>{const q=new FileReader;q.onload=te=>{te.target?L(te.target.result):H(new _e(K.READ_LOCAL_AUDIO_FILE_ERROR))},q.onerror=()=>{H(new _e(K.READ_LOCAL_AUDIO_FILE_ERROR))},q.readAsArrayBuffer(b)});const V=await function(k){const L=Wm();return new Ge((H,q)=>{L.decodeAudioData(k,te=>{H(te)},te=>{q(new _e(K.DECODE_AUDIO_FILE_FAILED,te.toString()))})})}(O);return typeof b=="string"&&R&&K5.set(b,V),V}(c,r)}catch(b){return p.onError(b),b.throw(N)}const v=new yse(c),y=new vse(g,v,a?WT(a):{},d);return N.info("create buffer source audio track success, trackId:",d),p.onSuccess(y.getTrackId()),y},setAppType:function(e){if(N.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw N.debug("Invalid appType"),new he(K.INVALID_PARAMS,"invalid app type",e);sr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){N.setLogLevel(e)},enableLogUpload:function(){$("USE_NEW_LOG")?sr("UPLOAD_LOG",!0):N.enableLogUpload()},disableLogUpload:function(){$("USE_NEW_LOG")?sr("UPLOAD_LOG",!1):N.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new z6},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=Ze.reportApiInvoke(null,{tag:Br.TRACER,name:rn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Gr||e instanceof qm)){const g=new he(K.INVALID_TRACK,"the parameter is not a audio track");return r.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const a=e instanceof Gr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let l=c,d=c;const p=Date.now();return new Ge(g=>{const v=setInterval(()=>{const y=e.getVolumeLevel();l=y>l?y:l,d=y<d?y:d;const b=l-d>1e-4,R=Date.now()-p;if(b||R>t){clearInterval(v);const O=b,V={duration:R,deviceLabel:a,maxVolumeLevel:l,result:O};N.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(V))),r.onSuccess(V),g(O)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=Ze.reportApiInvoke(null,{tag:Br.TRACER,name:rn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Tr||e instanceof Hm)){const b=new he(K.INVALID_TRACK,"the parameter is not a video track");return r.onError(b),b.throw()}t&&t<1e3&&(t=1e3);const a=e instanceof Tr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Qn()||NT())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([c]),l.play();const d=document.createElement("canvas");d.width=160,d.height=120;let p=0,g=0;try{const b=Date.now();p=await function(R,O,V,k){let L,H=0,q=null;return new Ge((te,oe)=>{function se(){H>k&&L&&(L(),te(H));const ae=V.getContext("2d");if(!ae){const Fe=new he(K.UNEXPECTED_ERROR,"can not get canvas 2d context.");return N.error(Fe.toString()),void oe(Fe)}ae.drawImage(R,0,0,160,120);const pe=ae.getImageData(0,0,V.width,V.height),Te=Math.floor(pe.data.length/3);if(q){for(let Fe=0;Fe<Te;Fe+=3)if(pe.data[Fe]!==q[Fe])return H+=1,void(q=pe.data);q=pe.data}else q=pe.data}setTimeout(()=>{L&&(L(),te(H))},O),L=ON(()=>{se()},30)})}(l,t,d,4),g=Date.now()-b}catch(b){throw r.onError(b),b}Vce===Xt.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const v=p>4,y={duration:g,changedPicNum:p,deviceLabel:a,result:v};return N.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),r.onSuccess(y),v},setArea:sP,audioElementPlayCenter:Qi,resumeAudioContext:function(){Qi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){rle.processExternalMediaAEC(e)},registerExtensions:function(e){const t=$("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!Ve(t).call(t,r.name)&&t.push(r.name);const a=r;a.__registered__=!0,a.logger.hookLog=N.extLog,a.reporter.hookApiInvoke=Ze.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=$(c)})}),z8("PLUGIN_INFO",t)},ChannelMediaRelayError:$m,ChannelMediaRelayEvent:Kl,ChannelMediaRelayState:fa,RemoteStreamFallbackType:dse,RemoteStreamType:use,ConnectionDisconnectedReason:tr,AudienceLatencyLevelType:Boe,AREAS:Jt,preload:async function(e,t,r,a){return vW(e,t,r,a)}});return Object.defineProperties(dn,{onAudioAutoplayFailed:{get:()=>to.onAudioAutoplayFailed,set:e=>{to.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>to.onAutoplayFailed,set:e=>{to.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>dn._onSecurityPolicyViolation,set(e){dn._onSecurityPolicyViolation=e,AG(e)}},__CLIENT_LIST__:{get:()=>$("SHOW_GLOBAL_CLIENT_LIST")?hp:[]}}),eo.on(cp.CAMERA_DEVICE_CHANGED,e=>{N.info("camera device changed",JSON.stringify(e)),dn.onCameraChanged&&dn.onCameraChanged(e),dn.safeEmit(zc.CAMERA_CHANGED,e)}),eo.on(cp.RECORDING_DEVICE_CHANGED,e=>{N.info("microphone device changed",JSON.stringify(e)),dn.onMicrophoneChanged&&dn.onMicrophoneChanged(e),dn.safeEmit(zc.MICROPHONE_CHANGED,e)}),eo.on(cp.PLAYOUT_DEVICE_CHANGED,e=>{N.debug("playout device changed",JSON.stringify(e)),dn.onPlaybackDeviceChanged&&dn.onPlaybackDeviceChanged(e),dn.safeEmit(zc.PLAYBACK_DEVICE_CHANGED,e)}),Qi.onAutoplayFailed=()=>{N.info("detect audio element autoplay failed"),to.onAudioAutoplayFailed&&to.onAudioAutoplayFailed()},cr.on("autoplay-failed",()=>{N.info("detect webaudio autoplay failed"),to.onAudioAutoplayFailed&&to.onAudioAutoplayFailed(),dn.safeEmit(zc.AUTOPLAY_FAILED)}),cr.on($n.STATE_CHANGE,(e,t)=>{N.info("audio context state changed: ".concat(t," => ").concat(e)),dn.onAudioContextStateChanged&&dn.onAudioContextStateChanged(e,t),dn.safeEmit(zc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),nn.on(Nm.NETWORK_STATE_CHANGE,(e,t)=>{N.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=dn),dn})}(pR)),pR.exports}var Qhe=Jhe();const gH=Yr(Qhe);class Zhe{constructor(n,o){bn(this,"websocket",null);bn(this,"callbacks");bn(this,"config");bn(this,"isConnected",!1);bn(this,"reconnectAttempts",0);bn(this,"maxReconnectAttempts",5);bn(this,"reconnectDelay",1e3);this.config=n,this.callbacks=o}async initialize(){try{console.log("初始化 TEN Framework 连接..."),await this.connectWebSocket(),console.log("TEN Framework 初始化成功")}catch(n){throw console.error("TEN Framework 初始化失败:",n),this.callbacks.onError("AI服务连接失败"),n}}async connectWebSocket(){return new Promise((n,o)=>{try{console.log("连接到 TEN Agent WebSocket:",this.config.websocketUrl),setTimeout(()=>{this.isConnected=!0,this.reconnectAttempts=0,this.callbacks.onStatusChange("idle"),console.log("TEN Framework WebSocket 连接成功"),n()},1e3)}catch(s){console.error("WebSocket连接失败:",s),o(s)}})}async sendTextMessage(n){if(!this.isConnected)throw new Error("TEN Framework 未连接");try{console.log("发送文本消息到 TEN Agent:",n),this.callbacks.onStatusChange("processing");const o={type:"text_message",content:n,timestamp:new Date().toISOString(),language:this.config.language};console.log("消息已发送到 TEN Agent:",o),await this.simulateTENResponse(n)}catch(o){throw console.error("发送文本消息失败:",o),this.callbacks.onError("消息发送失败"),o}}async sendAudioData(n){if(!this.isConnected)throw new Error("TEN Framework 未连接");try{console.log("发送音频数据到 TEN Agent, 大小:",n.byteLength),this.callbacks.onStatusChange("processing");const o={type:"audio_data",data:n,timestamp:new Date().toISOString(),format:"webm",sampleRate:16e3};console.log("音频数据已发送到 TEN Agent"),await this.simulateSTTProcessing(n)}catch(o){throw console.error("发送音频数据失败:",o),this.callbacks.onError("音频处理失败"),o}}async sendImageData(n){if(!this.isConnected)throw new Error("TEN Framework 未连接");try{console.log("发送图像数据到 TEN Agent:",n),this.callbacks.onStatusChange("processing");const o={type:"image_data",imageUrl:n,timestamp:new Date().toISOString()};console.log("图像数据已发送到 TEN Agent"),await this.simulateImageProcessing(n)}catch(o){throw console.error("发送图像数据失败:",o),this.callbacks.onError("图像处理失败"),o}}async startSession(n){try{console.log("启动 TEN Agent 会话:",n);const o={type:"start_session",userId:n,timestamp:new Date().toISOString(),config:{language:this.config.language,voiceId:this.config.voiceId,enableVAD:!0,enableTurnDetection:!0}};console.log("会话已启动:",o),this.callbacks.onStatusChange("listening")}catch(o){throw console.error("启动会话失败:",o),this.callbacks.onError("会话启动失败"),o}}async endSession(){try{console.log("结束 TEN Agent 会话");const n={type:"end_session",timestamp:new Date().toISOString()};console.log("会话已结束:",n),this.callbacks.onStatusChange("idle")}catch(n){console.error("结束会话失败:",n),this.callbacks.onError("会话结束失败")}}async simulateTENResponse(n){await new Promise(u=>setTimeout(u,1e3+Math.random()*2e3));let o=this.generateIntelligentResponse(n);const s={id:Date.now().toString(),content:o,type:"text",sender:"assistant",timestamp:new Date};this.callbacks.onStatusChange("speaking"),this.callbacks.onMessage(s),setTimeout(()=>{this.callbacks.onStatusChange("listening")},o.length*100)}async simulateSTTProcessing(n){await new Promise(f=>setTimeout(f,800+Math.random()*1200));const o=["今天感觉怎么样？","我想聊聊家人的事情","昨天发生了什么有趣的事情","能帮我回忆一下吗？","我有点担心健康问题"],s=o[Math.floor(Math.random()*o.length)];console.log("STT识别结果:",s);const u={id:Date.now().toString(),content:s,type:"audio",sender:"user",timestamp:new Date};this.callbacks.onMessage(u),await this.simulateTENResponse(s)}async simulateImageProcessing(n){await new Promise(f=>setTimeout(f,2e3+Math.random()*3e3));const o=["我看到了一张很有趣的图片！请告诉我这张图片背后的故事。","这张照片让我想起了美好的回忆，您能分享一下拍摄时的情景吗？","图片中的内容很丰富，您最喜欢哪个部分呢？","这是一张很温馨的照片，能看出您对生活的热爱。","我注意到图片中的细节，您当时是什么心情呢？"],s=o[Math.floor(Math.random()*o.length)],u={id:Date.now().toString(),content:s,type:"text",sender:"assistant",timestamp:new Date};this.callbacks.onStatusChange("speaking"),this.callbacks.onMessage(u),setTimeout(()=>{this.callbacks.onStatusChange("listening")},s.length*100)}generateIntelligentResponse(n){const o=n.toLowerCase();if(o.includes("难受")||o.includes("痛苦")||o.includes("不舒服")){const u=["我理解您现在的感受一定不太好。能告诉我更多关于您的感受吗？我会陪伴在您身边。","听起来您遇到了一些困难。不要担心，我们可以一起面对，您不是一个人在战斗。","您的感受是完全可以理解的。有什么具体的事情让您感到不适吗？我们慢慢聊。"];return u[Math.floor(Math.random()*u.length)]}if(o.includes("记忆")||o.includes("忘记")||o.includes("记不起")){const u=["记忆有时候就像是躲猫猫的小朋友，暂时躲起来了，但它们还在那里。我们可以一起慢慢寻找。","不要为记忆的事情太担心，这很常见。我们可以通过一些有趣的方式来锻炼记忆力。","每个人都有记忆的起伏，重要的是我们现在在一起，可以创造新的美好回忆。"];return u[Math.floor(Math.random()*u.length)]}if(o.includes("家人")||o.includes("孩子")||o.includes("老伴")||o.includes("孙子")){const u=["家人是我们生命中最珍贵的财富。您想分享一些关于家人的美好故事吗？","听您提到家人，我能感受到您对他们深深的爱。他们一定也很爱您。","家人之间的感情是世界上最温暖的力量。您的家人现在怎么样？"];return u[Math.floor(Math.random()*u.length)]}if(o.includes("健康")||o.includes("身体")||o.includes("医生")||o.includes("药")){const u=["关心健康是很重要的。除了身体健康，心理健康也同样重要。您今天心情如何？","我注意到您在关注健康问题。保持积极的心态对健康很有帮助，我们一起加油！","健康管理是一个长期的过程。有什么特别的健康习惯您想要培养吗？"];return u[Math.floor(Math.random()*u.length)]}if(o.includes("开心")||o.includes("高兴")||o.includes("快乐")||o.includes("好")){const u=["听到您这么说我也很开心！保持这种积极的心态，生活会更加美好。","您的快乐感染了我！能分享一下是什么让您如此开心吗？","这真是太好了！您的笑容一定很灿烂，继续保持这份美好的心情。"];return u[Math.floor(Math.random()*u.length)]}if(o.includes("你好")||o.includes("您好")||o.includes("早上好")||o.includes("晚上好")){const u=["您好！很高兴又见到您。今天过得怎么样？有什么想聊的吗？","您好呀！看到您我就很开心。今天有什么特别的事情想要分享吗？","您好！欢迎回来。我一直在这里等着和您聊天呢。"];return u[Math.floor(Math.random()*u.length)]}const s=["这听起来很有意思，请继续告诉我更多。","我很想了解您的想法，能详细说说吗？","您说得很好，这让我想到了很多有趣的事情。","我在认真倾听您的每一句话，请继续分享。","这是一个很好的话题，我们可以深入聊聊。"];return s[Math.floor(Math.random()*s.length)]}async reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.callbacks.onError("连接失败，请刷新页面重试");return}this.reconnectAttempts++,console.log(`尝试重连 TEN Framework (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),await new Promise(n=>setTimeout(n,this.reconnectDelay));try{await this.connectWebSocket()}catch(n){console.error("重连失败:",n),this.reconnectDelay*=2,await this.reconnect()}}async disconnect(){try{console.log("断开 TEN Framework 连接"),this.isConnected=!1,this.websocket&&(this.websocket.close(),this.websocket=null),this.callbacks.onStatusChange("idle")}catch(n){console.error("断开连接失败:",n)}}getConnectionState(){return this.isConnected}}class epe{constructor(n){bn(this,"client",null);bn(this,"localAudioTrack",null);bn(this,"remoteAudioTracks",new Map);bn(this,"tenService",null);bn(this,"callbacks");bn(this,"channelName");bn(this,"uid");bn(this,"isRecording",!1);bn(this,"audioLevelInterval",null);bn(this,"mediaRecorder",null);bn(this,"audioChunks",[]);bn(this,"isInitialized",!1);this.callbacks=n,this.channelName=`${Rhe.AGORA_CHANNEL_PREFIX}${Date.now()}`,this.uid=Date.now().toString()}async initialize(){if(this.isInitialized){console.log("Agora服务已初始化");return}try{console.log("初始化增强版Agora服务..."),await this.initializeAgoraClient(),await this.initializeTENService(),this.isInitialized=!0,this.callbacks.onConnectionStateChange(!0),console.log(`增强版Agora服务初始化成功. 频道: ${this.channelName}`)}catch(n){throw console.error("增强版Agora服务初始化失败:",n),this.callbacks.onError(`初始化失败: ${n}`),n}}async initializeAgoraClient(){try{this.client=gH.createClient({mode:"rtc",codec:"vp8"}),this.setupAgoraEventListeners(),await this.client.join(The,this.channelName,null,this.uid),this.localAudioTrack=await gH.createMicrophoneAudioTrack({encoderConfig:"speech_standard",AEC:!0,AGC:!0,ANS:!0}),console.log("Agora客户端初始化成功")}catch(n){throw console.error("Agora客户端初始化失败:",n),n}}async initializeTENService(){try{const n={websocketUrl:"ws://localhost:8080/ten-agent",language:"zh-CN",voiceId:"zh-CN-XiaoxiaoNeural"},o={onMessage:s=>{this.callbacks.onMessage(s)},onStatusChange:s=>{this.callbacks.onStatusChange(s)},onError:s=>{this.callbacks.onError(s)}};this.tenService=new Zhe(n,o),await this.tenService.initialize(),console.log("TEN Framework服务初始化成功")}catch(n){throw console.error("TEN Framework服务初始化失败:",n),n}}setupAgoraEventListeners(){this.client&&(this.client.on("connection-state-change",(n,o)=>{console.log(`Agora连接状态变化: ${o} -> ${n}`),this.callbacks.onConnectionStateChange(n==="CONNECTED")}),this.client.on("user-joined",n=>{console.log("远端用户加入:",n.uid),n.uid.toString().includes("ten-agent")&&this.startTENSession()}),this.client.on("user-published",async(n,o)=>{if(o==="audio"){await this.client.subscribe(n,o);const s=n.audioTrack;s&&(this.remoteAudioTracks.set(n.uid.toString(),s),s.play(),console.log("订阅远端音频成功"),this.callbacks.onStatusChange("speaking"))}}),this.client.on("user-unpublished",(n,o)=>{o==="audio"&&(this.remoteAudioTracks.delete(n.uid.toString()),console.log("远端用户取消发布音频"),this.callbacks.onStatusChange("listening"))}),this.client.on("user-left",n=>{this.remoteAudioTracks.delete(n.uid.toString()),console.log("远端用户离开:",n.uid)}),this.client.on("exception",n=>{console.error("Agora异常:",n),this.callbacks.onError(`连接异常: ${n.msg}`)}))}async startTENSession(){if(this.tenService)try{await this.tenService.startSession(this.uid),console.log("TEN会话已启动")}catch(n){console.error("启动TEN会话失败:",n)}}async startRecording(){if(!(!this.client||!this.localAudioTrack||this.isRecording))try{console.log("开始录音和音频流传输..."),await this.client.publish([this.localAudioTrack]),await this.startLocalRecording(),this.isRecording=!0,this.startAudioLevelMonitoring(),this.callbacks.onStatusChange("listening"),console.log("录音和音频流传输已启动")}catch(n){throw console.error("启动录音失败:",n),this.callbacks.onError("开始录音失败"),n}}async startLocalRecording(){try{const n=new MediaStream([this.localAudioTrack.getMediaStreamTrack()]);this.mediaRecorder=new MediaRecorder(n,{mimeType:"audio/webm;codecs=opus"}),this.audioChunks=[],this.mediaRecorder.ondataavailable=o=>{o.data.size>0&&this.audioChunks.push(o.data)},this.mediaRecorder.onstop=async()=>{if(this.audioChunks.length>0){const s=await new Blob(this.audioChunks,{type:"audio/webm"}).arrayBuffer();if(this.tenService)try{await this.tenService.sendAudioData(s)}catch(u){console.error("发送音频到TEN Framework失败:",u)}}},this.mediaRecorder.start(1e3)}catch(n){throw console.error("启动本地录音失败:",n),n}}async stopRecording(){if(!(!this.client||!this.localAudioTrack||!this.isRecording))try{console.log("停止录音和音频流传输..."),await this.client.unpublish([this.localAudioTrack]),this.mediaRecorder&&this.mediaRecorder.state==="recording"&&this.mediaRecorder.stop(),this.isRecording=!1,this.stopAudioLevelMonitoring(),this.callbacks.onStatusChange("processing"),console.log("录音和音频流传输已停止")}catch(n){throw console.error("停止录音失败:",n),this.callbacks.onError("停止录音失败"),n}}startAudioLevelMonitoring(){this.audioLevelInterval||(this.audioLevelInterval=setInterval(()=>{if(this.localAudioTrack&&this.isRecording){const n=this.localAudioTrack.getVolumeLevel();this.callbacks.onAudioLevel(n*100)}},100))}stopAudioLevelMonitoring(){this.audioLevelInterval&&(clearInterval(this.audioLevelInterval),this.audioLevelInterval=null),this.callbacks.onAudioLevel(0)}async sendTextMessage(n){if(console.log("发送文本消息:",n),this.tenService)try{await this.tenService.sendTextMessage(n)}catch(o){console.error("通过TEN Framework发送文本消息失败:",o),this.callbacks.onError("消息发送失败")}else console.warn("TEN Framework服务未可用，无法发送消息"),this.callbacks.onError("AI服务暂时不可用")}async sendImageMessage(n){if(console.log("发送图像消息:",n),this.tenService)try{await this.tenService.sendImageData(n)}catch(o){console.error("通过TEN Framework发送图像消息失败:",o),this.callbacks.onError("图像处理失败")}else console.warn("TEN Framework服务未可用，无法处理图像"),this.callbacks.onError("AI服务暂时不可用")}async interruptAI(){console.log("打断AI语音播放"),this.remoteAudioTracks.forEach(n=>{n.stop()}),this.tenService&&console.log("发送打断信号到TEN Framework"),this.callbacks.onStatusChange("listening")}async disconnect(){try{console.log("断开增强版Agora服务连接"),this.stopAudioLevelMonitoring(),this.mediaRecorder&&this.mediaRecorder.state==="recording"&&this.mediaRecorder.stop(),this.localAudioTrack&&this.localAudioTrack.close(),this.remoteAudioTracks.forEach(n=>{n.stop()}),this.remoteAudioTracks.clear(),this.client&&await this.client.leave(),this.tenService&&(await this.tenService.endSession(),await this.tenService.disconnect()),this.isInitialized=!1,this.callbacks.onConnectionStateChange(!1),console.log("增强版Agora服务已断开连接")}catch(n){console.error("断开连接失败:",n)}}getConnectionState(){var n;return((n=this.client)==null?void 0:n.connectionState)==="CONNECTED"&&this.isInitialized}getChannelName(){return this.channelName}getUserId(){return this.uid}getTENConnectionState(){var n;return((n=this.tenService)==null?void 0:n.getConnectionState())||!1}async setAudioQuality(n){if(this.localAudioTrack)try{console.log("音频质量已设置为:",n)}catch(o){console.error("设置音频质量失败:",o)}}getNetworkQuality(){if(this.client){const n=this.client.getRTCStats();return{uplink:n.gatewayRTT||0,downlink:n.gatewayRTT||0}}return{uplink:0,downlink:0}}}const tpe=()=>{const{user:i}=Gd(),{data:n,loading:o,sendMessage:s}=Yhe(i==null?void 0:i.id),[u,f]=Ee.useState(""),[_,E]=Ee.useState(!1),[T,w]=Ee.useState(!1),[I,A]=Ee.useState(!1),[P,j]=Ee.useState(!1),[W,F]=Ee.useState(0),[M,X]=Ee.useState("idle"),[Y,J]=Ee.useState(null),re=Ee.useRef(null),z=Ee.useRef(null),Z=Ee.useRef(null);Ee.useEffect(()=>((async()=>{if(!(z.current||!i))try{E(!0),J(null);const ke={onConnectionStateChange:Me=>{var Ue;w(Me),Me?A(((Ue=z.current)==null?void 0:Ue.getTENConnectionState())||!1):(A(!1),J("连接中断，请检查网络连接"))},onAudioLevel:Me=>{F(Me)},onMessage:Me=>{console.log("收到AI消息:",Me)},onStatusChange:Me=>{X(Me)},onError:Me=>{console.error("服务错误:",Me),J(Me)}};z.current=new epe(ke),await z.current.initialize(),console.log("增强版服务初始化成功")}catch(ke){console.error("初始化服务失败:",ke),J("初始化失败，请刷新页面重试")}finally{E(!1)}})(),()=>{z.current&&z.current.disconnect()}),[i]),Ee.useEffect(()=>{var be;(be=re.current)==null||be.scrollIntoView({behavior:"smooth"})},[n]),Ee.useEffect(()=>{const ke=setInterval(()=>{if(z.current&&T){const Me=z.current.getTENConnectionState();A(Me)}},2e3);return()=>clearInterval(ke)},[T]);const ie=async()=>{if(z.current)try{P?(await z.current.stopRecording(),j(!1)):(await z.current.startRecording(),j(!0),f(""))}catch(be){console.error("录音操作失败:",be),J("录音操作失败")}},de=async()=>{if(!(!u.trim()||!i))try{await s(i.id,u.trim(),"text"),z.current&&await z.current.sendTextMessage(u.trim()),f("")}catch(be){console.error("发送消息失败:",be),J("消息发送失败")}},ge=async be=>{var Me;const ke=(Me=be.target.files)==null?void 0:Me[0];if(!(!ke||!i)){try{const Ue=new FileReader;Ue.onload=async Pe=>{var He;const We=(He=Pe.target)==null?void 0:He.result;await s(i.id,We,"image"),z.current&&await z.current.sendImageMessage(We)},Ue.readAsDataURL(ke)}catch(Ue){console.error("发送图像失败:",Ue),J("图像处理失败")}Z.current&&(Z.current.value="")}},Oe=async()=>{if(z.current&&M==="speaking")try{await z.current.interruptAI()}catch(be){console.error("打断失败:",be)}},ye=(()=>{if(_)return{text:"连接中...",color:"text-yellow-600",icon:Qw};if(!T)return{text:"连接断开",color:"text-red-600",icon:Whe};if(!I)return{text:"AI服务连接中...",color:"text-orange-600",icon:Qw};switch(M){case"listening":return{text:"正在倾听...",color:"text-blue-600",icon:cD};case"processing":return{text:"AI思考中...",color:"text-purple-600",icon:Wp};case"speaking":return{text:"AI回复中...",color:"text-green-600",icon:lD};default:return{text:"准备就绪",color:"text-green-600",icon:fH}}})(),Ae=ye.icon;return U.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-blue-50 via-white to-green-50",children:[U.jsxs("div",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white",children:U.jsx(Wp,{className:"w-6 h-6"})}),U.jsxs("div",{children:[U.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AI 陪伴助手"}),U.jsx("p",{className:"text-gray-600",children:"我在这里陪伴您，随时为您提供帮助"})]})]}),U.jsxs("div",{className:"flex items-center space-x-6",children:[U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx("div",{className:`w-3 h-3 rounded-full ${T&&I?"bg-green-500":_?"bg-yellow-500":"bg-red-500"} ${_?"animate-pulse":""}`}),U.jsxs("div",{className:"flex items-center space-x-2",children:[U.jsx(Ae,{className:`w-4 h-4 ${ye.color} ${ye.icon===Qw?"animate-spin":""}`}),U.jsx("span",{className:`text-sm font-medium ${ye.color}`,children:ye.text})]})]}),T&&U.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[U.jsxs("div",{className:"flex items-center space-x-1",children:[U.jsx(fH,{className:`w-3 h-3 ${T?"text-green-500":"text-red-500"}`}),U.jsx("span",{className:"text-gray-500",children:"Agora"})]}),U.jsxs("div",{className:"flex items-center space-x-1",children:[U.jsx("div",{className:`w-2 h-2 rounded-full ${I?"bg-green-500":"bg-red-500"}`}),U.jsx("span",{className:"text-gray-500",children:"TEN"})]}),W>0&&U.jsxs("div",{className:"flex items-center space-x-1",children:[U.jsx("span",{className:"text-gray-500",children:"音量:"}),U.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded-full overflow-hidden",children:U.jsx("div",{className:"h-full bg-blue-500 transition-all duration-100",style:{width:`${W}%`}})})]})]})]})]}),Y&&U.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2",children:[U.jsx(KM,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),U.jsx("span",{className:"text-red-700 text-sm",children:Y}),U.jsx("button",{onClick:()=>J(null),className:"ml-auto text-red-500 hover:text-red-700",children:"×"})]})]}),U.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:o?U.jsxs("div",{className:"text-center py-12",children:[U.jsx(Qw,{className:"w-8 h-8 text-blue-500 mx-auto mb-4 animate-spin"}),U.jsx("p",{className:"text-gray-600",children:"加载消息中..."})]}):!n||n.length===0?U.jsxs("div",{className:"text-center py-12",children:[U.jsx("div",{className:"w-24 h-24 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6",children:U.jsx(lu,{className:"w-12 h-12 text-white"})}),U.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["您好，",i==null?void 0:i.name,"!"]}),U.jsx("p",{className:"text-gray-600 text-lg mb-6",children:"我是您的 AI 陪伴助手，您可以："}),U.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto",children:[U.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-100",children:[U.jsx(cD,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),U.jsx("p",{className:"text-sm text-gray-700",children:"点击麦克风开始语音对话"})]}),U.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-100",children:[U.jsx(hH,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),U.jsx("p",{className:"text-sm text-gray-700",children:"输入文字发送消息"})]}),U.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-100",children:[U.jsx(yL,{className:"w-8 h-8 text-purple-500 mx-auto mb-2"}),U.jsx("p",{className:"text-sm text-gray-700",children:"上传图片分享"})]})]})]}):U.jsxs(U.Fragment,{children:[n.map(be=>U.jsx("div",{className:`flex ${be.sender==="user"?"justify-end":"justify-start"} animate-fade-in`,children:U.jsxs("div",{className:`max-w-xs lg:max-w-md px-6 py-4 rounded-2xl relative ${be.sender==="user"?"bg-blue-500 text-white":"bg-white text-gray-900 shadow-md border border-gray-100"}`,children:[be.type==="text"&&U.jsx("p",{className:"text-lg leading-relaxed whitespace-pre-wrap",children:be.content}),be.type==="image"&&U.jsxs("div",{children:[U.jsx("img",{src:be.content,alt:"用户上传的图片",className:"rounded-lg max-w-full h-auto mb-2"}),be.sender==="user"&&U.jsx("p",{className:"text-sm opacity-75",children:"已上传图片"})]}),be.type==="audio"&&U.jsxs("div",{className:"flex items-center space-x-2",children:[U.jsx(lD,{className:"w-5 h-5"}),U.jsx("span",{children:"语音消息"})]}),U.jsxs("div",{className:"flex items-center justify-between mt-2",children:[U.jsx("p",{className:`text-xs ${be.sender==="user"?"text-blue-100":"text-gray-500"}`,children:be.timestamp.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),be.type==="audio"&&U.jsx(lD,{className:"w-3 h-3 opacity-70"})]})]})},be.id)),U.jsx("div",{ref:re})]})}),P&&U.jsx("div",{className:"px-6 py-3 bg-blue-50 border-t border-blue-200",children:U.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[U.jsx("span",{className:"text-sm text-blue-700 mr-4",children:"正在录音"}),Array.from({length:20}).map((be,ke)=>U.jsx("div",{className:"w-1 bg-blue-500 rounded-full transition-all duration-300",style:{height:`${8+Math.random()*16}px`,animationDelay:`${ke*50}ms`}},ke)),U.jsx("button",{onClick:Oe,className:"ml-4 text-xs text-blue-700 hover:text-blue-900 underline",children:"打断"})]})}),U.jsxs("div",{className:"bg-white border-t border-gray-200 p-6",children:[U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsxs("button",{onClick:ie,disabled:!T||!I,className:`relative p-4 rounded-full transition-all duration-200 ${P?"bg-red-500 hover:bg-red-600 text-white scale-110 shadow-lg":"bg-blue-500 hover:bg-blue-600 text-white"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[P?U.jsx(Mhe,{className:"w-6 h-6"}):U.jsx(cD,{className:"w-6 h-6"}),P&&U.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-400 rounded-full animate-ping"})]}),U.jsxs("div",{className:"flex-1 flex items-center space-x-2",children:[U.jsx("input",{type:"text",value:u,onChange:be=>f(be.target.value),onKeyDown:be=>be.key==="Enter"&&!be.shiftKey&&de(),placeholder:"输入消息或点击麦克风开始对话...",disabled:!T||!I||M==="processing",className:"flex-1 px-4 py-3 text-lg border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"}),U.jsx("button",{onClick:de,disabled:!u.trim()||!T||!I||M==="processing",className:"p-3 bg-green-500 hover:bg-green-600 text-white rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:U.jsx(hH,{className:"w-5 h-5"})})]}),U.jsxs("div",{children:[U.jsx("input",{ref:Z,type:"file",accept:"image/*",onChange:ge,className:"hidden"}),U.jsx("button",{onClick:()=>{var be;return(be=Z.current)==null?void 0:be.click()},disabled:!T||!I||M==="processing",className:"p-3 bg-purple-500 hover:bg-purple-600 text-white rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:U.jsx(yL,{className:"w-5 h-5"})})]})]}),U.jsxs("div",{className:"mt-3 text-center",children:[M==="speaking"&&U.jsx("button",{onClick:Oe,className:"text-sm text-blue-600 hover:text-blue-800 underline",children:"点击打断AI语音"}),(!T||!I)&&U.jsx("p",{className:"text-sm text-gray-500",children:T?"等待AI服务...":"等待连接..."})]})]})]})};function B7(i){var n,o,s="";if(typeof i=="string"||typeof i=="number")s+=i;else if(typeof i=="object")if(Array.isArray(i)){var u=i.length;for(n=0;n<u;n++)i[n]&&(o=B7(i[n]))&&(s&&(s+=" "),s+=o)}else for(o in i)i[o]&&(s&&(s+=" "),s+=o);return s}function or(){for(var i,n,o=0,s="",u=arguments.length;o<u;o++)(i=arguments[o])&&(n=B7(i))&&(s&&(s+=" "),s+=n);return s}var uD,_H;function so(){if(_H)return uD;_H=1;var i=Array.isArray;return uD=i,uD}var dD,vH;function W7(){if(vH)return dD;vH=1;var i=typeof Lp=="object"&&Lp&&Lp.Object===Object&&Lp;return dD=i,dD}var hD,yH;function pl(){if(yH)return hD;yH=1;var i=W7(),n=typeof self=="object"&&self&&self.Object===Object&&self,o=i||n||Function("return this")();return hD=o,hD}var pD,EH;function kS(){if(EH)return pD;EH=1;var i=pl(),n=i.Symbol;return pD=n,pD}var fD,SH;function rpe(){if(SH)return fD;SH=1;var i=kS(),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,u=i?i.toStringTag:void 0;function f(_){var E=o.call(_,u),T=_[u];try{_[u]=void 0;var w=!0}catch{}var I=s.call(_);return w&&(E?_[u]=T:delete _[u]),I}return fD=f,fD}var mD,bH;function npe(){if(bH)return mD;bH=1;var i=Object.prototype,n=i.toString;function o(s){return n.call(s)}return mD=o,mD}var gD,TH;function gu(){if(TH)return gD;TH=1;var i=kS(),n=rpe(),o=npe(),s="[object Null]",u="[object Undefined]",f=i?i.toStringTag:void 0;function _(E){return E==null?E===void 0?u:s:f&&f in Object(E)?n(E):o(E)}return gD=_,gD}var _D,wH;function _u(){if(wH)return _D;wH=1;function i(n){return n!=null&&typeof n=="object"}return _D=i,_D}var vD,RH;function o_(){if(RH)return vD;RH=1;var i=gu(),n=_u(),o="[object Symbol]";function s(u){return typeof u=="symbol"||n(u)&&i(u)==o}return vD=s,vD}var yD,CH;function $M(){if(CH)return yD;CH=1;var i=so(),n=o_(),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;function u(f,_){if(i(f))return!1;var E=typeof f;return E=="number"||E=="symbol"||E=="boolean"||f==null||n(f)?!0:s.test(f)||!o.test(f)||_!=null&&f in Object(_)}return yD=u,yD}var ED,AH;function Hd(){if(AH)return ED;AH=1;function i(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}return ED=i,ED}var SD,OH;function YM(){if(OH)return SD;OH=1;var i=gu(),n=Hd(),o="[object AsyncFunction]",s="[object Function]",u="[object GeneratorFunction]",f="[object Proxy]";function _(E){if(!n(E))return!1;var T=i(E);return T==s||T==u||T==o||T==f}return SD=_,SD}var bD,IH;function ipe(){if(IH)return bD;IH=1;var i=pl(),n=i["__core-js_shared__"];return bD=n,bD}var TD,NH;function ape(){if(NH)return TD;NH=1;var i=ipe(),n=function(){var s=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}();function o(s){return!!n&&n in s}return TD=o,TD}var wD,PH;function G7(){if(PH)return wD;PH=1;var i=Function.prototype,n=i.toString;function o(s){if(s!=null){try{return n.call(s)}catch{}try{return s+""}catch{}}return""}return wD=o,wD}var RD,DH;function ope(){if(DH)return RD;DH=1;var i=YM(),n=ape(),o=Hd(),s=G7(),u=/[\\^$.*+?()[\]{}|]/g,f=/^\[object .+?Constructor\]$/,_=Function.prototype,E=Object.prototype,T=_.toString,w=E.hasOwnProperty,I=RegExp("^"+T.call(w).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(P){if(!o(P)||n(P))return!1;var j=i(P)?I:f;return j.test(s(P))}return RD=A,RD}var CD,xH;function spe(){if(xH)return CD;xH=1;function i(n,o){return n==null?void 0:n[o]}return CD=i,CD}var AD,kH;function $p(){if(kH)return AD;kH=1;var i=ope(),n=spe();function o(s,u){var f=n(s,u);return i(f)?f:void 0}return AD=o,AD}var OD,LH;function TC(){if(LH)return OD;LH=1;var i=$p(),n=i(Object,"create");return OD=n,OD}var ID,MH;function cpe(){if(MH)return ID;MH=1;var i=TC();function n(){this.__data__=i?i(null):{},this.size=0}return ID=n,ID}var ND,UH;function lpe(){if(UH)return ND;UH=1;function i(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}return ND=i,ND}var PD,jH;function upe(){if(jH)return PD;jH=1;var i=TC(),n="__lodash_hash_undefined__",o=Object.prototype,s=o.hasOwnProperty;function u(f){var _=this.__data__;if(i){var E=_[f];return E===n?void 0:E}return s.call(_,f)?_[f]:void 0}return PD=u,PD}var DD,VH;function dpe(){if(VH)return DD;VH=1;var i=TC(),n=Object.prototype,o=n.hasOwnProperty;function s(u){var f=this.__data__;return i?f[u]!==void 0:o.call(f,u)}return DD=s,DD}var xD,FH;function hpe(){if(FH)return xD;FH=1;var i=TC(),n="__lodash_hash_undefined__";function o(s,u){var f=this.__data__;return this.size+=this.has(s)?0:1,f[s]=i&&u===void 0?n:u,this}return xD=o,xD}var kD,BH;function ppe(){if(BH)return kD;BH=1;var i=cpe(),n=lpe(),o=upe(),s=dpe(),u=hpe();function f(_){var E=-1,T=_==null?0:_.length;for(this.clear();++E<T;){var w=_[E];this.set(w[0],w[1])}}return f.prototype.clear=i,f.prototype.delete=n,f.prototype.get=o,f.prototype.has=s,f.prototype.set=u,kD=f,kD}var LD,WH;function fpe(){if(WH)return LD;WH=1;function i(){this.__data__=[],this.size=0}return LD=i,LD}var MD,GH;function XM(){if(GH)return MD;GH=1;function i(n,o){return n===o||n!==n&&o!==o}return MD=i,MD}var UD,HH;function wC(){if(HH)return UD;HH=1;var i=XM();function n(o,s){for(var u=o.length;u--;)if(i(o[u][0],s))return u;return-1}return UD=n,UD}var jD,qH;function mpe(){if(qH)return jD;qH=1;var i=wC(),n=Array.prototype,o=n.splice;function s(u){var f=this.__data__,_=i(f,u);if(_<0)return!1;var E=f.length-1;return _==E?f.pop():o.call(f,_,1),--this.size,!0}return jD=s,jD}var VD,KH;function gpe(){if(KH)return VD;KH=1;var i=wC();function n(o){var s=this.__data__,u=i(s,o);return u<0?void 0:s[u][1]}return VD=n,VD}var FD,zH;function _pe(){if(zH)return FD;zH=1;var i=wC();function n(o){return i(this.__data__,o)>-1}return FD=n,FD}var BD,$H;function vpe(){if($H)return BD;$H=1;var i=wC();function n(o,s){var u=this.__data__,f=i(u,o);return f<0?(++this.size,u.push([o,s])):u[f][1]=s,this}return BD=n,BD}var WD,YH;function RC(){if(YH)return WD;YH=1;var i=fpe(),n=mpe(),o=gpe(),s=_pe(),u=vpe();function f(_){var E=-1,T=_==null?0:_.length;for(this.clear();++E<T;){var w=_[E];this.set(w[0],w[1])}}return f.prototype.clear=i,f.prototype.delete=n,f.prototype.get=o,f.prototype.has=s,f.prototype.set=u,WD=f,WD}var GD,XH;function JM(){if(XH)return GD;XH=1;var i=$p(),n=pl(),o=i(n,"Map");return GD=o,GD}var HD,JH;function ype(){if(JH)return HD;JH=1;var i=ppe(),n=RC(),o=JM();function s(){this.size=0,this.__data__={hash:new i,map:new(o||n),string:new i}}return HD=s,HD}var qD,QH;function Epe(){if(QH)return qD;QH=1;function i(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}return qD=i,qD}var KD,ZH;function CC(){if(ZH)return KD;ZH=1;var i=Epe();function n(o,s){var u=o.__data__;return i(s)?u[typeof s=="string"?"string":"hash"]:u.map}return KD=n,KD}var zD,eq;function Spe(){if(eq)return zD;eq=1;var i=CC();function n(o){var s=i(this,o).delete(o);return this.size-=s?1:0,s}return zD=n,zD}var $D,tq;function bpe(){if(tq)return $D;tq=1;var i=CC();function n(o){return i(this,o).get(o)}return $D=n,$D}var YD,rq;function Tpe(){if(rq)return YD;rq=1;var i=CC();function n(o){return i(this,o).has(o)}return YD=n,YD}var XD,nq;function wpe(){if(nq)return XD;nq=1;var i=CC();function n(o,s){var u=i(this,o),f=u.size;return u.set(o,s),this.size+=u.size==f?0:1,this}return XD=n,XD}var JD,iq;function QM(){if(iq)return JD;iq=1;var i=ype(),n=Spe(),o=bpe(),s=Tpe(),u=wpe();function f(_){var E=-1,T=_==null?0:_.length;for(this.clear();++E<T;){var w=_[E];this.set(w[0],w[1])}}return f.prototype.clear=i,f.prototype.delete=n,f.prototype.get=o,f.prototype.has=s,f.prototype.set=u,JD=f,JD}var QD,aq;function H7(){if(aq)return QD;aq=1;var i=QM(),n="Expected a function";function o(s,u){if(typeof s!="function"||u!=null&&typeof u!="function")throw new TypeError(n);var f=function(){var _=arguments,E=u?u.apply(this,_):_[0],T=f.cache;if(T.has(E))return T.get(E);var w=s.apply(this,_);return f.cache=T.set(E,w)||T,w};return f.cache=new(o.Cache||i),f}return o.Cache=i,QD=o,QD}var ZD,oq;function Rpe(){if(oq)return ZD;oq=1;var i=H7(),n=500;function o(s){var u=i(s,function(_){return f.size===n&&f.clear(),_}),f=u.cache;return u}return ZD=o,ZD}var e1,sq;function Cpe(){if(sq)return e1;sq=1;var i=Rpe(),n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,s=i(function(u){var f=[];return u.charCodeAt(0)===46&&f.push(""),u.replace(n,function(_,E,T,w){f.push(T?w.replace(o,"$1"):E||_)}),f});return e1=s,e1}var t1,cq;function ZM(){if(cq)return t1;cq=1;function i(n,o){for(var s=-1,u=n==null?0:n.length,f=Array(u);++s<u;)f[s]=o(n[s],s,n);return f}return t1=i,t1}var r1,lq;function Ape(){if(lq)return r1;lq=1;var i=kS(),n=ZM(),o=so(),s=o_(),u=i?i.prototype:void 0,f=u?u.toString:void 0;function _(E){if(typeof E=="string")return E;if(o(E))return n(E,_)+"";if(s(E))return f?f.call(E):"";var T=E+"";return T=="0"&&1/E==-1/0?"-0":T}return r1=_,r1}var n1,uq;function q7(){if(uq)return n1;uq=1;var i=Ape();function n(o){return o==null?"":i(o)}return n1=n,n1}var i1,dq;function K7(){if(dq)return i1;dq=1;var i=so(),n=$M(),o=Cpe(),s=q7();function u(f,_){return i(f)?f:n(f,_)?[f]:o(s(f))}return i1=u,i1}var a1,hq;function AC(){if(hq)return a1;hq=1;var i=o_();function n(o){if(typeof o=="string"||i(o))return o;var s=o+"";return s=="0"&&1/o==-1/0?"-0":s}return a1=n,a1}var o1,pq;function e2(){if(pq)return o1;pq=1;var i=K7(),n=AC();function o(s,u){u=i(u,s);for(var f=0,_=u.length;s!=null&&f<_;)s=s[n(u[f++])];return f&&f==_?s:void 0}return o1=o,o1}var s1,fq;function z7(){if(fq)return s1;fq=1;var i=e2();function n(o,s,u){var f=o==null?void 0:i(o,s);return f===void 0?u:f}return s1=n,s1}var Ope=z7();const Lo=Yr(Ope);var c1,mq;function Ipe(){if(mq)return c1;mq=1;function i(n){return n==null}return c1=i,c1}var Npe=Ipe();const ir=Yr(Npe);var l1,gq;function Ppe(){if(gq)return l1;gq=1;var i=gu(),n=so(),o=_u(),s="[object String]";function u(f){return typeof f=="string"||!n(f)&&o(f)&&i(f)==s}return l1=u,l1}var Dpe=Ppe();const LS=Yr(Dpe);var xpe=YM();const zt=Yr(xpe);var kpe=Hd();const s_=Yr(kpe);var u1={exports:{}},Qr={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _q;function Lpe(){if(_q)return Qr;_q=1;var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),_=Symbol.for("react.context"),E=Symbol.for("react.server_context"),T=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),j=Symbol.for("react.offscreen"),W;W=Symbol.for("react.module.reference");function F(M){if(typeof M=="object"&&M!==null){var X=M.$$typeof;switch(X){case i:switch(M=M.type,M){case o:case u:case s:case w:case I:return M;default:switch(M=M&&M.$$typeof,M){case E:case _:case T:case P:case A:case f:return M;default:return X}}case n:return X}}}return Qr.ContextConsumer=_,Qr.ContextProvider=f,Qr.Element=i,Qr.ForwardRef=T,Qr.Fragment=o,Qr.Lazy=P,Qr.Memo=A,Qr.Portal=n,Qr.Profiler=u,Qr.StrictMode=s,Qr.Suspense=w,Qr.SuspenseList=I,Qr.isAsyncMode=function(){return!1},Qr.isConcurrentMode=function(){return!1},Qr.isContextConsumer=function(M){return F(M)===_},Qr.isContextProvider=function(M){return F(M)===f},Qr.isElement=function(M){return typeof M=="object"&&M!==null&&M.$$typeof===i},Qr.isForwardRef=function(M){return F(M)===T},Qr.isFragment=function(M){return F(M)===o},Qr.isLazy=function(M){return F(M)===P},Qr.isMemo=function(M){return F(M)===A},Qr.isPortal=function(M){return F(M)===n},Qr.isProfiler=function(M){return F(M)===u},Qr.isStrictMode=function(M){return F(M)===s},Qr.isSuspense=function(M){return F(M)===w},Qr.isSuspenseList=function(M){return F(M)===I},Qr.isValidElementType=function(M){return typeof M=="string"||typeof M=="function"||M===o||M===u||M===s||M===w||M===I||M===j||typeof M=="object"&&M!==null&&(M.$$typeof===P||M.$$typeof===A||M.$$typeof===f||M.$$typeof===_||M.$$typeof===T||M.$$typeof===W||M.getModuleId!==void 0)},Qr.typeOf=F,Qr}var vq;function Mpe(){return vq||(vq=1,u1.exports=Lpe()),u1.exports}var Upe=Mpe(),d1,yq;function $7(){if(yq)return d1;yq=1;var i=gu(),n=_u(),o="[object Number]";function s(u){return typeof u=="number"||n(u)&&i(u)==o}return d1=s,d1}var h1,Eq;function jpe(){if(Eq)return h1;Eq=1;var i=$7();function n(o){return i(o)&&o!=+o}return h1=n,h1}var Vpe=jpe();const MS=Yr(Vpe);var Fpe=$7();const Bpe=Yr(Fpe);var La=function(n){return n===0?0:n>0?1:-1},Mp=function(n){return LS(n)&&n.indexOf("%")===n.length-1},dt=function(n){return Bpe(n)&&!MS(n)},Oi=function(n){return dt(n)||LS(n)},Wpe=0,c_=function(n){var o=++Wpe;return"".concat(n||"").concat(o)},Ma=function(n,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!dt(n)&&!LS(n))return s;var f;if(Mp(n)){var _=n.indexOf("%");f=o*parseFloat(n.slice(0,_))/100}else f=+n;return MS(f)&&(f=s),u&&f>o&&(f=o),f},Md=function(n){if(!n)return null;var o=Object.keys(n);return o&&o.length?n[o[0]]:null},Gpe=function(n){if(!Array.isArray(n))return!1;for(var o=n.length,s={},u=0;u<o;u++)if(!s[n[u]])s[n[u]]=!0;else return!0;return!1},ia=function(n,o){return dt(n)&&dt(o)?function(s){return n+s*(o-n)}:function(){return o}};function vR(i,n,o){return!i||!i.length?null:i.find(function(s){return s&&(typeof n=="function"?n(s):Lo(s,n))===o})}function wg(i,n){for(var o in i)if({}.hasOwnProperty.call(i,o)&&(!{}.hasOwnProperty.call(n,o)||i[o]!==n[o]))return!1;for(var s in n)if({}.hasOwnProperty.call(n,s)&&!{}.hasOwnProperty.call(i,s))return!1;return!0}function SL(i){"@babel/helpers - typeof";return SL=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},SL(i)}var Hpe=["viewBox","children"],qpe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],Sq=["points","pathLength"],p1={svg:Hpe,polygon:Sq,polyline:Sq},t2=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],yR=function(n,o){if(!n||typeof n=="function"||typeof n=="boolean")return null;var s=n;if(Ee.isValidElement(n)&&(s=n.props),!s_(s))return null;var u={};return Object.keys(s).forEach(function(f){t2.includes(f)&&(u[f]=o||function(_){return s[f](s,_)})}),u},Kpe=function(n,o,s){return function(u){return n(o,s,u),null}},Gp=function(n,o,s){if(!s_(n)||SL(n)!=="object")return null;var u=null;return Object.keys(n).forEach(function(f){var _=n[f];t2.includes(f)&&typeof _=="function"&&(u||(u={}),u[f]=Kpe(_,o,s))}),u},zpe=["children"],$pe=["children"];function bq(i,n){if(i==null)return{};var o=Ype(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function Ype(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function bL(i){"@babel/helpers - typeof";return bL=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bL(i)}var Tq={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},su=function(n){return typeof n=="string"?n:n?n.displayName||n.name||"Component":""},wq=null,f1=null,r2=function i(n){if(n===wq&&Array.isArray(f1))return f1;var o=[];return Ee.Children.forEach(n,function(s){ir(s)||(Upe.isFragment(s)?o=o.concat(i(s.props.children)):o.push(s))}),f1=o,wq=n,o};function Mo(i,n){var o=[],s=[];return Array.isArray(n)?s=n.map(function(u){return su(u)}):s=[su(n)],r2(i).forEach(function(u){var f=Lo(u,"type.displayName")||Lo(u,"type.name");s.indexOf(f)!==-1&&o.push(u)}),o}function xo(i,n){var o=Mo(i,n);return o&&o[0]}var Rq=function(n){if(!n||!n.props)return!1;var o=n.props,s=o.width,u=o.height;return!(!dt(s)||s<=0||!dt(u)||u<=0)},Xpe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],Jpe=function(n){return n&&n.type&&LS(n.type)&&Xpe.indexOf(n.type)>=0},Qpe=function(n){return n&&bL(n)==="object"&&"clipDot"in n},Zpe=function(n,o,s,u){var f,_=(f=p1==null?void 0:p1[u])!==null&&f!==void 0?f:[];return o.startsWith("data-")||!zt(n)&&(u&&_.includes(o)||qpe.includes(o))||s&&t2.includes(o)},Pt=function(n,o,s){if(!n||typeof n=="function"||typeof n=="boolean")return null;var u=n;if(Ee.isValidElement(n)&&(u=n.props),!s_(u))return null;var f={};return Object.keys(u).forEach(function(_){var E;Zpe((E=u)===null||E===void 0?void 0:E[_],_,o,s)&&(f[_]=u[_])}),f},TL=function i(n,o){if(n===o)return!0;var s=Ee.Children.count(n);if(s!==Ee.Children.count(o))return!1;if(s===0)return!0;if(s===1)return Cq(Array.isArray(n)?n[0]:n,Array.isArray(o)?o[0]:o);for(var u=0;u<s;u++){var f=n[u],_=o[u];if(Array.isArray(f)||Array.isArray(_)){if(!i(f,_))return!1}else if(!Cq(f,_))return!1}return!0},Cq=function(n,o){if(ir(n)&&ir(o))return!0;if(!ir(n)&&!ir(o)){var s=n.props||{},u=s.children,f=bq(s,zpe),_=o.props||{},E=_.children,T=bq(_,$pe);return u&&E?wg(f,T)&&TL(u,E):!u&&!E?wg(f,T):!1}return!1},Aq=function(n,o){var s=[],u={};return r2(n).forEach(function(f,_){if(Jpe(f))s.push(f);else if(f){var E=su(f.type),T=o[E]||{},w=T.handler,I=T.once;if(w&&(!I||!u[E])){var A=w(f,E,_);s.push(A),u[E]=!0}}}),s},efe=function(n){var o=n&&n.type;return o&&Tq[o]?Tq[o]:null},tfe=function(n,o){return r2(o).indexOf(n)},rfe=["children","width","height","viewBox","className","style","title","desc"];function wL(){return wL=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},wL.apply(this,arguments)}function nfe(i,n){if(i==null)return{};var o=ife(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function ife(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function RL(i){var n=i.children,o=i.width,s=i.height,u=i.viewBox,f=i.className,_=i.style,E=i.title,T=i.desc,w=nfe(i,rfe),I=u||{width:o,height:s,x:0,y:0},A=or("recharts-surface",f);return ue.createElement("svg",wL({},Pt(w,!0,"svg"),{className:A,width:o,height:s,style:_,viewBox:"".concat(I.x," ").concat(I.y," ").concat(I.width," ").concat(I.height)}),ue.createElement("title",null,E),ue.createElement("desc",null,T),n)}var afe=["children","className"];function CL(){return CL=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},CL.apply(this,arguments)}function ofe(i,n){if(i==null)return{};var o=sfe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function sfe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}var Dr=ue.forwardRef(function(i,n){var o=i.children,s=i.className,u=ofe(i,afe),f=or("recharts-layer",s);return ue.createElement("g",CL({className:f},Pt(u,!0),{ref:n}),o)}),oc=function(n,o){for(var s=arguments.length,u=new Array(s>2?s-2:0),f=2;f<s;f++)u[f-2]=arguments[f]},m1,Oq;function cfe(){if(Oq)return m1;Oq=1;function i(n,o,s){var u=-1,f=n.length;o<0&&(o=-o>f?0:f+o),s=s>f?f:s,s<0&&(s+=f),f=o>s?0:s-o>>>0,o>>>=0;for(var _=Array(f);++u<f;)_[u]=n[u+o];return _}return m1=i,m1}var g1,Iq;function lfe(){if(Iq)return g1;Iq=1;var i=cfe();function n(o,s,u){var f=o.length;return u=u===void 0?f:u,!s&&u>=f?o:i(o,s,u)}return g1=n,g1}var _1,Nq;function Y7(){if(Nq)return _1;Nq=1;var i="\\ud800-\\udfff",n="\\u0300-\\u036f",o="\\ufe20-\\ufe2f",s="\\u20d0-\\u20ff",u=n+o+s,f="\\ufe0e\\ufe0f",_="\\u200d",E=RegExp("["+_+i+u+f+"]");function T(w){return E.test(w)}return _1=T,_1}var v1,Pq;function ufe(){if(Pq)return v1;Pq=1;function i(n){return n.split("")}return v1=i,v1}var y1,Dq;function dfe(){if(Dq)return y1;Dq=1;var i="\\ud800-\\udfff",n="\\u0300-\\u036f",o="\\ufe20-\\ufe2f",s="\\u20d0-\\u20ff",u=n+o+s,f="\\ufe0e\\ufe0f",_="["+i+"]",E="["+u+"]",T="\\ud83c[\\udffb-\\udfff]",w="(?:"+E+"|"+T+")",I="[^"+i+"]",A="(?:\\ud83c[\\udde6-\\uddff]){2}",P="[\\ud800-\\udbff][\\udc00-\\udfff]",j="\\u200d",W=w+"?",F="["+f+"]?",M="(?:"+j+"(?:"+[I,A,P].join("|")+")"+F+W+")*",X=F+W+M,Y="(?:"+[I+E+"?",E,A,P,_].join("|")+")",J=RegExp(T+"(?="+T+")|"+Y+X,"g");function re(z){return z.match(J)||[]}return y1=re,y1}var E1,xq;function hfe(){if(xq)return E1;xq=1;var i=ufe(),n=Y7(),o=dfe();function s(u){return n(u)?o(u):i(u)}return E1=s,E1}var S1,kq;function pfe(){if(kq)return S1;kq=1;var i=lfe(),n=Y7(),o=hfe(),s=q7();function u(f){return function(_){_=s(_);var E=n(_)?o(_):void 0,T=E?E[0]:_.charAt(0),w=E?i(E,1).join(""):_.slice(1);return T[f]()+w}}return S1=u,S1}var b1,Lq;function ffe(){if(Lq)return b1;Lq=1;var i=pfe(),n=i("toUpperCase");return b1=n,b1}var mfe=ffe();const OC=Yr(mfe);function wn(i){return function(){return i}}const X7=Math.cos,ER=Math.sin,cc=Math.sqrt,SR=Math.PI,IC=2*SR,AL=Math.PI,OL=2*AL,Dp=1e-6,gfe=OL-Dp;function J7(i){this._+=i[0];for(let n=1,o=i.length;n<o;++n)this._+=arguments[n]+i[n]}function _fe(i){let n=Math.floor(i);if(!(n>=0))throw new Error(`invalid digits: ${i}`);if(n>15)return J7;const o=10**n;return function(s){this._+=s[0];for(let u=1,f=s.length;u<f;++u)this._+=Math.round(arguments[u]*o)/o+s[u]}}class vfe{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?J7:_fe(n)}moveTo(n,o){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+o}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,o){this._append`L${this._x1=+n},${this._y1=+o}`}quadraticCurveTo(n,o,s,u){this._append`Q${+n},${+o},${this._x1=+s},${this._y1=+u}`}bezierCurveTo(n,o,s,u,f,_){this._append`C${+n},${+o},${+s},${+u},${this._x1=+f},${this._y1=+_}`}arcTo(n,o,s,u,f){if(n=+n,o=+o,s=+s,u=+u,f=+f,f<0)throw new Error(`negative radius: ${f}`);let _=this._x1,E=this._y1,T=s-n,w=u-o,I=_-n,A=E-o,P=I*I+A*A;if(this._x1===null)this._append`M${this._x1=n},${this._y1=o}`;else if(P>Dp)if(!(Math.abs(A*T-w*I)>Dp)||!f)this._append`L${this._x1=n},${this._y1=o}`;else{let j=s-_,W=u-E,F=T*T+w*w,M=j*j+W*W,X=Math.sqrt(F),Y=Math.sqrt(P),J=f*Math.tan((AL-Math.acos((F+P-M)/(2*X*Y)))/2),re=J/Y,z=J/X;Math.abs(re-1)>Dp&&this._append`L${n+re*I},${o+re*A}`,this._append`A${f},${f},0,0,${+(A*j>I*W)},${this._x1=n+z*T},${this._y1=o+z*w}`}}arc(n,o,s,u,f,_){if(n=+n,o=+o,s=+s,_=!!_,s<0)throw new Error(`negative radius: ${s}`);let E=s*Math.cos(u),T=s*Math.sin(u),w=n+E,I=o+T,A=1^_,P=_?u-f:f-u;this._x1===null?this._append`M${w},${I}`:(Math.abs(this._x1-w)>Dp||Math.abs(this._y1-I)>Dp)&&this._append`L${w},${I}`,s&&(P<0&&(P=P%OL+OL),P>gfe?this._append`A${s},${s},0,1,${A},${n-E},${o-T}A${s},${s},0,1,${A},${this._x1=w},${this._y1=I}`:P>Dp&&this._append`A${s},${s},0,${+(P>=AL)},${A},${this._x1=n+s*Math.cos(f)},${this._y1=o+s*Math.sin(f)}`)}rect(n,o,s,u){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+o}h${s=+s}v${+u}h${-s}Z`}toString(){return this._}}function n2(i){let n=3;return i.digits=function(o){if(!arguments.length)return n;if(o==null)n=null;else{const s=Math.floor(o);if(!(s>=0))throw new RangeError(`invalid digits: ${o}`);n=s}return i},()=>new vfe(n)}function i2(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Q7(i){this._context=i}Q7.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 1:this._point=2;default:this._context.lineTo(i,n);break}}};function NC(i){return new Q7(i)}function Z7(i){return i[0]}function eX(i){return i[1]}function tX(i,n){var o=wn(!0),s=null,u=NC,f=null,_=n2(E);i=typeof i=="function"?i:i===void 0?Z7:wn(i),n=typeof n=="function"?n:n===void 0?eX:wn(n);function E(T){var w,I=(T=i2(T)).length,A,P=!1,j;for(s==null&&(f=u(j=_())),w=0;w<=I;++w)!(w<I&&o(A=T[w],w,T))===P&&((P=!P)?f.lineStart():f.lineEnd()),P&&f.point(+i(A,w,T),+n(A,w,T));if(j)return f=null,j+""||null}return E.x=function(T){return arguments.length?(i=typeof T=="function"?T:wn(+T),E):i},E.y=function(T){return arguments.length?(n=typeof T=="function"?T:wn(+T),E):n},E.defined=function(T){return arguments.length?(o=typeof T=="function"?T:wn(!!T),E):o},E.curve=function(T){return arguments.length?(u=T,s!=null&&(f=u(s)),E):u},E.context=function(T){return arguments.length?(T==null?s=f=null:f=u(s=T),E):s},E}function eR(i,n,o){var s=null,u=wn(!0),f=null,_=NC,E=null,T=n2(w);i=typeof i=="function"?i:i===void 0?Z7:wn(+i),n=typeof n=="function"?n:wn(n===void 0?0:+n),o=typeof o=="function"?o:o===void 0?eX:wn(+o);function w(A){var P,j,W,F=(A=i2(A)).length,M,X=!1,Y,J=new Array(F),re=new Array(F);for(f==null&&(E=_(Y=T())),P=0;P<=F;++P){if(!(P<F&&u(M=A[P],P,A))===X)if(X=!X)j=P,E.areaStart(),E.lineStart();else{for(E.lineEnd(),E.lineStart(),W=P-1;W>=j;--W)E.point(J[W],re[W]);E.lineEnd(),E.areaEnd()}X&&(J[P]=+i(M,P,A),re[P]=+n(M,P,A),E.point(s?+s(M,P,A):J[P],o?+o(M,P,A):re[P]))}if(Y)return E=null,Y+""||null}function I(){return tX().defined(u).curve(_).context(f)}return w.x=function(A){return arguments.length?(i=typeof A=="function"?A:wn(+A),s=null,w):i},w.x0=function(A){return arguments.length?(i=typeof A=="function"?A:wn(+A),w):i},w.x1=function(A){return arguments.length?(s=A==null?null:typeof A=="function"?A:wn(+A),w):s},w.y=function(A){return arguments.length?(n=typeof A=="function"?A:wn(+A),o=null,w):n},w.y0=function(A){return arguments.length?(n=typeof A=="function"?A:wn(+A),w):n},w.y1=function(A){return arguments.length?(o=A==null?null:typeof A=="function"?A:wn(+A),w):o},w.lineX0=w.lineY0=function(){return I().x(i).y(n)},w.lineY1=function(){return I().x(i).y(o)},w.lineX1=function(){return I().x(s).y(n)},w.defined=function(A){return arguments.length?(u=typeof A=="function"?A:wn(!!A),w):u},w.curve=function(A){return arguments.length?(_=A,f!=null&&(E=_(f)),w):_},w.context=function(A){return arguments.length?(A==null?f=E=null:E=_(f=A),w):f},w}class rX{constructor(n,o){this._context=n,this._x=o}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,o){switch(n=+n,o=+o,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,o,n,o):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+o)/2,n,this._y0,n,o);break}}this._x0=n,this._y0=o}}function yfe(i){return new rX(i,!0)}function Efe(i){return new rX(i,!1)}const a2={draw(i,n){const o=cc(n/SR);i.moveTo(o,0),i.arc(0,0,o,0,IC)}},Sfe={draw(i,n){const o=cc(n/5)/2;i.moveTo(-3*o,-o),i.lineTo(-o,-o),i.lineTo(-o,-3*o),i.lineTo(o,-3*o),i.lineTo(o,-o),i.lineTo(3*o,-o),i.lineTo(3*o,o),i.lineTo(o,o),i.lineTo(o,3*o),i.lineTo(-o,3*o),i.lineTo(-o,o),i.lineTo(-3*o,o),i.closePath()}},nX=cc(1/3),bfe=nX*2,Tfe={draw(i,n){const o=cc(n/bfe),s=o*nX;i.moveTo(0,-o),i.lineTo(s,0),i.lineTo(0,o),i.lineTo(-s,0),i.closePath()}},wfe={draw(i,n){const o=cc(n),s=-o/2;i.rect(s,s,o,o)}},Rfe=.8908130915292852,iX=ER(SR/10)/ER(7*SR/10),Cfe=ER(IC/10)*iX,Afe=-X7(IC/10)*iX,Ofe={draw(i,n){const o=cc(n*Rfe),s=Cfe*o,u=Afe*o;i.moveTo(0,-o),i.lineTo(s,u);for(let f=1;f<5;++f){const _=IC*f/5,E=X7(_),T=ER(_);i.lineTo(T*o,-E*o),i.lineTo(E*s-T*u,T*s+E*u)}i.closePath()}},T1=cc(3),Ife={draw(i,n){const o=-cc(n/(T1*3));i.moveTo(0,o*2),i.lineTo(-T1*o,-o),i.lineTo(T1*o,-o),i.closePath()}},ms=-.5,gs=cc(3)/2,IL=1/cc(12),Nfe=(IL/2+1)*3,Pfe={draw(i,n){const o=cc(n/Nfe),s=o/2,u=o*IL,f=s,_=o*IL+o,E=-f,T=_;i.moveTo(s,u),i.lineTo(f,_),i.lineTo(E,T),i.lineTo(ms*s-gs*u,gs*s+ms*u),i.lineTo(ms*f-gs*_,gs*f+ms*_),i.lineTo(ms*E-gs*T,gs*E+ms*T),i.lineTo(ms*s+gs*u,ms*u-gs*s),i.lineTo(ms*f+gs*_,ms*_-gs*f),i.lineTo(ms*E+gs*T,ms*T-gs*E),i.closePath()}};function Dfe(i,n){let o=null,s=n2(u);i=typeof i=="function"?i:wn(i||a2),n=typeof n=="function"?n:wn(n===void 0?64:+n);function u(){let f;if(o||(o=f=s()),i.apply(this,arguments).draw(o,+n.apply(this,arguments)),f)return o=null,f+""||null}return u.type=function(f){return arguments.length?(i=typeof f=="function"?f:wn(f),u):i},u.size=function(f){return arguments.length?(n=typeof f=="function"?f:wn(+f),u):n},u.context=function(f){return arguments.length?(o=f??null,u):o},u}function bR(){}function TR(i,n,o){i._context.bezierCurveTo((2*i._x0+i._x1)/3,(2*i._y0+i._y1)/3,(i._x0+2*i._x1)/3,(i._y0+2*i._y1)/3,(i._x0+4*i._x1+n)/6,(i._y0+4*i._y1+o)/6)}function aX(i){this._context=i}aX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:TR(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:TR(this,i,n);break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n}};function xfe(i){return new aX(i)}function oX(i){this._context=i}oX.prototype={areaStart:bR,areaEnd:bR,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1,this._x2=i,this._y2=n;break;case 1:this._point=2,this._x3=i,this._y3=n;break;case 2:this._point=3,this._x4=i,this._y4=n,this._context.moveTo((this._x0+4*this._x1+i)/6,(this._y0+4*this._y1+n)/6);break;default:TR(this,i,n);break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n}};function kfe(i){return new oX(i)}function sX(i){this._context=i}sX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var o=(this._x0+4*this._x1+i)/6,s=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(o,s):this._context.moveTo(o,s);break;case 3:this._point=4;default:TR(this,i,n);break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n}};function Lfe(i){return new sX(i)}function cX(i){this._context=i}cX.prototype={areaStart:bR,areaEnd:bR,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(i,n){i=+i,n=+n,this._point?this._context.lineTo(i,n):(this._point=1,this._context.moveTo(i,n))}};function Mfe(i){return new cX(i)}function Mq(i){return i<0?-1:1}function Uq(i,n,o){var s=i._x1-i._x0,u=n-i._x1,f=(i._y1-i._y0)/(s||u<0&&-0),_=(o-i._y1)/(u||s<0&&-0),E=(f*u+_*s)/(s+u);return(Mq(f)+Mq(_))*Math.min(Math.abs(f),Math.abs(_),.5*Math.abs(E))||0}function jq(i,n){var o=i._x1-i._x0;return o?(3*(i._y1-i._y0)/o-n)/2:n}function w1(i,n,o){var s=i._x0,u=i._y0,f=i._x1,_=i._y1,E=(f-s)/3;i._context.bezierCurveTo(s+E,u+E*n,f-E,_-E*o,f,_)}function wR(i){this._context=i}wR.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:w1(this,this._t0,jq(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,n){var o=NaN;if(i=+i,n=+n,!(i===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 1:this._point=2;break;case 2:this._point=3,w1(this,jq(this,o=Uq(this,i,n)),o);break;default:w1(this,this._t0,o=Uq(this,i,n));break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n,this._t0=o}}};function lX(i){this._context=new uX(i)}(lX.prototype=Object.create(wR.prototype)).point=function(i,n){wR.prototype.point.call(this,n,i)};function uX(i){this._context=i}uX.prototype={moveTo:function(i,n){this._context.moveTo(n,i)},closePath:function(){this._context.closePath()},lineTo:function(i,n){this._context.lineTo(n,i)},bezierCurveTo:function(i,n,o,s,u,f){this._context.bezierCurveTo(n,i,s,o,f,u)}};function Ufe(i){return new wR(i)}function jfe(i){return new lX(i)}function dX(i){this._context=i}dX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var i=this._x,n=this._y,o=i.length;if(o)if(this._line?this._context.lineTo(i[0],n[0]):this._context.moveTo(i[0],n[0]),o===2)this._context.lineTo(i[1],n[1]);else for(var s=Vq(i),u=Vq(n),f=0,_=1;_<o;++f,++_)this._context.bezierCurveTo(s[0][f],u[0][f],s[1][f],u[1][f],i[_],n[_]);(this._line||this._line!==0&&o===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(i,n){this._x.push(+i),this._y.push(+n)}};function Vq(i){var n,o=i.length-1,s,u=new Array(o),f=new Array(o),_=new Array(o);for(u[0]=0,f[0]=2,_[0]=i[0]+2*i[1],n=1;n<o-1;++n)u[n]=1,f[n]=4,_[n]=4*i[n]+2*i[n+1];for(u[o-1]=2,f[o-1]=7,_[o-1]=8*i[o-1]+i[o],n=1;n<o;++n)s=u[n]/f[n-1],f[n]-=s,_[n]-=s*_[n-1];for(u[o-1]=_[o-1]/f[o-1],n=o-2;n>=0;--n)u[n]=(_[n]-u[n+1])/f[n];for(f[o-1]=(i[o]+u[o-1])/2,n=0;n<o-1;++n)f[n]=2*i[n+1]-u[n+1];return[u,f]}function Vfe(i){return new dX(i)}function PC(i,n){this._context=i,this._t=n}PC.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(i,n);else{var o=this._x*(1-this._t)+i*this._t;this._context.lineTo(o,this._y),this._context.lineTo(o,n)}break}}this._x=i,this._y=n}};function Ffe(i){return new PC(i,.5)}function Bfe(i){return new PC(i,0)}function Wfe(i){return new PC(i,1)}function Pg(i,n){if((_=i.length)>1)for(var o=1,s,u,f=i[n[0]],_,E=f.length;o<_;++o)for(u=f,f=i[n[o]],s=0;s<E;++s)f[s][1]+=f[s][0]=isNaN(u[s][1])?u[s][0]:u[s][1]}function NL(i){for(var n=i.length,o=new Array(n);--n>=0;)o[n]=n;return o}function Gfe(i,n){return i[n]}function Hfe(i){const n=[];return n.key=i,n}function qfe(){var i=wn([]),n=NL,o=Pg,s=Gfe;function u(f){var _=Array.from(i.apply(this,arguments),Hfe),E,T=_.length,w=-1,I;for(const A of f)for(E=0,++w;E<T;++E)(_[E][w]=[0,+s(A,_[E].key,w,f)]).data=A;for(E=0,I=i2(n(_));E<T;++E)_[I[E]].index=E;return o(_,I),_}return u.keys=function(f){return arguments.length?(i=typeof f=="function"?f:wn(Array.from(f)),u):i},u.value=function(f){return arguments.length?(s=typeof f=="function"?f:wn(+f),u):s},u.order=function(f){return arguments.length?(n=f==null?NL:typeof f=="function"?f:wn(Array.from(f)),u):n},u.offset=function(f){return arguments.length?(o=f??Pg,u):o},u}function Kfe(i,n){if((s=i.length)>0){for(var o,s,u=0,f=i[0].length,_;u<f;++u){for(_=o=0;o<s;++o)_+=i[o][u][1]||0;if(_)for(o=0;o<s;++o)i[o][u][1]/=_}Pg(i,n)}}function zfe(i,n){if((u=i.length)>0){for(var o=0,s=i[n[0]],u,f=s.length;o<f;++o){for(var _=0,E=0;_<u;++_)E+=i[_][o][1]||0;s[o][1]+=s[o][0]=-E/2}Pg(i,n)}}function $fe(i,n){if(!(!((_=i.length)>0)||!((f=(u=i[n[0]]).length)>0))){for(var o=0,s=1,u,f,_;s<f;++s){for(var E=0,T=0,w=0;E<_;++E){for(var I=i[n[E]],A=I[s][1]||0,P=I[s-1][1]||0,j=(A-P)/2,W=0;W<E;++W){var F=i[n[W]],M=F[s][1]||0,X=F[s-1][1]||0;j+=M-X}T+=A,w+=j*A}u[s-1][1]+=u[s-1][0]=o,T&&(o-=w/T)}u[s-1][1]+=u[s-1][0]=o,Pg(i,n)}}function XE(i){"@babel/helpers - typeof";return XE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},XE(i)}var Yfe=["type","size","sizeType"];function PL(){return PL=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},PL.apply(this,arguments)}function Fq(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Bq(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Fq(Object(o),!0).forEach(function(s){Xfe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Fq(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Xfe(i,n,o){return n=Jfe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function Jfe(i){var n=Qfe(i,"string");return XE(n)=="symbol"?n:n+""}function Qfe(i,n){if(XE(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(XE(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function Zfe(i,n){if(i==null)return{};var o=eme(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function eme(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}var hX={symbolCircle:a2,symbolCross:Sfe,symbolDiamond:Tfe,symbolSquare:wfe,symbolStar:Ofe,symbolTriangle:Ife,symbolWye:Pfe},tme=Math.PI/180,rme=function(n){var o="symbol".concat(OC(n));return hX[o]||a2},nme=function(n,o,s){if(o==="area")return n;switch(s){case"cross":return 5*n*n/9;case"diamond":return .5*n*n/Math.sqrt(3);case"square":return n*n;case"star":{var u=18*tme;return 1.25*n*n*(Math.tan(u)-Math.tan(u*2)*Math.pow(Math.tan(u),2))}case"triangle":return Math.sqrt(3)*n*n/4;case"wye":return(21-10*Math.sqrt(3))*n*n/8;default:return Math.PI*n*n/4}},ime=function(n,o){hX["symbol".concat(OC(n))]=o},o2=function(n){var o=n.type,s=o===void 0?"circle":o,u=n.size,f=u===void 0?64:u,_=n.sizeType,E=_===void 0?"area":_,T=Zfe(n,Yfe),w=Bq(Bq({},T),{},{type:s,size:f,sizeType:E}),I=function(){var M=rme(s),X=Dfe().type(M).size(nme(f,E,s));return X()},A=w.className,P=w.cx,j=w.cy,W=Pt(w,!0);return P===+P&&j===+j&&f===+f?ue.createElement("path",PL({},W,{className:or("recharts-symbols",A),transform:"translate(".concat(P,", ").concat(j,")"),d:I()})):null};o2.registerSymbol=ime;function Dg(i){"@babel/helpers - typeof";return Dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Dg(i)}function DL(){return DL=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},DL.apply(this,arguments)}function Wq(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function ame(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Wq(Object(o),!0).forEach(function(s){JE(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Wq(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ome(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function sme(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,fX(s.key),s)}}function cme(i,n,o){return n&&sme(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function lme(i,n,o){return n=RR(n),ume(i,pX()?Reflect.construct(n,o||[],RR(i).constructor):n.apply(i,o))}function ume(i,n){if(n&&(Dg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dme(i)}function dme(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function pX(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pX=function(){return!!i})()}function RR(i){return RR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},RR(i)}function hme(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&xL(i,n)}function xL(i,n){return xL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},xL(i,n)}function JE(i,n,o){return n=fX(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function fX(i){var n=pme(i,"string");return Dg(n)=="symbol"?n:n+""}function pme(i,n){if(Dg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Dg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var tc=32,s2=function(i){function n(){return ome(this,n),lme(this,n,arguments)}return hme(n,i),cme(n,[{key:"renderIcon",value:function(s){var u=this.props.inactiveColor,f=tc/2,_=tc/6,E=tc/3,T=s.inactive?u:s.color;if(s.type==="plainline")return ue.createElement("line",{strokeWidth:4,fill:"none",stroke:T,strokeDasharray:s.payload.strokeDasharray,x1:0,y1:f,x2:tc,y2:f,className:"recharts-legend-icon"});if(s.type==="line")return ue.createElement("path",{strokeWidth:4,fill:"none",stroke:T,d:"M0,".concat(f,"h").concat(E,`
            A`).concat(_,",").concat(_,",0,1,1,").concat(2*E,",").concat(f,`
            H`).concat(tc,"M").concat(2*E,",").concat(f,`
            A`).concat(_,",").concat(_,",0,1,1,").concat(E,",").concat(f),className:"recharts-legend-icon"});if(s.type==="rect")return ue.createElement("path",{stroke:"none",fill:T,d:"M0,".concat(tc/8,"h").concat(tc,"v").concat(tc*3/4,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(ue.isValidElement(s.legendIcon)){var w=ame({},s);return delete w.legendIcon,ue.cloneElement(s.legendIcon,w)}return ue.createElement(o2,{fill:T,cx:f,cy:f,size:tc,sizeType:"diameter",type:s.type})}},{key:"renderItems",value:function(){var s=this,u=this.props,f=u.payload,_=u.iconSize,E=u.layout,T=u.formatter,w=u.inactiveColor,I={x:0,y:0,width:tc,height:tc},A={display:E==="horizontal"?"inline-block":"block",marginRight:10},P={display:"inline-block",verticalAlign:"middle",marginRight:4};return f.map(function(j,W){var F=j.formatter||T,M=or(JE(JE({"recharts-legend-item":!0},"legend-item-".concat(W),!0),"inactive",j.inactive));if(j.type==="none")return null;var X=zt(j.value)?null:j.value;oc(!zt(j.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var Y=j.inactive?w:j.color;return ue.createElement("li",DL({className:M,style:A,key:"legend-item-".concat(W)},Gp(s.props,j,W)),ue.createElement(RL,{width:_,height:_,viewBox:I,style:P},s.renderIcon(j)),ue.createElement("span",{className:"recharts-legend-item-text",style:{color:Y}},F?F(X,j,W):X))})}},{key:"render",value:function(){var s=this.props,u=s.payload,f=s.layout,_=s.align;if(!u||!u.length)return null;var E={padding:0,margin:0,textAlign:f==="horizontal"?_:"left"};return ue.createElement("ul",{className:"recharts-default-legend",style:E},this.renderItems())}}])}(Ee.PureComponent);JE(s2,"displayName","Legend");JE(s2,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var R1,Gq;function fme(){if(Gq)return R1;Gq=1;var i=RC();function n(){this.__data__=new i,this.size=0}return R1=n,R1}var C1,Hq;function mme(){if(Hq)return C1;Hq=1;function i(n){var o=this.__data__,s=o.delete(n);return this.size=o.size,s}return C1=i,C1}var A1,qq;function gme(){if(qq)return A1;qq=1;function i(n){return this.__data__.get(n)}return A1=i,A1}var O1,Kq;function _me(){if(Kq)return O1;Kq=1;function i(n){return this.__data__.has(n)}return O1=i,O1}var I1,zq;function vme(){if(zq)return I1;zq=1;var i=RC(),n=JM(),o=QM(),s=200;function u(f,_){var E=this.__data__;if(E instanceof i){var T=E.__data__;if(!n||T.length<s-1)return T.push([f,_]),this.size=++E.size,this;E=this.__data__=new o(T)}return E.set(f,_),this.size=E.size,this}return I1=u,I1}var N1,$q;function mX(){if($q)return N1;$q=1;var i=RC(),n=fme(),o=mme(),s=gme(),u=_me(),f=vme();function _(E){var T=this.__data__=new i(E);this.size=T.size}return _.prototype.clear=n,_.prototype.delete=o,_.prototype.get=s,_.prototype.has=u,_.prototype.set=f,N1=_,N1}var P1,Yq;function yme(){if(Yq)return P1;Yq=1;var i="__lodash_hash_undefined__";function n(o){return this.__data__.set(o,i),this}return P1=n,P1}var D1,Xq;function Eme(){if(Xq)return D1;Xq=1;function i(n){return this.__data__.has(n)}return D1=i,D1}var x1,Jq;function gX(){if(Jq)return x1;Jq=1;var i=QM(),n=yme(),o=Eme();function s(u){var f=-1,_=u==null?0:u.length;for(this.__data__=new i;++f<_;)this.add(u[f])}return s.prototype.add=s.prototype.push=n,s.prototype.has=o,x1=s,x1}var k1,Qq;function _X(){if(Qq)return k1;Qq=1;function i(n,o){for(var s=-1,u=n==null?0:n.length;++s<u;)if(o(n[s],s,n))return!0;return!1}return k1=i,k1}var L1,Zq;function vX(){if(Zq)return L1;Zq=1;function i(n,o){return n.has(o)}return L1=i,L1}var M1,eK;function yX(){if(eK)return M1;eK=1;var i=gX(),n=_X(),o=vX(),s=1,u=2;function f(_,E,T,w,I,A){var P=T&s,j=_.length,W=E.length;if(j!=W&&!(P&&W>j))return!1;var F=A.get(_),M=A.get(E);if(F&&M)return F==E&&M==_;var X=-1,Y=!0,J=T&u?new i:void 0;for(A.set(_,E),A.set(E,_);++X<j;){var re=_[X],z=E[X];if(w)var Z=P?w(z,re,X,E,_,A):w(re,z,X,_,E,A);if(Z!==void 0){if(Z)continue;Y=!1;break}if(J){if(!n(E,function(ie,de){if(!o(J,de)&&(re===ie||I(re,ie,T,w,A)))return J.push(de)})){Y=!1;break}}else if(!(re===z||I(re,z,T,w,A))){Y=!1;break}}return A.delete(_),A.delete(E),Y}return M1=f,M1}var U1,tK;function Sme(){if(tK)return U1;tK=1;var i=pl(),n=i.Uint8Array;return U1=n,U1}var j1,rK;function bme(){if(rK)return j1;rK=1;function i(n){var o=-1,s=Array(n.size);return n.forEach(function(u,f){s[++o]=[f,u]}),s}return j1=i,j1}var V1,nK;function c2(){if(nK)return V1;nK=1;function i(n){var o=-1,s=Array(n.size);return n.forEach(function(u){s[++o]=u}),s}return V1=i,V1}var F1,iK;function Tme(){if(iK)return F1;iK=1;var i=kS(),n=Sme(),o=XM(),s=yX(),u=bme(),f=c2(),_=1,E=2,T="[object Boolean]",w="[object Date]",I="[object Error]",A="[object Map]",P="[object Number]",j="[object RegExp]",W="[object Set]",F="[object String]",M="[object Symbol]",X="[object ArrayBuffer]",Y="[object DataView]",J=i?i.prototype:void 0,re=J?J.valueOf:void 0;function z(Z,ie,de,ge,Oe,me,ye){switch(de){case Y:if(Z.byteLength!=ie.byteLength||Z.byteOffset!=ie.byteOffset)return!1;Z=Z.buffer,ie=ie.buffer;case X:return!(Z.byteLength!=ie.byteLength||!me(new n(Z),new n(ie)));case T:case w:case P:return o(+Z,+ie);case I:return Z.name==ie.name&&Z.message==ie.message;case j:case F:return Z==ie+"";case A:var Ae=u;case W:var be=ge&_;if(Ae||(Ae=f),Z.size!=ie.size&&!be)return!1;var ke=ye.get(Z);if(ke)return ke==ie;ge|=E,ye.set(Z,ie);var Me=s(Ae(Z),Ae(ie),ge,Oe,me,ye);return ye.delete(Z),Me;case M:if(re)return re.call(Z)==re.call(ie)}return!1}return F1=z,F1}var B1,aK;function EX(){if(aK)return B1;aK=1;function i(n,o){for(var s=-1,u=o.length,f=n.length;++s<u;)n[f+s]=o[s];return n}return B1=i,B1}var W1,oK;function wme(){if(oK)return W1;oK=1;var i=EX(),n=so();function o(s,u,f){var _=u(s);return n(s)?_:i(_,f(s))}return W1=o,W1}var G1,sK;function Rme(){if(sK)return G1;sK=1;function i(n,o){for(var s=-1,u=n==null?0:n.length,f=0,_=[];++s<u;){var E=n[s];o(E,s,n)&&(_[f++]=E)}return _}return G1=i,G1}var H1,cK;function Cme(){if(cK)return H1;cK=1;function i(){return[]}return H1=i,H1}var q1,lK;function Ame(){if(lK)return q1;lK=1;var i=Rme(),n=Cme(),o=Object.prototype,s=o.propertyIsEnumerable,u=Object.getOwnPropertySymbols,f=u?function(_){return _==null?[]:(_=Object(_),i(u(_),function(E){return s.call(_,E)}))}:n;return q1=f,q1}var K1,uK;function Ome(){if(uK)return K1;uK=1;function i(n,o){for(var s=-1,u=Array(n);++s<n;)u[s]=o(s);return u}return K1=i,K1}var z1,dK;function Ime(){if(dK)return z1;dK=1;var i=gu(),n=_u(),o="[object Arguments]";function s(u){return n(u)&&i(u)==o}return z1=s,z1}var $1,hK;function l2(){if(hK)return $1;hK=1;var i=Ime(),n=_u(),o=Object.prototype,s=o.hasOwnProperty,u=o.propertyIsEnumerable,f=i(function(){return arguments}())?i:function(_){return n(_)&&s.call(_,"callee")&&!u.call(_,"callee")};return $1=f,$1}var jE={exports:{}},Y1,pK;function Nme(){if(pK)return Y1;pK=1;function i(){return!1}return Y1=i,Y1}jE.exports;var fK;function SX(){return fK||(fK=1,function(i,n){var o=pl(),s=Nme(),u=n&&!n.nodeType&&n,f=u&&!0&&i&&!i.nodeType&&i,_=f&&f.exports===u,E=_?o.Buffer:void 0,T=E?E.isBuffer:void 0,w=T||s;i.exports=w}(jE,jE.exports)),jE.exports}var X1,mK;function u2(){if(mK)return X1;mK=1;var i=9007199254740991,n=/^(?:0|[1-9]\d*)$/;function o(s,u){var f=typeof s;return u=u??i,!!u&&(f=="number"||f!="symbol"&&n.test(s))&&s>-1&&s%1==0&&s<u}return X1=o,X1}var J1,gK;function d2(){if(gK)return J1;gK=1;var i=9007199254740991;function n(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=i}return J1=n,J1}var Q1,_K;function Pme(){if(_K)return Q1;_K=1;var i=gu(),n=d2(),o=_u(),s="[object Arguments]",u="[object Array]",f="[object Boolean]",_="[object Date]",E="[object Error]",T="[object Function]",w="[object Map]",I="[object Number]",A="[object Object]",P="[object RegExp]",j="[object Set]",W="[object String]",F="[object WeakMap]",M="[object ArrayBuffer]",X="[object DataView]",Y="[object Float32Array]",J="[object Float64Array]",re="[object Int8Array]",z="[object Int16Array]",Z="[object Int32Array]",ie="[object Uint8Array]",de="[object Uint8ClampedArray]",ge="[object Uint16Array]",Oe="[object Uint32Array]",me={};me[Y]=me[J]=me[re]=me[z]=me[Z]=me[ie]=me[de]=me[ge]=me[Oe]=!0,me[s]=me[u]=me[M]=me[f]=me[X]=me[_]=me[E]=me[T]=me[w]=me[I]=me[A]=me[P]=me[j]=me[W]=me[F]=!1;function ye(Ae){return o(Ae)&&n(Ae.length)&&!!me[i(Ae)]}return Q1=ye,Q1}var Z1,vK;function bX(){if(vK)return Z1;vK=1;function i(n){return function(o){return n(o)}}return Z1=i,Z1}var VE={exports:{}};VE.exports;var yK;function Dme(){return yK||(yK=1,function(i,n){var o=W7(),s=n&&!n.nodeType&&n,u=s&&!0&&i&&!i.nodeType&&i,f=u&&u.exports===s,_=f&&o.process,E=function(){try{var T=u&&u.require&&u.require("util").types;return T||_&&_.binding&&_.binding("util")}catch{}}();i.exports=E}(VE,VE.exports)),VE.exports}var ex,EK;function TX(){if(EK)return ex;EK=1;var i=Pme(),n=bX(),o=Dme(),s=o&&o.isTypedArray,u=s?n(s):i;return ex=u,ex}var tx,SK;function xme(){if(SK)return tx;SK=1;var i=Ome(),n=l2(),o=so(),s=SX(),u=u2(),f=TX(),_=Object.prototype,E=_.hasOwnProperty;function T(w,I){var A=o(w),P=!A&&n(w),j=!A&&!P&&s(w),W=!A&&!P&&!j&&f(w),F=A||P||j||W,M=F?i(w.length,String):[],X=M.length;for(var Y in w)(I||E.call(w,Y))&&!(F&&(Y=="length"||j&&(Y=="offset"||Y=="parent")||W&&(Y=="buffer"||Y=="byteLength"||Y=="byteOffset")||u(Y,X)))&&M.push(Y);return M}return tx=T,tx}var rx,bK;function kme(){if(bK)return rx;bK=1;var i=Object.prototype;function n(o){var s=o&&o.constructor,u=typeof s=="function"&&s.prototype||i;return o===u}return rx=n,rx}var nx,TK;function wX(){if(TK)return nx;TK=1;function i(n,o){return function(s){return n(o(s))}}return nx=i,nx}var ix,wK;function Lme(){if(wK)return ix;wK=1;var i=wX(),n=i(Object.keys,Object);return ix=n,ix}var ax,RK;function Mme(){if(RK)return ax;RK=1;var i=kme(),n=Lme(),o=Object.prototype,s=o.hasOwnProperty;function u(f){if(!i(f))return n(f);var _=[];for(var E in Object(f))s.call(f,E)&&E!="constructor"&&_.push(E);return _}return ax=u,ax}var ox,CK;function US(){if(CK)return ox;CK=1;var i=YM(),n=d2();function o(s){return s!=null&&n(s.length)&&!i(s)}return ox=o,ox}var sx,AK;function DC(){if(AK)return sx;AK=1;var i=xme(),n=Mme(),o=US();function s(u){return o(u)?i(u):n(u)}return sx=s,sx}var cx,OK;function Ume(){if(OK)return cx;OK=1;var i=wme(),n=Ame(),o=DC();function s(u){return i(u,o,n)}return cx=s,cx}var lx,IK;function jme(){if(IK)return lx;IK=1;var i=Ume(),n=1,o=Object.prototype,s=o.hasOwnProperty;function u(f,_,E,T,w,I){var A=E&n,P=i(f),j=P.length,W=i(_),F=W.length;if(j!=F&&!A)return!1;for(var M=j;M--;){var X=P[M];if(!(A?X in _:s.call(_,X)))return!1}var Y=I.get(f),J=I.get(_);if(Y&&J)return Y==_&&J==f;var re=!0;I.set(f,_),I.set(_,f);for(var z=A;++M<j;){X=P[M];var Z=f[X],ie=_[X];if(T)var de=A?T(ie,Z,X,_,f,I):T(Z,ie,X,f,_,I);if(!(de===void 0?Z===ie||w(Z,ie,E,T,I):de)){re=!1;break}z||(z=X=="constructor")}if(re&&!z){var ge=f.constructor,Oe=_.constructor;ge!=Oe&&"constructor"in f&&"constructor"in _&&!(typeof ge=="function"&&ge instanceof ge&&typeof Oe=="function"&&Oe instanceof Oe)&&(re=!1)}return I.delete(f),I.delete(_),re}return lx=u,lx}var ux,NK;function Vme(){if(NK)return ux;NK=1;var i=$p(),n=pl(),o=i(n,"DataView");return ux=o,ux}var dx,PK;function Fme(){if(PK)return dx;PK=1;var i=$p(),n=pl(),o=i(n,"Promise");return dx=o,dx}var hx,DK;function RX(){if(DK)return hx;DK=1;var i=$p(),n=pl(),o=i(n,"Set");return hx=o,hx}var px,xK;function Bme(){if(xK)return px;xK=1;var i=$p(),n=pl(),o=i(n,"WeakMap");return px=o,px}var fx,kK;function Wme(){if(kK)return fx;kK=1;var i=Vme(),n=JM(),o=Fme(),s=RX(),u=Bme(),f=gu(),_=G7(),E="[object Map]",T="[object Object]",w="[object Promise]",I="[object Set]",A="[object WeakMap]",P="[object DataView]",j=_(i),W=_(n),F=_(o),M=_(s),X=_(u),Y=f;return(i&&Y(new i(new ArrayBuffer(1)))!=P||n&&Y(new n)!=E||o&&Y(o.resolve())!=w||s&&Y(new s)!=I||u&&Y(new u)!=A)&&(Y=function(J){var re=f(J),z=re==T?J.constructor:void 0,Z=z?_(z):"";if(Z)switch(Z){case j:return P;case W:return E;case F:return w;case M:return I;case X:return A}return re}),fx=Y,fx}var mx,LK;function Gme(){if(LK)return mx;LK=1;var i=mX(),n=yX(),o=Tme(),s=jme(),u=Wme(),f=so(),_=SX(),E=TX(),T=1,w="[object Arguments]",I="[object Array]",A="[object Object]",P=Object.prototype,j=P.hasOwnProperty;function W(F,M,X,Y,J,re){var z=f(F),Z=f(M),ie=z?I:u(F),de=Z?I:u(M);ie=ie==w?A:ie,de=de==w?A:de;var ge=ie==A,Oe=de==A,me=ie==de;if(me&&_(F)){if(!_(M))return!1;z=!0,ge=!1}if(me&&!ge)return re||(re=new i),z||E(F)?n(F,M,X,Y,J,re):o(F,M,ie,X,Y,J,re);if(!(X&T)){var ye=ge&&j.call(F,"__wrapped__"),Ae=Oe&&j.call(M,"__wrapped__");if(ye||Ae){var be=ye?F.value():F,ke=Ae?M.value():M;return re||(re=new i),J(be,ke,X,Y,re)}}return me?(re||(re=new i),s(F,M,X,Y,J,re)):!1}return mx=W,mx}var gx,MK;function h2(){if(MK)return gx;MK=1;var i=Gme(),n=_u();function o(s,u,f,_,E){return s===u?!0:s==null||u==null||!n(s)&&!n(u)?s!==s&&u!==u:i(s,u,f,_,o,E)}return gx=o,gx}var _x,UK;function Hme(){if(UK)return _x;UK=1;var i=mX(),n=h2(),o=1,s=2;function u(f,_,E,T){var w=E.length,I=w,A=!T;if(f==null)return!I;for(f=Object(f);w--;){var P=E[w];if(A&&P[2]?P[1]!==f[P[0]]:!(P[0]in f))return!1}for(;++w<I;){P=E[w];var j=P[0],W=f[j],F=P[1];if(A&&P[2]){if(W===void 0&&!(j in f))return!1}else{var M=new i;if(T)var X=T(W,F,j,f,_,M);if(!(X===void 0?n(F,W,o|s,T,M):X))return!1}}return!0}return _x=u,_x}var vx,jK;function CX(){if(jK)return vx;jK=1;var i=Hd();function n(o){return o===o&&!i(o)}return vx=n,vx}var yx,VK;function qme(){if(VK)return yx;VK=1;var i=CX(),n=DC();function o(s){for(var u=n(s),f=u.length;f--;){var _=u[f],E=s[_];u[f]=[_,E,i(E)]}return u}return yx=o,yx}var Ex,FK;function AX(){if(FK)return Ex;FK=1;function i(n,o){return function(s){return s==null?!1:s[n]===o&&(o!==void 0||n in Object(s))}}return Ex=i,Ex}var Sx,BK;function Kme(){if(BK)return Sx;BK=1;var i=Hme(),n=qme(),o=AX();function s(u){var f=n(u);return f.length==1&&f[0][2]?o(f[0][0],f[0][1]):function(_){return _===u||i(_,u,f)}}return Sx=s,Sx}var bx,WK;function zme(){if(WK)return bx;WK=1;function i(n,o){return n!=null&&o in Object(n)}return bx=i,bx}var Tx,GK;function $me(){if(GK)return Tx;GK=1;var i=K7(),n=l2(),o=so(),s=u2(),u=d2(),f=AC();function _(E,T,w){T=i(T,E);for(var I=-1,A=T.length,P=!1;++I<A;){var j=f(T[I]);if(!(P=E!=null&&w(E,j)))break;E=E[j]}return P||++I!=A?P:(A=E==null?0:E.length,!!A&&u(A)&&s(j,A)&&(o(E)||n(E)))}return Tx=_,Tx}var wx,HK;function Yme(){if(HK)return wx;HK=1;var i=zme(),n=$me();function o(s,u){return s!=null&&n(s,u,i)}return wx=o,wx}var Rx,qK;function Xme(){if(qK)return Rx;qK=1;var i=h2(),n=z7(),o=Yme(),s=$M(),u=CX(),f=AX(),_=AC(),E=1,T=2;function w(I,A){return s(I)&&u(A)?f(_(I),A):function(P){var j=n(P,I);return j===void 0&&j===A?o(P,I):i(A,j,E|T)}}return Rx=w,Rx}var Cx,KK;function l_(){if(KK)return Cx;KK=1;function i(n){return n}return Cx=i,Cx}var Ax,zK;function Jme(){if(zK)return Ax;zK=1;function i(n){return function(o){return o==null?void 0:o[n]}}return Ax=i,Ax}var Ox,$K;function Qme(){if($K)return Ox;$K=1;var i=e2();function n(o){return function(s){return i(s,o)}}return Ox=n,Ox}var Ix,YK;function Zme(){if(YK)return Ix;YK=1;var i=Jme(),n=Qme(),o=$M(),s=AC();function u(f){return o(f)?i(s(f)):n(f)}return Ix=u,Ix}var Nx,XK;function fl(){if(XK)return Nx;XK=1;var i=Kme(),n=Xme(),o=l_(),s=so(),u=Zme();function f(_){return typeof _=="function"?_:_==null?o:typeof _=="object"?s(_)?n(_[0],_[1]):i(_):u(_)}return Nx=f,Nx}var Px,JK;function OX(){if(JK)return Px;JK=1;function i(n,o,s,u){for(var f=n.length,_=s+(u?1:-1);u?_--:++_<f;)if(o(n[_],_,n))return _;return-1}return Px=i,Px}var Dx,QK;function ege(){if(QK)return Dx;QK=1;function i(n){return n!==n}return Dx=i,Dx}var xx,ZK;function tge(){if(ZK)return xx;ZK=1;function i(n,o,s){for(var u=s-1,f=n.length;++u<f;)if(n[u]===o)return u;return-1}return xx=i,xx}var kx,ez;function rge(){if(ez)return kx;ez=1;var i=OX(),n=ege(),o=tge();function s(u,f,_){return f===f?o(u,f,_):i(u,n,_)}return kx=s,kx}var Lx,tz;function nge(){if(tz)return Lx;tz=1;var i=rge();function n(o,s){var u=o==null?0:o.length;return!!u&&i(o,s,0)>-1}return Lx=n,Lx}var Mx,rz;function ige(){if(rz)return Mx;rz=1;function i(n,o,s){for(var u=-1,f=n==null?0:n.length;++u<f;)if(s(o,n[u]))return!0;return!1}return Mx=i,Mx}var Ux,nz;function age(){if(nz)return Ux;nz=1;function i(){}return Ux=i,Ux}var jx,iz;function oge(){if(iz)return jx;iz=1;var i=RX(),n=age(),o=c2(),s=1/0,u=i&&1/o(new i([,-0]))[1]==s?function(f){return new i(f)}:n;return jx=u,jx}var Vx,az;function sge(){if(az)return Vx;az=1;var i=gX(),n=nge(),o=ige(),s=vX(),u=oge(),f=c2(),_=200;function E(T,w,I){var A=-1,P=n,j=T.length,W=!0,F=[],M=F;if(I)W=!1,P=o;else if(j>=_){var X=w?null:u(T);if(X)return f(X);W=!1,P=s,M=new i}else M=w?[]:F;e:for(;++A<j;){var Y=T[A],J=w?w(Y):Y;if(Y=I||Y!==0?Y:0,W&&J===J){for(var re=M.length;re--;)if(M[re]===J)continue e;w&&M.push(J),F.push(Y)}else P(M,J,I)||(M!==F&&M.push(J),F.push(Y))}return F}return Vx=E,Vx}var Fx,oz;function cge(){if(oz)return Fx;oz=1;var i=fl(),n=sge();function o(s,u){return s&&s.length?n(s,i(u,2)):[]}return Fx=o,Fx}var lge=cge();const sz=Yr(lge);function IX(i,n,o){return n===!0?sz(i,o):zt(n)?sz(i,n):i}function xg(i){"@babel/helpers - typeof";return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xg(i)}var uge=["ref"];function cz(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function tu(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?cz(Object(o),!0).forEach(function(s){xC(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):cz(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function dge(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function lz(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,PX(s.key),s)}}function hge(i,n,o){return n&&lz(i.prototype,n),o&&lz(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function pge(i,n,o){return n=CR(n),fge(i,NX()?Reflect.construct(n,o||[],CR(i).constructor):n.apply(i,o))}function fge(i,n){if(n&&(xg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mge(i)}function mge(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function NX(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NX=function(){return!!i})()}function CR(i){return CR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},CR(i)}function gge(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&kL(i,n)}function kL(i,n){return kL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},kL(i,n)}function xC(i,n,o){return n=PX(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function PX(i){var n=_ge(i,"string");return xg(n)=="symbol"?n:n+""}function _ge(i,n){if(xg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(xg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function vge(i,n){if(i==null)return{};var o=yge(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function yge(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function Ege(i){return i.value}function Sge(i,n){if(ue.isValidElement(i))return ue.cloneElement(i,n);if(typeof i=="function")return ue.createElement(i,n);n.ref;var o=vge(n,uge);return ue.createElement(s2,o)}var uz=1,Rg=function(i){function n(){var o;dge(this,n);for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];return o=pge(this,n,[].concat(u)),xC(o,"lastBoundingBox",{width:-1,height:-1}),o}return gge(n,i),hge(n,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var s=this.wrapperNode.getBoundingClientRect();return s.height=this.wrapperNode.offsetHeight,s.width=this.wrapperNode.offsetWidth,s}return null}},{key:"updateBBox",value:function(){var s=this.props.onBBoxUpdate,u=this.getBBox();u?(Math.abs(u.width-this.lastBoundingBox.width)>uz||Math.abs(u.height-this.lastBoundingBox.height)>uz)&&(this.lastBoundingBox.width=u.width,this.lastBoundingBox.height=u.height,s&&s(u)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,s&&s(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?tu({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(s){var u=this.props,f=u.layout,_=u.align,E=u.verticalAlign,T=u.margin,w=u.chartWidth,I=u.chartHeight,A,P;if(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))if(_==="center"&&f==="vertical"){var j=this.getBBoxSnapshot();A={left:((w||0)-j.width)/2}}else A=_==="right"?{right:T&&T.right||0}:{left:T&&T.left||0};if(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))if(E==="middle"){var W=this.getBBoxSnapshot();P={top:((I||0)-W.height)/2}}else P=E==="bottom"?{bottom:T&&T.bottom||0}:{top:T&&T.top||0};return tu(tu({},A),P)}},{key:"render",value:function(){var s=this,u=this.props,f=u.content,_=u.width,E=u.height,T=u.wrapperStyle,w=u.payloadUniqBy,I=u.payload,A=tu(tu({position:"absolute",width:_||"auto",height:E||"auto"},this.getDefaultPosition(T)),T);return ue.createElement("div",{className:"recharts-legend-wrapper",style:A,ref:function(j){s.wrapperNode=j}},Sge(f,tu(tu({},this.props),{},{payload:IX(I,w,Ege)})))}}],[{key:"getWithHeight",value:function(s,u){var f=tu(tu({},this.defaultProps),s.props),_=f.layout;return _==="vertical"&&dt(s.props.height)?{height:s.props.height}:_==="horizontal"?{width:s.props.width||u}:null}}])}(Ee.PureComponent);xC(Rg,"displayName","Legend");xC(Rg,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var Bx,dz;function bge(){if(dz)return Bx;dz=1;var i=kS(),n=l2(),o=so(),s=i?i.isConcatSpreadable:void 0;function u(f){return o(f)||n(f)||!!(s&&f&&f[s])}return Bx=u,Bx}var Wx,hz;function DX(){if(hz)return Wx;hz=1;var i=EX(),n=bge();function o(s,u,f,_,E){var T=-1,w=s.length;for(f||(f=n),E||(E=[]);++T<w;){var I=s[T];u>0&&f(I)?u>1?o(I,u-1,f,_,E):i(E,I):_||(E[E.length]=I)}return E}return Wx=o,Wx}var Gx,pz;function Tge(){if(pz)return Gx;pz=1;function i(n){return function(o,s,u){for(var f=-1,_=Object(o),E=u(o),T=E.length;T--;){var w=E[n?T:++f];if(s(_[w],w,_)===!1)break}return o}}return Gx=i,Gx}var Hx,fz;function wge(){if(fz)return Hx;fz=1;var i=Tge(),n=i();return Hx=n,Hx}var qx,mz;function xX(){if(mz)return qx;mz=1;var i=wge(),n=DC();function o(s,u){return s&&i(s,u,n)}return qx=o,qx}var Kx,gz;function Rge(){if(gz)return Kx;gz=1;var i=US();function n(o,s){return function(u,f){if(u==null)return u;if(!i(u))return o(u,f);for(var _=u.length,E=s?_:-1,T=Object(u);(s?E--:++E<_)&&f(T[E],E,T)!==!1;);return u}}return Kx=n,Kx}var zx,_z;function p2(){if(_z)return zx;_z=1;var i=xX(),n=Rge(),o=n(i);return zx=o,zx}var $x,vz;function kX(){if(vz)return $x;vz=1;var i=p2(),n=US();function o(s,u){var f=-1,_=n(s)?Array(s.length):[];return i(s,function(E,T,w){_[++f]=u(E,T,w)}),_}return $x=o,$x}var Yx,yz;function Cge(){if(yz)return Yx;yz=1;function i(n,o){var s=n.length;for(n.sort(o);s--;)n[s]=n[s].value;return n}return Yx=i,Yx}var Xx,Ez;function Age(){if(Ez)return Xx;Ez=1;var i=o_();function n(o,s){if(o!==s){var u=o!==void 0,f=o===null,_=o===o,E=i(o),T=s!==void 0,w=s===null,I=s===s,A=i(s);if(!w&&!A&&!E&&o>s||E&&T&&I&&!w&&!A||f&&T&&I||!u&&I||!_)return 1;if(!f&&!E&&!A&&o<s||A&&u&&_&&!f&&!E||w&&u&&_||!T&&_||!I)return-1}return 0}return Xx=n,Xx}var Jx,Sz;function Oge(){if(Sz)return Jx;Sz=1;var i=Age();function n(o,s,u){for(var f=-1,_=o.criteria,E=s.criteria,T=_.length,w=u.length;++f<T;){var I=i(_[f],E[f]);if(I){if(f>=w)return I;var A=u[f];return I*(A=="desc"?-1:1)}}return o.index-s.index}return Jx=n,Jx}var Qx,bz;function Ige(){if(bz)return Qx;bz=1;var i=ZM(),n=e2(),o=fl(),s=kX(),u=Cge(),f=bX(),_=Oge(),E=l_(),T=so();function w(I,A,P){A.length?A=i(A,function(F){return T(F)?function(M){return n(M,F.length===1?F[0]:F)}:F}):A=[E];var j=-1;A=i(A,f(o));var W=s(I,function(F,M,X){var Y=i(A,function(J){return J(F)});return{criteria:Y,index:++j,value:F}});return u(W,function(F,M){return _(F,M,P)})}return Qx=w,Qx}var Zx,Tz;function Nge(){if(Tz)return Zx;Tz=1;function i(n,o,s){switch(s.length){case 0:return n.call(o);case 1:return n.call(o,s[0]);case 2:return n.call(o,s[0],s[1]);case 3:return n.call(o,s[0],s[1],s[2])}return n.apply(o,s)}return Zx=i,Zx}var ek,wz;function Pge(){if(wz)return ek;wz=1;var i=Nge(),n=Math.max;function o(s,u,f){return u=n(u===void 0?s.length-1:u,0),function(){for(var _=arguments,E=-1,T=n(_.length-u,0),w=Array(T);++E<T;)w[E]=_[u+E];E=-1;for(var I=Array(u+1);++E<u;)I[E]=_[E];return I[u]=f(w),i(s,this,I)}}return ek=o,ek}var tk,Rz;function Dge(){if(Rz)return tk;Rz=1;function i(n){return function(){return n}}return tk=i,tk}var rk,Cz;function LX(){if(Cz)return rk;Cz=1;var i=$p(),n=function(){try{var o=i(Object,"defineProperty");return o({},"",{}),o}catch{}}();return rk=n,rk}var nk,Az;function xge(){if(Az)return nk;Az=1;var i=Dge(),n=LX(),o=l_(),s=n?function(u,f){return n(u,"toString",{configurable:!0,enumerable:!1,value:i(f),writable:!0})}:o;return nk=s,nk}var ik,Oz;function kge(){if(Oz)return ik;Oz=1;var i=800,n=16,o=Date.now;function s(u){var f=0,_=0;return function(){var E=o(),T=n-(E-_);if(_=E,T>0){if(++f>=i)return arguments[0]}else f=0;return u.apply(void 0,arguments)}}return ik=s,ik}var ak,Iz;function Lge(){if(Iz)return ak;Iz=1;var i=xge(),n=kge(),o=n(i);return ak=o,ak}var ok,Nz;function Mge(){if(Nz)return ok;Nz=1;var i=l_(),n=Pge(),o=Lge();function s(u,f){return o(n(u,f,i),u+"")}return ok=s,ok}var sk,Pz;function kC(){if(Pz)return sk;Pz=1;var i=XM(),n=US(),o=u2(),s=Hd();function u(f,_,E){if(!s(E))return!1;var T=typeof _;return(T=="number"?n(E)&&o(_,E.length):T=="string"&&_ in E)?i(E[_],f):!1}return sk=u,sk}var ck,Dz;function Uge(){if(Dz)return ck;Dz=1;var i=DX(),n=Ige(),o=Mge(),s=kC(),u=o(function(f,_){if(f==null)return[];var E=_.length;return E>1&&s(f,_[0],_[1])?_=[]:E>2&&s(_[0],_[1],_[2])&&(_=[_[0]]),n(f,i(_,1),[])});return ck=u,ck}var jge=Uge();const f2=Yr(jge);function QE(i){"@babel/helpers - typeof";return QE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},QE(i)}function LL(){return LL=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},LL.apply(this,arguments)}function Vge(i,n){return Gge(i)||Wge(i,n)||Bge(i,n)||Fge()}function Fge(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bge(i,n){if(i){if(typeof i=="string")return xz(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return xz(i,n)}}function xz(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function Wge(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function Gge(i){if(Array.isArray(i))return i}function kz(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function lk(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?kz(Object(o),!0).forEach(function(s){Hge(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):kz(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Hge(i,n,o){return n=qge(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function qge(i){var n=Kge(i,"string");return QE(n)=="symbol"?n:n+""}function Kge(i,n){if(QE(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(QE(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function zge(i){return Array.isArray(i)&&Oi(i[0])&&Oi(i[1])?i.join(" ~ "):i}var $ge=function(n){var o=n.separator,s=o===void 0?" : ":o,u=n.contentStyle,f=u===void 0?{}:u,_=n.itemStyle,E=_===void 0?{}:_,T=n.labelStyle,w=T===void 0?{}:T,I=n.payload,A=n.formatter,P=n.itemSorter,j=n.wrapperClassName,W=n.labelClassName,F=n.label,M=n.labelFormatter,X=n.accessibilityLayer,Y=X===void 0?!1:X,J=function(){if(I&&I.length){var ye={padding:0,margin:0},Ae=(P?f2(I,P):I).map(function(be,ke){if(be.type==="none")return null;var Me=lk({display:"block",paddingTop:4,paddingBottom:4,color:be.color||"#000"},E),Ue=be.formatter||A||zge,Pe=be.value,We=be.name,He=Pe,fe=We;if(Ue&&He!=null&&fe!=null){var Ce=Ue(Pe,We,be,ke,I);if(Array.isArray(Ce)){var ot=Vge(Ce,2);He=ot[0],fe=ot[1]}else He=Ce}return ue.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(ke),style:Me},Oi(fe)?ue.createElement("span",{className:"recharts-tooltip-item-name"},fe):null,Oi(fe)?ue.createElement("span",{className:"recharts-tooltip-item-separator"},s):null,ue.createElement("span",{className:"recharts-tooltip-item-value"},He),ue.createElement("span",{className:"recharts-tooltip-item-unit"},be.unit||""))});return ue.createElement("ul",{className:"recharts-tooltip-item-list",style:ye},Ae)}return null},re=lk({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},f),z=lk({margin:0},w),Z=!ir(F),ie=Z?F:"",de=or("recharts-default-tooltip",j),ge=or("recharts-tooltip-label",W);Z&&M&&I!==void 0&&I!==null&&(ie=M(F,I));var Oe=Y?{role:"status","aria-live":"assertive"}:{};return ue.createElement("div",LL({className:de,style:re},Oe),ue.createElement("p",{className:ge,style:z},ue.isValidElement(ie)?ie:"".concat(ie)),J())};function ZE(i){"@babel/helpers - typeof";return ZE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ZE(i)}function tR(i,n,o){return n=Yge(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function Yge(i){var n=Xge(i,"string");return ZE(n)=="symbol"?n:n+""}function Xge(i,n){if(ZE(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(ZE(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var OE="recharts-tooltip-wrapper",Jge={visibility:"hidden"};function Qge(i){var n=i.coordinate,o=i.translateX,s=i.translateY;return or(OE,tR(tR(tR(tR({},"".concat(OE,"-right"),dt(o)&&n&&dt(n.x)&&o>=n.x),"".concat(OE,"-left"),dt(o)&&n&&dt(n.x)&&o<n.x),"".concat(OE,"-bottom"),dt(s)&&n&&dt(n.y)&&s>=n.y),"".concat(OE,"-top"),dt(s)&&n&&dt(n.y)&&s<n.y))}function Lz(i){var n=i.allowEscapeViewBox,o=i.coordinate,s=i.key,u=i.offsetTopLeft,f=i.position,_=i.reverseDirection,E=i.tooltipDimension,T=i.viewBox,w=i.viewBoxDimension;if(f&&dt(f[s]))return f[s];var I=o[s]-E-u,A=o[s]+u;if(n[s])return _[s]?I:A;if(_[s]){var P=I,j=T[s];return P<j?Math.max(A,T[s]):Math.max(I,T[s])}var W=A+E,F=T[s]+w;return W>F?Math.max(I,T[s]):Math.max(A,T[s])}function Zge(i){var n=i.translateX,o=i.translateY,s=i.useTranslate3d;return{transform:s?"translate3d(".concat(n,"px, ").concat(o,"px, 0)"):"translate(".concat(n,"px, ").concat(o,"px)")}}function e_e(i){var n=i.allowEscapeViewBox,o=i.coordinate,s=i.offsetTopLeft,u=i.position,f=i.reverseDirection,_=i.tooltipBox,E=i.useTranslate3d,T=i.viewBox,w,I,A;return _.height>0&&_.width>0&&o?(I=Lz({allowEscapeViewBox:n,coordinate:o,key:"x",offsetTopLeft:s,position:u,reverseDirection:f,tooltipDimension:_.width,viewBox:T,viewBoxDimension:T.width}),A=Lz({allowEscapeViewBox:n,coordinate:o,key:"y",offsetTopLeft:s,position:u,reverseDirection:f,tooltipDimension:_.height,viewBox:T,viewBoxDimension:T.height}),w=Zge({translateX:I,translateY:A,useTranslate3d:E})):w=Jge,{cssProperties:w,cssClasses:Qge({translateX:I,translateY:A,coordinate:o})}}function kg(i){"@babel/helpers - typeof";return kg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},kg(i)}function Mz(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Uz(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Mz(Object(o),!0).forEach(function(s){UL(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Mz(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function t_e(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function r_e(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,UX(s.key),s)}}function n_e(i,n,o){return n&&r_e(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function i_e(i,n,o){return n=AR(n),a_e(i,MX()?Reflect.construct(n,o||[],AR(i).constructor):n.apply(i,o))}function a_e(i,n){if(n&&(kg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o_e(i)}function o_e(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function MX(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(MX=function(){return!!i})()}function AR(i){return AR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},AR(i)}function s_e(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&ML(i,n)}function ML(i,n){return ML=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},ML(i,n)}function UL(i,n,o){return n=UX(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function UX(i){var n=c_e(i,"string");return kg(n)=="symbol"?n:n+""}function c_e(i,n){if(kg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(kg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var jz=1,l_e=function(i){function n(){var o;t_e(this,n);for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];return o=i_e(this,n,[].concat(u)),UL(o,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),UL(o,"handleKeyDown",function(_){if(_.key==="Escape"){var E,T,w,I;o.setState({dismissed:!0,dismissedAtCoordinate:{x:(E=(T=o.props.coordinate)===null||T===void 0?void 0:T.x)!==null&&E!==void 0?E:0,y:(w=(I=o.props.coordinate)===null||I===void 0?void 0:I.y)!==null&&w!==void 0?w:0}})}}),o}return s_e(n,i),n_e(n,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var s=this.wrapperNode.getBoundingClientRect();(Math.abs(s.width-this.state.lastBoundingBox.width)>jz||Math.abs(s.height-this.state.lastBoundingBox.height)>jz)&&this.setState({lastBoundingBox:{width:s.width,height:s.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var s,u;this.props.active&&this.updateBBox(),this.state.dismissed&&(((s=this.props.coordinate)===null||s===void 0?void 0:s.x)!==this.state.dismissedAtCoordinate.x||((u=this.props.coordinate)===null||u===void 0?void 0:u.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var s=this,u=this.props,f=u.active,_=u.allowEscapeViewBox,E=u.animationDuration,T=u.animationEasing,w=u.children,I=u.coordinate,A=u.hasPayload,P=u.isAnimationActive,j=u.offset,W=u.position,F=u.reverseDirection,M=u.useTranslate3d,X=u.viewBox,Y=u.wrapperStyle,J=e_e({allowEscapeViewBox:_,coordinate:I,offsetTopLeft:j,position:W,reverseDirection:F,tooltipBox:this.state.lastBoundingBox,useTranslate3d:M,viewBox:X}),re=J.cssClasses,z=J.cssProperties,Z=Uz(Uz({transition:P&&f?"transform ".concat(E,"ms ").concat(T):void 0},z),{},{pointerEvents:"none",visibility:!this.state.dismissed&&f&&A?"visible":"hidden",position:"absolute",top:0,left:0},Y);return ue.createElement("div",{tabIndex:-1,className:re,style:Z,ref:function(de){s.wrapperNode=de}},w)}}])}(Ee.PureComponent),u_e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},qd={isSsr:u_e()};function Lg(i){"@babel/helpers - typeof";return Lg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Lg(i)}function Vz(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Fz(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Vz(Object(o),!0).forEach(function(s){m2(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Vz(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function d_e(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function h_e(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,VX(s.key),s)}}function p_e(i,n,o){return n&&h_e(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function f_e(i,n,o){return n=OR(n),m_e(i,jX()?Reflect.construct(n,o||[],OR(i).constructor):n.apply(i,o))}function m_e(i,n){if(n&&(Lg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g_e(i)}function g_e(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function jX(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jX=function(){return!!i})()}function OR(i){return OR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},OR(i)}function __e(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&jL(i,n)}function jL(i,n){return jL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},jL(i,n)}function m2(i,n,o){return n=VX(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function VX(i){var n=v_e(i,"string");return Lg(n)=="symbol"?n:n+""}function v_e(i,n){if(Lg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Lg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function y_e(i){return i.dataKey}function E_e(i,n){return ue.isValidElement(i)?ue.cloneElement(i,n):typeof i=="function"?ue.createElement(i,n):ue.createElement($ge,n)}var ao=function(i){function n(){return d_e(this,n),f_e(this,n,arguments)}return __e(n,i),p_e(n,[{key:"render",value:function(){var s=this,u=this.props,f=u.active,_=u.allowEscapeViewBox,E=u.animationDuration,T=u.animationEasing,w=u.content,I=u.coordinate,A=u.filterNull,P=u.isAnimationActive,j=u.offset,W=u.payload,F=u.payloadUniqBy,M=u.position,X=u.reverseDirection,Y=u.useTranslate3d,J=u.viewBox,re=u.wrapperStyle,z=W??[];A&&z.length&&(z=IX(W.filter(function(ie){return ie.value!=null&&(ie.hide!==!0||s.props.includeHidden)}),F,y_e));var Z=z.length>0;return ue.createElement(l_e,{allowEscapeViewBox:_,animationDuration:E,animationEasing:T,isAnimationActive:P,active:f,coordinate:I,hasPayload:Z,offset:j,position:M,reverseDirection:X,useTranslate3d:Y,viewBox:J,wrapperStyle:re},E_e(w,Fz(Fz({},this.props),{},{payload:z})))}}])}(Ee.PureComponent);m2(ao,"displayName","Tooltip");m2(ao,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!qd.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var uk,Bz;function S_e(){if(Bz)return uk;Bz=1;var i=pl(),n=function(){return i.Date.now()};return uk=n,uk}var dk,Wz;function b_e(){if(Wz)return dk;Wz=1;var i=/\s/;function n(o){for(var s=o.length;s--&&i.test(o.charAt(s)););return s}return dk=n,dk}var hk,Gz;function T_e(){if(Gz)return hk;Gz=1;var i=b_e(),n=/^\s+/;function o(s){return s&&s.slice(0,i(s)+1).replace(n,"")}return hk=o,hk}var pk,Hz;function FX(){if(Hz)return pk;Hz=1;var i=T_e(),n=Hd(),o=o_(),s=NaN,u=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,_=/^0o[0-7]+$/i,E=parseInt;function T(w){if(typeof w=="number")return w;if(o(w))return s;if(n(w)){var I=typeof w.valueOf=="function"?w.valueOf():w;w=n(I)?I+"":I}if(typeof w!="string")return w===0?w:+w;w=i(w);var A=f.test(w);return A||_.test(w)?E(w.slice(2),A?2:8):u.test(w)?s:+w}return pk=T,pk}var fk,qz;function w_e(){if(qz)return fk;qz=1;var i=Hd(),n=S_e(),o=FX(),s="Expected a function",u=Math.max,f=Math.min;function _(E,T,w){var I,A,P,j,W,F,M=0,X=!1,Y=!1,J=!0;if(typeof E!="function")throw new TypeError(s);T=o(T)||0,i(w)&&(X=!!w.leading,Y="maxWait"in w,P=Y?u(o(w.maxWait)||0,T):P,J="trailing"in w?!!w.trailing:J);function re(Ae){var be=I,ke=A;return I=A=void 0,M=Ae,j=E.apply(ke,be),j}function z(Ae){return M=Ae,W=setTimeout(de,T),X?re(Ae):j}function Z(Ae){var be=Ae-F,ke=Ae-M,Me=T-be;return Y?f(Me,P-ke):Me}function ie(Ae){var be=Ae-F,ke=Ae-M;return F===void 0||be>=T||be<0||Y&&ke>=P}function de(){var Ae=n();if(ie(Ae))return ge(Ae);W=setTimeout(de,Z(Ae))}function ge(Ae){return W=void 0,J&&I?re(Ae):(I=A=void 0,j)}function Oe(){W!==void 0&&clearTimeout(W),M=0,I=F=A=W=void 0}function me(){return W===void 0?j:ge(n())}function ye(){var Ae=n(),be=ie(Ae);if(I=arguments,A=this,F=Ae,be){if(W===void 0)return z(F);if(Y)return clearTimeout(W),W=setTimeout(de,T),re(F)}return W===void 0&&(W=setTimeout(de,T)),j}return ye.cancel=Oe,ye.flush=me,ye}return fk=_,fk}var mk,Kz;function R_e(){if(Kz)return mk;Kz=1;var i=w_e(),n=Hd(),o="Expected a function";function s(u,f,_){var E=!0,T=!0;if(typeof u!="function")throw new TypeError(o);return n(_)&&(E="leading"in _?!!_.leading:E,T="trailing"in _?!!_.trailing:T),i(u,f,{leading:E,maxWait:f,trailing:T})}return mk=s,mk}var C_e=R_e();const BX=Yr(C_e);function eS(i){"@babel/helpers - typeof";return eS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},eS(i)}function zz(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function rR(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?zz(Object(o),!0).forEach(function(s){A_e(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):zz(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function A_e(i,n,o){return n=O_e(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function O_e(i){var n=I_e(i,"string");return eS(n)=="symbol"?n:n+""}function I_e(i,n){if(eS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(eS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function N_e(i,n){return k_e(i)||x_e(i,n)||D_e(i,n)||P_e()}function P_e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D_e(i,n){if(i){if(typeof i=="string")return $z(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return $z(i,n)}}function $z(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function x_e(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function k_e(i){if(Array.isArray(i))return i}var Cg=Ee.forwardRef(function(i,n){var o=i.aspect,s=i.initialDimension,u=s===void 0?{width:-1,height:-1}:s,f=i.width,_=f===void 0?"100%":f,E=i.height,T=E===void 0?"100%":E,w=i.minWidth,I=w===void 0?0:w,A=i.minHeight,P=i.maxHeight,j=i.children,W=i.debounce,F=W===void 0?0:W,M=i.id,X=i.className,Y=i.onResize,J=i.style,re=J===void 0?{}:J,z=Ee.useRef(null),Z=Ee.useRef();Z.current=Y,Ee.useImperativeHandle(n,function(){return Object.defineProperty(z.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),z.current},configurable:!0})});var ie=Ee.useState({containerWidth:u.width,containerHeight:u.height}),de=N_e(ie,2),ge=de[0],Oe=de[1],me=Ee.useCallback(function(Ae,be){Oe(function(ke){var Me=Math.round(Ae),Ue=Math.round(be);return ke.containerWidth===Me&&ke.containerHeight===Ue?ke:{containerWidth:Me,containerHeight:Ue}})},[]);Ee.useEffect(function(){var Ae=function(We){var He,fe=We[0].contentRect,Ce=fe.width,ot=fe.height;me(Ce,ot),(He=Z.current)===null||He===void 0||He.call(Z,Ce,ot)};F>0&&(Ae=BX(Ae,F,{trailing:!0,leading:!1}));var be=new ResizeObserver(Ae),ke=z.current.getBoundingClientRect(),Me=ke.width,Ue=ke.height;return me(Me,Ue),be.observe(z.current),function(){be.disconnect()}},[me,F]);var ye=Ee.useMemo(function(){var Ae=ge.containerWidth,be=ge.containerHeight;if(Ae<0||be<0)return null;oc(Mp(_)||Mp(T),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,_,T),oc(!o||o>0,"The aspect(%s) must be greater than zero.",o);var ke=Mp(_)?Ae:_,Me=Mp(T)?be:T;o&&o>0&&(ke?Me=ke/o:Me&&(ke=Me*o),P&&Me>P&&(Me=P)),oc(ke>0||Me>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,ke,Me,_,T,I,A,o);var Ue=!Array.isArray(j)&&su(j.type).endsWith("Chart");return ue.Children.map(j,function(Pe){return ue.isValidElement(Pe)?Ee.cloneElement(Pe,rR({width:ke,height:Me},Ue?{style:rR({height:"100%",width:"100%",maxHeight:Me,maxWidth:ke},Pe.props.style)}:{})):Pe})},[o,j,T,P,A,I,ge,_]);return ue.createElement("div",{id:M?"".concat(M):void 0,className:or("recharts-responsive-container",X),style:rR(rR({},re),{},{width:_,height:T,minWidth:I,minHeight:A,maxHeight:P}),ref:z},ye)}),LC=function(n){return null};LC.displayName="Cell";function tS(i){"@babel/helpers - typeof";return tS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},tS(i)}function Yz(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function VL(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Yz(Object(o),!0).forEach(function(s){L_e(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Yz(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function L_e(i,n,o){return n=M_e(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function M_e(i){var n=U_e(i,"string");return tS(n)=="symbol"?n:n+""}function U_e(i,n){if(tS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(tS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var fg={widthCache:{},cacheCount:0},j_e=2e3,V_e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},Xz="recharts_measurement_span";function F_e(i){var n=VL({},i);return Object.keys(n).forEach(function(o){n[o]||delete n[o]}),n}var BE=function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||qd.isSsr)return{width:0,height:0};var s=F_e(o),u=JSON.stringify({text:n,copyStyle:s});if(fg.widthCache[u])return fg.widthCache[u];try{var f=document.getElementById(Xz);f||(f=document.createElement("span"),f.setAttribute("id",Xz),f.setAttribute("aria-hidden","true"),document.body.appendChild(f));var _=VL(VL({},V_e),s);Object.assign(f.style,_),f.textContent="".concat(n);var E=f.getBoundingClientRect(),T={width:E.width,height:E.height};return fg.widthCache[u]=T,++fg.cacheCount>j_e&&(fg.cacheCount=0,fg.widthCache={}),T}catch{return{width:0,height:0}}},B_e=function(n){return{top:n.top+window.scrollY-document.documentElement.clientTop,left:n.left+window.scrollX-document.documentElement.clientLeft}};function rS(i){"@babel/helpers - typeof";return rS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},rS(i)}function IR(i,n){return q_e(i)||H_e(i,n)||G_e(i,n)||W_e()}function W_e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G_e(i,n){if(i){if(typeof i=="string")return Jz(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Jz(i,n)}}function Jz(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function H_e(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n===0){if(Object(o)!==o)return;T=!1}else for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function q_e(i){if(Array.isArray(i))return i}function K_e(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function Qz(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,$_e(s.key),s)}}function z_e(i,n,o){return n&&Qz(i.prototype,n),o&&Qz(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function $_e(i){var n=Y_e(i,"string");return rS(n)=="symbol"?n:n+""}function Y_e(i,n){if(rS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(rS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var Zz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,e$=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,X_e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,J_e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,WX={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},Q_e=Object.keys(WX),yg="NaN";function Z_e(i,n){return i*WX[n]}var nR=function(){function i(n,o){K_e(this,i),this.num=n,this.unit=o,this.num=n,this.unit=o,Number.isNaN(n)&&(this.unit=""),o!==""&&!X_e.test(o)&&(this.num=NaN,this.unit=""),Q_e.includes(o)&&(this.num=Z_e(n,o),this.unit="px")}return z_e(i,[{key:"add",value:function(o){return this.unit!==o.unit?new i(NaN,""):new i(this.num+o.num,this.unit)}},{key:"subtract",value:function(o){return this.unit!==o.unit?new i(NaN,""):new i(this.num-o.num,this.unit)}},{key:"multiply",value:function(o){return this.unit!==""&&o.unit!==""&&this.unit!==o.unit?new i(NaN,""):new i(this.num*o.num,this.unit||o.unit)}},{key:"divide",value:function(o){return this.unit!==""&&o.unit!==""&&this.unit!==o.unit?new i(NaN,""):new i(this.num/o.num,this.unit||o.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(o){var s,u=(s=J_e.exec(o))!==null&&s!==void 0?s:[],f=IR(u,3),_=f[1],E=f[2];return new i(parseFloat(_),E??"")}}])}();function GX(i){if(i.includes(yg))return yg;for(var n=i;n.includes("*")||n.includes("/");){var o,s=(o=Zz.exec(n))!==null&&o!==void 0?o:[],u=IR(s,4),f=u[1],_=u[2],E=u[3],T=nR.parse(f??""),w=nR.parse(E??""),I=_==="*"?T.multiply(w):T.divide(w);if(I.isNaN())return yg;n=n.replace(Zz,I.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var A,P=(A=e$.exec(n))!==null&&A!==void 0?A:[],j=IR(P,4),W=j[1],F=j[2],M=j[3],X=nR.parse(W??""),Y=nR.parse(M??""),J=F==="+"?X.add(Y):X.subtract(Y);if(J.isNaN())return yg;n=n.replace(e$,J.toString())}return n}var t$=/\(([^()]*)\)/;function eve(i){for(var n=i;n.includes("(");){var o=t$.exec(n),s=IR(o,2),u=s[1];n=n.replace(t$,GX(u))}return n}function tve(i){var n=i.replace(/\s+/g,"");return n=eve(n),n=GX(n),n}function rve(i){try{return tve(i)}catch{return yg}}function gk(i){var n=rve(i.slice(5,-1));return n===yg?"":n}var nve=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],ive=["dx","dy","angle","className","breakAll"];function FL(){return FL=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},FL.apply(this,arguments)}function r$(i,n){if(i==null)return{};var o=ave(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function ave(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function n$(i,n){return lve(i)||cve(i,n)||sve(i,n)||ove()}function ove(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sve(i,n){if(i){if(typeof i=="string")return i$(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return i$(i,n)}}function i$(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function cve(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n===0){if(Object(o)!==o)return;T=!1}else for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function lve(i){if(Array.isArray(i))return i}var HX=/[ \f\n\r\t\v\u2028\u2029]+/,qX=function(n){var o=n.children,s=n.breakAll,u=n.style;try{var f=[];ir(o)||(s?f=o.toString().split(""):f=o.toString().split(HX));var _=f.map(function(T){return{word:T,width:BE(T,u).width}}),E=s?0:BE(" ",u).width;return{wordsWithComputedWidth:_,spaceWidth:E}}catch{return null}},uve=function(n,o,s,u,f){var _=n.maxLines,E=n.children,T=n.style,w=n.breakAll,I=dt(_),A=E,P=function(){var ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ke.reduce(function(Me,Ue){var Pe=Ue.word,We=Ue.width,He=Me[Me.length-1];if(He&&(u==null||f||He.width+We+s<Number(u)))He.words.push(Pe),He.width+=We+s;else{var fe={words:[Pe],width:We};Me.push(fe)}return Me},[])},j=P(o),W=function(ke){return ke.reduce(function(Me,Ue){return Me.width>Ue.width?Me:Ue})};if(!I)return j;for(var F="…",M=function(ke){var Me=A.slice(0,ke),Ue=qX({breakAll:w,style:T,children:Me+F}).wordsWithComputedWidth,Pe=P(Ue),We=Pe.length>_||W(Pe).width>Number(u);return[We,Pe]},X=0,Y=A.length-1,J=0,re;X<=Y&&J<=A.length-1;){var z=Math.floor((X+Y)/2),Z=z-1,ie=M(Z),de=n$(ie,2),ge=de[0],Oe=de[1],me=M(z),ye=n$(me,1),Ae=ye[0];if(!ge&&!Ae&&(X=z+1),ge&&Ae&&(Y=z-1),!ge&&Ae){re=Oe;break}J++}return re||j},a$=function(n){var o=ir(n)?[]:n.toString().split(HX);return[{words:o}]},dve=function(n){var o=n.width,s=n.scaleToFit,u=n.children,f=n.style,_=n.breakAll,E=n.maxLines;if((o||s)&&!qd.isSsr){var T,w,I=qX({breakAll:_,children:u,style:f});if(I){var A=I.wordsWithComputedWidth,P=I.spaceWidth;T=A,w=P}else return a$(u);return uve({breakAll:_,children:u,maxLines:E,style:f},T,w,o,s)}return a$(u)},o$="#808080",Hp=function(n){var o=n.x,s=o===void 0?0:o,u=n.y,f=u===void 0?0:u,_=n.lineHeight,E=_===void 0?"1em":_,T=n.capHeight,w=T===void 0?"0.71em":T,I=n.scaleToFit,A=I===void 0?!1:I,P=n.textAnchor,j=P===void 0?"start":P,W=n.verticalAnchor,F=W===void 0?"end":W,M=n.fill,X=M===void 0?o$:M,Y=r$(n,nve),J=Ee.useMemo(function(){return dve({breakAll:Y.breakAll,children:Y.children,maxLines:Y.maxLines,scaleToFit:A,style:Y.style,width:Y.width})},[Y.breakAll,Y.children,Y.maxLines,A,Y.style,Y.width]),re=Y.dx,z=Y.dy,Z=Y.angle,ie=Y.className,de=Y.breakAll,ge=r$(Y,ive);if(!Oi(s)||!Oi(f))return null;var Oe=s+(dt(re)?re:0),me=f+(dt(z)?z:0),ye;switch(F){case"start":ye=gk("calc(".concat(w,")"));break;case"middle":ye=gk("calc(".concat((J.length-1)/2," * -").concat(E," + (").concat(w," / 2))"));break;default:ye=gk("calc(".concat(J.length-1," * -").concat(E,")"));break}var Ae=[];if(A){var be=J[0].width,ke=Y.width;Ae.push("scale(".concat((dt(ke)?ke/be:1)/be,")"))}return Z&&Ae.push("rotate(".concat(Z,", ").concat(Oe,", ").concat(me,")")),Ae.length&&(ge.transform=Ae.join(" ")),ue.createElement("text",FL({},Pt(ge,!0),{x:Oe,y:me,className:or("recharts-text",ie),textAnchor:j,fill:X.includes("url")?o$:X}),J.map(function(Me,Ue){var Pe=Me.words.join(de?"":" ");return ue.createElement("tspan",{x:Oe,dy:Ue===0?ye:E,key:"".concat(Pe,"-").concat(Ue)},Pe)}))};function Fd(i,n){return i==null||n==null?NaN:i<n?-1:i>n?1:i>=n?0:NaN}function hve(i,n){return i==null||n==null?NaN:n<i?-1:n>i?1:n>=i?0:NaN}function g2(i){let n,o,s;i.length!==2?(n=Fd,o=(E,T)=>Fd(i(E),T),s=(E,T)=>i(E)-T):(n=i===Fd||i===hve?i:pve,o=i,s=i);function u(E,T,w=0,I=E.length){if(w<I){if(n(T,T)!==0)return I;do{const A=w+I>>>1;o(E[A],T)<0?w=A+1:I=A}while(w<I)}return w}function f(E,T,w=0,I=E.length){if(w<I){if(n(T,T)!==0)return I;do{const A=w+I>>>1;o(E[A],T)<=0?w=A+1:I=A}while(w<I)}return w}function _(E,T,w=0,I=E.length){const A=u(E,T,w,I-1);return A>w&&s(E[A-1],T)>-s(E[A],T)?A-1:A}return{left:u,center:_,right:f}}function pve(){return 0}function KX(i){return i===null?NaN:+i}function*fve(i,n){for(let o of i)o!=null&&(o=+o)>=o&&(yield o)}const mve=g2(Fd),jS=mve.right;g2(KX).center;class s$ extends Map{constructor(n,o=vve){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:o}}),n!=null)for(const[s,u]of n)this.set(s,u)}get(n){return super.get(c$(this,n))}has(n){return super.has(c$(this,n))}set(n,o){return super.set(gve(this,n),o)}delete(n){return super.delete(_ve(this,n))}}function c$({_intern:i,_key:n},o){const s=n(o);return i.has(s)?i.get(s):o}function gve({_intern:i,_key:n},o){const s=n(o);return i.has(s)?i.get(s):(i.set(s,o),o)}function _ve({_intern:i,_key:n},o){const s=n(o);return i.has(s)&&(o=i.get(s),i.delete(s)),o}function vve(i){return i!==null&&typeof i=="object"?i.valueOf():i}function yve(i=Fd){if(i===Fd)return zX;if(typeof i!="function")throw new TypeError("compare is not a function");return(n,o)=>{const s=i(n,o);return s||s===0?s:(i(o,o)===0)-(i(n,n)===0)}}function zX(i,n){return(i==null||!(i>=i))-(n==null||!(n>=n))||(i<n?-1:i>n?1:0)}const Eve=Math.sqrt(50),Sve=Math.sqrt(10),bve=Math.sqrt(2);function NR(i,n,o){const s=(n-i)/Math.max(0,o),u=Math.floor(Math.log10(s)),f=s/Math.pow(10,u),_=f>=Eve?10:f>=Sve?5:f>=bve?2:1;let E,T,w;return u<0?(w=Math.pow(10,-u)/_,E=Math.round(i*w),T=Math.round(n*w),E/w<i&&++E,T/w>n&&--T,w=-w):(w=Math.pow(10,u)*_,E=Math.round(i/w),T=Math.round(n/w),E*w<i&&++E,T*w>n&&--T),T<E&&.5<=o&&o<2?NR(i,n,o*2):[E,T,w]}function BL(i,n,o){if(n=+n,i=+i,o=+o,!(o>0))return[];if(i===n)return[i];const s=n<i,[u,f,_]=s?NR(n,i,o):NR(i,n,o);if(!(f>=u))return[];const E=f-u+1,T=new Array(E);if(s)if(_<0)for(let w=0;w<E;++w)T[w]=(f-w)/-_;else for(let w=0;w<E;++w)T[w]=(f-w)*_;else if(_<0)for(let w=0;w<E;++w)T[w]=(u+w)/-_;else for(let w=0;w<E;++w)T[w]=(u+w)*_;return T}function WL(i,n,o){return n=+n,i=+i,o=+o,NR(i,n,o)[2]}function GL(i,n,o){n=+n,i=+i,o=+o;const s=n<i,u=s?WL(n,i,o):WL(i,n,o);return(s?-1:1)*(u<0?1/-u:u)}function l$(i,n){let o;for(const s of i)s!=null&&(o<s||o===void 0&&s>=s)&&(o=s);return o}function u$(i,n){let o;for(const s of i)s!=null&&(o>s||o===void 0&&s>=s)&&(o=s);return o}function $X(i,n,o=0,s=1/0,u){if(n=Math.floor(n),o=Math.floor(Math.max(0,o)),s=Math.floor(Math.min(i.length-1,s)),!(o<=n&&n<=s))return i;for(u=u===void 0?zX:yve(u);s>o;){if(s-o>600){const T=s-o+1,w=n-o+1,I=Math.log(T),A=.5*Math.exp(2*I/3),P=.5*Math.sqrt(I*A*(T-A)/T)*(w-T/2<0?-1:1),j=Math.max(o,Math.floor(n-w*A/T+P)),W=Math.min(s,Math.floor(n+(T-w)*A/T+P));$X(i,n,j,W,u)}const f=i[n];let _=o,E=s;for(IE(i,o,n),u(i[s],f)>0&&IE(i,o,s);_<E;){for(IE(i,_,E),++_,--E;u(i[_],f)<0;)++_;for(;u(i[E],f)>0;)--E}u(i[o],f)===0?IE(i,o,E):(++E,IE(i,E,s)),E<=n&&(o=E+1),n<=E&&(s=E-1)}return i}function IE(i,n,o){const s=i[n];i[n]=i[o],i[o]=s}function Tve(i,n,o){if(i=Float64Array.from(fve(i)),!(!(s=i.length)||isNaN(n=+n))){if(n<=0||s<2)return u$(i);if(n>=1)return l$(i);var s,u=(s-1)*n,f=Math.floor(u),_=l$($X(i,f).subarray(0,f+1)),E=u$(i.subarray(f+1));return _+(E-_)*(u-f)}}function wve(i,n,o=KX){if(!(!(s=i.length)||isNaN(n=+n))){if(n<=0||s<2)return+o(i[0],0,i);if(n>=1)return+o(i[s-1],s-1,i);var s,u=(s-1)*n,f=Math.floor(u),_=+o(i[f],f,i),E=+o(i[f+1],f+1,i);return _+(E-_)*(u-f)}}function Rve(i,n,o){i=+i,n=+n,o=(u=arguments.length)<2?(n=i,i=0,1):u<3?1:+o;for(var s=-1,u=Math.max(0,Math.ceil((n-i)/o))|0,f=new Array(u);++s<u;)f[s]=i+s*o;return f}function Ss(i,n){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(n).domain(i);break}return this}function vu(i,n){switch(arguments.length){case 0:break;case 1:{typeof i=="function"?this.interpolator(i):this.range(i);break}default:{this.domain(i),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const HL=Symbol("implicit");function _2(){var i=new s$,n=[],o=[],s=HL;function u(f){let _=i.get(f);if(_===void 0){if(s!==HL)return s;i.set(f,_=n.push(f)-1)}return o[_%o.length]}return u.domain=function(f){if(!arguments.length)return n.slice();n=[],i=new s$;for(const _ of f)i.has(_)||i.set(_,n.push(_)-1);return u},u.range=function(f){return arguments.length?(o=Array.from(f),u):o.slice()},u.unknown=function(f){return arguments.length?(s=f,u):s},u.copy=function(){return _2(n,o).unknown(s)},Ss.apply(u,arguments),u}function nS(){var i=_2().unknown(void 0),n=i.domain,o=i.range,s=0,u=1,f,_,E=!1,T=0,w=0,I=.5;delete i.unknown;function A(){var P=n().length,j=u<s,W=j?u:s,F=j?s:u;f=(F-W)/Math.max(1,P-T+w*2),E&&(f=Math.floor(f)),W+=(F-W-f*(P-T))*I,_=f*(1-T),E&&(W=Math.round(W),_=Math.round(_));var M=Rve(P).map(function(X){return W+f*X});return o(j?M.reverse():M)}return i.domain=function(P){return arguments.length?(n(P),A()):n()},i.range=function(P){return arguments.length?([s,u]=P,s=+s,u=+u,A()):[s,u]},i.rangeRound=function(P){return[s,u]=P,s=+s,u=+u,E=!0,A()},i.bandwidth=function(){return _},i.step=function(){return f},i.round=function(P){return arguments.length?(E=!!P,A()):E},i.padding=function(P){return arguments.length?(T=Math.min(1,w=+P),A()):T},i.paddingInner=function(P){return arguments.length?(T=Math.min(1,P),A()):T},i.paddingOuter=function(P){return arguments.length?(w=+P,A()):w},i.align=function(P){return arguments.length?(I=Math.max(0,Math.min(1,P)),A()):I},i.copy=function(){return nS(n(),[s,u]).round(E).paddingInner(T).paddingOuter(w).align(I)},Ss.apply(A(),arguments)}function YX(i){var n=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return YX(n())},i}function WE(){return YX(nS.apply(null,arguments).paddingInner(1))}function v2(i,n,o){i.prototype=n.prototype=o,o.constructor=i}function XX(i,n){var o=Object.create(i.prototype);for(var s in n)o[s]=n[s];return o}function VS(){}var iS=.7,PR=1/iS,Ag="\\s*([+-]?\\d+)\\s*",aS="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",sl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Cve=/^#([0-9a-f]{3,8})$/,Ave=new RegExp(`^rgb\\(${Ag},${Ag},${Ag}\\)$`),Ove=new RegExp(`^rgb\\(${sl},${sl},${sl}\\)$`),Ive=new RegExp(`^rgba\\(${Ag},${Ag},${Ag},${aS}\\)$`),Nve=new RegExp(`^rgba\\(${sl},${sl},${sl},${aS}\\)$`),Pve=new RegExp(`^hsl\\(${aS},${sl},${sl}\\)$`),Dve=new RegExp(`^hsla\\(${aS},${sl},${sl},${aS}\\)$`),d$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};v2(VS,oS,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:h$,formatHex:h$,formatHex8:xve,formatHsl:kve,formatRgb:p$,toString:p$});function h$(){return this.rgb().formatHex()}function xve(){return this.rgb().formatHex8()}function kve(){return JX(this).formatHsl()}function p$(){return this.rgb().formatRgb()}function oS(i){var n,o;return i=(i+"").trim().toLowerCase(),(n=Cve.exec(i))?(o=n[1].length,n=parseInt(n[1],16),o===6?f$(n):o===3?new oo(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):o===8?iR(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):o===4?iR(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=Ave.exec(i))?new oo(n[1],n[2],n[3],1):(n=Ove.exec(i))?new oo(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=Ive.exec(i))?iR(n[1],n[2],n[3],n[4]):(n=Nve.exec(i))?iR(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=Pve.exec(i))?_$(n[1],n[2]/100,n[3]/100,1):(n=Dve.exec(i))?_$(n[1],n[2]/100,n[3]/100,n[4]):d$.hasOwnProperty(i)?f$(d$[i]):i==="transparent"?new oo(NaN,NaN,NaN,0):null}function f$(i){return new oo(i>>16&255,i>>8&255,i&255,1)}function iR(i,n,o,s){return s<=0&&(i=n=o=NaN),new oo(i,n,o,s)}function Lve(i){return i instanceof VS||(i=oS(i)),i?(i=i.rgb(),new oo(i.r,i.g,i.b,i.opacity)):new oo}function qL(i,n,o,s){return arguments.length===1?Lve(i):new oo(i,n,o,s??1)}function oo(i,n,o,s){this.r=+i,this.g=+n,this.b=+o,this.opacity=+s}v2(oo,qL,XX(VS,{brighter(i){return i=i==null?PR:Math.pow(PR,i),new oo(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?iS:Math.pow(iS,i),new oo(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new oo(Fp(this.r),Fp(this.g),Fp(this.b),DR(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:m$,formatHex:m$,formatHex8:Mve,formatRgb:g$,toString:g$}));function m$(){return`#${Up(this.r)}${Up(this.g)}${Up(this.b)}`}function Mve(){return`#${Up(this.r)}${Up(this.g)}${Up(this.b)}${Up((isNaN(this.opacity)?1:this.opacity)*255)}`}function g$(){const i=DR(this.opacity);return`${i===1?"rgb(":"rgba("}${Fp(this.r)}, ${Fp(this.g)}, ${Fp(this.b)}${i===1?")":`, ${i})`}`}function DR(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function Fp(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function Up(i){return i=Fp(i),(i<16?"0":"")+i.toString(16)}function _$(i,n,o,s){return s<=0?i=n=o=NaN:o<=0||o>=1?i=n=NaN:n<=0&&(i=NaN),new ac(i,n,o,s)}function JX(i){if(i instanceof ac)return new ac(i.h,i.s,i.l,i.opacity);if(i instanceof VS||(i=oS(i)),!i)return new ac;if(i instanceof ac)return i;i=i.rgb();var n=i.r/255,o=i.g/255,s=i.b/255,u=Math.min(n,o,s),f=Math.max(n,o,s),_=NaN,E=f-u,T=(f+u)/2;return E?(n===f?_=(o-s)/E+(o<s)*6:o===f?_=(s-n)/E+2:_=(n-o)/E+4,E/=T<.5?f+u:2-f-u,_*=60):E=T>0&&T<1?0:_,new ac(_,E,T,i.opacity)}function Uve(i,n,o,s){return arguments.length===1?JX(i):new ac(i,n,o,s??1)}function ac(i,n,o,s){this.h=+i,this.s=+n,this.l=+o,this.opacity=+s}v2(ac,Uve,XX(VS,{brighter(i){return i=i==null?PR:Math.pow(PR,i),new ac(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?iS:Math.pow(iS,i),new ac(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,n=isNaN(i)||isNaN(this.s)?0:this.s,o=this.l,s=o+(o<.5?o:1-o)*n,u=2*o-s;return new oo(_k(i>=240?i-240:i+120,u,s),_k(i,u,s),_k(i<120?i+240:i-120,u,s),this.opacity)},clamp(){return new ac(v$(this.h),aR(this.s),aR(this.l),DR(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=DR(this.opacity);return`${i===1?"hsl(":"hsla("}${v$(this.h)}, ${aR(this.s)*100}%, ${aR(this.l)*100}%${i===1?")":`, ${i})`}`}}));function v$(i){return i=(i||0)%360,i<0?i+360:i}function aR(i){return Math.max(0,Math.min(1,i||0))}function _k(i,n,o){return(i<60?n+(o-n)*i/60:i<180?o:i<240?n+(o-n)*(240-i)/60:n)*255}const y2=i=>()=>i;function jve(i,n){return function(o){return i+o*n}}function Vve(i,n,o){return i=Math.pow(i,o),n=Math.pow(n,o)-i,o=1/o,function(s){return Math.pow(i+s*n,o)}}function Fve(i){return(i=+i)==1?QX:function(n,o){return o-n?Vve(n,o,i):y2(isNaN(n)?o:n)}}function QX(i,n){var o=n-i;return o?jve(i,o):y2(isNaN(i)?n:i)}const y$=function i(n){var o=Fve(n);function s(u,f){var _=o((u=qL(u)).r,(f=qL(f)).r),E=o(u.g,f.g),T=o(u.b,f.b),w=QX(u.opacity,f.opacity);return function(I){return u.r=_(I),u.g=E(I),u.b=T(I),u.opacity=w(I),u+""}}return s.gamma=i,s}(1);function Bve(i,n){n||(n=[]);var o=i?Math.min(n.length,i.length):0,s=n.slice(),u;return function(f){for(u=0;u<o;++u)s[u]=i[u]*(1-f)+n[u]*f;return s}}function Wve(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Gve(i,n){var o=n?n.length:0,s=i?Math.min(o,i.length):0,u=new Array(s),f=new Array(o),_;for(_=0;_<s;++_)u[_]=u_(i[_],n[_]);for(;_<o;++_)f[_]=n[_];return function(E){for(_=0;_<s;++_)f[_]=u[_](E);return f}}function Hve(i,n){var o=new Date;return i=+i,n=+n,function(s){return o.setTime(i*(1-s)+n*s),o}}function xR(i,n){return i=+i,n=+n,function(o){return i*(1-o)+n*o}}function qve(i,n){var o={},s={},u;(i===null||typeof i!="object")&&(i={}),(n===null||typeof n!="object")&&(n={});for(u in n)u in i?o[u]=u_(i[u],n[u]):s[u]=n[u];return function(f){for(u in o)s[u]=o[u](f);return s}}var KL=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vk=new RegExp(KL.source,"g");function Kve(i){return function(){return i}}function zve(i){return function(n){return i(n)+""}}function $ve(i,n){var o=KL.lastIndex=vk.lastIndex=0,s,u,f,_=-1,E=[],T=[];for(i=i+"",n=n+"";(s=KL.exec(i))&&(u=vk.exec(n));)(f=u.index)>o&&(f=n.slice(o,f),E[_]?E[_]+=f:E[++_]=f),(s=s[0])===(u=u[0])?E[_]?E[_]+=u:E[++_]=u:(E[++_]=null,T.push({i:_,x:xR(s,u)})),o=vk.lastIndex;return o<n.length&&(f=n.slice(o),E[_]?E[_]+=f:E[++_]=f),E.length<2?T[0]?zve(T[0].x):Kve(n):(n=T.length,function(w){for(var I=0,A;I<n;++I)E[(A=T[I]).i]=A.x(w);return E.join("")})}function u_(i,n){var o=typeof n,s;return n==null||o==="boolean"?y2(n):(o==="number"?xR:o==="string"?(s=oS(n))?(n=s,y$):$ve:n instanceof oS?y$:n instanceof Date?Hve:Wve(n)?Bve:Array.isArray(n)?Gve:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?qve:xR)(i,n)}function E2(i,n){return i=+i,n=+n,function(o){return Math.round(i*(1-o)+n*o)}}function Yve(i,n){n===void 0&&(n=i,i=u_);for(var o=0,s=n.length-1,u=n[0],f=new Array(s<0?0:s);o<s;)f[o]=i(u,u=n[++o]);return function(_){var E=Math.max(0,Math.min(s-1,Math.floor(_*=s)));return f[E](_-E)}}function Xve(i){return function(){return i}}function kR(i){return+i}var E$=[0,1];function Ua(i){return i}function zL(i,n){return(n-=i=+i)?function(o){return(o-i)/n}:Xve(isNaN(n)?NaN:.5)}function Jve(i,n){var o;return i>n&&(o=i,i=n,n=o),function(s){return Math.max(i,Math.min(n,s))}}function Qve(i,n,o){var s=i[0],u=i[1],f=n[0],_=n[1];return u<s?(s=zL(u,s),f=o(_,f)):(s=zL(s,u),f=o(f,_)),function(E){return f(s(E))}}function Zve(i,n,o){var s=Math.min(i.length,n.length)-1,u=new Array(s),f=new Array(s),_=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),n=n.slice().reverse());++_<s;)u[_]=zL(i[_],i[_+1]),f[_]=o(n[_],n[_+1]);return function(E){var T=jS(i,E,1,s)-1;return f[T](u[T](E))}}function FS(i,n){return n.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function MC(){var i=E$,n=E$,o=u_,s,u,f,_=Ua,E,T,w;function I(){var P=Math.min(i.length,n.length);return _!==Ua&&(_=Jve(i[0],i[P-1])),E=P>2?Zve:Qve,T=w=null,A}function A(P){return P==null||isNaN(P=+P)?f:(T||(T=E(i.map(s),n,o)))(s(_(P)))}return A.invert=function(P){return _(u((w||(w=E(n,i.map(s),xR)))(P)))},A.domain=function(P){return arguments.length?(i=Array.from(P,kR),I()):i.slice()},A.range=function(P){return arguments.length?(n=Array.from(P),I()):n.slice()},A.rangeRound=function(P){return n=Array.from(P),o=E2,I()},A.clamp=function(P){return arguments.length?(_=P?!0:Ua,I()):_!==Ua},A.interpolate=function(P){return arguments.length?(o=P,I()):o},A.unknown=function(P){return arguments.length?(f=P,A):f},function(P,j){return s=P,u=j,I()}}function S2(){return MC()(Ua,Ua)}function eye(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function LR(i,n){if((o=(i=n?i.toExponential(n-1):i.toExponential()).indexOf("e"))<0)return null;var o,s=i.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+i.slice(o+1)]}function Mg(i){return i=LR(Math.abs(i)),i?i[1]:NaN}function tye(i,n){return function(o,s){for(var u=o.length,f=[],_=0,E=i[0],T=0;u>0&&E>0&&(T+E+1>s&&(E=Math.max(1,s-T)),f.push(o.substring(u-=E,u+E)),!((T+=E+1)>s));)E=i[_=(_+1)%i.length];return f.reverse().join(n)}}function rye(i){return function(n){return n.replace(/[0-9]/g,function(o){return i[+o]})}}var nye=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sS(i){if(!(n=nye.exec(i)))throw new Error("invalid format: "+i);var n;return new b2({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}sS.prototype=b2.prototype;function b2(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}b2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function iye(i){e:for(var n=i.length,o=1,s=-1,u;o<n;++o)switch(i[o]){case".":s=u=o;break;case"0":s===0&&(s=o),u=o;break;default:if(!+i[o])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(u+1):i}var ZX;function aye(i,n){var o=LR(i,n);if(!o)return i+"";var s=o[0],u=o[1],f=u-(ZX=Math.max(-8,Math.min(8,Math.floor(u/3)))*3)+1,_=s.length;return f===_?s:f>_?s+new Array(f-_+1).join("0"):f>0?s.slice(0,f)+"."+s.slice(f):"0."+new Array(1-f).join("0")+LR(i,Math.max(0,n+f-1))[0]}function S$(i,n){var o=LR(i,n);if(!o)return i+"";var s=o[0],u=o[1];return u<0?"0."+new Array(-u).join("0")+s:s.length>u+1?s.slice(0,u+1)+"."+s.slice(u+1):s+new Array(u-s.length+2).join("0")}const b$={"%":(i,n)=>(i*100).toFixed(n),b:i=>Math.round(i).toString(2),c:i=>i+"",d:eye,e:(i,n)=>i.toExponential(n),f:(i,n)=>i.toFixed(n),g:(i,n)=>i.toPrecision(n),o:i=>Math.round(i).toString(8),p:(i,n)=>S$(i*100,n),r:S$,s:aye,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function T$(i){return i}var w$=Array.prototype.map,R$=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function oye(i){var n=i.grouping===void 0||i.thousands===void 0?T$:tye(w$.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",u=i.decimal===void 0?".":i.decimal+"",f=i.numerals===void 0?T$:rye(w$.call(i.numerals,String)),_=i.percent===void 0?"%":i.percent+"",E=i.minus===void 0?"−":i.minus+"",T=i.nan===void 0?"NaN":i.nan+"";function w(A){A=sS(A);var P=A.fill,j=A.align,W=A.sign,F=A.symbol,M=A.zero,X=A.width,Y=A.comma,J=A.precision,re=A.trim,z=A.type;z==="n"?(Y=!0,z="g"):b$[z]||(J===void 0&&(J=12),re=!0,z="g"),(M||P==="0"&&j==="=")&&(M=!0,P="0",j="=");var Z=F==="$"?o:F==="#"&&/[boxX]/.test(z)?"0"+z.toLowerCase():"",ie=F==="$"?s:/[%p]/.test(z)?_:"",de=b$[z],ge=/[defgprs%]/.test(z);J=J===void 0?6:/[gprs]/.test(z)?Math.max(1,Math.min(21,J)):Math.max(0,Math.min(20,J));function Oe(me){var ye=Z,Ae=ie,be,ke,Me;if(z==="c")Ae=de(me)+Ae,me="";else{me=+me;var Ue=me<0||1/me<0;if(me=isNaN(me)?T:de(Math.abs(me),J),re&&(me=iye(me)),Ue&&+me==0&&W!=="+"&&(Ue=!1),ye=(Ue?W==="("?W:E:W==="-"||W==="("?"":W)+ye,Ae=(z==="s"?R$[8+ZX/3]:"")+Ae+(Ue&&W==="("?")":""),ge){for(be=-1,ke=me.length;++be<ke;)if(Me=me.charCodeAt(be),48>Me||Me>57){Ae=(Me===46?u+me.slice(be+1):me.slice(be))+Ae,me=me.slice(0,be);break}}}Y&&!M&&(me=n(me,1/0));var Pe=ye.length+me.length+Ae.length,We=Pe<X?new Array(X-Pe+1).join(P):"";switch(Y&&M&&(me=n(We+me,We.length?X-Ae.length:1/0),We=""),j){case"<":me=ye+me+Ae+We;break;case"=":me=ye+We+me+Ae;break;case"^":me=We.slice(0,Pe=We.length>>1)+ye+me+Ae+We.slice(Pe);break;default:me=We+ye+me+Ae;break}return f(me)}return Oe.toString=function(){return A+""},Oe}function I(A,P){var j=w((A=sS(A),A.type="f",A)),W=Math.max(-8,Math.min(8,Math.floor(Mg(P)/3)))*3,F=Math.pow(10,-W),M=R$[8+W/3];return function(X){return j(F*X)+M}}return{format:w,formatPrefix:I}}var oR,T2,eJ;sye({thousands:",",grouping:[3],currency:["$",""]});function sye(i){return oR=oye(i),T2=oR.format,eJ=oR.formatPrefix,oR}function cye(i){return Math.max(0,-Mg(Math.abs(i)))}function lye(i,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Mg(n)/3)))*3-Mg(Math.abs(i)))}function uye(i,n){return i=Math.abs(i),n=Math.abs(n)-i,Math.max(0,Mg(n)-Mg(i))+1}function tJ(i,n,o,s){var u=GL(i,n,o),f;switch(s=sS(s??",f"),s.type){case"s":{var _=Math.max(Math.abs(i),Math.abs(n));return s.precision==null&&!isNaN(f=lye(u,_))&&(s.precision=f),eJ(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(f=uye(u,Math.max(Math.abs(i),Math.abs(n))))&&(s.precision=f-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(f=cye(u))&&(s.precision=f-(s.type==="%")*2);break}}return T2(s)}function Kd(i){var n=i.domain;return i.ticks=function(o){var s=n();return BL(s[0],s[s.length-1],o??10)},i.tickFormat=function(o,s){var u=n();return tJ(u[0],u[u.length-1],o??10,s)},i.nice=function(o){o==null&&(o=10);var s=n(),u=0,f=s.length-1,_=s[u],E=s[f],T,w,I=10;for(E<_&&(w=_,_=E,E=w,w=u,u=f,f=w);I-- >0;){if(w=WL(_,E,o),w===T)return s[u]=_,s[f]=E,n(s);if(w>0)_=Math.floor(_/w)*w,E=Math.ceil(E/w)*w;else if(w<0)_=Math.ceil(_*w)/w,E=Math.floor(E*w)/w;else break;T=w}return i},i}function MR(){var i=S2();return i.copy=function(){return FS(i,MR())},Ss.apply(i,arguments),Kd(i)}function rJ(i){var n;function o(s){return s==null||isNaN(s=+s)?n:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(i=Array.from(s,kR),o):i.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.copy=function(){return rJ(i).unknown(n)},i=arguments.length?Array.from(i,kR):[0,1],Kd(o)}function nJ(i,n){i=i.slice();var o=0,s=i.length-1,u=i[o],f=i[s],_;return f<u&&(_=o,o=s,s=_,_=u,u=f,f=_),i[o]=n.floor(u),i[s]=n.ceil(f),i}function C$(i){return Math.log(i)}function A$(i){return Math.exp(i)}function dye(i){return-Math.log(-i)}function hye(i){return-Math.exp(-i)}function pye(i){return isFinite(i)?+("1e"+i):i<0?0:i}function fye(i){return i===10?pye:i===Math.E?Math.exp:n=>Math.pow(i,n)}function mye(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),n=>Math.log(n)/i)}function O$(i){return(n,o)=>-i(-n,o)}function w2(i){const n=i(C$,A$),o=n.domain;let s=10,u,f;function _(){return u=mye(s),f=fye(s),o()[0]<0?(u=O$(u),f=O$(f),i(dye,hye)):i(C$,A$),n}return n.base=function(E){return arguments.length?(s=+E,_()):s},n.domain=function(E){return arguments.length?(o(E),_()):o()},n.ticks=E=>{const T=o();let w=T[0],I=T[T.length-1];const A=I<w;A&&([w,I]=[I,w]);let P=u(w),j=u(I),W,F;const M=E==null?10:+E;let X=[];if(!(s%1)&&j-P<M){if(P=Math.floor(P),j=Math.ceil(j),w>0){for(;P<=j;++P)for(W=1;W<s;++W)if(F=P<0?W/f(-P):W*f(P),!(F<w)){if(F>I)break;X.push(F)}}else for(;P<=j;++P)for(W=s-1;W>=1;--W)if(F=P>0?W/f(-P):W*f(P),!(F<w)){if(F>I)break;X.push(F)}X.length*2<M&&(X=BL(w,I,M))}else X=BL(P,j,Math.min(j-P,M)).map(f);return A?X.reverse():X},n.tickFormat=(E,T)=>{if(E==null&&(E=10),T==null&&(T=s===10?"s":","),typeof T!="function"&&(!(s%1)&&(T=sS(T)).precision==null&&(T.trim=!0),T=T2(T)),E===1/0)return T;const w=Math.max(1,s*E/n.ticks().length);return I=>{let A=I/f(Math.round(u(I)));return A*s<s-.5&&(A*=s),A<=w?T(I):""}},n.nice=()=>o(nJ(o(),{floor:E=>f(Math.floor(u(E))),ceil:E=>f(Math.ceil(u(E)))})),n}function iJ(){const i=w2(MC()).domain([1,10]);return i.copy=()=>FS(i,iJ()).base(i.base()),Ss.apply(i,arguments),i}function I$(i){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/i))}}function N$(i){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*i}}function R2(i){var n=1,o=i(I$(n),N$(n));return o.constant=function(s){return arguments.length?i(I$(n=+s),N$(n)):n},Kd(o)}function aJ(){var i=R2(MC());return i.copy=function(){return FS(i,aJ()).constant(i.constant())},Ss.apply(i,arguments)}function P$(i){return function(n){return n<0?-Math.pow(-n,i):Math.pow(n,i)}}function gye(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function _ye(i){return i<0?-i*i:i*i}function C2(i){var n=i(Ua,Ua),o=1;function s(){return o===1?i(Ua,Ua):o===.5?i(gye,_ye):i(P$(o),P$(1/o))}return n.exponent=function(u){return arguments.length?(o=+u,s()):o},Kd(n)}function A2(){var i=C2(MC());return i.copy=function(){return FS(i,A2()).exponent(i.exponent())},Ss.apply(i,arguments),i}function vye(){return A2.apply(null,arguments).exponent(.5)}function D$(i){return Math.sign(i)*i*i}function yye(i){return Math.sign(i)*Math.sqrt(Math.abs(i))}function oJ(){var i=S2(),n=[0,1],o=!1,s;function u(f){var _=yye(i(f));return isNaN(_)?s:o?Math.round(_):_}return u.invert=function(f){return i.invert(D$(f))},u.domain=function(f){return arguments.length?(i.domain(f),u):i.domain()},u.range=function(f){return arguments.length?(i.range((n=Array.from(f,kR)).map(D$)),u):n.slice()},u.rangeRound=function(f){return u.range(f).round(!0)},u.round=function(f){return arguments.length?(o=!!f,u):o},u.clamp=function(f){return arguments.length?(i.clamp(f),u):i.clamp()},u.unknown=function(f){return arguments.length?(s=f,u):s},u.copy=function(){return oJ(i.domain(),n).round(o).clamp(i.clamp()).unknown(s)},Ss.apply(u,arguments),Kd(u)}function sJ(){var i=[],n=[],o=[],s;function u(){var _=0,E=Math.max(1,n.length);for(o=new Array(E-1);++_<E;)o[_-1]=wve(i,_/E);return f}function f(_){return _==null||isNaN(_=+_)?s:n[jS(o,_)]}return f.invertExtent=function(_){var E=n.indexOf(_);return E<0?[NaN,NaN]:[E>0?o[E-1]:i[0],E<o.length?o[E]:i[i.length-1]]},f.domain=function(_){if(!arguments.length)return i.slice();i=[];for(let E of _)E!=null&&!isNaN(E=+E)&&i.push(E);return i.sort(Fd),u()},f.range=function(_){return arguments.length?(n=Array.from(_),u()):n.slice()},f.unknown=function(_){return arguments.length?(s=_,f):s},f.quantiles=function(){return o.slice()},f.copy=function(){return sJ().domain(i).range(n).unknown(s)},Ss.apply(f,arguments)}function cJ(){var i=0,n=1,o=1,s=[.5],u=[0,1],f;function _(T){return T!=null&&T<=T?u[jS(s,T,0,o)]:f}function E(){var T=-1;for(s=new Array(o);++T<o;)s[T]=((T+1)*n-(T-o)*i)/(o+1);return _}return _.domain=function(T){return arguments.length?([i,n]=T,i=+i,n=+n,E()):[i,n]},_.range=function(T){return arguments.length?(o=(u=Array.from(T)).length-1,E()):u.slice()},_.invertExtent=function(T){var w=u.indexOf(T);return w<0?[NaN,NaN]:w<1?[i,s[0]]:w>=o?[s[o-1],n]:[s[w-1],s[w]]},_.unknown=function(T){return arguments.length&&(f=T),_},_.thresholds=function(){return s.slice()},_.copy=function(){return cJ().domain([i,n]).range(u).unknown(f)},Ss.apply(Kd(_),arguments)}function lJ(){var i=[.5],n=[0,1],o,s=1;function u(f){return f!=null&&f<=f?n[jS(i,f,0,s)]:o}return u.domain=function(f){return arguments.length?(i=Array.from(f),s=Math.min(i.length,n.length-1),u):i.slice()},u.range=function(f){return arguments.length?(n=Array.from(f),s=Math.min(i.length,n.length-1),u):n.slice()},u.invertExtent=function(f){var _=n.indexOf(f);return[i[_-1],i[_]]},u.unknown=function(f){return arguments.length?(o=f,u):o},u.copy=function(){return lJ().domain(i).range(n).unknown(o)},Ss.apply(u,arguments)}const yk=new Date,Ek=new Date;function Ii(i,n,o,s){function u(f){return i(f=arguments.length===0?new Date:new Date(+f)),f}return u.floor=f=>(i(f=new Date(+f)),f),u.ceil=f=>(i(f=new Date(f-1)),n(f,1),i(f),f),u.round=f=>{const _=u(f),E=u.ceil(f);return f-_<E-f?_:E},u.offset=(f,_)=>(n(f=new Date(+f),_==null?1:Math.floor(_)),f),u.range=(f,_,E)=>{const T=[];if(f=u.ceil(f),E=E==null?1:Math.floor(E),!(f<_)||!(E>0))return T;let w;do T.push(w=new Date(+f)),n(f,E),i(f);while(w<f&&f<_);return T},u.filter=f=>Ii(_=>{if(_>=_)for(;i(_),!f(_);)_.setTime(_-1)},(_,E)=>{if(_>=_)if(E<0)for(;++E<=0;)for(;n(_,-1),!f(_););else for(;--E>=0;)for(;n(_,1),!f(_););}),o&&(u.count=(f,_)=>(yk.setTime(+f),Ek.setTime(+_),i(yk),i(Ek),Math.floor(o(yk,Ek))),u.every=f=>(f=Math.floor(f),!isFinite(f)||!(f>0)?null:f>1?u.filter(s?_=>s(_)%f===0:_=>u.count(0,_)%f===0):u)),u}const UR=Ii(()=>{},(i,n)=>{i.setTime(+i+n)},(i,n)=>n-i);UR.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?Ii(n=>{n.setTime(Math.floor(n/i)*i)},(n,o)=>{n.setTime(+n+o*i)},(n,o)=>(o-n)/i):UR);UR.range;const iu=1e3,ys=iu*60,au=ys*60,uu=au*24,O2=uu*7,x$=uu*30,Sk=uu*365,jp=Ii(i=>{i.setTime(i-i.getMilliseconds())},(i,n)=>{i.setTime(+i+n*iu)},(i,n)=>(n-i)/iu,i=>i.getUTCSeconds());jp.range;const I2=Ii(i=>{i.setTime(i-i.getMilliseconds()-i.getSeconds()*iu)},(i,n)=>{i.setTime(+i+n*ys)},(i,n)=>(n-i)/ys,i=>i.getMinutes());I2.range;const N2=Ii(i=>{i.setUTCSeconds(0,0)},(i,n)=>{i.setTime(+i+n*ys)},(i,n)=>(n-i)/ys,i=>i.getUTCMinutes());N2.range;const P2=Ii(i=>{i.setTime(i-i.getMilliseconds()-i.getSeconds()*iu-i.getMinutes()*ys)},(i,n)=>{i.setTime(+i+n*au)},(i,n)=>(n-i)/au,i=>i.getHours());P2.range;const D2=Ii(i=>{i.setUTCMinutes(0,0,0)},(i,n)=>{i.setTime(+i+n*au)},(i,n)=>(n-i)/au,i=>i.getUTCHours());D2.range;const BS=Ii(i=>i.setHours(0,0,0,0),(i,n)=>i.setDate(i.getDate()+n),(i,n)=>(n-i-(n.getTimezoneOffset()-i.getTimezoneOffset())*ys)/uu,i=>i.getDate()-1);BS.range;const UC=Ii(i=>{i.setUTCHours(0,0,0,0)},(i,n)=>{i.setUTCDate(i.getUTCDate()+n)},(i,n)=>(n-i)/uu,i=>i.getUTCDate()-1);UC.range;const uJ=Ii(i=>{i.setUTCHours(0,0,0,0)},(i,n)=>{i.setUTCDate(i.getUTCDate()+n)},(i,n)=>(n-i)/uu,i=>Math.floor(i/uu));uJ.range;function Yp(i){return Ii(n=>{n.setDate(n.getDate()-(n.getDay()+7-i)%7),n.setHours(0,0,0,0)},(n,o)=>{n.setDate(n.getDate()+o*7)},(n,o)=>(o-n-(o.getTimezoneOffset()-n.getTimezoneOffset())*ys)/O2)}const jC=Yp(0),jR=Yp(1),Eye=Yp(2),Sye=Yp(3),Ug=Yp(4),bye=Yp(5),Tye=Yp(6);jC.range;jR.range;Eye.range;Sye.range;Ug.range;bye.range;Tye.range;function Xp(i){return Ii(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-i)%7),n.setUTCHours(0,0,0,0)},(n,o)=>{n.setUTCDate(n.getUTCDate()+o*7)},(n,o)=>(o-n)/O2)}const VC=Xp(0),VR=Xp(1),wye=Xp(2),Rye=Xp(3),jg=Xp(4),Cye=Xp(5),Aye=Xp(6);VC.range;VR.range;wye.range;Rye.range;jg.range;Cye.range;Aye.range;const x2=Ii(i=>{i.setDate(1),i.setHours(0,0,0,0)},(i,n)=>{i.setMonth(i.getMonth()+n)},(i,n)=>n.getMonth()-i.getMonth()+(n.getFullYear()-i.getFullYear())*12,i=>i.getMonth());x2.range;const k2=Ii(i=>{i.setUTCDate(1),i.setUTCHours(0,0,0,0)},(i,n)=>{i.setUTCMonth(i.getUTCMonth()+n)},(i,n)=>n.getUTCMonth()-i.getUTCMonth()+(n.getUTCFullYear()-i.getUTCFullYear())*12,i=>i.getUTCMonth());k2.range;const du=Ii(i=>{i.setMonth(0,1),i.setHours(0,0,0,0)},(i,n)=>{i.setFullYear(i.getFullYear()+n)},(i,n)=>n.getFullYear()-i.getFullYear(),i=>i.getFullYear());du.every=i=>!isFinite(i=Math.floor(i))||!(i>0)?null:Ii(n=>{n.setFullYear(Math.floor(n.getFullYear()/i)*i),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,o)=>{n.setFullYear(n.getFullYear()+o*i)});du.range;const hu=Ii(i=>{i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},(i,n)=>{i.setUTCFullYear(i.getUTCFullYear()+n)},(i,n)=>n.getUTCFullYear()-i.getUTCFullYear(),i=>i.getUTCFullYear());hu.every=i=>!isFinite(i=Math.floor(i))||!(i>0)?null:Ii(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/i)*i),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,o)=>{n.setUTCFullYear(n.getUTCFullYear()+o*i)});hu.range;function dJ(i,n,o,s,u,f){const _=[[jp,1,iu],[jp,5,5*iu],[jp,15,15*iu],[jp,30,30*iu],[f,1,ys],[f,5,5*ys],[f,15,15*ys],[f,30,30*ys],[u,1,au],[u,3,3*au],[u,6,6*au],[u,12,12*au],[s,1,uu],[s,2,2*uu],[o,1,O2],[n,1,x$],[n,3,3*x$],[i,1,Sk]];function E(w,I,A){const P=I<w;P&&([w,I]=[I,w]);const j=A&&typeof A.range=="function"?A:T(w,I,A),W=j?j.range(w,+I+1):[];return P?W.reverse():W}function T(w,I,A){const P=Math.abs(I-w)/A,j=g2(([,,M])=>M).right(_,P);if(j===_.length)return i.every(GL(w/Sk,I/Sk,A));if(j===0)return UR.every(Math.max(GL(w,I,A),1));const[W,F]=_[P/_[j-1][2]<_[j][2]/P?j-1:j];return W.every(F)}return[E,T]}const[Oye,Iye]=dJ(hu,k2,VC,uJ,D2,N2),[Nye,Pye]=dJ(du,x2,jC,BS,P2,I2);function bk(i){if(0<=i.y&&i.y<100){var n=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return n.setFullYear(i.y),n}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function Tk(i){if(0<=i.y&&i.y<100){var n=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return n.setUTCFullYear(i.y),n}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function NE(i,n,o){return{y:i,m:n,d:o,H:0,M:0,S:0,L:0}}function Dye(i){var n=i.dateTime,o=i.date,s=i.time,u=i.periods,f=i.days,_=i.shortDays,E=i.months,T=i.shortMonths,w=PE(u),I=DE(u),A=PE(f),P=DE(f),j=PE(_),W=DE(_),F=PE(E),M=DE(E),X=PE(T),Y=DE(T),J={a:Ue,A:Pe,b:We,B:He,c:null,d:V$,e:V$,f:tEe,g:dEe,G:pEe,H:Qye,I:Zye,j:eEe,L:hJ,m:rEe,M:nEe,p:fe,q:Ce,Q:W$,s:G$,S:iEe,u:aEe,U:oEe,V:sEe,w:cEe,W:lEe,x:null,X:null,y:uEe,Y:hEe,Z:fEe,"%":B$},re={a:ot,A:_t,b:Lt,B:Yt,c:null,d:F$,e:F$,f:vEe,g:OEe,G:NEe,H:mEe,I:gEe,j:_Ee,L:fJ,m:yEe,M:EEe,p:br,q:Qt,Q:W$,s:G$,S:SEe,u:bEe,U:TEe,V:wEe,w:REe,W:CEe,x:null,X:null,y:AEe,Y:IEe,Z:PEe,"%":B$},z={a:Oe,A:me,b:ye,B:Ae,c:be,d:U$,e:U$,f:$ye,g:M$,G:L$,H:j$,I:j$,j:Hye,L:zye,m:Gye,M:qye,p:ge,q:Wye,Q:Xye,s:Jye,S:Kye,u:Uye,U:jye,V:Vye,w:Mye,W:Fye,x:ke,X:Me,y:M$,Y:L$,Z:Bye,"%":Yye};J.x=Z(o,J),J.X=Z(s,J),J.c=Z(n,J),re.x=Z(o,re),re.X=Z(s,re),re.c=Z(n,re);function Z(nt,It){return function(Zt){var rt=[],Or=-1,vr=0,Dn=nt.length,qr,pi,en;for(Zt instanceof Date||(Zt=new Date(+Zt));++Or<Dn;)nt.charCodeAt(Or)===37&&(rt.push(nt.slice(vr,Or)),(pi=k$[qr=nt.charAt(++Or)])!=null?qr=nt.charAt(++Or):pi=qr==="e"?" ":"0",(en=It[qr])&&(qr=en(Zt,pi)),rt.push(qr),vr=Or+1);return rt.push(nt.slice(vr,Or)),rt.join("")}}function ie(nt,It){return function(Zt){var rt=NE(1900,void 0,1),Or=de(rt,nt,Zt+="",0),vr,Dn;if(Or!=Zt.length)return null;if("Q"in rt)return new Date(rt.Q);if("s"in rt)return new Date(rt.s*1e3+("L"in rt?rt.L:0));if(It&&!("Z"in rt)&&(rt.Z=0),"p"in rt&&(rt.H=rt.H%12+rt.p*12),rt.m===void 0&&(rt.m="q"in rt?rt.q:0),"V"in rt){if(rt.V<1||rt.V>53)return null;"w"in rt||(rt.w=1),"Z"in rt?(vr=Tk(NE(rt.y,0,1)),Dn=vr.getUTCDay(),vr=Dn>4||Dn===0?VR.ceil(vr):VR(vr),vr=UC.offset(vr,(rt.V-1)*7),rt.y=vr.getUTCFullYear(),rt.m=vr.getUTCMonth(),rt.d=vr.getUTCDate()+(rt.w+6)%7):(vr=bk(NE(rt.y,0,1)),Dn=vr.getDay(),vr=Dn>4||Dn===0?jR.ceil(vr):jR(vr),vr=BS.offset(vr,(rt.V-1)*7),rt.y=vr.getFullYear(),rt.m=vr.getMonth(),rt.d=vr.getDate()+(rt.w+6)%7)}else("W"in rt||"U"in rt)&&("w"in rt||(rt.w="u"in rt?rt.u%7:"W"in rt?1:0),Dn="Z"in rt?Tk(NE(rt.y,0,1)).getUTCDay():bk(NE(rt.y,0,1)).getDay(),rt.m=0,rt.d="W"in rt?(rt.w+6)%7+rt.W*7-(Dn+5)%7:rt.w+rt.U*7-(Dn+6)%7);return"Z"in rt?(rt.H+=rt.Z/100|0,rt.M+=rt.Z%100,Tk(rt)):bk(rt)}}function de(nt,It,Zt,rt){for(var Or=0,vr=It.length,Dn=Zt.length,qr,pi;Or<vr;){if(rt>=Dn)return-1;if(qr=It.charCodeAt(Or++),qr===37){if(qr=It.charAt(Or++),pi=z[qr in k$?It.charAt(Or++):qr],!pi||(rt=pi(nt,Zt,rt))<0)return-1}else if(qr!=Zt.charCodeAt(rt++))return-1}return rt}function ge(nt,It,Zt){var rt=w.exec(It.slice(Zt));return rt?(nt.p=I.get(rt[0].toLowerCase()),Zt+rt[0].length):-1}function Oe(nt,It,Zt){var rt=j.exec(It.slice(Zt));return rt?(nt.w=W.get(rt[0].toLowerCase()),Zt+rt[0].length):-1}function me(nt,It,Zt){var rt=A.exec(It.slice(Zt));return rt?(nt.w=P.get(rt[0].toLowerCase()),Zt+rt[0].length):-1}function ye(nt,It,Zt){var rt=X.exec(It.slice(Zt));return rt?(nt.m=Y.get(rt[0].toLowerCase()),Zt+rt[0].length):-1}function Ae(nt,It,Zt){var rt=F.exec(It.slice(Zt));return rt?(nt.m=M.get(rt[0].toLowerCase()),Zt+rt[0].length):-1}function be(nt,It,Zt){return de(nt,n,It,Zt)}function ke(nt,It,Zt){return de(nt,o,It,Zt)}function Me(nt,It,Zt){return de(nt,s,It,Zt)}function Ue(nt){return _[nt.getDay()]}function Pe(nt){return f[nt.getDay()]}function We(nt){return T[nt.getMonth()]}function He(nt){return E[nt.getMonth()]}function fe(nt){return u[+(nt.getHours()>=12)]}function Ce(nt){return 1+~~(nt.getMonth()/3)}function ot(nt){return _[nt.getUTCDay()]}function _t(nt){return f[nt.getUTCDay()]}function Lt(nt){return T[nt.getUTCMonth()]}function Yt(nt){return E[nt.getUTCMonth()]}function br(nt){return u[+(nt.getUTCHours()>=12)]}function Qt(nt){return 1+~~(nt.getUTCMonth()/3)}return{format:function(nt){var It=Z(nt+="",J);return It.toString=function(){return nt},It},parse:function(nt){var It=ie(nt+="",!1);return It.toString=function(){return nt},It},utcFormat:function(nt){var It=Z(nt+="",re);return It.toString=function(){return nt},It},utcParse:function(nt){var It=ie(nt+="",!0);return It.toString=function(){return nt},It}}}var k$={"-":"",_:" ",0:"0"},Ki=/^\s*\d+/,xye=/^%/,kye=/[\\^$*+?|[\]().{}]/g;function Hr(i,n,o){var s=i<0?"-":"",u=(s?-i:i)+"",f=u.length;return s+(f<o?new Array(o-f+1).join(n)+u:u)}function Lye(i){return i.replace(kye,"\\$&")}function PE(i){return new RegExp("^(?:"+i.map(Lye).join("|")+")","i")}function DE(i){return new Map(i.map((n,o)=>[n.toLowerCase(),o]))}function Mye(i,n,o){var s=Ki.exec(n.slice(o,o+1));return s?(i.w=+s[0],o+s[0].length):-1}function Uye(i,n,o){var s=Ki.exec(n.slice(o,o+1));return s?(i.u=+s[0],o+s[0].length):-1}function jye(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.U=+s[0],o+s[0].length):-1}function Vye(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.V=+s[0],o+s[0].length):-1}function Fye(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.W=+s[0],o+s[0].length):-1}function L$(i,n,o){var s=Ki.exec(n.slice(o,o+4));return s?(i.y=+s[0],o+s[0].length):-1}function M$(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function Bye(i,n,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(o,o+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Wye(i,n,o){var s=Ki.exec(n.slice(o,o+1));return s?(i.q=s[0]*3-3,o+s[0].length):-1}function Gye(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.m=s[0]-1,o+s[0].length):-1}function U$(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.d=+s[0],o+s[0].length):-1}function Hye(i,n,o){var s=Ki.exec(n.slice(o,o+3));return s?(i.m=0,i.d=+s[0],o+s[0].length):-1}function j$(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.H=+s[0],o+s[0].length):-1}function qye(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.M=+s[0],o+s[0].length):-1}function Kye(i,n,o){var s=Ki.exec(n.slice(o,o+2));return s?(i.S=+s[0],o+s[0].length):-1}function zye(i,n,o){var s=Ki.exec(n.slice(o,o+3));return s?(i.L=+s[0],o+s[0].length):-1}function $ye(i,n,o){var s=Ki.exec(n.slice(o,o+6));return s?(i.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function Yye(i,n,o){var s=xye.exec(n.slice(o,o+1));return s?o+s[0].length:-1}function Xye(i,n,o){var s=Ki.exec(n.slice(o));return s?(i.Q=+s[0],o+s[0].length):-1}function Jye(i,n,o){var s=Ki.exec(n.slice(o));return s?(i.s=+s[0],o+s[0].length):-1}function V$(i,n){return Hr(i.getDate(),n,2)}function Qye(i,n){return Hr(i.getHours(),n,2)}function Zye(i,n){return Hr(i.getHours()%12||12,n,2)}function eEe(i,n){return Hr(1+BS.count(du(i),i),n,3)}function hJ(i,n){return Hr(i.getMilliseconds(),n,3)}function tEe(i,n){return hJ(i,n)+"000"}function rEe(i,n){return Hr(i.getMonth()+1,n,2)}function nEe(i,n){return Hr(i.getMinutes(),n,2)}function iEe(i,n){return Hr(i.getSeconds(),n,2)}function aEe(i){var n=i.getDay();return n===0?7:n}function oEe(i,n){return Hr(jC.count(du(i)-1,i),n,2)}function pJ(i){var n=i.getDay();return n>=4||n===0?Ug(i):Ug.ceil(i)}function sEe(i,n){return i=pJ(i),Hr(Ug.count(du(i),i)+(du(i).getDay()===4),n,2)}function cEe(i){return i.getDay()}function lEe(i,n){return Hr(jR.count(du(i)-1,i),n,2)}function uEe(i,n){return Hr(i.getFullYear()%100,n,2)}function dEe(i,n){return i=pJ(i),Hr(i.getFullYear()%100,n,2)}function hEe(i,n){return Hr(i.getFullYear()%1e4,n,4)}function pEe(i,n){var o=i.getDay();return i=o>=4||o===0?Ug(i):Ug.ceil(i),Hr(i.getFullYear()%1e4,n,4)}function fEe(i){var n=i.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Hr(n/60|0,"0",2)+Hr(n%60,"0",2)}function F$(i,n){return Hr(i.getUTCDate(),n,2)}function mEe(i,n){return Hr(i.getUTCHours(),n,2)}function gEe(i,n){return Hr(i.getUTCHours()%12||12,n,2)}function _Ee(i,n){return Hr(1+UC.count(hu(i),i),n,3)}function fJ(i,n){return Hr(i.getUTCMilliseconds(),n,3)}function vEe(i,n){return fJ(i,n)+"000"}function yEe(i,n){return Hr(i.getUTCMonth()+1,n,2)}function EEe(i,n){return Hr(i.getUTCMinutes(),n,2)}function SEe(i,n){return Hr(i.getUTCSeconds(),n,2)}function bEe(i){var n=i.getUTCDay();return n===0?7:n}function TEe(i,n){return Hr(VC.count(hu(i)-1,i),n,2)}function mJ(i){var n=i.getUTCDay();return n>=4||n===0?jg(i):jg.ceil(i)}function wEe(i,n){return i=mJ(i),Hr(jg.count(hu(i),i)+(hu(i).getUTCDay()===4),n,2)}function REe(i){return i.getUTCDay()}function CEe(i,n){return Hr(VR.count(hu(i)-1,i),n,2)}function AEe(i,n){return Hr(i.getUTCFullYear()%100,n,2)}function OEe(i,n){return i=mJ(i),Hr(i.getUTCFullYear()%100,n,2)}function IEe(i,n){return Hr(i.getUTCFullYear()%1e4,n,4)}function NEe(i,n){var o=i.getUTCDay();return i=o>=4||o===0?jg(i):jg.ceil(i),Hr(i.getUTCFullYear()%1e4,n,4)}function PEe(){return"+0000"}function B$(){return"%"}function W$(i){return+i}function G$(i){return Math.floor(+i/1e3)}var mg,gJ,_J;DEe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function DEe(i){return mg=Dye(i),gJ=mg.format,mg.parse,_J=mg.utcFormat,mg.utcParse,mg}function xEe(i){return new Date(i)}function kEe(i){return i instanceof Date?+i:+new Date(+i)}function L2(i,n,o,s,u,f,_,E,T,w){var I=S2(),A=I.invert,P=I.domain,j=w(".%L"),W=w(":%S"),F=w("%I:%M"),M=w("%I %p"),X=w("%a %d"),Y=w("%b %d"),J=w("%B"),re=w("%Y");function z(Z){return(T(Z)<Z?j:E(Z)<Z?W:_(Z)<Z?F:f(Z)<Z?M:s(Z)<Z?u(Z)<Z?X:Y:o(Z)<Z?J:re)(Z)}return I.invert=function(Z){return new Date(A(Z))},I.domain=function(Z){return arguments.length?P(Array.from(Z,kEe)):P().map(xEe)},I.ticks=function(Z){var ie=P();return i(ie[0],ie[ie.length-1],Z??10)},I.tickFormat=function(Z,ie){return ie==null?z:w(ie)},I.nice=function(Z){var ie=P();return(!Z||typeof Z.range!="function")&&(Z=n(ie[0],ie[ie.length-1],Z??10)),Z?P(nJ(ie,Z)):I},I.copy=function(){return FS(I,L2(i,n,o,s,u,f,_,E,T,w))},I}function LEe(){return Ss.apply(L2(Nye,Pye,du,x2,jC,BS,P2,I2,jp,gJ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function MEe(){return Ss.apply(L2(Oye,Iye,hu,k2,VC,UC,D2,N2,jp,_J).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function FC(){var i=0,n=1,o,s,u,f,_=Ua,E=!1,T;function w(A){return A==null||isNaN(A=+A)?T:_(u===0?.5:(A=(f(A)-o)*u,E?Math.max(0,Math.min(1,A)):A))}w.domain=function(A){return arguments.length?([i,n]=A,o=f(i=+i),s=f(n=+n),u=o===s?0:1/(s-o),w):[i,n]},w.clamp=function(A){return arguments.length?(E=!!A,w):E},w.interpolator=function(A){return arguments.length?(_=A,w):_};function I(A){return function(P){var j,W;return arguments.length?([j,W]=P,_=A(j,W),w):[_(0),_(1)]}}return w.range=I(u_),w.rangeRound=I(E2),w.unknown=function(A){return arguments.length?(T=A,w):T},function(A){return f=A,o=A(i),s=A(n),u=o===s?0:1/(s-o),w}}function zd(i,n){return n.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function vJ(){var i=Kd(FC()(Ua));return i.copy=function(){return zd(i,vJ())},vu.apply(i,arguments)}function yJ(){var i=w2(FC()).domain([1,10]);return i.copy=function(){return zd(i,yJ()).base(i.base())},vu.apply(i,arguments)}function EJ(){var i=R2(FC());return i.copy=function(){return zd(i,EJ()).constant(i.constant())},vu.apply(i,arguments)}function M2(){var i=C2(FC());return i.copy=function(){return zd(i,M2()).exponent(i.exponent())},vu.apply(i,arguments)}function UEe(){return M2.apply(null,arguments).exponent(.5)}function SJ(){var i=[],n=Ua;function o(s){if(s!=null&&!isNaN(s=+s))return n((jS(i,s,1)-1)/(i.length-1))}return o.domain=function(s){if(!arguments.length)return i.slice();i=[];for(let u of s)u!=null&&!isNaN(u=+u)&&i.push(u);return i.sort(Fd),o},o.interpolator=function(s){return arguments.length?(n=s,o):n},o.range=function(){return i.map((s,u)=>n(u/(i.length-1)))},o.quantiles=function(s){return Array.from({length:s+1},(u,f)=>Tve(i,f/s))},o.copy=function(){return SJ(n).domain(i)},vu.apply(o,arguments)}function BC(){var i=0,n=.5,o=1,s=1,u,f,_,E,T,w=Ua,I,A=!1,P;function j(F){return isNaN(F=+F)?P:(F=.5+((F=+I(F))-f)*(s*F<s*f?E:T),w(A?Math.max(0,Math.min(1,F)):F))}j.domain=function(F){return arguments.length?([i,n,o]=F,u=I(i=+i),f=I(n=+n),_=I(o=+o),E=u===f?0:.5/(f-u),T=f===_?0:.5/(_-f),s=f<u?-1:1,j):[i,n,o]},j.clamp=function(F){return arguments.length?(A=!!F,j):A},j.interpolator=function(F){return arguments.length?(w=F,j):w};function W(F){return function(M){var X,Y,J;return arguments.length?([X,Y,J]=M,w=Yve(F,[X,Y,J]),j):[w(0),w(.5),w(1)]}}return j.range=W(u_),j.rangeRound=W(E2),j.unknown=function(F){return arguments.length?(P=F,j):P},function(F){return I=F,u=F(i),f=F(n),_=F(o),E=u===f?0:.5/(f-u),T=f===_?0:.5/(_-f),s=f<u?-1:1,j}}function bJ(){var i=Kd(BC()(Ua));return i.copy=function(){return zd(i,bJ())},vu.apply(i,arguments)}function TJ(){var i=w2(BC()).domain([.1,1,10]);return i.copy=function(){return zd(i,TJ()).base(i.base())},vu.apply(i,arguments)}function wJ(){var i=R2(BC());return i.copy=function(){return zd(i,wJ()).constant(i.constant())},vu.apply(i,arguments)}function U2(){var i=C2(BC());return i.copy=function(){return zd(i,U2()).exponent(i.exponent())},vu.apply(i,arguments)}function jEe(){return U2.apply(null,arguments).exponent(.5)}const H$=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:nS,scaleDiverging:bJ,scaleDivergingLog:TJ,scaleDivergingPow:U2,scaleDivergingSqrt:jEe,scaleDivergingSymlog:wJ,scaleIdentity:rJ,scaleImplicit:HL,scaleLinear:MR,scaleLog:iJ,scaleOrdinal:_2,scalePoint:WE,scalePow:A2,scaleQuantile:sJ,scaleQuantize:cJ,scaleRadial:oJ,scaleSequential:vJ,scaleSequentialLog:yJ,scaleSequentialPow:M2,scaleSequentialQuantile:SJ,scaleSequentialSqrt:UEe,scaleSequentialSymlog:EJ,scaleSqrt:vye,scaleSymlog:aJ,scaleThreshold:lJ,scaleTime:LEe,scaleUtc:MEe,tickFormat:tJ},Symbol.toStringTag,{value:"Module"}));var wk,q$;function WC(){if(q$)return wk;q$=1;var i=o_();function n(o,s,u){for(var f=-1,_=o.length;++f<_;){var E=o[f],T=s(E);if(T!=null&&(w===void 0?T===T&&!i(T):u(T,w)))var w=T,I=E}return I}return wk=n,wk}var Rk,K$;function RJ(){if(K$)return Rk;K$=1;function i(n,o){return n>o}return Rk=i,Rk}var Ck,z$;function VEe(){if(z$)return Ck;z$=1;var i=WC(),n=RJ(),o=l_();function s(u){return u&&u.length?i(u,o,n):void 0}return Ck=s,Ck}var FEe=VEe();const GC=Yr(FEe);var Ak,$$;function CJ(){if($$)return Ak;$$=1;function i(n,o){return n<o}return Ak=i,Ak}var Ok,Y$;function BEe(){if(Y$)return Ok;Y$=1;var i=WC(),n=CJ(),o=l_();function s(u){return u&&u.length?i(u,o,n):void 0}return Ok=s,Ok}var WEe=BEe();const HC=Yr(WEe);var Ik,X$;function GEe(){if(X$)return Ik;X$=1;var i=ZM(),n=fl(),o=kX(),s=so();function u(f,_){var E=s(f)?i:o;return E(f,n(_,3))}return Ik=u,Ik}var Nk,J$;function HEe(){if(J$)return Nk;J$=1;var i=DX(),n=GEe();function o(s,u){return i(n(s,u),1)}return Nk=o,Nk}var qEe=HEe();const KEe=Yr(qEe);var Pk,Q$;function zEe(){if(Q$)return Pk;Q$=1;var i=h2();function n(o,s){return i(o,s)}return Pk=n,Pk}var $Ee=zEe();const d_=Yr($Ee);var h_=1e9,YEe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},V2,Vn=!0,Es="[DecimalError] ",Bp=Es+"Invalid argument: ",j2=Es+"Exponent out of range: ",p_=Math.floor,xp=Math.pow,XEe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ko,Hi=1e7,Pn=7,AJ=9007199254740991,FR=p_(AJ/Pn),Rt={};Rt.absoluteValue=Rt.abs=function(){var i=new this.constructor(this);return i.s&&(i.s=1),i};Rt.comparedTo=Rt.cmp=function(i){var n,o,s,u,f=this;if(i=new f.constructor(i),f.s!==i.s)return f.s||-i.s;if(f.e!==i.e)return f.e>i.e^f.s<0?1:-1;for(s=f.d.length,u=i.d.length,n=0,o=s<u?s:u;n<o;++n)if(f.d[n]!==i.d[n])return f.d[n]>i.d[n]^f.s<0?1:-1;return s===u?0:s>u^f.s<0?1:-1};Rt.decimalPlaces=Rt.dp=function(){var i=this,n=i.d.length-1,o=(n-i.e)*Pn;if(n=i.d[n],n)for(;n%10==0;n/=10)o--;return o<0?0:o};Rt.dividedBy=Rt.div=function(i){return cu(this,new this.constructor(i))};Rt.dividedToIntegerBy=Rt.idiv=function(i){var n=this,o=n.constructor;return yn(cu(n,new o(i),0,1),o.precision)};Rt.equals=Rt.eq=function(i){return!this.cmp(i)};Rt.exponent=function(){return vi(this)};Rt.greaterThan=Rt.gt=function(i){return this.cmp(i)>0};Rt.greaterThanOrEqualTo=Rt.gte=function(i){return this.cmp(i)>=0};Rt.isInteger=Rt.isint=function(){return this.e>this.d.length-2};Rt.isNegative=Rt.isneg=function(){return this.s<0};Rt.isPositive=Rt.ispos=function(){return this.s>0};Rt.isZero=function(){return this.s===0};Rt.lessThan=Rt.lt=function(i){return this.cmp(i)<0};Rt.lessThanOrEqualTo=Rt.lte=function(i){return this.cmp(i)<1};Rt.logarithm=Rt.log=function(i){var n,o=this,s=o.constructor,u=s.precision,f=u+5;if(i===void 0)i=new s(10);else if(i=new s(i),i.s<1||i.eq(ko))throw Error(Es+"NaN");if(o.s<1)throw Error(Es+(o.s?"NaN":"-Infinity"));return o.eq(ko)?new s(0):(Vn=!1,n=cu(cS(o,f),cS(i,f),f),Vn=!0,yn(n,u))};Rt.minus=Rt.sub=function(i){var n=this;return i=new n.constructor(i),n.s==i.s?NJ(n,i):OJ(n,(i.s=-i.s,i))};Rt.modulo=Rt.mod=function(i){var n,o=this,s=o.constructor,u=s.precision;if(i=new s(i),!i.s)throw Error(Es+"NaN");return o.s?(Vn=!1,n=cu(o,i,0,1).times(i),Vn=!0,o.minus(n)):yn(new s(o),u)};Rt.naturalExponential=Rt.exp=function(){return IJ(this)};Rt.naturalLogarithm=Rt.ln=function(){return cS(this)};Rt.negated=Rt.neg=function(){var i=new this.constructor(this);return i.s=-i.s||0,i};Rt.plus=Rt.add=function(i){var n=this;return i=new n.constructor(i),n.s==i.s?OJ(n,i):NJ(n,(i.s=-i.s,i))};Rt.precision=Rt.sd=function(i){var n,o,s,u=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Bp+i);if(n=vi(u)+1,s=u.d.length-1,o=s*Pn+1,s=u.d[s],s){for(;s%10==0;s/=10)o--;for(s=u.d[0];s>=10;s/=10)o++}return i&&n>o?n:o};Rt.squareRoot=Rt.sqrt=function(){var i,n,o,s,u,f,_,E=this,T=E.constructor;if(E.s<1){if(!E.s)return new T(0);throw Error(Es+"NaN")}for(i=vi(E),Vn=!1,u=Math.sqrt(+E),u==0||u==1/0?(n=ol(E.d),(n.length+i)%2==0&&(n+="0"),u=Math.sqrt(n),i=p_((i+1)/2)-(i<0||i%2),u==1/0?n="5e"+i:(n=u.toExponential(),n=n.slice(0,n.indexOf("e")+1)+i),s=new T(n)):s=new T(u.toString()),o=T.precision,u=_=o+3;;)if(f=s,s=f.plus(cu(E,f,_+2)).times(.5),ol(f.d).slice(0,_)===(n=ol(s.d)).slice(0,_)){if(n=n.slice(_-3,_+1),u==_&&n=="4999"){if(yn(f,o+1,0),f.times(f).eq(E)){s=f;break}}else if(n!="9999")break;_+=4}return Vn=!0,yn(s,o)};Rt.times=Rt.mul=function(i){var n,o,s,u,f,_,E,T,w,I=this,A=I.constructor,P=I.d,j=(i=new A(i)).d;if(!I.s||!i.s)return new A(0);for(i.s*=I.s,o=I.e+i.e,T=P.length,w=j.length,T<w&&(f=P,P=j,j=f,_=T,T=w,w=_),f=[],_=T+w,s=_;s--;)f.push(0);for(s=w;--s>=0;){for(n=0,u=T+s;u>s;)E=f[u]+j[s]*P[u-s-1]+n,f[u--]=E%Hi|0,n=E/Hi|0;f[u]=(f[u]+n)%Hi|0}for(;!f[--_];)f.pop();return n?++o:f.shift(),i.d=f,i.e=o,Vn?yn(i,A.precision):i};Rt.toDecimalPlaces=Rt.todp=function(i,n){var o=this,s=o.constructor;return o=new s(o),i===void 0?o:(dl(i,0,h_),n===void 0?n=s.rounding:dl(n,0,8),yn(o,i+vi(o)+1,n))};Rt.toExponential=function(i,n){var o,s=this,u=s.constructor;return i===void 0?o=qp(s,!0):(dl(i,0,h_),n===void 0?n=u.rounding:dl(n,0,8),s=yn(new u(s),i+1,n),o=qp(s,!0,i+1)),o};Rt.toFixed=function(i,n){var o,s,u=this,f=u.constructor;return i===void 0?qp(u):(dl(i,0,h_),n===void 0?n=f.rounding:dl(n,0,8),s=yn(new f(u),i+vi(u)+1,n),o=qp(s.abs(),!1,i+vi(s)+1),u.isneg()&&!u.isZero()?"-"+o:o)};Rt.toInteger=Rt.toint=function(){var i=this,n=i.constructor;return yn(new n(i),vi(i)+1,n.rounding)};Rt.toNumber=function(){return+this};Rt.toPower=Rt.pow=function(i){var n,o,s,u,f,_,E=this,T=E.constructor,w=12,I=+(i=new T(i));if(!i.s)return new T(ko);if(E=new T(E),!E.s){if(i.s<1)throw Error(Es+"Infinity");return E}if(E.eq(ko))return E;if(s=T.precision,i.eq(ko))return yn(E,s);if(n=i.e,o=i.d.length-1,_=n>=o,f=E.s,_){if((o=I<0?-I:I)<=AJ){for(u=new T(ko),n=Math.ceil(s/Pn+4),Vn=!1;o%2&&(u=u.times(E),eY(u.d,n)),o=p_(o/2),o!==0;)E=E.times(E),eY(E.d,n);return Vn=!0,i.s<0?new T(ko).div(u):yn(u,s)}}else if(f<0)throw Error(Es+"NaN");return f=f<0&&i.d[Math.max(n,o)]&1?-1:1,E.s=1,Vn=!1,u=i.times(cS(E,s+w)),Vn=!0,u=IJ(u),u.s=f,u};Rt.toPrecision=function(i,n){var o,s,u=this,f=u.constructor;return i===void 0?(o=vi(u),s=qp(u,o<=f.toExpNeg||o>=f.toExpPos)):(dl(i,1,h_),n===void 0?n=f.rounding:dl(n,0,8),u=yn(new f(u),i,n),o=vi(u),s=qp(u,i<=o||o<=f.toExpNeg,i)),s};Rt.toSignificantDigits=Rt.tosd=function(i,n){var o=this,s=o.constructor;return i===void 0?(i=s.precision,n=s.rounding):(dl(i,1,h_),n===void 0?n=s.rounding:dl(n,0,8)),yn(new s(o),i,n)};Rt.toString=Rt.valueOf=Rt.val=Rt.toJSON=Rt[Symbol.for("nodejs.util.inspect.custom")]=function(){var i=this,n=vi(i),o=i.constructor;return qp(i,n<=o.toExpNeg||n>=o.toExpPos)};function OJ(i,n){var o,s,u,f,_,E,T,w,I=i.constructor,A=I.precision;if(!i.s||!n.s)return n.s||(n=new I(i)),Vn?yn(n,A):n;if(T=i.d,w=n.d,_=i.e,u=n.e,T=T.slice(),f=_-u,f){for(f<0?(s=T,f=-f,E=w.length):(s=w,u=_,E=T.length),_=Math.ceil(A/Pn),E=_>E?_+1:E+1,f>E&&(f=E,s.length=1),s.reverse();f--;)s.push(0);s.reverse()}for(E=T.length,f=w.length,E-f<0&&(f=E,s=w,w=T,T=s),o=0;f;)o=(T[--f]=T[f]+w[f]+o)/Hi|0,T[f]%=Hi;for(o&&(T.unshift(o),++u),E=T.length;T[--E]==0;)T.pop();return n.d=T,n.e=u,Vn?yn(n,A):n}function dl(i,n,o){if(i!==~~i||i<n||i>o)throw Error(Bp+i)}function ol(i){var n,o,s,u=i.length-1,f="",_=i[0];if(u>0){for(f+=_,n=1;n<u;n++)s=i[n]+"",o=Pn-s.length,o&&(f+=Ld(o)),f+=s;_=i[n],s=_+"",o=Pn-s.length,o&&(f+=Ld(o))}else if(_===0)return"0";for(;_%10===0;)_/=10;return f+_}var cu=function(){function i(s,u){var f,_=0,E=s.length;for(s=s.slice();E--;)f=s[E]*u+_,s[E]=f%Hi|0,_=f/Hi|0;return _&&s.unshift(_),s}function n(s,u,f,_){var E,T;if(f!=_)T=f>_?1:-1;else for(E=T=0;E<f;E++)if(s[E]!=u[E]){T=s[E]>u[E]?1:-1;break}return T}function o(s,u,f){for(var _=0;f--;)s[f]-=_,_=s[f]<u[f]?1:0,s[f]=_*Hi+s[f]-u[f];for(;!s[0]&&s.length>1;)s.shift()}return function(s,u,f,_){var E,T,w,I,A,P,j,W,F,M,X,Y,J,re,z,Z,ie,de,ge=s.constructor,Oe=s.s==u.s?1:-1,me=s.d,ye=u.d;if(!s.s)return new ge(s);if(!u.s)throw Error(Es+"Division by zero");for(T=s.e-u.e,ie=ye.length,z=me.length,j=new ge(Oe),W=j.d=[],w=0;ye[w]==(me[w]||0);)++w;if(ye[w]>(me[w]||0)&&--T,f==null?Y=f=ge.precision:_?Y=f+(vi(s)-vi(u))+1:Y=f,Y<0)return new ge(0);if(Y=Y/Pn+2|0,w=0,ie==1)for(I=0,ye=ye[0],Y++;(w<z||I)&&Y--;w++)J=I*Hi+(me[w]||0),W[w]=J/ye|0,I=J%ye|0;else{for(I=Hi/(ye[0]+1)|0,I>1&&(ye=i(ye,I),me=i(me,I),ie=ye.length,z=me.length),re=ie,F=me.slice(0,ie),M=F.length;M<ie;)F[M++]=0;de=ye.slice(),de.unshift(0),Z=ye[0],ye[1]>=Hi/2&&++Z;do I=0,E=n(ye,F,ie,M),E<0?(X=F[0],ie!=M&&(X=X*Hi+(F[1]||0)),I=X/Z|0,I>1?(I>=Hi&&(I=Hi-1),A=i(ye,I),P=A.length,M=F.length,E=n(A,F,P,M),E==1&&(I--,o(A,ie<P?de:ye,P))):(I==0&&(E=I=1),A=ye.slice()),P=A.length,P<M&&A.unshift(0),o(F,A,M),E==-1&&(M=F.length,E=n(ye,F,ie,M),E<1&&(I++,o(F,ie<M?de:ye,M))),M=F.length):E===0&&(I++,F=[0]),W[w++]=I,E&&F[0]?F[M++]=me[re]||0:(F=[me[re]],M=1);while((re++<z||F[0]!==void 0)&&Y--)}return W[0]||W.shift(),j.e=T,yn(j,_?f+vi(j)+1:f)}}();function IJ(i,n){var o,s,u,f,_,E,T=0,w=0,I=i.constructor,A=I.precision;if(vi(i)>16)throw Error(j2+vi(i));if(!i.s)return new I(ko);for(Vn=!1,E=A,_=new I(.03125);i.abs().gte(.1);)i=i.times(_),w+=5;for(s=Math.log(xp(2,w))/Math.LN10*2+5|0,E+=s,o=u=f=new I(ko),I.precision=E;;){if(u=yn(u.times(i),E),o=o.times(++T),_=f.plus(cu(u,o,E)),ol(_.d).slice(0,E)===ol(f.d).slice(0,E)){for(;w--;)f=yn(f.times(f),E);return I.precision=A,n==null?(Vn=!0,yn(f,A)):f}f=_}}function vi(i){for(var n=i.e*Pn,o=i.d[0];o>=10;o/=10)n++;return n}function Dk(i,n,o){if(n>i.LN10.sd())throw Vn=!0,o&&(i.precision=o),Error(Es+"LN10 precision limit exceeded");return yn(new i(i.LN10),n)}function Ld(i){for(var n="";i--;)n+="0";return n}function cS(i,n){var o,s,u,f,_,E,T,w,I,A=1,P=10,j=i,W=j.d,F=j.constructor,M=F.precision;if(j.s<1)throw Error(Es+(j.s?"NaN":"-Infinity"));if(j.eq(ko))return new F(0);if(n==null?(Vn=!1,w=M):w=n,j.eq(10))return n==null&&(Vn=!0),Dk(F,w);if(w+=P,F.precision=w,o=ol(W),s=o.charAt(0),f=vi(j),Math.abs(f)<15e14){for(;s<7&&s!=1||s==1&&o.charAt(1)>3;)j=j.times(i),o=ol(j.d),s=o.charAt(0),A++;f=vi(j),s>1?(j=new F("0."+o),f++):j=new F(s+"."+o.slice(1))}else return T=Dk(F,w+2,M).times(f+""),j=cS(new F(s+"."+o.slice(1)),w-P).plus(T),F.precision=M,n==null?(Vn=!0,yn(j,M)):j;for(E=_=j=cu(j.minus(ko),j.plus(ko),w),I=yn(j.times(j),w),u=3;;){if(_=yn(_.times(I),w),T=E.plus(cu(_,new F(u),w)),ol(T.d).slice(0,w)===ol(E.d).slice(0,w))return E=E.times(2),f!==0&&(E=E.plus(Dk(F,w+2,M).times(f+""))),E=cu(E,new F(A),w),F.precision=M,n==null?(Vn=!0,yn(E,M)):E;E=T,u+=2}}function Z$(i,n){var o,s,u;for((o=n.indexOf("."))>-1&&(n=n.replace(".","")),(s=n.search(/e/i))>0?(o<0&&(o=s),o+=+n.slice(s+1),n=n.substring(0,s)):o<0&&(o=n.length),s=0;n.charCodeAt(s)===48;)++s;for(u=n.length;n.charCodeAt(u-1)===48;)--u;if(n=n.slice(s,u),n){if(u-=s,o=o-s-1,i.e=p_(o/Pn),i.d=[],s=(o+1)%Pn,o<0&&(s+=Pn),s<u){for(s&&i.d.push(+n.slice(0,s)),u-=Pn;s<u;)i.d.push(+n.slice(s,s+=Pn));n=n.slice(s),s=Pn-n.length}else s-=u;for(;s--;)n+="0";if(i.d.push(+n),Vn&&(i.e>FR||i.e<-FR))throw Error(j2+o)}else i.s=0,i.e=0,i.d=[0];return i}function yn(i,n,o){var s,u,f,_,E,T,w,I,A=i.d;for(_=1,f=A[0];f>=10;f/=10)_++;if(s=n-_,s<0)s+=Pn,u=n,w=A[I=0];else{if(I=Math.ceil((s+1)/Pn),f=A.length,I>=f)return i;for(w=f=A[I],_=1;f>=10;f/=10)_++;s%=Pn,u=s-Pn+_}if(o!==void 0&&(f=xp(10,_-u-1),E=w/f%10|0,T=n<0||A[I+1]!==void 0||w%f,T=o<4?(E||T)&&(o==0||o==(i.s<0?3:2)):E>5||E==5&&(o==4||T||o==6&&(s>0?u>0?w/xp(10,_-u):0:A[I-1])%10&1||o==(i.s<0?8:7))),n<1||!A[0])return T?(f=vi(i),A.length=1,n=n-f-1,A[0]=xp(10,(Pn-n%Pn)%Pn),i.e=p_(-n/Pn)||0):(A.length=1,A[0]=i.e=i.s=0),i;if(s==0?(A.length=I,f=1,I--):(A.length=I+1,f=xp(10,Pn-s),A[I]=u>0?(w/xp(10,_-u)%xp(10,u)|0)*f:0),T)for(;;)if(I==0){(A[0]+=f)==Hi&&(A[0]=1,++i.e);break}else{if(A[I]+=f,A[I]!=Hi)break;A[I--]=0,f=1}for(s=A.length;A[--s]===0;)A.pop();if(Vn&&(i.e>FR||i.e<-FR))throw Error(j2+vi(i));return i}function NJ(i,n){var o,s,u,f,_,E,T,w,I,A,P=i.constructor,j=P.precision;if(!i.s||!n.s)return n.s?n.s=-n.s:n=new P(i),Vn?yn(n,j):n;if(T=i.d,A=n.d,s=n.e,w=i.e,T=T.slice(),_=w-s,_){for(I=_<0,I?(o=T,_=-_,E=A.length):(o=A,s=w,E=T.length),u=Math.max(Math.ceil(j/Pn),E)+2,_>u&&(_=u,o.length=1),o.reverse(),u=_;u--;)o.push(0);o.reverse()}else{for(u=T.length,E=A.length,I=u<E,I&&(E=u),u=0;u<E;u++)if(T[u]!=A[u]){I=T[u]<A[u];break}_=0}for(I&&(o=T,T=A,A=o,n.s=-n.s),E=T.length,u=A.length-E;u>0;--u)T[E++]=0;for(u=A.length;u>_;){if(T[--u]<A[u]){for(f=u;f&&T[--f]===0;)T[f]=Hi-1;--T[f],T[u]+=Hi}T[u]-=A[u]}for(;T[--E]===0;)T.pop();for(;T[0]===0;T.shift())--s;return T[0]?(n.d=T,n.e=s,Vn?yn(n,j):n):new P(0)}function qp(i,n,o){var s,u=vi(i),f=ol(i.d),_=f.length;return n?(o&&(s=o-_)>0?f=f.charAt(0)+"."+f.slice(1)+Ld(s):_>1&&(f=f.charAt(0)+"."+f.slice(1)),f=f+(u<0?"e":"e+")+u):u<0?(f="0."+Ld(-u-1)+f,o&&(s=o-_)>0&&(f+=Ld(s))):u>=_?(f+=Ld(u+1-_),o&&(s=o-u-1)>0&&(f=f+"."+Ld(s))):((s=u+1)<_&&(f=f.slice(0,s)+"."+f.slice(s)),o&&(s=o-_)>0&&(u+1===_&&(f+="."),f+=Ld(s))),i.s<0?"-"+f:f}function eY(i,n){if(i.length>n)return i.length=n,!0}function PJ(i){var n,o,s;function u(f){var _=this;if(!(_ instanceof u))return new u(f);if(_.constructor=u,f instanceof u){_.s=f.s,_.e=f.e,_.d=(f=f.d)?f.slice():f;return}if(typeof f=="number"){if(f*0!==0)throw Error(Bp+f);if(f>0)_.s=1;else if(f<0)f=-f,_.s=-1;else{_.s=0,_.e=0,_.d=[0];return}if(f===~~f&&f<1e7){_.e=0,_.d=[f];return}return Z$(_,f.toString())}else if(typeof f!="string")throw Error(Bp+f);if(f.charCodeAt(0)===45?(f=f.slice(1),_.s=-1):_.s=1,XEe.test(f))Z$(_,f);else throw Error(Bp+f)}if(u.prototype=Rt,u.ROUND_UP=0,u.ROUND_DOWN=1,u.ROUND_CEIL=2,u.ROUND_FLOOR=3,u.ROUND_HALF_UP=4,u.ROUND_HALF_DOWN=5,u.ROUND_HALF_EVEN=6,u.ROUND_HALF_CEIL=7,u.ROUND_HALF_FLOOR=8,u.clone=PJ,u.config=u.set=JEe,i===void 0&&(i={}),i)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<s.length;)i.hasOwnProperty(o=s[n++])||(i[o]=this[o]);return u.config(i),u}function JEe(i){if(!i||typeof i!="object")throw Error(Es+"Object expected");var n,o,s,u=["precision",1,h_,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<u.length;n+=3)if((s=i[o=u[n]])!==void 0)if(p_(s)===s&&s>=u[n+1]&&s<=u[n+2])this[o]=s;else throw Error(Bp+o+": "+s);if((s=i[o="LN10"])!==void 0)if(s==Math.LN10)this[o]=new this(s);else throw Error(Bp+o+": "+s);return this}var V2=PJ(YEe);ko=new V2(1);const pn=V2;function QEe(i){return rSe(i)||tSe(i)||eSe(i)||ZEe()}function ZEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eSe(i,n){if(i){if(typeof i=="string")return $L(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return $L(i,n)}}function tSe(i){if(typeof Symbol<"u"&&Symbol.iterator in Object(i))return Array.from(i)}function rSe(i){if(Array.isArray(i))return $L(i)}function $L(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}var nSe=function(n){return n},DJ={},xJ=function(n){return n===DJ},tY=function(n){return function o(){return arguments.length===0||arguments.length===1&&xJ(arguments.length<=0?void 0:arguments[0])?o:n.apply(void 0,arguments)}},iSe=function i(n,o){return n===1?o:tY(function(){for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];var _=u.filter(function(E){return E!==DJ}).length;return _>=n?o.apply(void 0,u):i(n-_,tY(function(){for(var E=arguments.length,T=new Array(E),w=0;w<E;w++)T[w]=arguments[w];var I=u.map(function(A){return xJ(A)?T.shift():A});return o.apply(void 0,QEe(I).concat(T))}))})},qC=function(n){return iSe(n.length,n)},YL=function(n,o){for(var s=[],u=n;u<o;++u)s[u-n]=u;return s},aSe=qC(function(i,n){return Array.isArray(n)?n.map(i):Object.keys(n).map(function(o){return n[o]}).map(i)}),oSe=function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];if(!o.length)return nSe;var u=o.reverse(),f=u[0],_=u.slice(1);return function(){return _.reduce(function(E,T){return T(E)},f.apply(void 0,arguments))}},XL=function(n){return Array.isArray(n)?n.reverse():n.split("").reverse.join("")},kJ=function(n){var o=null,s=null;return function(){for(var u=arguments.length,f=new Array(u),_=0;_<u;_++)f[_]=arguments[_];return o&&f.every(function(E,T){return E===o[T]})||(o=f,s=n.apply(void 0,f)),s}};function sSe(i){var n;return i===0?n=1:n=Math.floor(new pn(i).abs().log(10).toNumber())+1,n}function cSe(i,n,o){for(var s=new pn(i),u=0,f=[];s.lt(n)&&u<1e5;)f.push(s.toNumber()),s=s.add(o),u++;return f}var lSe=qC(function(i,n,o){var s=+i,u=+n;return s+o*(u-s)}),uSe=qC(function(i,n,o){var s=n-+i;return s=s||1/0,(o-i)/s}),dSe=qC(function(i,n,o){var s=n-+i;return s=s||1/0,Math.max(0,Math.min(1,(o-i)/s))});const KC={rangeStep:cSe,getDigitCount:sSe,interpolateNumber:lSe,uninterpolateNumber:uSe,uninterpolateTruncation:dSe};function JL(i){return fSe(i)||pSe(i)||LJ(i)||hSe()}function hSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pSe(i){if(typeof Symbol<"u"&&Symbol.iterator in Object(i))return Array.from(i)}function fSe(i){if(Array.isArray(i))return QL(i)}function lS(i,n){return _Se(i)||gSe(i,n)||LJ(i,n)||mSe()}function mSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LJ(i,n){if(i){if(typeof i=="string")return QL(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return QL(i,n)}}function QL(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function gSe(i,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(i)))){var o=[],s=!0,u=!1,f=void 0;try{for(var _=i[Symbol.iterator](),E;!(s=(E=_.next()).done)&&(o.push(E.value),!(n&&o.length===n));s=!0);}catch(T){u=!0,f=T}finally{try{!s&&_.return!=null&&_.return()}finally{if(u)throw f}}return o}}function _Se(i){if(Array.isArray(i))return i}function MJ(i){var n=lS(i,2),o=n[0],s=n[1],u=o,f=s;return o>s&&(u=s,f=o),[u,f]}function UJ(i,n,o){if(i.lte(0))return new pn(0);var s=KC.getDigitCount(i.toNumber()),u=new pn(10).pow(s),f=i.div(u),_=s!==1?.05:.1,E=new pn(Math.ceil(f.div(_).toNumber())).add(o).mul(_),T=E.mul(u);return n?T:new pn(Math.ceil(T))}function vSe(i,n,o){var s=1,u=new pn(i);if(!u.isint()&&o){var f=Math.abs(i);f<1?(s=new pn(10).pow(KC.getDigitCount(i)-1),u=new pn(Math.floor(u.div(s).toNumber())).mul(s)):f>1&&(u=new pn(Math.floor(i)))}else i===0?u=new pn(Math.floor((n-1)/2)):o||(u=new pn(Math.floor(i)));var _=Math.floor((n-1)/2),E=oSe(aSe(function(T){return u.add(new pn(T-_).mul(s)).toNumber()}),YL);return E(0,n)}function jJ(i,n,o,s){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-i)/(o-1)))return{step:new pn(0),tickMin:new pn(0),tickMax:new pn(0)};var f=UJ(new pn(n).sub(i).div(o-1),s,u),_;i<=0&&n>=0?_=new pn(0):(_=new pn(i).add(n).div(2),_=_.sub(new pn(_).mod(f)));var E=Math.ceil(_.sub(i).div(f).toNumber()),T=Math.ceil(new pn(n).sub(_).div(f).toNumber()),w=E+T+1;return w>o?jJ(i,n,o,s,u+1):(w<o&&(T=n>0?T+(o-w):T,E=n>0?E:E+(o-w)),{step:f,tickMin:_.sub(new pn(E).mul(f)),tickMax:_.add(new pn(T).mul(f))})}function ySe(i){var n=lS(i,2),o=n[0],s=n[1],u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,_=Math.max(u,2),E=MJ([o,s]),T=lS(E,2),w=T[0],I=T[1];if(w===-1/0||I===1/0){var A=I===1/0?[w].concat(JL(YL(0,u-1).map(function(){return 1/0}))):[].concat(JL(YL(0,u-1).map(function(){return-1/0})),[I]);return o>s?XL(A):A}if(w===I)return vSe(w,u,f);var P=jJ(w,I,_,f),j=P.step,W=P.tickMin,F=P.tickMax,M=KC.rangeStep(W,F.add(new pn(.1).mul(j)),j);return o>s?XL(M):M}function ESe(i,n){var o=lS(i,2),s=o[0],u=o[1],f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,_=MJ([s,u]),E=lS(_,2),T=E[0],w=E[1];if(T===-1/0||w===1/0)return[s,u];if(T===w)return[T];var I=Math.max(n,2),A=UJ(new pn(w).sub(T).div(I-1),f,0),P=[].concat(JL(KC.rangeStep(new pn(T),new pn(w).sub(new pn(.99).mul(A)),A)),[w]);return s>u?XL(P):P}var SSe=kJ(ySe),bSe=kJ(ESe),TSe="Invariant failed";function Kp(i,n){throw new Error(TSe)}var wSe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Vg(i){"@babel/helpers - typeof";return Vg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Vg(i)}function BR(){return BR=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},BR.apply(this,arguments)}function RSe(i,n){return ISe(i)||OSe(i,n)||ASe(i,n)||CSe()}function CSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ASe(i,n){if(i){if(typeof i=="string")return rY(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return rY(i,n)}}function rY(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function OSe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function ISe(i){if(Array.isArray(i))return i}function NSe(i,n){if(i==null)return{};var o=PSe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function PSe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function DSe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function xSe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,BJ(s.key),s)}}function kSe(i,n,o){return n&&xSe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function LSe(i,n,o){return n=WR(n),MSe(i,VJ()?Reflect.construct(n,o||[],WR(i).constructor):n.apply(i,o))}function MSe(i,n){if(n&&(Vg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return USe(i)}function USe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function VJ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(VJ=function(){return!!i})()}function WR(i){return WR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},WR(i)}function jSe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&ZL(i,n)}function ZL(i,n){return ZL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},ZL(i,n)}function FJ(i,n,o){return n=BJ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function BJ(i){var n=VSe(i,"string");return Vg(n)=="symbol"?n:n+""}function VSe(i,n){if(Vg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Vg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var WS=function(i){function n(){return DSe(this,n),LSe(this,n,arguments)}return jSe(n,i),kSe(n,[{key:"render",value:function(){var s=this.props,u=s.offset,f=s.layout,_=s.width,E=s.dataKey,T=s.data,w=s.dataPointFormatter,I=s.xAxis,A=s.yAxis,P=NSe(s,wSe),j=Pt(P,!1);this.props.direction==="x"&&I.type!=="number"&&Kp();var W=T.map(function(F){var M=w(F,E),X=M.x,Y=M.y,J=M.value,re=M.errorVal;if(!re)return null;var z=[],Z,ie;if(Array.isArray(re)){var de=RSe(re,2);Z=de[0],ie=de[1]}else Z=ie=re;if(f==="vertical"){var ge=I.scale,Oe=Y+u,me=Oe+_,ye=Oe-_,Ae=ge(J-Z),be=ge(J+ie);z.push({x1:be,y1:me,x2:be,y2:ye}),z.push({x1:Ae,y1:Oe,x2:be,y2:Oe}),z.push({x1:Ae,y1:me,x2:Ae,y2:ye})}else if(f==="horizontal"){var ke=A.scale,Me=X+u,Ue=Me-_,Pe=Me+_,We=ke(J-Z),He=ke(J+ie);z.push({x1:Ue,y1:He,x2:Pe,y2:He}),z.push({x1:Me,y1:We,x2:Me,y2:He}),z.push({x1:Ue,y1:We,x2:Pe,y2:We})}return ue.createElement(Dr,BR({className:"recharts-errorBar",key:"bar-".concat(z.map(function(fe){return"".concat(fe.x1,"-").concat(fe.x2,"-").concat(fe.y1,"-").concat(fe.y2)}))},j),z.map(function(fe){return ue.createElement("line",BR({},fe,{key:"line-".concat(fe.x1,"-").concat(fe.x2,"-").concat(fe.y1,"-").concat(fe.y2)}))}))});return ue.createElement(Dr,{className:"recharts-errorBars"},W)}}])}(ue.Component);FJ(WS,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});FJ(WS,"displayName","ErrorBar");function uS(i){"@babel/helpers - typeof";return uS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},uS(i)}function nY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Op(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?nY(Object(o),!0).forEach(function(s){FSe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):nY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function FSe(i,n,o){return n=BSe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function BSe(i){var n=WSe(i,"string");return uS(n)=="symbol"?n:n+""}function WSe(i,n){if(uS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(uS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var WJ=function(n){var o=n.children,s=n.formattedGraphicalItems,u=n.legendWidth,f=n.legendContent,_=xo(o,Rg);if(!_)return null;var E=Rg.defaultProps,T=E!==void 0?Op(Op({},E),_.props):{},w;return _.props&&_.props.payload?w=_.props&&_.props.payload:f==="children"?w=(s||[]).reduce(function(I,A){var P=A.item,j=A.props,W=j.sectors||j.data||[];return I.concat(W.map(function(F){return{type:_.props.iconType||P.props.legendType,value:F.name,color:F.fill,payload:F}}))},[]):w=(s||[]).map(function(I){var A=I.item,P=A.type.defaultProps,j=P!==void 0?Op(Op({},P),A.props):{},W=j.dataKey,F=j.name,M=j.legendType,X=j.hide;return{inactive:X,dataKey:W,type:T.iconType||M||"square",color:F2(A),value:F||W,payload:j}}),Op(Op(Op({},T),Rg.getWithHeight(_,u)),{},{payload:w,item:_})};function dS(i){"@babel/helpers - typeof";return dS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},dS(i)}function iY(i){return KSe(i)||qSe(i)||HSe(i)||GSe()}function GSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HSe(i,n){if(i){if(typeof i=="string")return eM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return eM(i,n)}}function qSe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function KSe(i){if(Array.isArray(i))return eM(i)}function eM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function aY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function ni(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?aY(Object(o),!0).forEach(function(s){Og(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):aY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Og(i,n,o){return n=zSe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function zSe(i){var n=$Se(i,"string");return dS(n)=="symbol"?n:n+""}function $Se(i,n){if(dS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(dS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function hi(i,n,o){return ir(i)||ir(n)?o:Oi(n)?Lo(i,n,o):zt(n)?n(i):o}function GE(i,n,o,s){var u=KEe(i,function(E){return hi(E,n)});if(o==="number"){var f=u.filter(function(E){return dt(E)||parseFloat(E)});return f.length?[HC(f),GC(f)]:[1/0,-1/0]}var _=s?u.filter(function(E){return!ir(E)}):u;return _.map(function(E){return Oi(E)||E instanceof Date?E:""})}var YSe=function(n){var o,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],u=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0,_=-1,E=(o=s==null?void 0:s.length)!==null&&o!==void 0?o:0;if(E<=1)return 0;if(f&&f.axisType==="angleAxis"&&Math.abs(Math.abs(f.range[1]-f.range[0])-360)<=1e-6)for(var T=f.range,w=0;w<E;w++){var I=w>0?u[w-1].coordinate:u[E-1].coordinate,A=u[w].coordinate,P=w>=E-1?u[0].coordinate:u[w+1].coordinate,j=void 0;if(La(A-I)!==La(P-A)){var W=[];if(La(P-A)===La(T[1]-T[0])){j=P;var F=A+T[1]-T[0];W[0]=Math.min(F,(F+I)/2),W[1]=Math.max(F,(F+I)/2)}else{j=I;var M=P+T[1]-T[0];W[0]=Math.min(A,(M+A)/2),W[1]=Math.max(A,(M+A)/2)}var X=[Math.min(A,(j+A)/2),Math.max(A,(j+A)/2)];if(n>X[0]&&n<=X[1]||n>=W[0]&&n<=W[1]){_=u[w].index;break}}else{var Y=Math.min(I,P),J=Math.max(I,P);if(n>(Y+A)/2&&n<=(J+A)/2){_=u[w].index;break}}}else for(var re=0;re<E;re++)if(re===0&&n<=(s[re].coordinate+s[re+1].coordinate)/2||re>0&&re<E-1&&n>(s[re].coordinate+s[re-1].coordinate)/2&&n<=(s[re].coordinate+s[re+1].coordinate)/2||re===E-1&&n>(s[re].coordinate+s[re-1].coordinate)/2){_=s[re].index;break}return _},F2=function(n){var o,s=n,u=s.type.displayName,f=(o=n.type)!==null&&o!==void 0&&o.defaultProps?ni(ni({},n.type.defaultProps),n.props):n.props,_=f.stroke,E=f.fill,T;switch(u){case"Line":T=_;break;case"Area":case"Radar":T=_&&_!=="none"?_:E;break;default:T=E;break}return T},XSe=function(n){var o=n.barSize,s=n.totalSize,u=n.stackGroups,f=u===void 0?{}:u;if(!f)return{};for(var _={},E=Object.keys(f),T=0,w=E.length;T<w;T++)for(var I=f[E[T]].stackGroups,A=Object.keys(I),P=0,j=A.length;P<j;P++){var W=I[A[P]],F=W.items,M=W.cateAxisId,X=F.filter(function(ie){return su(ie.type).indexOf("Bar")>=0});if(X&&X.length){var Y=X[0].type.defaultProps,J=Y!==void 0?ni(ni({},Y),X[0].props):X[0].props,re=J.barSize,z=J[M];_[z]||(_[z]=[]);var Z=ir(re)?o:re;_[z].push({item:X[0],stackList:X.slice(1),barSize:ir(Z)?void 0:Ma(Z,s,0)})}}return _},JSe=function(n){var o=n.barGap,s=n.barCategoryGap,u=n.bandSize,f=n.sizeList,_=f===void 0?[]:f,E=n.maxBarSize,T=_.length;if(T<1)return null;var w=Ma(o,u,0,!0),I,A=[];if(_[0].barSize===+_[0].barSize){var P=!1,j=u/T,W=_.reduce(function(re,z){return re+z.barSize||0},0);W+=(T-1)*w,W>=u&&(W-=(T-1)*w,w=0),W>=u&&j>0&&(P=!0,j*=.9,W=T*j);var F=(u-W)/2>>0,M={offset:F-w,size:0};I=_.reduce(function(re,z){var Z={item:z.item,position:{offset:M.offset+M.size+w,size:P?j:z.barSize}},ie=[].concat(iY(re),[Z]);return M=ie[ie.length-1].position,z.stackList&&z.stackList.length&&z.stackList.forEach(function(de){ie.push({item:de,position:M})}),ie},A)}else{var X=Ma(s,u,0,!0);u-2*X-(T-1)*w<=0&&(w=0);var Y=(u-2*X-(T-1)*w)/T;Y>1&&(Y>>=0);var J=E===+E?Math.min(Y,E):Y;I=_.reduce(function(re,z,Z){var ie=[].concat(iY(re),[{item:z.item,position:{offset:X+(Y+w)*Z+(Y-J)/2,size:J}}]);return z.stackList&&z.stackList.length&&z.stackList.forEach(function(de){ie.push({item:de,position:ie[ie.length-1].position})}),ie},A)}return I},QSe=function(n,o,s,u){var f=s.children,_=s.width,E=s.margin,T=_-(E.left||0)-(E.right||0),w=WJ({children:f,legendWidth:T});if(w){var I=u||{},A=I.width,P=I.height,j=w.align,W=w.verticalAlign,F=w.layout;if((F==="vertical"||F==="horizontal"&&W==="middle")&&j!=="center"&&dt(n[j]))return ni(ni({},n),{},Og({},j,n[j]+(A||0)));if((F==="horizontal"||F==="vertical"&&j==="center")&&W!=="middle"&&dt(n[W]))return ni(ni({},n),{},Og({},W,n[W]+(P||0)))}return n},ZSe=function(n,o,s){return ir(o)?!0:n==="horizontal"?o==="yAxis":n==="vertical"||s==="x"?o==="xAxis":s==="y"?o==="yAxis":!0},GJ=function(n,o,s,u,f){var _=o.props.children,E=Mo(_,WS).filter(function(w){return ZSe(u,f,w.props.direction)});if(E&&E.length){var T=E.map(function(w){return w.props.dataKey});return n.reduce(function(w,I){var A=hi(I,s);if(ir(A))return w;var P=Array.isArray(A)?[HC(A),GC(A)]:[A,A],j=T.reduce(function(W,F){var M=hi(I,F,0),X=P[0]-Math.abs(Array.isArray(M)?M[0]:M),Y=P[1]+Math.abs(Array.isArray(M)?M[1]:M);return[Math.min(X,W[0]),Math.max(Y,W[1])]},[1/0,-1/0]);return[Math.min(j[0],w[0]),Math.max(j[1],w[1])]},[1/0,-1/0])}return null},e0e=function(n,o,s,u,f){var _=o.map(function(E){return GJ(n,E,s,f,u)}).filter(function(E){return!ir(E)});return _&&_.length?_.reduce(function(E,T){return[Math.min(E[0],T[0]),Math.max(E[1],T[1])]},[1/0,-1/0]):null},HJ=function(n,o,s,u,f){var _=o.map(function(T){var w=T.props.dataKey;return s==="number"&&w&&GJ(n,T,w,u)||GE(n,w,s,f)});if(s==="number")return _.reduce(function(T,w){return[Math.min(T[0],w[0]),Math.max(T[1],w[1])]},[1/0,-1/0]);var E={};return _.reduce(function(T,w){for(var I=0,A=w.length;I<A;I++)E[w[I]]||(E[w[I]]=!0,T.push(w[I]));return T},[])},qJ=function(n,o){return n==="horizontal"&&o==="xAxis"||n==="vertical"&&o==="yAxis"||n==="centric"&&o==="angleAxis"||n==="radial"&&o==="radiusAxis"},KJ=function(n,o,s,u){if(u)return n.map(function(T){return T.coordinate});var f,_,E=n.map(function(T){return T.coordinate===o&&(f=!0),T.coordinate===s&&(_=!0),T.coordinate});return f||E.push(o),_||E.push(s),E},ou=function(n,o,s){if(!n)return null;var u=n.scale,f=n.duplicateDomain,_=n.type,E=n.range,T=n.realScaleType==="scaleBand"?u.bandwidth()/2:2,w=(o||s)&&_==="category"&&u.bandwidth?u.bandwidth()/T:0;if(w=n.axisType==="angleAxis"&&(E==null?void 0:E.length)>=2?La(E[0]-E[1])*2*w:w,o&&(n.ticks||n.niceTicks)){var I=(n.ticks||n.niceTicks).map(function(A){var P=f?f.indexOf(A):A;return{coordinate:u(P)+w,value:A,offset:w}});return I.filter(function(A){return!MS(A.coordinate)})}return n.isCategorical&&n.categoricalDomain?n.categoricalDomain.map(function(A,P){return{coordinate:u(A)+w,value:A,index:P,offset:w}}):u.ticks&&!s?u.ticks(n.tickCount).map(function(A){return{coordinate:u(A)+w,value:A,offset:w}}):u.domain().map(function(A,P){return{coordinate:u(A)+w,value:f?f[A]:A,index:P,offset:w}})},xk=new WeakMap,sR=function(n,o){if(typeof o!="function")return n;xk.has(n)||xk.set(n,new WeakMap);var s=xk.get(n);if(s.has(o))return s.get(o);var u=function(){n.apply(void 0,arguments),o.apply(void 0,arguments)};return s.set(o,u),u},zJ=function(n,o,s){var u=n.scale,f=n.type,_=n.layout,E=n.axisType;if(u==="auto")return _==="radial"&&E==="radiusAxis"?{scale:nS(),realScaleType:"band"}:_==="radial"&&E==="angleAxis"?{scale:MR(),realScaleType:"linear"}:f==="category"&&o&&(o.indexOf("LineChart")>=0||o.indexOf("AreaChart")>=0||o.indexOf("ComposedChart")>=0&&!s)?{scale:WE(),realScaleType:"point"}:f==="category"?{scale:nS(),realScaleType:"band"}:{scale:MR(),realScaleType:"linear"};if(LS(u)){var T="scale".concat(OC(u));return{scale:(H$[T]||WE)(),realScaleType:H$[T]?T:"point"}}return zt(u)?{scale:u}:{scale:WE(),realScaleType:"point"}},oY=1e-4,$J=function(n){var o=n.domain();if(!(!o||o.length<=2)){var s=o.length,u=n.range(),f=Math.min(u[0],u[1])-oY,_=Math.max(u[0],u[1])+oY,E=n(o[0]),T=n(o[s-1]);(E<f||E>_||T<f||T>_)&&n.domain([o[0],o[s-1]])}},t0e=function(n,o){if(!n)return null;for(var s=0,u=n.length;s<u;s++)if(n[s].item===o)return n[s].position;return null},r0e=function(n,o){if(!o||o.length!==2||!dt(o[0])||!dt(o[1]))return n;var s=Math.min(o[0],o[1]),u=Math.max(o[0],o[1]),f=[n[0],n[1]];return(!dt(n[0])||n[0]<s)&&(f[0]=s),(!dt(n[1])||n[1]>u)&&(f[1]=u),f[0]>u&&(f[0]=u),f[1]<s&&(f[1]=s),f},n0e=function(n){var o=n.length;if(!(o<=0))for(var s=0,u=n[0].length;s<u;++s)for(var f=0,_=0,E=0;E<o;++E){var T=MS(n[E][s][1])?n[E][s][0]:n[E][s][1];T>=0?(n[E][s][0]=f,n[E][s][1]=f+T,f=n[E][s][1]):(n[E][s][0]=_,n[E][s][1]=_+T,_=n[E][s][1])}},i0e=function(n){var o=n.length;if(!(o<=0))for(var s=0,u=n[0].length;s<u;++s)for(var f=0,_=0;_<o;++_){var E=MS(n[_][s][1])?n[_][s][0]:n[_][s][1];E>=0?(n[_][s][0]=f,n[_][s][1]=f+E,f=n[_][s][1]):(n[_][s][0]=0,n[_][s][1]=0)}},a0e={sign:n0e,expand:Kfe,none:Pg,silhouette:zfe,wiggle:$fe,positive:i0e},o0e=function(n,o,s){var u=o.map(function(E){return E.props.dataKey}),f=a0e[s],_=qfe().keys(u).value(function(E,T){return+hi(E,T,0)}).order(NL).offset(f);return _(n)},s0e=function(n,o,s,u,f,_){if(!n)return null;var E=_?o.reverse():o,T={},w=E.reduce(function(A,P){var j,W=(j=P.type)!==null&&j!==void 0&&j.defaultProps?ni(ni({},P.type.defaultProps),P.props):P.props,F=W.stackId,M=W.hide;if(M)return A;var X=W[s],Y=A[X]||{hasStack:!1,stackGroups:{}};if(Oi(F)){var J=Y.stackGroups[F]||{numericAxisId:s,cateAxisId:u,items:[]};J.items.push(P),Y.hasStack=!0,Y.stackGroups[F]=J}else Y.stackGroups[c_("_stackId_")]={numericAxisId:s,cateAxisId:u,items:[P]};return ni(ni({},A),{},Og({},X,Y))},T),I={};return Object.keys(w).reduce(function(A,P){var j=w[P];if(j.hasStack){var W={};j.stackGroups=Object.keys(j.stackGroups).reduce(function(F,M){var X=j.stackGroups[M];return ni(ni({},F),{},Og({},M,{numericAxisId:s,cateAxisId:u,items:X.items,stackedData:o0e(n,X.items,f)}))},W)}return ni(ni({},A),{},Og({},P,j))},I)},YJ=function(n,o){var s=o.realScaleType,u=o.type,f=o.tickCount,_=o.originalDomain,E=o.allowDecimals,T=s||o.scale;if(T!=="auto"&&T!=="linear")return null;if(f&&u==="number"&&_&&(_[0]==="auto"||_[1]==="auto")){var w=n.domain();if(!w.length)return null;var I=SSe(w,f,E);return n.domain([HC(I),GC(I)]),{niceTicks:I}}if(f&&u==="number"){var A=n.domain(),P=bSe(A,f,E);return{niceTicks:P}}return null};function sY(i){var n=i.axis,o=i.ticks,s=i.bandSize,u=i.entry,f=i.index,_=i.dataKey;if(n.type==="category"){if(!n.allowDuplicatedCategory&&n.dataKey&&!ir(u[n.dataKey])){var E=vR(o,"value",u[n.dataKey]);if(E)return E.coordinate+s/2}return o[f]?o[f].coordinate+s/2:null}var T=hi(u,ir(_)?n.dataKey:_);return ir(T)?null:n.scale(T)}var cY=function(n){var o=n.axis,s=n.ticks,u=n.offset,f=n.bandSize,_=n.entry,E=n.index;if(o.type==="category")return s[E]?s[E].coordinate+u:null;var T=hi(_,o.dataKey,o.domain[E]);return ir(T)?null:o.scale(T)-f/2+u},c0e=function(n){var o=n.numericAxis,s=o.scale.domain();if(o.type==="number"){var u=Math.min(s[0],s[1]),f=Math.max(s[0],s[1]);return u<=0&&f>=0?0:f<0?f:u}return s[0]},l0e=function(n,o){var s,u=(s=n.type)!==null&&s!==void 0&&s.defaultProps?ni(ni({},n.type.defaultProps),n.props):n.props,f=u.stackId;if(Oi(f)){var _=o[f];if(_){var E=_.items.indexOf(n);return E>=0?_.stackedData[E]:null}}return null},u0e=function(n){return n.reduce(function(o,s){return[HC(s.concat([o[0]]).filter(dt)),GC(s.concat([o[1]]).filter(dt))]},[1/0,-1/0])},XJ=function(n,o,s){return Object.keys(n).reduce(function(u,f){var _=n[f],E=_.stackedData,T=E.reduce(function(w,I){var A=u0e(I.slice(o,s+1));return[Math.min(w[0],A[0]),Math.max(w[1],A[1])]},[1/0,-1/0]);return[Math.min(T[0],u[0]),Math.max(T[1],u[1])]},[1/0,-1/0]).map(function(u){return u===1/0||u===-1/0?0:u})},lY=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,uY=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,tM=function(n,o,s){if(zt(n))return n(o,s);if(!Array.isArray(n))return o;var u=[];if(dt(n[0]))u[0]=s?n[0]:Math.min(n[0],o[0]);else if(lY.test(n[0])){var f=+lY.exec(n[0])[1];u[0]=o[0]-f}else zt(n[0])?u[0]=n[0](o[0]):u[0]=o[0];if(dt(n[1]))u[1]=s?n[1]:Math.max(n[1],o[1]);else if(uY.test(n[1])){var _=+uY.exec(n[1])[1];u[1]=o[1]+_}else zt(n[1])?u[1]=n[1](o[1]):u[1]=o[1];return u},GR=function(n,o,s){if(n&&n.scale&&n.scale.bandwidth){var u=n.scale.bandwidth();if(!s||u>0)return u}if(n&&o&&o.length>=2){for(var f=f2(o,function(A){return A.coordinate}),_=1/0,E=1,T=f.length;E<T;E++){var w=f[E],I=f[E-1];_=Math.min((w.coordinate||0)-(I.coordinate||0),_)}return _===1/0?0:_}return s?void 0:0},dY=function(n,o,s){return!n||!n.length||d_(n,Lo(s,"type.defaultProps.domain"))?o:n},JJ=function(n,o){var s=n.type.defaultProps?ni(ni({},n.type.defaultProps),n.props):n.props,u=s.dataKey,f=s.name,_=s.unit,E=s.formatter,T=s.tooltipType,w=s.chartType,I=s.hide;return ni(ni({},Pt(n,!1)),{},{dataKey:u,unit:_,formatter:E,name:f||u,color:F2(n),value:hi(o,u),type:T,payload:o,chartType:w,hide:I})};function hS(i){"@babel/helpers - typeof";return hS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hS(i)}function hY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function ru(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?hY(Object(o),!0).forEach(function(s){QJ(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function QJ(i,n,o){return n=d0e(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function d0e(i){var n=h0e(i,"string");return hS(n)=="symbol"?n:n+""}function h0e(i,n){if(hS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(hS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function p0e(i,n){return _0e(i)||g0e(i,n)||m0e(i,n)||f0e()}function f0e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m0e(i,n){if(i){if(typeof i=="string")return pY(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return pY(i,n)}}function pY(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function g0e(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function _0e(i){if(Array.isArray(i))return i}var HR=Math.PI/180,v0e=function(n){return n*180/Math.PI},$r=function(n,o,s,u){return{x:n+Math.cos(-HR*u)*s,y:o+Math.sin(-HR*u)*s}},ZJ=function(n,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(n-(s.left||0)-(s.right||0)),Math.abs(o-(s.top||0)-(s.bottom||0)))/2},eQ=function(n,o,s,u,f){var _=n.width,E=n.height,T=n.startAngle,w=n.endAngle,I=Ma(n.cx,_,_/2),A=Ma(n.cy,E,E/2),P=ZJ(_,E,s),j=Ma(n.innerRadius,P,0),W=Ma(n.outerRadius,P,P*.8),F=Object.keys(o);return F.reduce(function(M,X){var Y=o[X],J=Y.domain,re=Y.reversed,z;if(ir(Y.range))u==="angleAxis"?z=[T,w]:u==="radiusAxis"&&(z=[j,W]),re&&(z=[z[1],z[0]]);else{z=Y.range;var Z=z,ie=p0e(Z,2);T=ie[0],w=ie[1]}var de=zJ(Y,f),ge=de.realScaleType,Oe=de.scale;Oe.domain(J).range(z),$J(Oe);var me=YJ(Oe,ru(ru({},Y),{},{realScaleType:ge})),ye=ru(ru(ru({},Y),me),{},{range:z,radius:W,realScaleType:ge,scale:Oe,cx:I,cy:A,innerRadius:j,outerRadius:W,startAngle:T,endAngle:w});return ru(ru({},M),{},QJ({},X,ye))},{})},y0e=function(n,o){var s=n.x,u=n.y,f=o.x,_=o.y;return Math.sqrt(Math.pow(s-f,2)+Math.pow(u-_,2))},E0e=function(n,o){var s=n.x,u=n.y,f=o.cx,_=o.cy,E=y0e({x:s,y:u},{x:f,y:_});if(E<=0)return{radius:E};var T=(s-f)/E,w=Math.acos(T);return u>_&&(w=2*Math.PI-w),{radius:E,angle:v0e(w),angleInRadian:w}},S0e=function(n){var o=n.startAngle,s=n.endAngle,u=Math.floor(o/360),f=Math.floor(s/360),_=Math.min(u,f);return{startAngle:o-_*360,endAngle:s-_*360}},b0e=function(n,o){var s=o.startAngle,u=o.endAngle,f=Math.floor(s/360),_=Math.floor(u/360),E=Math.min(f,_);return n+E*360},fY=function(n,o){var s=n.x,u=n.y,f=E0e({x:s,y:u},o),_=f.radius,E=f.angle,T=o.innerRadius,w=o.outerRadius;if(_<T||_>w)return!1;if(_===0)return!0;var I=S0e(o),A=I.startAngle,P=I.endAngle,j=E,W;if(A<=P){for(;j>P;)j-=360;for(;j<A;)j+=360;W=j>=A&&j<=P}else{for(;j>A;)j-=360;for(;j<P;)j+=360;W=j>=P&&j<=A}return W?ru(ru({},o),{},{radius:_,angle:b0e(j,o)}):null},tQ=function(n){return!Ee.isValidElement(n)&&!zt(n)&&typeof n!="boolean"?n.className:""};function pS(i){"@babel/helpers - typeof";return pS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},pS(i)}var T0e=["offset"];function w0e(i){return O0e(i)||A0e(i)||C0e(i)||R0e()}function R0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C0e(i,n){if(i){if(typeof i=="string")return rM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return rM(i,n)}}function A0e(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function O0e(i){if(Array.isArray(i))return rM(i)}function rM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function I0e(i,n){if(i==null)return{};var o=N0e(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function N0e(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function mY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Ai(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?mY(Object(o),!0).forEach(function(s){P0e(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):mY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function P0e(i,n,o){return n=D0e(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function D0e(i){var n=x0e(i,"string");return pS(n)=="symbol"?n:n+""}function x0e(i,n){if(pS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(pS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function fS(){return fS=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},fS.apply(this,arguments)}var k0e=function(n){var o=n.value,s=n.formatter,u=ir(n.children)?o:n.children;return zt(s)?s(u):u},L0e=function(n,o){var s=La(o-n),u=Math.min(Math.abs(o-n),360);return s*u},M0e=function(n,o,s){var u=n.position,f=n.viewBox,_=n.offset,E=n.className,T=f,w=T.cx,I=T.cy,A=T.innerRadius,P=T.outerRadius,j=T.startAngle,W=T.endAngle,F=T.clockWise,M=(A+P)/2,X=L0e(j,W),Y=X>=0?1:-1,J,re;u==="insideStart"?(J=j+Y*_,re=F):u==="insideEnd"?(J=W-Y*_,re=!F):u==="end"&&(J=W+Y*_,re=F),re=X<=0?re:!re;var z=$r(w,I,M,J),Z=$r(w,I,M,J+(re?1:-1)*359),ie="M".concat(z.x,",").concat(z.y,`
    A`).concat(M,",").concat(M,",0,1,").concat(re?0:1,`,
    `).concat(Z.x,",").concat(Z.y),de=ir(n.id)?c_("recharts-radial-line-"):n.id;return ue.createElement("text",fS({},s,{dominantBaseline:"central",className:or("recharts-radial-bar-label",E)}),ue.createElement("defs",null,ue.createElement("path",{id:de,d:ie})),ue.createElement("textPath",{xlinkHref:"#".concat(de)},o))},U0e=function(n){var o=n.viewBox,s=n.offset,u=n.position,f=o,_=f.cx,E=f.cy,T=f.innerRadius,w=f.outerRadius,I=f.startAngle,A=f.endAngle,P=(I+A)/2;if(u==="outside"){var j=$r(_,E,w+s,P),W=j.x,F=j.y;return{x:W,y:F,textAnchor:W>=_?"start":"end",verticalAnchor:"middle"}}if(u==="center")return{x:_,y:E,textAnchor:"middle",verticalAnchor:"middle"};if(u==="centerTop")return{x:_,y:E,textAnchor:"middle",verticalAnchor:"start"};if(u==="centerBottom")return{x:_,y:E,textAnchor:"middle",verticalAnchor:"end"};var M=(T+w)/2,X=$r(_,E,M,P),Y=X.x,J=X.y;return{x:Y,y:J,textAnchor:"middle",verticalAnchor:"middle"}},j0e=function(n){var o=n.viewBox,s=n.parentViewBox,u=n.offset,f=n.position,_=o,E=_.x,T=_.y,w=_.width,I=_.height,A=I>=0?1:-1,P=A*u,j=A>0?"end":"start",W=A>0?"start":"end",F=w>=0?1:-1,M=F*u,X=F>0?"end":"start",Y=F>0?"start":"end";if(f==="top"){var J={x:E+w/2,y:T-A*u,textAnchor:"middle",verticalAnchor:j};return Ai(Ai({},J),s?{height:Math.max(T-s.y,0),width:w}:{})}if(f==="bottom"){var re={x:E+w/2,y:T+I+P,textAnchor:"middle",verticalAnchor:W};return Ai(Ai({},re),s?{height:Math.max(s.y+s.height-(T+I),0),width:w}:{})}if(f==="left"){var z={x:E-M,y:T+I/2,textAnchor:X,verticalAnchor:"middle"};return Ai(Ai({},z),s?{width:Math.max(z.x-s.x,0),height:I}:{})}if(f==="right"){var Z={x:E+w+M,y:T+I/2,textAnchor:Y,verticalAnchor:"middle"};return Ai(Ai({},Z),s?{width:Math.max(s.x+s.width-Z.x,0),height:I}:{})}var ie=s?{width:w,height:I}:{};return f==="insideLeft"?Ai({x:E+M,y:T+I/2,textAnchor:Y,verticalAnchor:"middle"},ie):f==="insideRight"?Ai({x:E+w-M,y:T+I/2,textAnchor:X,verticalAnchor:"middle"},ie):f==="insideTop"?Ai({x:E+w/2,y:T+P,textAnchor:"middle",verticalAnchor:W},ie):f==="insideBottom"?Ai({x:E+w/2,y:T+I-P,textAnchor:"middle",verticalAnchor:j},ie):f==="insideTopLeft"?Ai({x:E+M,y:T+P,textAnchor:Y,verticalAnchor:W},ie):f==="insideTopRight"?Ai({x:E+w-M,y:T+P,textAnchor:X,verticalAnchor:W},ie):f==="insideBottomLeft"?Ai({x:E+M,y:T+I-P,textAnchor:Y,verticalAnchor:j},ie):f==="insideBottomRight"?Ai({x:E+w-M,y:T+I-P,textAnchor:X,verticalAnchor:j},ie):s_(f)&&(dt(f.x)||Mp(f.x))&&(dt(f.y)||Mp(f.y))?Ai({x:E+Ma(f.x,w),y:T+Ma(f.y,I),textAnchor:"end",verticalAnchor:"end"},ie):Ai({x:E+w/2,y:T+I/2,textAnchor:"middle",verticalAnchor:"middle"},ie)},V0e=function(n){return"cx"in n&&dt(n.cx)};function qi(i){var n=i.offset,o=n===void 0?5:n,s=I0e(i,T0e),u=Ai({offset:o},s),f=u.viewBox,_=u.position,E=u.value,T=u.children,w=u.content,I=u.className,A=I===void 0?"":I,P=u.textBreakAll;if(!f||ir(E)&&ir(T)&&!Ee.isValidElement(w)&&!zt(w))return null;if(Ee.isValidElement(w))return Ee.cloneElement(w,u);var j;if(zt(w)){if(j=Ee.createElement(w,u),Ee.isValidElement(j))return j}else j=k0e(u);var W=V0e(f),F=Pt(u,!0);if(W&&(_==="insideStart"||_==="insideEnd"||_==="end"))return M0e(u,j,F);var M=W?U0e(u):j0e(u);return ue.createElement(Hp,fS({className:or("recharts-label",A)},F,M,{breakAll:P}),j)}qi.displayName="Label";var rQ=function(n){var o=n.cx,s=n.cy,u=n.angle,f=n.startAngle,_=n.endAngle,E=n.r,T=n.radius,w=n.innerRadius,I=n.outerRadius,A=n.x,P=n.y,j=n.top,W=n.left,F=n.width,M=n.height,X=n.clockWise,Y=n.labelViewBox;if(Y)return Y;if(dt(F)&&dt(M)){if(dt(A)&&dt(P))return{x:A,y:P,width:F,height:M};if(dt(j)&&dt(W))return{x:j,y:W,width:F,height:M}}return dt(A)&&dt(P)?{x:A,y:P,width:0,height:0}:dt(o)&&dt(s)?{cx:o,cy:s,startAngle:f||u||0,endAngle:_||u||0,innerRadius:w||0,outerRadius:I||T||E||0,clockWise:X}:n.viewBox?n.viewBox:{}},F0e=function(n,o){return n?n===!0?ue.createElement(qi,{key:"label-implicit",viewBox:o}):Oi(n)?ue.createElement(qi,{key:"label-implicit",viewBox:o,value:n}):Ee.isValidElement(n)?n.type===qi?Ee.cloneElement(n,{key:"label-implicit",viewBox:o}):ue.createElement(qi,{key:"label-implicit",content:n,viewBox:o}):zt(n)?ue.createElement(qi,{key:"label-implicit",content:n,viewBox:o}):s_(n)?ue.createElement(qi,fS({viewBox:o},n,{key:"label-implicit"})):null:null},B0e=function(n,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&s&&!n.label)return null;var u=n.children,f=rQ(n),_=Mo(u,qi).map(function(T,w){return Ee.cloneElement(T,{viewBox:o||f,key:"label-".concat(w)})});if(!s)return _;var E=F0e(n.label,o||f);return[E].concat(w0e(_))};qi.parseViewBox=rQ;qi.renderCallByParent=B0e;var kk,gY;function W0e(){if(gY)return kk;gY=1;function i(n){var o=n==null?0:n.length;return o?n[o-1]:void 0}return kk=i,kk}var G0e=W0e();const nQ=Yr(G0e);function mS(i){"@babel/helpers - typeof";return mS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mS(i)}var H0e=["valueAccessor"],q0e=["data","dataKey","clockWise","id","textBreakAll"];function K0e(i){return X0e(i)||Y0e(i)||$0e(i)||z0e()}function z0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $0e(i,n){if(i){if(typeof i=="string")return nM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return nM(i,n)}}function Y0e(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function X0e(i){if(Array.isArray(i))return nM(i)}function nM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function qR(){return qR=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},qR.apply(this,arguments)}function _Y(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function vY(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?_Y(Object(o),!0).forEach(function(s){J0e(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):_Y(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function J0e(i,n,o){return n=Q0e(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function Q0e(i){var n=Z0e(i,"string");return mS(n)=="symbol"?n:n+""}function Z0e(i,n){if(mS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(mS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function yY(i,n){if(i==null)return{};var o=ebe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function ebe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}var tbe=function(n){return Array.isArray(n.value)?nQ(n.value):n.value};function cl(i){var n=i.valueAccessor,o=n===void 0?tbe:n,s=yY(i,H0e),u=s.data,f=s.dataKey,_=s.clockWise,E=s.id,T=s.textBreakAll,w=yY(s,q0e);return!u||!u.length?null:ue.createElement(Dr,{className:"recharts-label-list"},u.map(function(I,A){var P=ir(f)?o(I,A):hi(I&&I.payload,f),j=ir(E)?{}:{id:"".concat(E,"-").concat(A)};return ue.createElement(qi,qR({},Pt(I,!0),w,j,{parentViewBox:I.parentViewBox,value:P,textBreakAll:T,viewBox:qi.parseViewBox(ir(_)?I:vY(vY({},I),{},{clockWise:_})),key:"label-".concat(A),index:A}))}))}cl.displayName="LabelList";function rbe(i,n){return i?i===!0?ue.createElement(cl,{key:"labelList-implicit",data:n}):ue.isValidElement(i)||zt(i)?ue.createElement(cl,{key:"labelList-implicit",data:n,content:i}):s_(i)?ue.createElement(cl,qR({data:n},i,{key:"labelList-implicit"})):null:null}function nbe(i,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!i||!i.children&&o&&!i.label)return null;var s=i.children,u=Mo(s,cl).map(function(_,E){return Ee.cloneElement(_,{data:n,key:"labelList-".concat(E)})});if(!o)return u;var f=rbe(i.label,n);return[f].concat(K0e(u))}cl.renderCallByParent=nbe;function gS(i){"@babel/helpers - typeof";return gS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gS(i)}function iM(){return iM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},iM.apply(this,arguments)}function EY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function SY(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?EY(Object(o),!0).forEach(function(s){ibe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):EY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ibe(i,n,o){return n=abe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function abe(i){var n=obe(i,"string");return gS(n)=="symbol"?n:n+""}function obe(i,n){if(gS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(gS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var sbe=function(n,o){var s=La(o-n),u=Math.min(Math.abs(o-n),359.999);return s*u},cR=function(n){var o=n.cx,s=n.cy,u=n.radius,f=n.angle,_=n.sign,E=n.isExternal,T=n.cornerRadius,w=n.cornerIsExternal,I=T*(E?1:-1)+u,A=Math.asin(T/I)/HR,P=w?f:f+_*A,j=$r(o,s,I,P),W=$r(o,s,u,P),F=w?f-_*A:f,M=$r(o,s,I*Math.cos(A*HR),F);return{center:j,circleTangency:W,lineTangency:M,theta:A}},iQ=function(n){var o=n.cx,s=n.cy,u=n.innerRadius,f=n.outerRadius,_=n.startAngle,E=n.endAngle,T=sbe(_,E),w=_+T,I=$r(o,s,f,_),A=$r(o,s,f,w),P="M ".concat(I.x,",").concat(I.y,`
    A `).concat(f,",").concat(f,`,0,
    `).concat(+(Math.abs(T)>180),",").concat(+(_>w),`,
    `).concat(A.x,",").concat(A.y,`
  `);if(u>0){var j=$r(o,s,u,_),W=$r(o,s,u,w);P+="L ".concat(W.x,",").concat(W.y,`
            A `).concat(u,",").concat(u,`,0,
            `).concat(+(Math.abs(T)>180),",").concat(+(_<=w),`,
            `).concat(j.x,",").concat(j.y," Z")}else P+="L ".concat(o,",").concat(s," Z");return P},cbe=function(n){var o=n.cx,s=n.cy,u=n.innerRadius,f=n.outerRadius,_=n.cornerRadius,E=n.forceCornerRadius,T=n.cornerIsExternal,w=n.startAngle,I=n.endAngle,A=La(I-w),P=cR({cx:o,cy:s,radius:f,angle:w,sign:A,cornerRadius:_,cornerIsExternal:T}),j=P.circleTangency,W=P.lineTangency,F=P.theta,M=cR({cx:o,cy:s,radius:f,angle:I,sign:-A,cornerRadius:_,cornerIsExternal:T}),X=M.circleTangency,Y=M.lineTangency,J=M.theta,re=T?Math.abs(w-I):Math.abs(w-I)-F-J;if(re<0)return E?"M ".concat(W.x,",").concat(W.y,`
        a`).concat(_,",").concat(_,",0,0,1,").concat(_*2,`,0
        a`).concat(_,",").concat(_,",0,0,1,").concat(-_*2,`,0
      `):iQ({cx:o,cy:s,innerRadius:u,outerRadius:f,startAngle:w,endAngle:I});var z="M ".concat(W.x,",").concat(W.y,`
    A`).concat(_,",").concat(_,",0,0,").concat(+(A<0),",").concat(j.x,",").concat(j.y,`
    A`).concat(f,",").concat(f,",0,").concat(+(re>180),",").concat(+(A<0),",").concat(X.x,",").concat(X.y,`
    A`).concat(_,",").concat(_,",0,0,").concat(+(A<0),",").concat(Y.x,",").concat(Y.y,`
  `);if(u>0){var Z=cR({cx:o,cy:s,radius:u,angle:w,sign:A,isExternal:!0,cornerRadius:_,cornerIsExternal:T}),ie=Z.circleTangency,de=Z.lineTangency,ge=Z.theta,Oe=cR({cx:o,cy:s,radius:u,angle:I,sign:-A,isExternal:!0,cornerRadius:_,cornerIsExternal:T}),me=Oe.circleTangency,ye=Oe.lineTangency,Ae=Oe.theta,be=T?Math.abs(w-I):Math.abs(w-I)-ge-Ae;if(be<0&&_===0)return"".concat(z,"L").concat(o,",").concat(s,"Z");z+="L".concat(ye.x,",").concat(ye.y,`
      A`).concat(_,",").concat(_,",0,0,").concat(+(A<0),",").concat(me.x,",").concat(me.y,`
      A`).concat(u,",").concat(u,",0,").concat(+(be>180),",").concat(+(A>0),",").concat(ie.x,",").concat(ie.y,`
      A`).concat(_,",").concat(_,",0,0,").concat(+(A<0),",").concat(de.x,",").concat(de.y,"Z")}else z+="L".concat(o,",").concat(s,"Z");return z},lbe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},aQ=function(n){var o=SY(SY({},lbe),n),s=o.cx,u=o.cy,f=o.innerRadius,_=o.outerRadius,E=o.cornerRadius,T=o.forceCornerRadius,w=o.cornerIsExternal,I=o.startAngle,A=o.endAngle,P=o.className;if(_<f||I===A)return null;var j=or("recharts-sector",P),W=_-f,F=Ma(E,W,0,!0),M;return F>0&&Math.abs(I-A)<360?M=cbe({cx:s,cy:u,innerRadius:f,outerRadius:_,cornerRadius:Math.min(F,W/2),forceCornerRadius:T,cornerIsExternal:w,startAngle:I,endAngle:A}):M=iQ({cx:s,cy:u,innerRadius:f,outerRadius:_,startAngle:I,endAngle:A}),ue.createElement("path",iM({},Pt(o,!0),{className:j,d:M,role:"img"}))};function _S(i){"@babel/helpers - typeof";return _S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_S(i)}function aM(){return aM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},aM.apply(this,arguments)}function bY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function TY(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?bY(Object(o),!0).forEach(function(s){ube(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):bY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ube(i,n,o){return n=dbe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function dbe(i){var n=hbe(i,"string");return _S(n)=="symbol"?n:n+""}function hbe(i,n){if(_S(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(_S(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var wY={curveBasisClosed:kfe,curveBasisOpen:Lfe,curveBasis:xfe,curveBumpX:yfe,curveBumpY:Efe,curveLinearClosed:Mfe,curveLinear:NC,curveMonotoneX:Ufe,curveMonotoneY:jfe,curveNatural:Vfe,curveStep:Ffe,curveStepAfter:Wfe,curveStepBefore:Bfe},lR=function(n){return n.x===+n.x&&n.y===+n.y},xE=function(n){return n.x},kE=function(n){return n.y},pbe=function(n,o){if(zt(n))return n;var s="curve".concat(OC(n));return(s==="curveMonotone"||s==="curveBump")&&o?wY["".concat(s).concat(o==="vertical"?"Y":"X")]:wY[s]||NC},fbe=function(n){var o=n.type,s=o===void 0?"linear":o,u=n.points,f=u===void 0?[]:u,_=n.baseLine,E=n.layout,T=n.connectNulls,w=T===void 0?!1:T,I=pbe(s,E),A=w?f.filter(function(F){return lR(F)}):f,P;if(Array.isArray(_)){var j=w?_.filter(function(F){return lR(F)}):_,W=A.map(function(F,M){return TY(TY({},F),{},{base:j[M]})});return E==="vertical"?P=eR().y(kE).x1(xE).x0(function(F){return F.base.x}):P=eR().x(xE).y1(kE).y0(function(F){return F.base.y}),P.defined(lR).curve(I),P(W)}return E==="vertical"&&dt(_)?P=eR().y(kE).x1(xE).x0(_):dt(_)?P=eR().x(xE).y1(kE).y0(_):P=tX().x(xE).y(kE),P.defined(lR).curve(I),P(A)},KR=function(n){var o=n.className,s=n.points,u=n.path,f=n.pathRef;if((!s||!s.length)&&!u)return null;var _=s&&s.length?fbe(n):u;return ue.createElement("path",aM({},Pt(n,!1),yR(n),{className:or("recharts-curve",o),d:_,ref:f}))},Lk={exports:{}},Mk,RY;function mbe(){if(RY)return Mk;RY=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Mk=i,Mk}var Uk,CY;function gbe(){if(CY)return Uk;CY=1;var i=mbe();function n(){}function o(){}return o.resetWarningCache=n,Uk=function(){function s(_,E,T,w,I,A){if(A!==i){var P=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw P.name="Invariant Violation",P}}s.isRequired=s;function u(){return s}var f={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:u,element:s,elementType:s,instanceOf:u,node:s,objectOf:u,oneOf:u,oneOfType:u,shape:u,exact:u,checkPropTypes:o,resetWarningCache:n};return f.PropTypes=f,f},Uk}var AY;function _be(){return AY||(AY=1,Lk.exports=gbe()()),Lk.exports}var vbe=_be();const Zr=Yr(vbe);var ybe=Object.getOwnPropertyNames,Ebe=Object.getOwnPropertySymbols,Sbe=Object.prototype.hasOwnProperty;function OY(i,n){return function(s,u,f){return i(s,u,f)&&n(s,u,f)}}function uR(i){return function(o,s,u){if(!o||!s||typeof o!="object"||typeof s!="object")return i(o,s,u);var f=u.cache,_=f.get(o),E=f.get(s);if(_&&E)return _===s&&E===o;f.set(o,s),f.set(s,o);var T=i(o,s,u);return f.delete(o),f.delete(s),T}}function IY(i){return ybe(i).concat(Ebe(i))}var bbe=Object.hasOwn||function(i,n){return Sbe.call(i,n)};function Jp(i,n){return i===n||!i&&!n&&i!==i&&n!==n}var Tbe="__v",wbe="__o",Rbe="_owner",NY=Object.getOwnPropertyDescriptor,PY=Object.keys;function Cbe(i,n,o){var s=i.length;if(n.length!==s)return!1;for(;s-- >0;)if(!o.equals(i[s],n[s],s,s,i,n,o))return!1;return!0}function Abe(i,n){return Jp(i.getTime(),n.getTime())}function Obe(i,n){return i.name===n.name&&i.message===n.message&&i.cause===n.cause&&i.stack===n.stack}function Ibe(i,n){return i===n}function DY(i,n,o){var s=i.size;if(s!==n.size)return!1;if(!s)return!0;for(var u=new Array(s),f=i.entries(),_,E,T=0;(_=f.next())&&!_.done;){for(var w=n.entries(),I=!1,A=0;(E=w.next())&&!E.done;){if(u[A]){A++;continue}var P=_.value,j=E.value;if(o.equals(P[0],j[0],T,A,i,n,o)&&o.equals(P[1],j[1],P[0],j[0],i,n,o)){I=u[A]=!0;break}A++}if(!I)return!1;T++}return!0}var Nbe=Jp;function Pbe(i,n,o){var s=PY(i),u=s.length;if(PY(n).length!==u)return!1;for(;u-- >0;)if(!oQ(i,n,o,s[u]))return!1;return!0}function LE(i,n,o){var s=IY(i),u=s.length;if(IY(n).length!==u)return!1;for(var f,_,E;u-- >0;)if(f=s[u],!oQ(i,n,o,f)||(_=NY(i,f),E=NY(n,f),(_||E)&&(!_||!E||_.configurable!==E.configurable||_.enumerable!==E.enumerable||_.writable!==E.writable)))return!1;return!0}function Dbe(i,n){return Jp(i.valueOf(),n.valueOf())}function xbe(i,n){return i.source===n.source&&i.flags===n.flags}function xY(i,n,o){var s=i.size;if(s!==n.size)return!1;if(!s)return!0;for(var u=new Array(s),f=i.values(),_,E;(_=f.next())&&!_.done;){for(var T=n.values(),w=!1,I=0;(E=T.next())&&!E.done;){if(!u[I]&&o.equals(_.value,E.value,_.value,E.value,i,n,o)){w=u[I]=!0;break}I++}if(!w)return!1}return!0}function kbe(i,n){var o=i.length;if(n.length!==o)return!1;for(;o-- >0;)if(i[o]!==n[o])return!1;return!0}function Lbe(i,n){return i.hostname===n.hostname&&i.pathname===n.pathname&&i.protocol===n.protocol&&i.port===n.port&&i.hash===n.hash&&i.username===n.username&&i.password===n.password}function oQ(i,n,o,s){return(s===Rbe||s===wbe||s===Tbe)&&(i.$$typeof||n.$$typeof)?!0:bbe(n,s)&&o.equals(i[s],n[s],s,s,i,n,o)}var Mbe="[object Arguments]",Ube="[object Boolean]",jbe="[object Date]",Vbe="[object Error]",Fbe="[object Map]",Bbe="[object Number]",Wbe="[object Object]",Gbe="[object RegExp]",Hbe="[object Set]",qbe="[object String]",Kbe="[object URL]",zbe=Array.isArray,kY=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,LY=Object.assign,$be=Object.prototype.toString.call.bind(Object.prototype.toString);function Ybe(i){var n=i.areArraysEqual,o=i.areDatesEqual,s=i.areErrorsEqual,u=i.areFunctionsEqual,f=i.areMapsEqual,_=i.areNumbersEqual,E=i.areObjectsEqual,T=i.arePrimitiveWrappersEqual,w=i.areRegExpsEqual,I=i.areSetsEqual,A=i.areTypedArraysEqual,P=i.areUrlsEqual;return function(W,F,M){if(W===F)return!0;if(W==null||F==null)return!1;var X=typeof W;if(X!==typeof F)return!1;if(X!=="object")return X==="number"?_(W,F,M):X==="function"?u(W,F,M):!1;var Y=W.constructor;if(Y!==F.constructor)return!1;if(Y===Object)return E(W,F,M);if(zbe(W))return n(W,F,M);if(kY!=null&&kY(W))return A(W,F,M);if(Y===Date)return o(W,F,M);if(Y===RegExp)return w(W,F,M);if(Y===Map)return f(W,F,M);if(Y===Set)return I(W,F,M);var J=$be(W);return J===jbe?o(W,F,M):J===Gbe?w(W,F,M):J===Fbe?f(W,F,M):J===Hbe?I(W,F,M):J===Wbe?typeof W.then!="function"&&typeof F.then!="function"&&E(W,F,M):J===Kbe?P(W,F,M):J===Vbe?s(W,F,M):J===Mbe?E(W,F,M):J===Ube||J===Bbe||J===qbe?T(W,F,M):!1}}function Xbe(i){var n=i.circular,o=i.createCustomConfig,s=i.strict,u={areArraysEqual:s?LE:Cbe,areDatesEqual:Abe,areErrorsEqual:Obe,areFunctionsEqual:Ibe,areMapsEqual:s?OY(DY,LE):DY,areNumbersEqual:Nbe,areObjectsEqual:s?LE:Pbe,arePrimitiveWrappersEqual:Dbe,areRegExpsEqual:xbe,areSetsEqual:s?OY(xY,LE):xY,areTypedArraysEqual:s?LE:kbe,areUrlsEqual:Lbe};if(o&&(u=LY({},u,o(u))),n){var f=uR(u.areArraysEqual),_=uR(u.areMapsEqual),E=uR(u.areObjectsEqual),T=uR(u.areSetsEqual);u=LY({},u,{areArraysEqual:f,areMapsEqual:_,areObjectsEqual:E,areSetsEqual:T})}return u}function Jbe(i){return function(n,o,s,u,f,_,E){return i(n,o,E)}}function Qbe(i){var n=i.circular,o=i.comparator,s=i.createState,u=i.equals,f=i.strict;if(s)return function(T,w){var I=s(),A=I.cache,P=A===void 0?n?new WeakMap:void 0:A,j=I.meta;return o(T,w,{cache:P,equals:u,meta:j,strict:f})};if(n)return function(T,w){return o(T,w,{cache:new WeakMap,equals:u,meta:void 0,strict:f})};var _={cache:void 0,equals:u,meta:void 0,strict:f};return function(T,w){return o(T,w,_)}}var Zbe=$d();$d({strict:!0});$d({circular:!0});$d({circular:!0,strict:!0});$d({createInternalComparator:function(){return Jp}});$d({strict:!0,createInternalComparator:function(){return Jp}});$d({circular:!0,createInternalComparator:function(){return Jp}});$d({circular:!0,createInternalComparator:function(){return Jp},strict:!0});function $d(i){i===void 0&&(i={});var n=i.circular,o=n===void 0?!1:n,s=i.createInternalComparator,u=i.createState,f=i.strict,_=f===void 0?!1:f,E=Xbe(i),T=Ybe(E),w=s?s(T):Jbe(T);return Qbe({circular:o,comparator:T,createState:u,equals:w,strict:_})}function eTe(i){typeof requestAnimationFrame<"u"&&requestAnimationFrame(i)}function MY(i){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=-1,s=function u(f){o<0&&(o=f),f-o>n?(i(f),o=-1):eTe(u)};requestAnimationFrame(s)}function oM(i){"@babel/helpers - typeof";return oM=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},oM(i)}function tTe(i){return aTe(i)||iTe(i)||nTe(i)||rTe()}function rTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nTe(i,n){if(i){if(typeof i=="string")return UY(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return UY(i,n)}}function UY(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function iTe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function aTe(i){if(Array.isArray(i))return i}function oTe(){var i={},n=function(){return null},o=!1,s=function u(f){if(!o){if(Array.isArray(f)){if(!f.length)return;var _=f,E=tTe(_),T=E[0],w=E.slice(1);if(typeof T=="number"){MY(u.bind(null,w),T);return}u(T),MY(u.bind(null,w));return}oM(f)==="object"&&(i=f,n(i)),typeof f=="function"&&f()}};return{stop:function(){o=!0},start:function(f){o=!1,s(f)},subscribe:function(f){return n=f,function(){n=function(){return null}}}}}function vS(i){"@babel/helpers - typeof";return vS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vS(i)}function jY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function VY(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?jY(Object(o),!0).forEach(function(s){sQ(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):jY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function sQ(i,n,o){return n=sTe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function sTe(i){var n=cTe(i,"string");return vS(n)==="symbol"?n:String(n)}function cTe(i,n){if(vS(i)!=="object"||i===null)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(vS(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var lTe=function(n,o){return[Object.keys(n),Object.keys(o)].reduce(function(s,u){return s.filter(function(f){return u.includes(f)})})},uTe=function(n){return n},dTe=function(n){return n.replace(/([A-Z])/g,function(o){return"-".concat(o.toLowerCase())})},HE=function(n,o){return Object.keys(o).reduce(function(s,u){return VY(VY({},s),{},sQ({},u,n(u,o[u])))},{})},FY=function(n,o,s){return n.map(function(u){return"".concat(dTe(u)," ").concat(o,"ms ").concat(s)}).join(",")};function hTe(i,n){return mTe(i)||fTe(i,n)||cQ(i,n)||pTe()}function pTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fTe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function mTe(i){if(Array.isArray(i))return i}function gTe(i){return yTe(i)||vTe(i)||cQ(i)||_Te()}function _Te(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cQ(i,n){if(i){if(typeof i=="string")return sM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return sM(i,n)}}function vTe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function yTe(i){if(Array.isArray(i))return sM(i)}function sM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}var zR=1e-4,lQ=function(n,o){return[0,3*n,3*o-6*n,3*n-3*o+1]},uQ=function(n,o){return n.map(function(s,u){return s*Math.pow(o,u)}).reduce(function(s,u){return s+u})},BY=function(n,o){return function(s){var u=lQ(n,o);return uQ(u,s)}},ETe=function(n,o){return function(s){var u=lQ(n,o),f=[].concat(gTe(u.map(function(_,E){return _*E}).slice(1)),[0]);return uQ(f,s)}},WY=function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];var u=o[0],f=o[1],_=o[2],E=o[3];if(o.length===1)switch(o[0]){case"linear":u=0,f=0,_=1,E=1;break;case"ease":u=.25,f=.1,_=.25,E=1;break;case"ease-in":u=.42,f=0,_=1,E=1;break;case"ease-out":u=.42,f=0,_=.58,E=1;break;case"ease-in-out":u=0,f=0,_=.58,E=1;break;default:{var T=o[0].split("(");if(T[0]==="cubic-bezier"&&T[1].split(")")[0].split(",").length===4){var w=T[1].split(")")[0].split(",").map(function(M){return parseFloat(M)}),I=hTe(w,4);u=I[0],f=I[1],_=I[2],E=I[3]}}}var A=BY(u,_),P=BY(f,E),j=ETe(u,_),W=function(X){return X>1?1:X<0?0:X},F=function(X){for(var Y=X>1?1:X,J=Y,re=0;re<8;++re){var z=A(J)-Y,Z=j(J);if(Math.abs(z-Y)<zR||Z<zR)return P(J);J=W(J-z/Z)}return P(J)};return F.isStepper=!1,F},STe=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.stiff,s=o===void 0?100:o,u=n.damping,f=u===void 0?8:u,_=n.dt,E=_===void 0?17:_,T=function(I,A,P){var j=-(I-A)*s,W=P*f,F=P+(j-W)*E/1e3,M=P*E/1e3+I;return Math.abs(M-A)<zR&&Math.abs(F)<zR?[A,0]:[M,F]};return T.isStepper=!0,T.dt=E,T},bTe=function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];var u=o[0];if(typeof u=="string")switch(u){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return WY(u);case"spring":return STe();default:if(u.split("(")[0]==="cubic-bezier")return WY(u)}return typeof u=="function"?u:null};function yS(i){"@babel/helpers - typeof";return yS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yS(i)}function GY(i){return RTe(i)||wTe(i)||dQ(i)||TTe()}function TTe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wTe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function RTe(i){if(Array.isArray(i))return lM(i)}function HY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function na(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?HY(Object(o),!0).forEach(function(s){cM(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):HY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function cM(i,n,o){return n=CTe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function CTe(i){var n=ATe(i,"string");return yS(n)==="symbol"?n:String(n)}function ATe(i,n){if(yS(i)!=="object"||i===null)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(yS(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function OTe(i,n){return PTe(i)||NTe(i,n)||dQ(i,n)||ITe()}function ITe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dQ(i,n){if(i){if(typeof i=="string")return lM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return lM(i,n)}}function lM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function NTe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function PTe(i){if(Array.isArray(i))return i}var $R=function(n,o,s){return n+(o-n)*s},uM=function(n){var o=n.from,s=n.to;return o!==s},DTe=function i(n,o,s){var u=HE(function(f,_){if(uM(_)){var E=n(_.from,_.to,_.velocity),T=OTe(E,2),w=T[0],I=T[1];return na(na({},_),{},{from:w,velocity:I})}return _},o);return s<1?HE(function(f,_){return uM(_)?na(na({},_),{},{velocity:$R(_.velocity,u[f].velocity,s),from:$R(_.from,u[f].from,s)}):_},o):i(n,u,s-1)};const xTe=function(i,n,o,s,u){var f=lTe(i,n),_=f.reduce(function(M,X){return na(na({},M),{},cM({},X,[i[X],n[X]]))},{}),E=f.reduce(function(M,X){return na(na({},M),{},cM({},X,{from:i[X],velocity:0,to:n[X]}))},{}),T=-1,w,I,A=function(){return null},P=function(){return HE(function(X,Y){return Y.from},E)},j=function(){return!Object.values(E).filter(uM).length},W=function(X){w||(w=X);var Y=X-w,J=Y/o.dt;E=DTe(o,E,J),u(na(na(na({},i),n),P())),w=X,j()||(T=requestAnimationFrame(A))},F=function(X){I||(I=X);var Y=(X-I)/s,J=HE(function(z,Z){return $R.apply(void 0,GY(Z).concat([o(Y)]))},_);if(u(na(na(na({},i),n),J)),Y<1)T=requestAnimationFrame(A);else{var re=HE(function(z,Z){return $R.apply(void 0,GY(Z).concat([o(1)]))},_);u(na(na(na({},i),n),re))}};return A=o.isStepper?W:F,function(){return requestAnimationFrame(A),function(){cancelAnimationFrame(T)}}};function Fg(i){"@babel/helpers - typeof";return Fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Fg(i)}var kTe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function LTe(i,n){if(i==null)return{};var o=MTe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function MTe(i,n){if(i==null)return{};var o={},s=Object.keys(i),u,f;for(f=0;f<s.length;f++)u=s[f],!(n.indexOf(u)>=0)&&(o[u]=i[u]);return o}function jk(i){return FTe(i)||VTe(i)||jTe(i)||UTe()}function UTe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jTe(i,n){if(i){if(typeof i=="string")return dM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return dM(i,n)}}function VTe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function FTe(i){if(Array.isArray(i))return dM(i)}function dM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function qY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function rc(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?qY(Object(o),!0).forEach(function(s){FE(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):qY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function FE(i,n,o){return n=hQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function BTe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function WTe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,hQ(s.key),s)}}function GTe(i,n,o){return n&&WTe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function hQ(i){var n=HTe(i,"string");return Fg(n)==="symbol"?n:String(n)}function HTe(i,n){if(Fg(i)!=="object"||i===null)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Fg(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function qTe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&hM(i,n)}function hM(i,n){return hM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},hM(i,n)}function KTe(i){var n=zTe();return function(){var s=YR(i),u;if(n){var f=YR(this).constructor;u=Reflect.construct(s,arguments,f)}else u=s.apply(this,arguments);return pM(this,u)}}function pM(i,n){if(n&&(Fg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fM(i)}function fM(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function zTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function YR(i){return YR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},YR(i)}var sc=function(i){qTe(o,i);var n=KTe(o);function o(s,u){var f;BTe(this,o),f=n.call(this,s,u);var _=f.props,E=_.isActive,T=_.attributeName,w=_.from,I=_.to,A=_.steps,P=_.children,j=_.duration;if(f.handleStyleChange=f.handleStyleChange.bind(fM(f)),f.changeStyle=f.changeStyle.bind(fM(f)),!E||j<=0)return f.state={style:{}},typeof P=="function"&&(f.state={style:I}),pM(f);if(A&&A.length)f.state={style:A[0].style};else if(w){if(typeof P=="function")return f.state={style:w},pM(f);f.state={style:T?FE({},T,w):w}}else f.state={style:{}};return f}return GTe(o,[{key:"componentDidMount",value:function(){var u=this.props,f=u.isActive,_=u.canBegin;this.mounted=!0,!(!f||!_)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(u){var f=this.props,_=f.isActive,E=f.canBegin,T=f.attributeName,w=f.shouldReAnimate,I=f.to,A=f.from,P=this.state.style;if(E){if(!_){var j={style:T?FE({},T,I):I};this.state&&P&&(T&&P[T]!==I||!T&&P!==I)&&this.setState(j);return}if(!(Zbe(u.to,I)&&u.canBegin&&u.isActive)){var W=!u.canBegin||!u.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var F=W||w?A:u.to;if(this.state&&P){var M={style:T?FE({},T,F):F};(T&&P[T]!==F||!T&&P!==F)&&this.setState(M)}this.runAnimation(rc(rc({},this.props),{},{from:F,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var u=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),u&&u()}},{key:"handleStyleChange",value:function(u){this.changeStyle(u)}},{key:"changeStyle",value:function(u){this.mounted&&this.setState({style:u})}},{key:"runJSAnimation",value:function(u){var f=this,_=u.from,E=u.to,T=u.duration,w=u.easing,I=u.begin,A=u.onAnimationEnd,P=u.onAnimationStart,j=xTe(_,E,bTe(w),T,this.changeStyle),W=function(){f.stopJSAnimation=j()};this.manager.start([P,I,W,T,A])}},{key:"runStepAnimation",value:function(u){var f=this,_=u.steps,E=u.begin,T=u.onAnimationStart,w=_[0],I=w.style,A=w.duration,P=A===void 0?0:A,j=function(F,M,X){if(X===0)return F;var Y=M.duration,J=M.easing,re=J===void 0?"ease":J,z=M.style,Z=M.properties,ie=M.onAnimationEnd,de=X>0?_[X-1]:M,ge=Z||Object.keys(z);if(typeof re=="function"||re==="spring")return[].concat(jk(F),[f.runJSAnimation.bind(f,{from:de.style,to:z,duration:Y,easing:re}),Y]);var Oe=FY(ge,Y,re),me=rc(rc(rc({},de.style),z),{},{transition:Oe});return[].concat(jk(F),[me,Y,ie]).filter(uTe)};return this.manager.start([T].concat(jk(_.reduce(j,[I,Math.max(P,E)])),[u.onAnimationEnd]))}},{key:"runAnimation",value:function(u){this.manager||(this.manager=oTe());var f=u.begin,_=u.duration,E=u.attributeName,T=u.to,w=u.easing,I=u.onAnimationStart,A=u.onAnimationEnd,P=u.steps,j=u.children,W=this.manager;if(this.unSubscribe=W.subscribe(this.handleStyleChange),typeof w=="function"||typeof j=="function"||w==="spring"){this.runJSAnimation(u);return}if(P.length>1){this.runStepAnimation(u);return}var F=E?FE({},E,T):T,M=FY(Object.keys(F),_,w);W.start([I,f,rc(rc({},F),{},{transition:M}),_,A])}},{key:"render",value:function(){var u=this.props,f=u.children;u.begin;var _=u.duration;u.attributeName,u.easing;var E=u.isActive;u.steps,u.from,u.to,u.canBegin,u.onAnimationEnd,u.shouldReAnimate,u.onAnimationReStart;var T=LTe(u,kTe),w=Ee.Children.count(f),I=this.state.style;if(typeof f=="function")return f(I);if(!E||w===0||_<=0)return f;var A=function(j){var W=j.props,F=W.style,M=F===void 0?{}:F,X=W.className,Y=Ee.cloneElement(j,rc(rc({},T),{},{style:rc(rc({},M),I),className:X}));return Y};return w===1?A(Ee.Children.only(f)):ue.createElement("div",null,Ee.Children.map(f,function(P){return A(P)}))}}]),o}(Ee.PureComponent);sc.displayName="Animate";sc.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};sc.propTypes={from:Zr.oneOfType([Zr.object,Zr.string]),to:Zr.oneOfType([Zr.object,Zr.string]),attributeName:Zr.string,duration:Zr.number,begin:Zr.number,easing:Zr.oneOfType([Zr.string,Zr.func]),steps:Zr.arrayOf(Zr.shape({duration:Zr.number.isRequired,style:Zr.object.isRequired,easing:Zr.oneOfType([Zr.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Zr.func]),properties:Zr.arrayOf("string"),onAnimationEnd:Zr.func})),children:Zr.oneOfType([Zr.node,Zr.func]),isActive:Zr.bool,canBegin:Zr.bool,onAnimationEnd:Zr.func,shouldReAnimate:Zr.bool,onAnimationStart:Zr.func,onAnimationReStart:Zr.func};function ES(i){"@babel/helpers - typeof";return ES=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ES(i)}function XR(){return XR=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},XR.apply(this,arguments)}function $Te(i,n){return QTe(i)||JTe(i,n)||XTe(i,n)||YTe()}function YTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XTe(i,n){if(i){if(typeof i=="string")return KY(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return KY(i,n)}}function KY(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function JTe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function QTe(i){if(Array.isArray(i))return i}function zY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function $Y(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?zY(Object(o),!0).forEach(function(s){ZTe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):zY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ZTe(i,n,o){return n=ewe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function ewe(i){var n=twe(i,"string");return ES(n)=="symbol"?n:n+""}function twe(i,n){if(ES(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(ES(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var YY=function(n,o,s,u,f){var _=Math.min(Math.abs(s)/2,Math.abs(u)/2),E=u>=0?1:-1,T=s>=0?1:-1,w=u>=0&&s>=0||u<0&&s<0?1:0,I;if(_>0&&f instanceof Array){for(var A=[0,0,0,0],P=0,j=4;P<j;P++)A[P]=f[P]>_?_:f[P];I="M".concat(n,",").concat(o+E*A[0]),A[0]>0&&(I+="A ".concat(A[0],",").concat(A[0],",0,0,").concat(w,",").concat(n+T*A[0],",").concat(o)),I+="L ".concat(n+s-T*A[1],",").concat(o),A[1]>0&&(I+="A ".concat(A[1],",").concat(A[1],",0,0,").concat(w,`,
        `).concat(n+s,",").concat(o+E*A[1])),I+="L ".concat(n+s,",").concat(o+u-E*A[2]),A[2]>0&&(I+="A ".concat(A[2],",").concat(A[2],",0,0,").concat(w,`,
        `).concat(n+s-T*A[2],",").concat(o+u)),I+="L ".concat(n+T*A[3],",").concat(o+u),A[3]>0&&(I+="A ".concat(A[3],",").concat(A[3],",0,0,").concat(w,`,
        `).concat(n,",").concat(o+u-E*A[3])),I+="Z"}else if(_>0&&f===+f&&f>0){var W=Math.min(_,f);I="M ".concat(n,",").concat(o+E*W,`
            A `).concat(W,",").concat(W,",0,0,").concat(w,",").concat(n+T*W,",").concat(o,`
            L `).concat(n+s-T*W,",").concat(o,`
            A `).concat(W,",").concat(W,",0,0,").concat(w,",").concat(n+s,",").concat(o+E*W,`
            L `).concat(n+s,",").concat(o+u-E*W,`
            A `).concat(W,",").concat(W,",0,0,").concat(w,",").concat(n+s-T*W,",").concat(o+u,`
            L `).concat(n+T*W,",").concat(o+u,`
            A `).concat(W,",").concat(W,",0,0,").concat(w,",").concat(n,",").concat(o+u-E*W," Z")}else I="M ".concat(n,",").concat(o," h ").concat(s," v ").concat(u," h ").concat(-s," Z");return I},rwe=function(n,o){if(!n||!o)return!1;var s=n.x,u=n.y,f=o.x,_=o.y,E=o.width,T=o.height;if(Math.abs(E)>0&&Math.abs(T)>0){var w=Math.min(f,f+E),I=Math.max(f,f+E),A=Math.min(_,_+T),P=Math.max(_,_+T);return s>=w&&s<=I&&u>=A&&u<=P}return!1},nwe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},B2=function(n){var o=$Y($Y({},nwe),n),s=Ee.useRef(),u=Ee.useState(-1),f=$Te(u,2),_=f[0],E=f[1];Ee.useEffect(function(){if(s.current&&s.current.getTotalLength)try{var re=s.current.getTotalLength();re&&E(re)}catch{}},[]);var T=o.x,w=o.y,I=o.width,A=o.height,P=o.radius,j=o.className,W=o.animationEasing,F=o.animationDuration,M=o.animationBegin,X=o.isAnimationActive,Y=o.isUpdateAnimationActive;if(T!==+T||w!==+w||I!==+I||A!==+A||I===0||A===0)return null;var J=or("recharts-rectangle",j);return Y?ue.createElement(sc,{canBegin:_>0,from:{width:I,height:A,x:T,y:w},to:{width:I,height:A,x:T,y:w},duration:F,animationEasing:W,isActive:Y},function(re){var z=re.width,Z=re.height,ie=re.x,de=re.y;return ue.createElement(sc,{canBegin:_>0,from:"0px ".concat(_===-1?1:_,"px"),to:"".concat(_,"px 0px"),attributeName:"strokeDasharray",begin:M,duration:F,isActive:X,easing:W},ue.createElement("path",XR({},Pt(o,!0),{className:J,d:YY(ie,de,z,Z,P),ref:s})))}):ue.createElement("path",XR({},Pt(o,!0),{className:J,d:YY(T,w,I,A,P)}))},iwe=["points","className","baseLinePoints","connectNulls"];function Eg(){return Eg=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},Eg.apply(this,arguments)}function awe(i,n){if(i==null)return{};var o=owe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function owe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function XY(i){return uwe(i)||lwe(i)||cwe(i)||swe()}function swe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cwe(i,n){if(i){if(typeof i=="string")return mM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return mM(i,n)}}function lwe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function uwe(i){if(Array.isArray(i))return mM(i)}function mM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}var JY=function(n){return n&&n.x===+n.x&&n.y===+n.y},dwe=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],o=[[]];return n.forEach(function(s){JY(s)?o[o.length-1].push(s):o[o.length-1].length>0&&o.push([])}),JY(n[0])&&o[o.length-1].push(n[0]),o[o.length-1].length<=0&&(o=o.slice(0,-1)),o},qE=function(n,o){var s=dwe(n);o&&(s=[s.reduce(function(f,_){return[].concat(XY(f),XY(_))},[])]);var u=s.map(function(f){return f.reduce(function(_,E,T){return"".concat(_).concat(T===0?"M":"L").concat(E.x,",").concat(E.y)},"")}).join("");return s.length===1?"".concat(u,"Z"):u},hwe=function(n,o,s){var u=qE(n,s);return"".concat(u.slice(-1)==="Z"?u.slice(0,-1):u,"L").concat(qE(o.reverse(),s).slice(1))},pQ=function(n){var o=n.points,s=n.className,u=n.baseLinePoints,f=n.connectNulls,_=awe(n,iwe);if(!o||!o.length)return null;var E=or("recharts-polygon",s);if(u&&u.length){var T=_.stroke&&_.stroke!=="none",w=hwe(o,u,f);return ue.createElement("g",{className:E},ue.createElement("path",Eg({},Pt(_,!0),{fill:w.slice(-1)==="Z"?_.fill:"none",stroke:"none",d:w})),T?ue.createElement("path",Eg({},Pt(_,!0),{fill:"none",d:qE(o,f)})):null,T?ue.createElement("path",Eg({},Pt(_,!0),{fill:"none",d:qE(u,f)})):null)}var I=qE(o,f);return ue.createElement("path",Eg({},Pt(_,!0),{fill:I.slice(-1)==="Z"?_.fill:"none",className:E,d:I}))};function gM(){return gM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},gM.apply(this,arguments)}var GS=function(n){var o=n.cx,s=n.cy,u=n.r,f=n.className,_=or("recharts-dot",f);return o===+o&&s===+s&&u===+u?ue.createElement("circle",gM({},Pt(n,!1),yR(n),{className:_,cx:o,cy:s,r:u})):null};function SS(i){"@babel/helpers - typeof";return SS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},SS(i)}var pwe=["x","y","top","left","width","height","className"];function _M(){return _M=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},_M.apply(this,arguments)}function QY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function fwe(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?QY(Object(o),!0).forEach(function(s){mwe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):QY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function mwe(i,n,o){return n=gwe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function gwe(i){var n=_we(i,"string");return SS(n)=="symbol"?n:n+""}function _we(i,n){if(SS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(SS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function vwe(i,n){if(i==null)return{};var o=ywe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function ywe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}var Ewe=function(n,o,s,u,f,_){return"M".concat(n,",").concat(f,"v").concat(u,"M").concat(_,",").concat(o,"h").concat(s)},Swe=function(n){var o=n.x,s=o===void 0?0:o,u=n.y,f=u===void 0?0:u,_=n.top,E=_===void 0?0:_,T=n.left,w=T===void 0?0:T,I=n.width,A=I===void 0?0:I,P=n.height,j=P===void 0?0:P,W=n.className,F=vwe(n,pwe),M=fwe({x:s,y:f,top:E,left:w,width:A,height:j},F);return!dt(s)||!dt(f)||!dt(A)||!dt(j)||!dt(E)||!dt(w)?null:ue.createElement("path",_M({},Pt(M,!0),{className:or("recharts-cross",W),d:Ewe(s,f,A,j,E,w)}))},bwe=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function bS(i){"@babel/helpers - typeof";return bS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bS(i)}function Twe(i,n){if(i==null)return{};var o=wwe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function wwe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function pu(){return pu=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},pu.apply(this,arguments)}function ZY(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function TS(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?ZY(Object(o),!0).forEach(function(s){Rwe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ZY(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Rwe(i,n,o){return n=Cwe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function Cwe(i){var n=Awe(i,"string");return bS(n)=="symbol"?n:n+""}function Awe(i,n){if(bS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(bS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var Owe=function(n,o,s,u){var f="";return u.forEach(function(_,E){var T=$r(o,s,n,_);E?f+="L ".concat(T.x,",").concat(T.y):f+="M ".concat(T.x,",").concat(T.y)}),f+="Z",f},Iwe=function(n){var o=n.cx,s=n.cy,u=n.innerRadius,f=n.outerRadius,_=n.polarAngles,E=n.radialLines;if(!_||!_.length||!E)return null;var T=TS({stroke:"#ccc"},Pt(n,!1));return ue.createElement("g",{className:"recharts-polar-grid-angle"},_.map(function(w){var I=$r(o,s,u,w),A=$r(o,s,f,w);return ue.createElement("line",pu({},T,{key:"line-".concat(w),x1:I.x,y1:I.y,x2:A.x,y2:A.y}))}))},Nwe=function(n){var o=n.cx,s=n.cy,u=n.radius,f=n.index,_=TS(TS({stroke:"#ccc"},Pt(n,!1)),{},{fill:"none"});return ue.createElement("circle",pu({},_,{className:or("recharts-polar-grid-concentric-circle",n.className),key:"circle-".concat(f),cx:o,cy:s,r:u}))},Pwe=function(n){var o=n.radius,s=n.index,u=TS(TS({stroke:"#ccc"},Pt(n,!1)),{},{fill:"none"});return ue.createElement("path",pu({},u,{className:or("recharts-polar-grid-concentric-polygon",n.className),key:"path-".concat(s),d:Owe(o,n.cx,n.cy,n.polarAngles)}))},Dwe=function(n){var o=n.polarRadius,s=n.gridType;return!o||!o.length?null:ue.createElement("g",{className:"recharts-polar-grid-concentric"},o.map(function(u,f){var _=f;return s==="circle"?ue.createElement(Nwe,pu({key:_},n,{radius:u,index:f})):ue.createElement(Pwe,pu({key:_},n,{radius:u,index:f}))}))},fQ=function(n){var o=n.cx,s=o===void 0?0:o,u=n.cy,f=u===void 0?0:u,_=n.innerRadius,E=_===void 0?0:_,T=n.outerRadius,w=T===void 0?0:T,I=n.gridType,A=I===void 0?"polygon":I,P=n.radialLines,j=P===void 0?!0:P,W=Twe(n,bwe);return w<=0?null:ue.createElement("g",{className:"recharts-polar-grid"},ue.createElement(Iwe,pu({cx:s,cy:f,innerRadius:E,outerRadius:w,gridType:A,radialLines:j},W)),ue.createElement(Dwe,pu({cx:s,cy:f,innerRadius:E,outerRadius:w,gridType:A,radialLines:j},W)))};fQ.displayName="PolarGrid";var Vk,e9;function xwe(){if(e9)return Vk;e9=1;var i=WC(),n=RJ(),o=fl();function s(u,f){return u&&u.length?i(u,o(f,2),n):void 0}return Vk=s,Vk}var kwe=xwe();const Lwe=Yr(kwe);var Fk,t9;function Mwe(){if(t9)return Fk;t9=1;var i=WC(),n=fl(),o=CJ();function s(u,f){return u&&u.length?i(u,n(f,2),o):void 0}return Fk=s,Fk}var Uwe=Mwe();const jwe=Yr(Uwe);var Vwe=["cx","cy","angle","ticks","axisLine"],Fwe=["ticks","tick","angle","tickFormatter","stroke"];function Bg(i){"@babel/helpers - typeof";return Bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Bg(i)}function KE(){return KE=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},KE.apply(this,arguments)}function r9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Ip(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?r9(Object(o),!0).forEach(function(s){zC(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):r9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function n9(i,n){if(i==null)return{};var o=Bwe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function Bwe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function Wwe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function i9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,gQ(s.key),s)}}function Gwe(i,n,o){return n&&i9(i.prototype,n),o&&i9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function Hwe(i,n,o){return n=JR(n),qwe(i,mQ()?Reflect.construct(n,o||[],JR(i).constructor):n.apply(i,o))}function qwe(i,n){if(n&&(Bg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kwe(i)}function Kwe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function mQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mQ=function(){return!!i})()}function JR(i){return JR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},JR(i)}function zwe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&vM(i,n)}function vM(i,n){return vM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},vM(i,n)}function zC(i,n,o){return n=gQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function gQ(i){var n=$we(i,"string");return Bg(n)=="symbol"?n:n+""}function $we(i,n){if(Bg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Bg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var f_=function(i){function n(){return Wwe(this,n),Hwe(this,n,arguments)}return zwe(n,i),Gwe(n,[{key:"getTickValueCoord",value:function(s){var u=s.coordinate,f=this.props,_=f.angle,E=f.cx,T=f.cy;return $r(E,T,u,_)}},{key:"getTickTextAnchor",value:function(){var s=this.props.orientation,u;switch(s){case"left":u="end";break;case"right":u="start";break;default:u="middle";break}return u}},{key:"getViewBox",value:function(){var s=this.props,u=s.cx,f=s.cy,_=s.angle,E=s.ticks,T=Lwe(E,function(I){return I.coordinate||0}),w=jwe(E,function(I){return I.coordinate||0});return{cx:u,cy:f,startAngle:_,endAngle:_,innerRadius:w.coordinate||0,outerRadius:T.coordinate||0}}},{key:"renderAxisLine",value:function(){var s=this.props,u=s.cx,f=s.cy,_=s.angle,E=s.ticks,T=s.axisLine,w=n9(s,Vwe),I=E.reduce(function(W,F){return[Math.min(W[0],F.coordinate),Math.max(W[1],F.coordinate)]},[1/0,-1/0]),A=$r(u,f,I[0],_),P=$r(u,f,I[1],_),j=Ip(Ip(Ip({},Pt(w,!1)),{},{fill:"none"},Pt(T,!1)),{},{x1:A.x,y1:A.y,x2:P.x,y2:P.y});return ue.createElement("line",KE({className:"recharts-polar-radius-axis-line"},j))}},{key:"renderTicks",value:function(){var s=this,u=this.props,f=u.ticks,_=u.tick,E=u.angle,T=u.tickFormatter,w=u.stroke,I=n9(u,Fwe),A=this.getTickTextAnchor(),P=Pt(I,!1),j=Pt(_,!1),W=f.map(function(F,M){var X=s.getTickValueCoord(F),Y=Ip(Ip(Ip(Ip({textAnchor:A,transform:"rotate(".concat(90-E,", ").concat(X.x,", ").concat(X.y,")")},P),{},{stroke:"none",fill:w},j),{},{index:M},X),{},{payload:F});return ue.createElement(Dr,KE({className:or("recharts-polar-radius-axis-tick",tQ(_)),key:"tick-".concat(F.coordinate)},Gp(s.props,F,M)),n.renderTickItem(_,Y,T?T(F.value,M):F.value))});return ue.createElement(Dr,{className:"recharts-polar-radius-axis-ticks"},W)}},{key:"render",value:function(){var s=this.props,u=s.ticks,f=s.axisLine,_=s.tick;return!u||!u.length?null:ue.createElement(Dr,{className:or("recharts-polar-radius-axis",this.props.className)},f&&this.renderAxisLine(),_&&this.renderTicks(),qi.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(s,u,f){var _;return ue.isValidElement(s)?_=ue.cloneElement(s,u):zt(s)?_=s(u):_=ue.createElement(Hp,KE({},u,{className:"recharts-polar-radius-axis-tick-value"}),f),_}}])}(Ee.PureComponent);zC(f_,"displayName","PolarRadiusAxis");zC(f_,"axisType","radiusAxis");zC(f_,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Wg(i){"@babel/helpers - typeof";return Wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Wg(i)}function kp(){return kp=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},kp.apply(this,arguments)}function a9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Np(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?a9(Object(o),!0).forEach(function(s){$C(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):a9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ywe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function o9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,vQ(s.key),s)}}function Xwe(i,n,o){return n&&o9(i.prototype,n),o&&o9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function Jwe(i,n,o){return n=QR(n),Qwe(i,_Q()?Reflect.construct(n,o||[],QR(i).constructor):n.apply(i,o))}function Qwe(i,n){if(n&&(Wg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zwe(i)}function Zwe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function _Q(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_Q=function(){return!!i})()}function QR(i){return QR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},QR(i)}function eRe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&yM(i,n)}function yM(i,n){return yM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},yM(i,n)}function $C(i,n,o){return n=vQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function vQ(i){var n=tRe(i,"string");return Wg(n)=="symbol"?n:n+""}function tRe(i,n){if(Wg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Wg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var rRe=Math.PI/180,nRe=1e-5,m_=function(i){function n(){return Ywe(this,n),Jwe(this,n,arguments)}return eRe(n,i),Xwe(n,[{key:"getTickLineCoord",value:function(s){var u=this.props,f=u.cx,_=u.cy,E=u.radius,T=u.orientation,w=u.tickSize,I=w||8,A=$r(f,_,E,s.coordinate),P=$r(f,_,E+(T==="inner"?-1:1)*I,s.coordinate);return{x1:A.x,y1:A.y,x2:P.x,y2:P.y}}},{key:"getTickTextAnchor",value:function(s){var u=this.props.orientation,f=Math.cos(-s.coordinate*rRe),_;return f>nRe?_=u==="outer"?"start":"end":f<-1e-5?_=u==="outer"?"end":"start":_="middle",_}},{key:"renderAxisLine",value:function(){var s=this.props,u=s.cx,f=s.cy,_=s.radius,E=s.axisLine,T=s.axisLineType,w=Np(Np({},Pt(this.props,!1)),{},{fill:"none"},Pt(E,!1));if(T==="circle")return ue.createElement(GS,kp({className:"recharts-polar-angle-axis-line"},w,{cx:u,cy:f,r:_}));var I=this.props.ticks,A=I.map(function(P){return $r(u,f,_,P.coordinate)});return ue.createElement(pQ,kp({className:"recharts-polar-angle-axis-line"},w,{points:A}))}},{key:"renderTicks",value:function(){var s=this,u=this.props,f=u.ticks,_=u.tick,E=u.tickLine,T=u.tickFormatter,w=u.stroke,I=Pt(this.props,!1),A=Pt(_,!1),P=Np(Np({},I),{},{fill:"none"},Pt(E,!1)),j=f.map(function(W,F){var M=s.getTickLineCoord(W),X=s.getTickTextAnchor(W),Y=Np(Np(Np({textAnchor:X},I),{},{stroke:"none",fill:w},A),{},{index:F,payload:W,x:M.x2,y:M.y2});return ue.createElement(Dr,kp({className:or("recharts-polar-angle-axis-tick",tQ(_)),key:"tick-".concat(W.coordinate)},Gp(s.props,W,F)),E&&ue.createElement("line",kp({className:"recharts-polar-angle-axis-tick-line"},P,M)),_&&n.renderTickItem(_,Y,T?T(W.value,F):W.value))});return ue.createElement(Dr,{className:"recharts-polar-angle-axis-ticks"},j)}},{key:"render",value:function(){var s=this.props,u=s.ticks,f=s.radius,_=s.axisLine;return f<=0||!u||!u.length?null:ue.createElement(Dr,{className:or("recharts-polar-angle-axis",this.props.className)},_&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(s,u,f){var _;return ue.isValidElement(s)?_=ue.cloneElement(s,u):zt(s)?_=s(u):_=ue.createElement(Hp,kp({},u,{className:"recharts-polar-angle-axis-tick-value"}),f),_}}])}(Ee.PureComponent);$C(m_,"displayName","PolarAngleAxis");$C(m_,"axisType","angleAxis");$C(m_,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var Bk,s9;function iRe(){if(s9)return Bk;s9=1;var i=wX(),n=i(Object.getPrototypeOf,Object);return Bk=n,Bk}var Wk,c9;function aRe(){if(c9)return Wk;c9=1;var i=gu(),n=iRe(),o=_u(),s="[object Object]",u=Function.prototype,f=Object.prototype,_=u.toString,E=f.hasOwnProperty,T=_.call(Object);function w(I){if(!o(I)||i(I)!=s)return!1;var A=n(I);if(A===null)return!0;var P=E.call(A,"constructor")&&A.constructor;return typeof P=="function"&&P instanceof P&&_.call(P)==T}return Wk=w,Wk}var oRe=aRe();const sRe=Yr(oRe);var Gk,l9;function cRe(){if(l9)return Gk;l9=1;var i=gu(),n=_u(),o="[object Boolean]";function s(u){return u===!0||u===!1||n(u)&&i(u)==o}return Gk=s,Gk}var lRe=cRe();const uRe=Yr(lRe);function wS(i){"@babel/helpers - typeof";return wS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wS(i)}function ZR(){return ZR=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},ZR.apply(this,arguments)}function dRe(i,n){return mRe(i)||fRe(i,n)||pRe(i,n)||hRe()}function hRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pRe(i,n){if(i){if(typeof i=="string")return u9(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return u9(i,n)}}function u9(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function fRe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function mRe(i){if(Array.isArray(i))return i}function d9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function h9(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?d9(Object(o),!0).forEach(function(s){gRe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):d9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function gRe(i,n,o){return n=_Re(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function _Re(i){var n=vRe(i,"string");return wS(n)=="symbol"?n:n+""}function vRe(i,n){if(wS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(wS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var p9=function(n,o,s,u,f){var _=s-u,E;return E="M ".concat(n,",").concat(o),E+="L ".concat(n+s,",").concat(o),E+="L ".concat(n+s-_/2,",").concat(o+f),E+="L ".concat(n+s-_/2-u,",").concat(o+f),E+="L ".concat(n,",").concat(o," Z"),E},yRe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},ERe=function(n){var o=h9(h9({},yRe),n),s=Ee.useRef(),u=Ee.useState(-1),f=dRe(u,2),_=f[0],E=f[1];Ee.useEffect(function(){if(s.current&&s.current.getTotalLength)try{var J=s.current.getTotalLength();J&&E(J)}catch{}},[]);var T=o.x,w=o.y,I=o.upperWidth,A=o.lowerWidth,P=o.height,j=o.className,W=o.animationEasing,F=o.animationDuration,M=o.animationBegin,X=o.isUpdateAnimationActive;if(T!==+T||w!==+w||I!==+I||A!==+A||P!==+P||I===0&&A===0||P===0)return null;var Y=or("recharts-trapezoid",j);return X?ue.createElement(sc,{canBegin:_>0,from:{upperWidth:0,lowerWidth:0,height:P,x:T,y:w},to:{upperWidth:I,lowerWidth:A,height:P,x:T,y:w},duration:F,animationEasing:W,isActive:X},function(J){var re=J.upperWidth,z=J.lowerWidth,Z=J.height,ie=J.x,de=J.y;return ue.createElement(sc,{canBegin:_>0,from:"0px ".concat(_===-1?1:_,"px"),to:"".concat(_,"px 0px"),attributeName:"strokeDasharray",begin:M,duration:F,easing:W},ue.createElement("path",ZR({},Pt(o,!0),{className:Y,d:p9(ie,de,re,z,Z),ref:s})))}):ue.createElement("g",null,ue.createElement("path",ZR({},Pt(o,!0),{className:Y,d:p9(T,w,I,A,P)})))},SRe=["option","shapeType","propTransformer","activeClassName","isActive"];function RS(i){"@babel/helpers - typeof";return RS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},RS(i)}function bRe(i,n){if(i==null)return{};var o=TRe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function TRe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function f9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function eC(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?f9(Object(o),!0).forEach(function(s){wRe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):f9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function wRe(i,n,o){return n=RRe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function RRe(i){var n=CRe(i,"string");return RS(n)=="symbol"?n:n+""}function CRe(i,n){if(RS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(RS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function ARe(i,n){return eC(eC({},n),i)}function ORe(i,n){return i==="symbols"}function m9(i){var n=i.shapeType,o=i.elementProps;switch(n){case"rectangle":return ue.createElement(B2,o);case"trapezoid":return ue.createElement(ERe,o);case"sector":return ue.createElement(aQ,o);case"symbols":if(ORe(n))return ue.createElement(o2,o);break;default:return null}}function IRe(i){return Ee.isValidElement(i)?i.props:i}function yQ(i){var n=i.option,o=i.shapeType,s=i.propTransformer,u=s===void 0?ARe:s,f=i.activeClassName,_=f===void 0?"recharts-active-shape":f,E=i.isActive,T=bRe(i,SRe),w;if(Ee.isValidElement(n))w=Ee.cloneElement(n,eC(eC({},T),IRe(n)));else if(zt(n))w=n(T);else if(sRe(n)&&!uRe(n)){var I=u(n,T);w=ue.createElement(m9,{shapeType:o,elementProps:I})}else{var A=T;w=ue.createElement(m9,{shapeType:o,elementProps:A})}return E?ue.createElement(Dr,{className:_},w):w}function YC(i,n){return n!=null&&"trapezoids"in i.props}function XC(i,n){return n!=null&&"sectors"in i.props}function CS(i,n){return n!=null&&"points"in i.props}function NRe(i,n){var o,s,u=i.x===(n==null||(o=n.labelViewBox)===null||o===void 0?void 0:o.x)||i.x===n.x,f=i.y===(n==null||(s=n.labelViewBox)===null||s===void 0?void 0:s.y)||i.y===n.y;return u&&f}function PRe(i,n){var o=i.endAngle===n.endAngle,s=i.startAngle===n.startAngle;return o&&s}function DRe(i,n){var o=i.x===n.x,s=i.y===n.y,u=i.z===n.z;return o&&s&&u}function xRe(i,n){var o;return YC(i,n)?o=NRe:XC(i,n)?o=PRe:CS(i,n)&&(o=DRe),o}function kRe(i,n){var o;return YC(i,n)?o="trapezoids":XC(i,n)?o="sectors":CS(i,n)&&(o="points"),o}function LRe(i,n){if(YC(i,n)){var o;return(o=n.tooltipPayload)===null||o===void 0||(o=o[0])===null||o===void 0||(o=o.payload)===null||o===void 0?void 0:o.payload}if(XC(i,n)){var s;return(s=n.tooltipPayload)===null||s===void 0||(s=s[0])===null||s===void 0||(s=s.payload)===null||s===void 0?void 0:s.payload}return CS(i,n)?n.payload:{}}function MRe(i){var n=i.activeTooltipItem,o=i.graphicalItem,s=i.itemData,u=kRe(o,n),f=LRe(o,n),_=s.filter(function(T,w){var I=d_(f,T),A=o.props[u].filter(function(W){var F=xRe(o,n);return F(W,n)}),P=o.props[u].indexOf(A[A.length-1]),j=w===P;return I&&j}),E=s.indexOf(_[_.length-1]);return E}var fR;function Gg(i){"@babel/helpers - typeof";return Gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Gg(i)}function Sg(){return Sg=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},Sg.apply(this,arguments)}function g9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Tn(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?g9(Object(o),!0).forEach(function(s){vs(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):g9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function URe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function _9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,SQ(s.key),s)}}function jRe(i,n,o){return n&&_9(i.prototype,n),o&&_9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function VRe(i,n,o){return n=tC(n),FRe(i,EQ()?Reflect.construct(n,o||[],tC(i).constructor):n.apply(i,o))}function FRe(i,n){if(n&&(Gg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BRe(i)}function BRe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function EQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(EQ=function(){return!!i})()}function tC(i){return tC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},tC(i)}function WRe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&EM(i,n)}function EM(i,n){return EM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},EM(i,n)}function vs(i,n,o){return n=SQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function SQ(i){var n=GRe(i,"string");return Gg(n)=="symbol"?n:n+""}function GRe(i,n){if(Gg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Gg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var yu=function(i){function n(o){var s;return URe(this,n),s=VRe(this,n,[o]),vs(s,"pieRef",null),vs(s,"sectorRefs",[]),vs(s,"id",c_("recharts-pie-")),vs(s,"handleAnimationEnd",function(){var u=s.props.onAnimationEnd;s.setState({isAnimationFinished:!0}),zt(u)&&u()}),vs(s,"handleAnimationStart",function(){var u=s.props.onAnimationStart;s.setState({isAnimationFinished:!1}),zt(u)&&u()}),s.state={isAnimationFinished:!o.isAnimationActive,prevIsAnimationActive:o.isAnimationActive,prevAnimationId:o.animationId,sectorToFocus:0},s}return WRe(n,i),jRe(n,[{key:"isActiveIndex",value:function(s){var u=this.props.activeIndex;return Array.isArray(u)?u.indexOf(s)!==-1:s===u}},{key:"hasActiveIndex",value:function(){var s=this.props.activeIndex;return Array.isArray(s)?s.length!==0:s||s===0}},{key:"renderLabels",value:function(s){var u=this.props.isAnimationActive;if(u&&!this.state.isAnimationFinished)return null;var f=this.props,_=f.label,E=f.labelLine,T=f.dataKey,w=f.valueKey,I=Pt(this.props,!1),A=Pt(_,!1),P=Pt(E,!1),j=_&&_.offsetRadius||20,W=s.map(function(F,M){var X=(F.startAngle+F.endAngle)/2,Y=$r(F.cx,F.cy,F.outerRadius+j,X),J=Tn(Tn(Tn(Tn({},I),F),{},{stroke:"none"},A),{},{index:M,textAnchor:n.getTextAnchor(Y.x,F.cx)},Y),re=Tn(Tn(Tn(Tn({},I),F),{},{fill:"none",stroke:F.fill},P),{},{index:M,points:[$r(F.cx,F.cy,F.outerRadius,X),Y]}),z=T;return ir(T)&&ir(w)?z="value":ir(T)&&(z=w),ue.createElement(Dr,{key:"label-".concat(F.startAngle,"-").concat(F.endAngle,"-").concat(F.midAngle,"-").concat(M)},E&&n.renderLabelLineItem(E,re,"line"),n.renderLabelItem(_,J,hi(F,z)))});return ue.createElement(Dr,{className:"recharts-pie-labels"},W)}},{key:"renderSectorsStatically",value:function(s){var u=this,f=this.props,_=f.activeShape,E=f.blendStroke,T=f.inactiveShape;return s.map(function(w,I){if((w==null?void 0:w.startAngle)===0&&(w==null?void 0:w.endAngle)===0&&s.length!==1)return null;var A=u.isActiveIndex(I),P=T&&u.hasActiveIndex()?T:null,j=A?_:P,W=Tn(Tn({},w),{},{stroke:E?w.fill:w.stroke,tabIndex:-1});return ue.createElement(Dr,Sg({ref:function(M){M&&!u.sectorRefs.includes(M)&&u.sectorRefs.push(M)},tabIndex:-1,className:"recharts-pie-sector"},Gp(u.props,w,I),{key:"sector-".concat(w==null?void 0:w.startAngle,"-").concat(w==null?void 0:w.endAngle,"-").concat(w.midAngle,"-").concat(I)}),ue.createElement(yQ,Sg({option:j,isActive:A,shapeType:"sector"},W)))})}},{key:"renderSectorsWithAnimation",value:function(){var s=this,u=this.props,f=u.sectors,_=u.isAnimationActive,E=u.animationBegin,T=u.animationDuration,w=u.animationEasing,I=u.animationId,A=this.state,P=A.prevSectors,j=A.prevIsAnimationActive;return ue.createElement(sc,{begin:E,duration:T,isActive:_,easing:w,from:{t:0},to:{t:1},key:"pie-".concat(I,"-").concat(j),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(W){var F=W.t,M=[],X=f&&f[0],Y=X.startAngle;return f.forEach(function(J,re){var z=P&&P[re],Z=re>0?Lo(J,"paddingAngle",0):0;if(z){var ie=ia(z.endAngle-z.startAngle,J.endAngle-J.startAngle),de=Tn(Tn({},J),{},{startAngle:Y+Z,endAngle:Y+ie(F)+Z});M.push(de),Y=de.endAngle}else{var ge=J.endAngle,Oe=J.startAngle,me=ia(0,ge-Oe),ye=me(F),Ae=Tn(Tn({},J),{},{startAngle:Y+Z,endAngle:Y+ye+Z});M.push(Ae),Y=Ae.endAngle}}),ue.createElement(Dr,null,s.renderSectorsStatically(M))})}},{key:"attachKeyboardHandlers",value:function(s){var u=this;s.onkeydown=function(f){if(!f.altKey)switch(f.key){case"ArrowLeft":{var _=++u.state.sectorToFocus%u.sectorRefs.length;u.sectorRefs[_].focus(),u.setState({sectorToFocus:_});break}case"ArrowRight":{var E=--u.state.sectorToFocus<0?u.sectorRefs.length-1:u.state.sectorToFocus%u.sectorRefs.length;u.sectorRefs[E].focus(),u.setState({sectorToFocus:E});break}case"Escape":{u.sectorRefs[u.state.sectorToFocus].blur(),u.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var s=this.props,u=s.sectors,f=s.isAnimationActive,_=this.state.prevSectors;return f&&u&&u.length&&(!_||!d_(_,u))?this.renderSectorsWithAnimation():this.renderSectorsStatically(u)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var s=this,u=this.props,f=u.hide,_=u.sectors,E=u.className,T=u.label,w=u.cx,I=u.cy,A=u.innerRadius,P=u.outerRadius,j=u.isAnimationActive,W=this.state.isAnimationFinished;if(f||!_||!_.length||!dt(w)||!dt(I)||!dt(A)||!dt(P))return null;var F=or("recharts-pie",E);return ue.createElement(Dr,{tabIndex:this.props.rootTabIndex,className:F,ref:function(X){s.pieRef=X}},this.renderSectors(),T&&this.renderLabels(_),qi.renderCallByParent(this.props,null,!1),(!j||W)&&cl.renderCallByParent(this.props,_,!1))}}],[{key:"getDerivedStateFromProps",value:function(s,u){return u.prevIsAnimationActive!==s.isAnimationActive?{prevIsAnimationActive:s.isAnimationActive,prevAnimationId:s.animationId,curSectors:s.sectors,prevSectors:[],isAnimationFinished:!0}:s.isAnimationActive&&s.animationId!==u.prevAnimationId?{prevAnimationId:s.animationId,curSectors:s.sectors,prevSectors:u.curSectors,isAnimationFinished:!0}:s.sectors!==u.curSectors?{curSectors:s.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(s,u){return s>u?"start":s<u?"end":"middle"}},{key:"renderLabelLineItem",value:function(s,u,f){if(ue.isValidElement(s))return ue.cloneElement(s,u);if(zt(s))return s(u);var _=or("recharts-pie-label-line",typeof s!="boolean"?s.className:"");return ue.createElement(KR,Sg({},u,{key:f,type:"linear",className:_}))}},{key:"renderLabelItem",value:function(s,u,f){if(ue.isValidElement(s))return ue.cloneElement(s,u);var _=f;if(zt(s)&&(_=s(u),ue.isValidElement(_)))return _;var E=or("recharts-pie-label-text",typeof s!="boolean"&&!zt(s)?s.className:"");return ue.createElement(Hp,Sg({},u,{alignmentBaseline:"middle",className:E}),_)}}])}(Ee.PureComponent);fR=yu;vs(yu,"displayName","Pie");vs(yu,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!qd.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});vs(yu,"parseDeltaAngle",function(i,n){var o=La(n-i),s=Math.min(Math.abs(n-i),360);return o*s});vs(yu,"getRealPieData",function(i){var n=i.data,o=i.children,s=Pt(i,!1),u=Mo(o,LC);return n&&n.length?n.map(function(f,_){return Tn(Tn(Tn({payload:f},s),f),u&&u[_]&&u[_].props)}):u&&u.length?u.map(function(f){return Tn(Tn({},s),f.props)}):[]});vs(yu,"parseCoordinateOfPie",function(i,n){var o=n.top,s=n.left,u=n.width,f=n.height,_=ZJ(u,f),E=s+Ma(i.cx,u,u/2),T=o+Ma(i.cy,f,f/2),w=Ma(i.innerRadius,_,0),I=Ma(i.outerRadius,_,_*.8),A=i.maxRadius||Math.sqrt(u*u+f*f)/2;return{cx:E,cy:T,innerRadius:w,outerRadius:I,maxRadius:A}});vs(yu,"getComposedData",function(i){var n=i.item,o=i.offset,s=n.type.defaultProps!==void 0?Tn(Tn({},n.type.defaultProps),n.props):n.props,u=fR.getRealPieData(s);if(!u||!u.length)return null;var f=s.cornerRadius,_=s.startAngle,E=s.endAngle,T=s.paddingAngle,w=s.dataKey,I=s.nameKey,A=s.valueKey,P=s.tooltipType,j=Math.abs(s.minAngle),W=fR.parseCoordinateOfPie(s,o),F=fR.parseDeltaAngle(_,E),M=Math.abs(F),X=w;ir(w)&&ir(A)?(oc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),X="value"):ir(w)&&(oc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),X=A);var Y=u.filter(function(de){return hi(de,X,0)!==0}).length,J=(M>=360?Y:Y-1)*T,re=M-Y*j-J,z=u.reduce(function(de,ge){var Oe=hi(ge,X,0);return de+(dt(Oe)?Oe:0)},0),Z;if(z>0){var ie;Z=u.map(function(de,ge){var Oe=hi(de,X,0),me=hi(de,I,ge),ye=(dt(Oe)?Oe:0)/z,Ae;ge?Ae=ie.endAngle+La(F)*T*(Oe!==0?1:0):Ae=_;var be=Ae+La(F)*((Oe!==0?j:0)+ye*re),ke=(Ae+be)/2,Me=(W.innerRadius+W.outerRadius)/2,Ue=[{name:me,value:Oe,payload:de,dataKey:X,type:P}],Pe=$r(W.cx,W.cy,Me,ke);return ie=Tn(Tn(Tn({percent:ye,cornerRadius:f,name:me,tooltipPayload:Ue,midAngle:ke,middleRadius:Me,tooltipPosition:Pe},de),W),{},{value:hi(de,X),startAngle:Ae,endAngle:be,payload:de,paddingAngle:La(F)*T}),ie})}return Tn(Tn({},W),{},{sectors:Z,data:u})});var Hk,v9;function HRe(){if(v9)return Hk;v9=1;function i(n){return n&&n.length?n[0]:void 0}return Hk=i,Hk}var qk,y9;function qRe(){return y9||(y9=1,qk=HRe()),qk}var KRe=qRe();const zRe=Yr(KRe);var $Re=["key"];function Hg(i){"@babel/helpers - typeof";return Hg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Hg(i)}function YRe(i,n){if(i==null)return{};var o=XRe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function XRe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function rC(){return rC=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},rC.apply(this,arguments)}function E9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function ka(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?E9(Object(o),!0).forEach(function(s){nu(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):E9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function JRe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function S9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,TQ(s.key),s)}}function QRe(i,n,o){return n&&S9(i.prototype,n),o&&S9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function ZRe(i,n,o){return n=nC(n),eCe(i,bQ()?Reflect.construct(n,o||[],nC(i).constructor):n.apply(i,o))}function eCe(i,n){if(n&&(Hg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tCe(i)}function tCe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function bQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bQ=function(){return!!i})()}function nC(i){return nC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},nC(i)}function rCe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&SM(i,n)}function SM(i,n){return SM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},SM(i,n)}function nu(i,n,o){return n=TQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function TQ(i){var n=nCe(i,"string");return Hg(n)=="symbol"?n:n+""}function nCe(i,n){if(Hg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Hg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var HS=function(i){function n(){var o;JRe(this,n);for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];return o=ZRe(this,n,[].concat(u)),nu(o,"state",{isAnimationFinished:!1}),nu(o,"handleAnimationEnd",function(){var _=o.props.onAnimationEnd;o.setState({isAnimationFinished:!0}),zt(_)&&_()}),nu(o,"handleAnimationStart",function(){var _=o.props.onAnimationStart;o.setState({isAnimationFinished:!1}),zt(_)&&_()}),nu(o,"handleMouseEnter",function(_){var E=o.props.onMouseEnter;E&&E(o.props,_)}),nu(o,"handleMouseLeave",function(_){var E=o.props.onMouseLeave;E&&E(o.props,_)}),o}return rCe(n,i),QRe(n,[{key:"renderDots",value:function(s){var u=this.props,f=u.dot,_=u.dataKey,E=Pt(this.props,!1),T=Pt(f,!0),w=s.map(function(I,A){var P=ka(ka(ka({key:"dot-".concat(A),r:3},E),T),{},{dataKey:_,cx:I.x,cy:I.y,index:A,payload:I});return n.renderDotItem(f,P)});return ue.createElement(Dr,{className:"recharts-radar-dots"},w)}},{key:"renderPolygonStatically",value:function(s){var u=this.props,f=u.shape,_=u.dot,E=u.isRange,T=u.baseLinePoints,w=u.connectNulls,I;return ue.isValidElement(f)?I=ue.cloneElement(f,ka(ka({},this.props),{},{points:s})):zt(f)?I=f(ka(ka({},this.props),{},{points:s})):I=ue.createElement(pQ,rC({},Pt(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:s,baseLinePoints:E?T:null,connectNulls:w})),ue.createElement(Dr,{className:"recharts-radar-polygon"},I,_?this.renderDots(s):null)}},{key:"renderPolygonWithAnimation",value:function(){var s=this,u=this.props,f=u.points,_=u.isAnimationActive,E=u.animationBegin,T=u.animationDuration,w=u.animationEasing,I=u.animationId,A=this.state.prevPoints;return ue.createElement(sc,{begin:E,duration:T,isActive:_,easing:w,from:{t:0},to:{t:1},key:"radar-".concat(I),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(P){var j=P.t,W=A&&A.length/f.length,F=f.map(function(M,X){var Y=A&&A[Math.floor(X*W)];if(Y){var J=ia(Y.x,M.x),re=ia(Y.y,M.y);return ka(ka({},M),{},{x:J(j),y:re(j)})}var z=ia(M.cx,M.x),Z=ia(M.cy,M.y);return ka(ka({},M),{},{x:z(j),y:Z(j)})});return s.renderPolygonStatically(F)})}},{key:"renderPolygon",value:function(){var s=this.props,u=s.points,f=s.isAnimationActive,_=s.isRange,E=this.state.prevPoints;return f&&u&&u.length&&!_&&(!E||!d_(E,u))?this.renderPolygonWithAnimation():this.renderPolygonStatically(u)}},{key:"render",value:function(){var s=this.props,u=s.hide,f=s.className,_=s.points,E=s.isAnimationActive;if(u||!_||!_.length)return null;var T=this.state.isAnimationFinished,w=or("recharts-radar",f);return ue.createElement(Dr,{className:w},this.renderPolygon(),(!E||T)&&cl.renderCallByParent(this.props,_))}}],[{key:"getDerivedStateFromProps",value:function(s,u){return s.animationId!==u.prevAnimationId?{prevAnimationId:s.animationId,curPoints:s.points,prevPoints:u.curPoints}:s.points!==u.curPoints?{curPoints:s.points}:null}},{key:"renderDotItem",value:function(s,u){var f;if(ue.isValidElement(s))f=ue.cloneElement(s,u);else if(zt(s))f=s(u);else{var _=u.key,E=YRe(u,$Re);f=ue.createElement(GS,rC({},E,{key:_,className:or("recharts-radar-dot",typeof s!="boolean"?s.className:"")}))}return f}}])}(Ee.PureComponent);nu(HS,"displayName","Radar");nu(HS,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!qd.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});nu(HS,"getComposedData",function(i){var n=i.radiusAxis,o=i.angleAxis,s=i.displayedData,u=i.dataKey,f=i.bandSize,_=o.cx,E=o.cy,T=!1,w=[],I=o.type!=="number"?f??0:0;s.forEach(function(P,j){var W=hi(P,o.dataKey,j),F=hi(P,u),M=o.scale(W)+I,X=Array.isArray(F)?nQ(F):F,Y=ir(X)?void 0:n.scale(X);Array.isArray(F)&&F.length>=2&&(T=!0),w.push(ka(ka({},$r(_,E,Y,M)),{},{name:W,value:F,cx:_,cy:E,radius:Y,angle:M,payload:P}))});var A=[];return T&&w.forEach(function(P){if(Array.isArray(P.value)){var j=zRe(P.value),W=ir(j)?void 0:n.scale(j);A.push(ka(ka({},P),{},{radius:W},$r(_,E,W,P.angle)))}else A.push(P)}),{points:w,isRange:T,baseLinePoints:A}});var Kk,b9;function iCe(){if(b9)return Kk;b9=1;var i=Math.ceil,n=Math.max;function o(s,u,f,_){for(var E=-1,T=n(i((u-s)/(f||1)),0),w=Array(T);T--;)w[_?T:++E]=s,s+=f;return w}return Kk=o,Kk}var zk,T9;function wQ(){if(T9)return zk;T9=1;var i=FX(),n=1/0,o=17976931348623157e292;function s(u){if(!u)return u===0?u:0;if(u=i(u),u===n||u===-1/0){var f=u<0?-1:1;return f*o}return u===u?u:0}return zk=s,zk}var $k,w9;function aCe(){if(w9)return $k;w9=1;var i=iCe(),n=kC(),o=wQ();function s(u){return function(f,_,E){return E&&typeof E!="number"&&n(f,_,E)&&(_=E=void 0),f=o(f),_===void 0?(_=f,f=0):_=o(_),E=E===void 0?f<_?1:-1:o(E),i(f,_,E,u)}}return $k=s,$k}var Yk,R9;function oCe(){if(R9)return Yk;R9=1;var i=aCe(),n=i();return Yk=n,Yk}var sCe=oCe();const iC=Yr(sCe);function AS(i){"@babel/helpers - typeof";return AS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},AS(i)}function C9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function A9(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?C9(Object(o),!0).forEach(function(s){RQ(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):C9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function RQ(i,n,o){return n=cCe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function cCe(i){var n=lCe(i,"string");return AS(n)=="symbol"?n:n+""}function lCe(i,n){if(AS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(AS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var uCe=["Webkit","Moz","O","ms"],dCe=function(n,o){var s=n.replace(/(\w)/,function(f){return f.toUpperCase()}),u=uCe.reduce(function(f,_){return A9(A9({},f),{},RQ({},_+s,o))},{});return u[n]=o,u};function qg(i){"@babel/helpers - typeof";return qg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},qg(i)}function aC(){return aC=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},aC.apply(this,arguments)}function O9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Xk(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?O9(Object(o),!0).forEach(function(s){Do(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):O9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function hCe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function I9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,AQ(s.key),s)}}function pCe(i,n,o){return n&&I9(i.prototype,n),o&&I9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function fCe(i,n,o){return n=oC(n),mCe(i,CQ()?Reflect.construct(n,o||[],oC(i).constructor):n.apply(i,o))}function mCe(i,n){if(n&&(qg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gCe(i)}function gCe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function CQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(CQ=function(){return!!i})()}function oC(i){return oC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},oC(i)}function _Ce(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&bM(i,n)}function bM(i,n){return bM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},bM(i,n)}function Do(i,n,o){return n=AQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function AQ(i){var n=vCe(i,"string");return qg(n)=="symbol"?n:n+""}function vCe(i,n){if(qg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(qg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var yCe=function(n){var o=n.data,s=n.startIndex,u=n.endIndex,f=n.x,_=n.width,E=n.travellerWidth;if(!o||!o.length)return{};var T=o.length,w=WE().domain(iC(0,T)).range([f,f+_-E]),I=w.domain().map(function(A){return w(A)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:w(s),endX:w(u),scale:w,scaleValues:I}},N9=function(n){return n.changedTouches&&!!n.changedTouches.length},Kg=function(i){function n(o){var s;return hCe(this,n),s=fCe(this,n,[o]),Do(s,"handleDrag",function(u){s.leaveTimer&&(clearTimeout(s.leaveTimer),s.leaveTimer=null),s.state.isTravellerMoving?s.handleTravellerMove(u):s.state.isSlideMoving&&s.handleSlideDrag(u)}),Do(s,"handleTouchMove",function(u){u.changedTouches!=null&&u.changedTouches.length>0&&s.handleDrag(u.changedTouches[0])}),Do(s,"handleDragEnd",function(){s.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var u=s.props,f=u.endIndex,_=u.onDragEnd,E=u.startIndex;_==null||_({endIndex:f,startIndex:E})}),s.detachDragEndListener()}),Do(s,"handleLeaveWrapper",function(){(s.state.isTravellerMoving||s.state.isSlideMoving)&&(s.leaveTimer=window.setTimeout(s.handleDragEnd,s.props.leaveTimeOut))}),Do(s,"handleEnterSlideOrTraveller",function(){s.setState({isTextActive:!0})}),Do(s,"handleLeaveSlideOrTraveller",function(){s.setState({isTextActive:!1})}),Do(s,"handleSlideDragStart",function(u){var f=N9(u)?u.changedTouches[0]:u;s.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:f.pageX}),s.attachDragEndListener()}),s.travellerDragStartHandlers={startX:s.handleTravellerDragStart.bind(s,"startX"),endX:s.handleTravellerDragStart.bind(s,"endX")},s.state={},s}return _Ce(n,i),pCe(n,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(s){var u=s.startX,f=s.endX,_=this.state.scaleValues,E=this.props,T=E.gap,w=E.data,I=w.length-1,A=Math.min(u,f),P=Math.max(u,f),j=n.getIndexInRange(_,A),W=n.getIndexInRange(_,P);return{startIndex:j-j%T,endIndex:W===I?I:W-W%T}}},{key:"getTextOfTick",value:function(s){var u=this.props,f=u.data,_=u.tickFormatter,E=u.dataKey,T=hi(f[s],E,s);return zt(_)?_(T,s):T}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(s){var u=this.state,f=u.slideMoveStartX,_=u.startX,E=u.endX,T=this.props,w=T.x,I=T.width,A=T.travellerWidth,P=T.startIndex,j=T.endIndex,W=T.onChange,F=s.pageX-f;F>0?F=Math.min(F,w+I-A-E,w+I-A-_):F<0&&(F=Math.max(F,w-_,w-E));var M=this.getIndex({startX:_+F,endX:E+F});(M.startIndex!==P||M.endIndex!==j)&&W&&W(M),this.setState({startX:_+F,endX:E+F,slideMoveStartX:s.pageX})}},{key:"handleTravellerDragStart",value:function(s,u){var f=N9(u)?u.changedTouches[0]:u;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:s,brushMoveStartX:f.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(s){var u=this.state,f=u.brushMoveStartX,_=u.movingTravellerId,E=u.endX,T=u.startX,w=this.state[_],I=this.props,A=I.x,P=I.width,j=I.travellerWidth,W=I.onChange,F=I.gap,M=I.data,X={startX:this.state.startX,endX:this.state.endX},Y=s.pageX-f;Y>0?Y=Math.min(Y,A+P-j-w):Y<0&&(Y=Math.max(Y,A-w)),X[_]=w+Y;var J=this.getIndex(X),re=J.startIndex,z=J.endIndex,Z=function(){var de=M.length-1;return _==="startX"&&(E>T?re%F===0:z%F===0)||E<T&&z===de||_==="endX"&&(E>T?z%F===0:re%F===0)||E>T&&z===de};this.setState(Do(Do({},_,w+Y),"brushMoveStartX",s.pageX),function(){W&&Z()&&W(J)})}},{key:"handleTravellerMoveKeyboard",value:function(s,u){var f=this,_=this.state,E=_.scaleValues,T=_.startX,w=_.endX,I=this.state[u],A=E.indexOf(I);if(A!==-1){var P=A+s;if(!(P===-1||P>=E.length)){var j=E[P];u==="startX"&&j>=w||u==="endX"&&j<=T||this.setState(Do({},u,j),function(){f.props.onChange(f.getIndex({startX:f.state.startX,endX:f.state.endX}))})}}}},{key:"renderBackground",value:function(){var s=this.props,u=s.x,f=s.y,_=s.width,E=s.height,T=s.fill,w=s.stroke;return ue.createElement("rect",{stroke:w,fill:T,x:u,y:f,width:_,height:E})}},{key:"renderPanorama",value:function(){var s=this.props,u=s.x,f=s.y,_=s.width,E=s.height,T=s.data,w=s.children,I=s.padding,A=Ee.Children.only(w);return A?ue.cloneElement(A,{x:u,y:f,width:_,height:E,margin:I,compact:!0,data:T}):null}},{key:"renderTravellerLayer",value:function(s,u){var f,_,E=this,T=this.props,w=T.y,I=T.travellerWidth,A=T.height,P=T.traveller,j=T.ariaLabel,W=T.data,F=T.startIndex,M=T.endIndex,X=Math.max(s,this.props.x),Y=Xk(Xk({},Pt(this.props,!1)),{},{x:X,y:w,width:I,height:A}),J=j||"Min value: ".concat((f=W[F])===null||f===void 0?void 0:f.name,", Max value: ").concat((_=W[M])===null||_===void 0?void 0:_.name);return ue.createElement(Dr,{tabIndex:0,role:"slider","aria-label":J,"aria-valuenow":s,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[u],onTouchStart:this.travellerDragStartHandlers[u],onKeyDown:function(z){["ArrowLeft","ArrowRight"].includes(z.key)&&(z.preventDefault(),z.stopPropagation(),E.handleTravellerMoveKeyboard(z.key==="ArrowRight"?1:-1,u))},onFocus:function(){E.setState({isTravellerFocused:!0})},onBlur:function(){E.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},n.renderTraveller(P,Y))}},{key:"renderSlide",value:function(s,u){var f=this.props,_=f.y,E=f.height,T=f.stroke,w=f.travellerWidth,I=Math.min(s,u)+w,A=Math.max(Math.abs(u-s)-w,0);return ue.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:T,fillOpacity:.2,x:I,y:_,width:A,height:E})}},{key:"renderText",value:function(){var s=this.props,u=s.startIndex,f=s.endIndex,_=s.y,E=s.height,T=s.travellerWidth,w=s.stroke,I=this.state,A=I.startX,P=I.endX,j=5,W={pointerEvents:"none",fill:w};return ue.createElement(Dr,{className:"recharts-brush-texts"},ue.createElement(Hp,aC({textAnchor:"end",verticalAnchor:"middle",x:Math.min(A,P)-j,y:_+E/2},W),this.getTextOfTick(u)),ue.createElement(Hp,aC({textAnchor:"start",verticalAnchor:"middle",x:Math.max(A,P)+T+j,y:_+E/2},W),this.getTextOfTick(f)))}},{key:"render",value:function(){var s=this.props,u=s.data,f=s.className,_=s.children,E=s.x,T=s.y,w=s.width,I=s.height,A=s.alwaysShowText,P=this.state,j=P.startX,W=P.endX,F=P.isTextActive,M=P.isSlideMoving,X=P.isTravellerMoving,Y=P.isTravellerFocused;if(!u||!u.length||!dt(E)||!dt(T)||!dt(w)||!dt(I)||w<=0||I<=0)return null;var J=or("recharts-brush",f),re=ue.Children.count(_)===1,z=dCe("userSelect","none");return ue.createElement(Dr,{className:J,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:z},this.renderBackground(),re&&this.renderPanorama(),this.renderSlide(j,W),this.renderTravellerLayer(j,"startX"),this.renderTravellerLayer(W,"endX"),(F||M||X||Y||A)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(s){var u=s.x,f=s.y,_=s.width,E=s.height,T=s.stroke,w=Math.floor(f+E/2)-1;return ue.createElement(ue.Fragment,null,ue.createElement("rect",{x:u,y:f,width:_,height:E,fill:T,stroke:"none"}),ue.createElement("line",{x1:u+1,y1:w,x2:u+_-1,y2:w,fill:"none",stroke:"#fff"}),ue.createElement("line",{x1:u+1,y1:w+2,x2:u+_-1,y2:w+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(s,u){var f;return ue.isValidElement(s)?f=ue.cloneElement(s,u):zt(s)?f=s(u):f=n.renderDefaultTraveller(u),f}},{key:"getDerivedStateFromProps",value:function(s,u){var f=s.data,_=s.width,E=s.x,T=s.travellerWidth,w=s.updateId,I=s.startIndex,A=s.endIndex;if(f!==u.prevData||w!==u.prevUpdateId)return Xk({prevData:f,prevTravellerWidth:T,prevUpdateId:w,prevX:E,prevWidth:_},f&&f.length?yCe({data:f,width:_,x:E,travellerWidth:T,startIndex:I,endIndex:A}):{scale:null,scaleValues:null});if(u.scale&&(_!==u.prevWidth||E!==u.prevX||T!==u.prevTravellerWidth)){u.scale.range([E,E+_-T]);var P=u.scale.domain().map(function(j){return u.scale(j)});return{prevData:f,prevTravellerWidth:T,prevUpdateId:w,prevX:E,prevWidth:_,startX:u.scale(s.startIndex),endX:u.scale(s.endIndex),scaleValues:P}}return null}},{key:"getIndexInRange",value:function(s,u){for(var f=s.length,_=0,E=f-1;E-_>1;){var T=Math.floor((_+E)/2);s[T]>u?E=T:_=T}return u>=s[E]?E:_}}])}(Ee.PureComponent);Do(Kg,"displayName","Brush");Do(Kg,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var Jk,P9;function ECe(){if(P9)return Jk;P9=1;var i=p2();function n(o,s){var u;return i(o,function(f,_,E){return u=s(f,_,E),!u}),!!u}return Jk=n,Jk}var Qk,D9;function SCe(){if(D9)return Qk;D9=1;var i=_X(),n=fl(),o=ECe(),s=so(),u=kC();function f(_,E,T){var w=s(_)?i:o;return T&&u(_,E,T)&&(E=void 0),w(_,n(E,3))}return Qk=f,Qk}var bCe=SCe();const TCe=Yr(bCe);var ll=function(n,o){var s=n.alwaysShow,u=n.ifOverflow;return s&&(u="extendDomain"),u===o},Zk,x9;function wCe(){if(x9)return Zk;x9=1;var i=LX();function n(o,s,u){s=="__proto__"&&i?i(o,s,{configurable:!0,enumerable:!0,value:u,writable:!0}):o[s]=u}return Zk=n,Zk}var eL,k9;function RCe(){if(k9)return eL;k9=1;var i=wCe(),n=xX(),o=fl();function s(u,f){var _={};return f=o(f,3),n(u,function(E,T,w){i(_,T,f(E,T,w))}),_}return eL=s,eL}var CCe=RCe();const ACe=Yr(CCe);var tL,L9;function OCe(){if(L9)return tL;L9=1;function i(n,o){for(var s=-1,u=n==null?0:n.length;++s<u;)if(!o(n[s],s,n))return!1;return!0}return tL=i,tL}var rL,M9;function ICe(){if(M9)return rL;M9=1;var i=p2();function n(o,s){var u=!0;return i(o,function(f,_,E){return u=!!s(f,_,E),u}),u}return rL=n,rL}var nL,U9;function NCe(){if(U9)return nL;U9=1;var i=OCe(),n=ICe(),o=fl(),s=so(),u=kC();function f(_,E,T){var w=s(_)?i:n;return T&&u(_,E,T)&&(E=void 0),w(_,o(E,3))}return nL=f,nL}var PCe=NCe();const OQ=Yr(PCe);var DCe=["x","y"];function OS(i){"@babel/helpers - typeof";return OS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},OS(i)}function TM(){return TM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},TM.apply(this,arguments)}function j9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function ME(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?j9(Object(o),!0).forEach(function(s){xCe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):j9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function xCe(i,n,o){return n=kCe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function kCe(i){var n=LCe(i,"string");return OS(n)=="symbol"?n:n+""}function LCe(i,n){if(OS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(OS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function MCe(i,n){if(i==null)return{};var o=UCe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function UCe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function jCe(i,n){var o=i.x,s=i.y,u=MCe(i,DCe),f="".concat(o),_=parseInt(f,10),E="".concat(s),T=parseInt(E,10),w="".concat(n.height||u.height),I=parseInt(w,10),A="".concat(n.width||u.width),P=parseInt(A,10);return ME(ME(ME(ME(ME({},n),u),_?{x:_}:{}),T?{y:T}:{}),{},{height:I,width:P,name:n.name,radius:n.radius})}function V9(i){return ue.createElement(yQ,TM({shapeType:"rectangle",propTransformer:jCe,activeClassName:"recharts-active-bar"},i))}var VCe=function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(s,u){if(typeof n=="number")return n;var f=typeof s=="number";return f?n(s,u):(f||Kp(),o)}},FCe=["value","background"],IQ;function zg(i){"@babel/helpers - typeof";return zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zg(i)}function BCe(i,n){if(i==null)return{};var o=WCe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function WCe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function sC(){return sC=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},sC.apply(this,arguments)}function F9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function _i(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?F9(Object(o),!0).forEach(function(s){jd(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):F9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function GCe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function B9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,PQ(s.key),s)}}function HCe(i,n,o){return n&&B9(i.prototype,n),o&&B9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function qCe(i,n,o){return n=cC(n),KCe(i,NQ()?Reflect.construct(n,o||[],cC(i).constructor):n.apply(i,o))}function KCe(i,n){if(n&&(zg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zCe(i)}function zCe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function NQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NQ=function(){return!!i})()}function cC(i){return cC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},cC(i)}function $Ce(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&wM(i,n)}function wM(i,n){return wM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},wM(i,n)}function jd(i,n,o){return n=PQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function PQ(i){var n=YCe(i,"string");return zg(n)=="symbol"?n:n+""}function YCe(i,n){if(zg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(zg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var fu=function(i){function n(){var o;GCe(this,n);for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];return o=qCe(this,n,[].concat(u)),jd(o,"state",{isAnimationFinished:!1}),jd(o,"id",c_("recharts-bar-")),jd(o,"handleAnimationEnd",function(){var _=o.props.onAnimationEnd;o.setState({isAnimationFinished:!0}),_&&_()}),jd(o,"handleAnimationStart",function(){var _=o.props.onAnimationStart;o.setState({isAnimationFinished:!1}),_&&_()}),o}return $Ce(n,i),HCe(n,[{key:"renderRectanglesStatically",value:function(s){var u=this,f=this.props,_=f.shape,E=f.dataKey,T=f.activeIndex,w=f.activeBar,I=Pt(this.props,!1);return s&&s.map(function(A,P){var j=P===T,W=j?w:_,F=_i(_i(_i({},I),A),{},{isActive:j,option:W,index:P,dataKey:E,onAnimationStart:u.handleAnimationStart,onAnimationEnd:u.handleAnimationEnd});return ue.createElement(Dr,sC({className:"recharts-bar-rectangle"},Gp(u.props,A,P),{key:"rectangle-".concat(A==null?void 0:A.x,"-").concat(A==null?void 0:A.y,"-").concat(A==null?void 0:A.value,"-").concat(P)}),ue.createElement(V9,F))})}},{key:"renderRectanglesWithAnimation",value:function(){var s=this,u=this.props,f=u.data,_=u.layout,E=u.isAnimationActive,T=u.animationBegin,w=u.animationDuration,I=u.animationEasing,A=u.animationId,P=this.state.prevData;return ue.createElement(sc,{begin:T,duration:w,isActive:E,easing:I,from:{t:0},to:{t:1},key:"bar-".concat(A),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(j){var W=j.t,F=f.map(function(M,X){var Y=P&&P[X];if(Y){var J=ia(Y.x,M.x),re=ia(Y.y,M.y),z=ia(Y.width,M.width),Z=ia(Y.height,M.height);return _i(_i({},M),{},{x:J(W),y:re(W),width:z(W),height:Z(W)})}if(_==="horizontal"){var ie=ia(0,M.height),de=ie(W);return _i(_i({},M),{},{y:M.y+M.height-de,height:de})}var ge=ia(0,M.width),Oe=ge(W);return _i(_i({},M),{},{width:Oe})});return ue.createElement(Dr,null,s.renderRectanglesStatically(F))})}},{key:"renderRectangles",value:function(){var s=this.props,u=s.data,f=s.isAnimationActive,_=this.state.prevData;return f&&u&&u.length&&(!_||!d_(_,u))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(u)}},{key:"renderBackground",value:function(){var s=this,u=this.props,f=u.data,_=u.dataKey,E=u.activeIndex,T=Pt(this.props.background,!1);return f.map(function(w,I){w.value;var A=w.background,P=BCe(w,FCe);if(!A)return null;var j=_i(_i(_i(_i(_i({},P),{},{fill:"#eee"},A),T),Gp(s.props,w,I)),{},{onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd,dataKey:_,index:I,className:"recharts-bar-background-rectangle"});return ue.createElement(V9,sC({key:"background-bar-".concat(I),option:s.props.background,isActive:I===E},j))})}},{key:"renderErrorBar",value:function(s,u){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var f=this.props,_=f.data,E=f.xAxis,T=f.yAxis,w=f.layout,I=f.children,A=Mo(I,WS);if(!A)return null;var P=w==="vertical"?_[0].height/2:_[0].width/2,j=function(M,X){var Y=Array.isArray(M.value)?M.value[1]:M.value;return{x:M.x,y:M.y,value:Y,errorVal:hi(M,X)}},W={clipPath:s?"url(#clipPath-".concat(u,")"):null};return ue.createElement(Dr,W,A.map(function(F){return ue.cloneElement(F,{key:"error-bar-".concat(u,"-").concat(F.props.dataKey),data:_,xAxis:E,yAxis:T,layout:w,offset:P,dataPointFormatter:j})}))}},{key:"render",value:function(){var s=this.props,u=s.hide,f=s.data,_=s.className,E=s.xAxis,T=s.yAxis,w=s.left,I=s.top,A=s.width,P=s.height,j=s.isAnimationActive,W=s.background,F=s.id;if(u||!f||!f.length)return null;var M=this.state.isAnimationFinished,X=or("recharts-bar",_),Y=E&&E.allowDataOverflow,J=T&&T.allowDataOverflow,re=Y||J,z=ir(F)?this.id:F;return ue.createElement(Dr,{className:X},Y||J?ue.createElement("defs",null,ue.createElement("clipPath",{id:"clipPath-".concat(z)},ue.createElement("rect",{x:Y?w:w-A/2,y:J?I:I-P/2,width:Y?A:A*2,height:J?P:P*2}))):null,ue.createElement(Dr,{className:"recharts-bar-rectangles",clipPath:re?"url(#clipPath-".concat(z,")"):null},W?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(re,z),(!j||M)&&cl.renderCallByParent(this.props,f))}}],[{key:"getDerivedStateFromProps",value:function(s,u){return s.animationId!==u.prevAnimationId?{prevAnimationId:s.animationId,curData:s.data,prevData:u.curData}:s.data!==u.curData?{curData:s.data}:null}}])}(Ee.PureComponent);IQ=fu;jd(fu,"displayName","Bar");jd(fu,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!qd.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});jd(fu,"getComposedData",function(i){var n=i.props,o=i.item,s=i.barPosition,u=i.bandSize,f=i.xAxis,_=i.yAxis,E=i.xAxisTicks,T=i.yAxisTicks,w=i.stackedData,I=i.dataStartIndex,A=i.displayedData,P=i.offset,j=t0e(s,o);if(!j)return null;var W=n.layout,F=o.type.defaultProps,M=F!==void 0?_i(_i({},F),o.props):o.props,X=M.dataKey,Y=M.children,J=M.minPointSize,re=W==="horizontal"?_:f,z=w?re.scale.domain():null,Z=c0e({numericAxis:re}),ie=Mo(Y,LC),de=A.map(function(ge,Oe){var me,ye,Ae,be,ke,Me;w?me=r0e(w[I+Oe],z):(me=hi(ge,X),Array.isArray(me)||(me=[Z,me]));var Ue=VCe(J,IQ.defaultProps.minPointSize)(me[1],Oe);if(W==="horizontal"){var Pe,We=[_.scale(me[0]),_.scale(me[1])],He=We[0],fe=We[1];ye=cY({axis:f,ticks:E,bandSize:u,offset:j.offset,entry:ge,index:Oe}),Ae=(Pe=fe??He)!==null&&Pe!==void 0?Pe:void 0,be=j.size;var Ce=He-fe;if(ke=Number.isNaN(Ce)?0:Ce,Me={x:ye,y:_.y,width:be,height:_.height},Math.abs(Ue)>0&&Math.abs(ke)<Math.abs(Ue)){var ot=La(ke||Ue)*(Math.abs(Ue)-Math.abs(ke));Ae-=ot,ke+=ot}}else{var _t=[f.scale(me[0]),f.scale(me[1])],Lt=_t[0],Yt=_t[1];if(ye=Lt,Ae=cY({axis:_,ticks:T,bandSize:u,offset:j.offset,entry:ge,index:Oe}),be=Yt-Lt,ke=j.size,Me={x:f.x,y:Ae,width:f.width,height:ke},Math.abs(Ue)>0&&Math.abs(be)<Math.abs(Ue)){var br=La(be||Ue)*(Math.abs(Ue)-Math.abs(be));be+=br}}return _i(_i(_i({},ge),{},{x:ye,y:Ae,width:be,height:ke,value:w?me:me[1],payload:ge,background:Me},ie&&ie[Oe]&&ie[Oe].props),{},{tooltipPayload:[JJ(o,ge)],tooltipPosition:{x:ye+be/2,y:Ae+ke/2}})});return _i({data:de,layout:W},P)});function IS(i){"@babel/helpers - typeof";return IS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},IS(i)}function XCe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function W9(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,DQ(s.key),s)}}function JCe(i,n,o){return n&&W9(i.prototype,n),o&&W9(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function G9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function nc(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?G9(Object(o),!0).forEach(function(s){JC(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):G9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function JC(i,n,o){return n=DQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function DQ(i){var n=QCe(i,"string");return IS(n)=="symbol"?n:n+""}function QCe(i,n){if(IS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(IS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var xQ=function(n,o,s,u,f){var _=n.width,E=n.height,T=n.layout,w=n.children,I=Object.keys(o),A={left:s.left,leftMirror:s.left,right:_-s.right,rightMirror:_-s.right,top:s.top,topMirror:s.top,bottom:E-s.bottom,bottomMirror:E-s.bottom},P=!!xo(w,fu);return I.reduce(function(j,W){var F=o[W],M=F.orientation,X=F.domain,Y=F.padding,J=Y===void 0?{}:Y,re=F.mirror,z=F.reversed,Z="".concat(M).concat(re?"Mirror":""),ie,de,ge,Oe,me;if(F.type==="number"&&(F.padding==="gap"||F.padding==="no-gap")){var ye=X[1]-X[0],Ae=1/0,be=F.categoricalDomain.sort();if(be.forEach(function(_t,Lt){Lt>0&&(Ae=Math.min((_t||0)-(be[Lt-1]||0),Ae))}),Number.isFinite(Ae)){var ke=Ae/ye,Me=F.layout==="vertical"?s.height:s.width;if(F.padding==="gap"&&(ie=ke*Me/2),F.padding==="no-gap"){var Ue=Ma(n.barCategoryGap,ke*Me),Pe=ke*Me/2;ie=Pe-Ue-(Pe-Ue)/Me*Ue}}}u==="xAxis"?de=[s.left+(J.left||0)+(ie||0),s.left+s.width-(J.right||0)-(ie||0)]:u==="yAxis"?de=T==="horizontal"?[s.top+s.height-(J.bottom||0),s.top+(J.top||0)]:[s.top+(J.top||0)+(ie||0),s.top+s.height-(J.bottom||0)-(ie||0)]:de=F.range,z&&(de=[de[1],de[0]]);var We=zJ(F,f,P),He=We.scale,fe=We.realScaleType;He.domain(X).range(de),$J(He);var Ce=YJ(He,nc(nc({},F),{},{realScaleType:fe}));u==="xAxis"?(me=M==="top"&&!re||M==="bottom"&&re,ge=s.left,Oe=A[Z]-me*F.height):u==="yAxis"&&(me=M==="left"&&!re||M==="right"&&re,ge=A[Z]-me*F.width,Oe=s.top);var ot=nc(nc(nc({},F),Ce),{},{realScaleType:fe,x:ge,y:Oe,scale:He,width:u==="xAxis"?s.width:F.width,height:u==="yAxis"?s.height:F.height});return ot.bandSize=GR(ot,Ce),!F.hide&&u==="xAxis"?A[Z]+=(me?-1:1)*ot.height:F.hide||(A[Z]+=(me?-1:1)*ot.width),nc(nc({},j),{},JC({},W,ot))},{})},kQ=function(n,o){var s=n.x,u=n.y,f=o.x,_=o.y;return{x:Math.min(s,f),y:Math.min(u,_),width:Math.abs(f-s),height:Math.abs(_-u)}},ZCe=function(n){var o=n.x1,s=n.y1,u=n.x2,f=n.y2;return kQ({x:o,y:s},{x:u,y:f})},LQ=function(){function i(n){XCe(this,i),this.scale=n}return JCe(i,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=s.bandAware,f=s.position;if(o!==void 0){if(f)switch(f){case"start":return this.scale(o);case"middle":{var _=this.bandwidth?this.bandwidth()/2:0;return this.scale(o)+_}case"end":{var E=this.bandwidth?this.bandwidth():0;return this.scale(o)+E}default:return this.scale(o)}if(u){var T=this.bandwidth?this.bandwidth()/2:0;return this.scale(o)+T}return this.scale(o)}}},{key:"isInRange",value:function(o){var s=this.range(),u=s[0],f=s[s.length-1];return u<=f?o>=u&&o<=f:o>=f&&o<=u}}],[{key:"create",value:function(o){return new i(o)}}])}();JC(LQ,"EPS",1e-4);var W2=function(n){var o=Object.keys(n).reduce(function(s,u){return nc(nc({},s),{},JC({},u,LQ.create(n[u])))},{});return nc(nc({},o),{},{apply:function(u){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=f.bandAware,E=f.position;return ACe(u,function(T,w){return o[w].apply(T,{bandAware:_,position:E})})},isInRange:function(u){return OQ(u,function(f,_){return o[_].isInRange(f)})}})};function eAe(i){return(i%180+180)%180}var tAe=function(n){var o=n.width,s=n.height,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=eAe(u),_=f*Math.PI/180,E=Math.atan(s/o),T=_>E&&_<Math.PI-E?s/Math.sin(_):o/Math.cos(_);return Math.abs(T)},iL,H9;function rAe(){if(H9)return iL;H9=1;var i=fl(),n=US(),o=DC();function s(u){return function(f,_,E){var T=Object(f);if(!n(f)){var w=i(_,3);f=o(f),_=function(A){return w(T[A],A,T)}}var I=u(f,_,E);return I>-1?T[w?f[I]:I]:void 0}}return iL=s,iL}var aL,q9;function nAe(){if(q9)return aL;q9=1;var i=wQ();function n(o){var s=i(o),u=s%1;return s===s?u?s-u:s:0}return aL=n,aL}var oL,K9;function iAe(){if(K9)return oL;K9=1;var i=OX(),n=fl(),o=nAe(),s=Math.max;function u(f,_,E){var T=f==null?0:f.length;if(!T)return-1;var w=E==null?0:o(E);return w<0&&(w=s(T+w,0)),i(f,n(_,3),w)}return oL=u,oL}var sL,z9;function aAe(){if(z9)return sL;z9=1;var i=rAe(),n=iAe(),o=i(n);return sL=o,sL}var oAe=aAe();const sAe=Yr(oAe);var cAe=H7();const lAe=Yr(cAe);var uAe=lAe(function(i){return{x:i.left,y:i.top,width:i.width,height:i.height}},function(i){return["l",i.left,"t",i.top,"w",i.width,"h",i.height].join("")}),G2=Ee.createContext(void 0),H2=Ee.createContext(void 0),MQ=Ee.createContext(void 0),UQ=Ee.createContext({}),jQ=Ee.createContext(void 0),VQ=Ee.createContext(0),FQ=Ee.createContext(0),$9=function(n){var o=n.state,s=o.xAxisMap,u=o.yAxisMap,f=o.offset,_=n.clipPathId,E=n.children,T=n.width,w=n.height,I=uAe(f);return ue.createElement(G2.Provider,{value:s},ue.createElement(H2.Provider,{value:u},ue.createElement(UQ.Provider,{value:f},ue.createElement(MQ.Provider,{value:I},ue.createElement(jQ.Provider,{value:_},ue.createElement(VQ.Provider,{value:w},ue.createElement(FQ.Provider,{value:T},E)))))))},dAe=function(){return Ee.useContext(jQ)},BQ=function(n){var o=Ee.useContext(G2);o==null&&Kp();var s=o[n];return s==null&&Kp(),s},hAe=function(){var n=Ee.useContext(G2);return Md(n)},pAe=function(){var n=Ee.useContext(H2),o=sAe(n,function(s){return OQ(s.domain,Number.isFinite)});return o||Md(n)},WQ=function(n){var o=Ee.useContext(H2);o==null&&Kp();var s=o[n];return s==null&&Kp(),s},fAe=function(){var n=Ee.useContext(MQ);return n},mAe=function(){return Ee.useContext(UQ)},q2=function(){return Ee.useContext(FQ)},K2=function(){return Ee.useContext(VQ)};function $g(i){"@babel/helpers - typeof";return $g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$g(i)}function gAe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function _Ae(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,HQ(s.key),s)}}function vAe(i,n,o){return n&&_Ae(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function yAe(i,n,o){return n=lC(n),EAe(i,GQ()?Reflect.construct(n,o||[],lC(i).constructor):n.apply(i,o))}function EAe(i,n){if(n&&($g(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SAe(i)}function SAe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function GQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GQ=function(){return!!i})()}function lC(i){return lC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},lC(i)}function bAe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&RM(i,n)}function RM(i,n){return RM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},RM(i,n)}function Y9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function X9(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Y9(Object(o),!0).forEach(function(s){z2(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Y9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function z2(i,n,o){return n=HQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function HQ(i){var n=TAe(i,"string");return $g(n)=="symbol"?n:n+""}function TAe(i,n){if($g(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if($g(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function wAe(i,n){return OAe(i)||AAe(i,n)||CAe(i,n)||RAe()}function RAe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CAe(i,n){if(i){if(typeof i=="string")return J9(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return J9(i,n)}}function J9(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function AAe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function OAe(i){if(Array.isArray(i))return i}function CM(){return CM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},CM.apply(this,arguments)}var IAe=function(n,o){var s;return ue.isValidElement(n)?s=ue.cloneElement(n,o):zt(n)?s=n(o):s=ue.createElement("line",CM({},o,{className:"recharts-reference-line-line"})),s},NAe=function(n,o,s,u,f,_,E,T,w){var I=f.x,A=f.y,P=f.width,j=f.height;if(s){var W=w.y,F=n.y.apply(W,{position:_});if(ll(w,"discard")&&!n.y.isInRange(F))return null;var M=[{x:I+P,y:F},{x:I,y:F}];return T==="left"?M.reverse():M}if(o){var X=w.x,Y=n.x.apply(X,{position:_});if(ll(w,"discard")&&!n.x.isInRange(Y))return null;var J=[{x:Y,y:A+j},{x:Y,y:A}];return E==="top"?J.reverse():J}if(u){var re=w.segment,z=re.map(function(Z){return n.apply(Z,{position:_})});return ll(w,"discard")&&TCe(z,function(Z){return!n.isInRange(Z)})?null:z}return null};function PAe(i){var n=i.x,o=i.y,s=i.segment,u=i.xAxisId,f=i.yAxisId,_=i.shape,E=i.className,T=i.alwaysShow,w=dAe(),I=BQ(u),A=WQ(f),P=fAe();if(!w||!P)return null;oc(T===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var j=W2({x:I.scale,y:A.scale}),W=Oi(n),F=Oi(o),M=s&&s.length===2,X=NAe(j,W,F,M,P,i.position,I.orientation,A.orientation,i);if(!X)return null;var Y=wAe(X,2),J=Y[0],re=J.x,z=J.y,Z=Y[1],ie=Z.x,de=Z.y,ge=ll(i,"hidden")?"url(#".concat(w,")"):void 0,Oe=X9(X9({clipPath:ge},Pt(i,!0)),{},{x1:re,y1:z,x2:ie,y2:de});return ue.createElement(Dr,{className:or("recharts-reference-line",E)},IAe(_,Oe),qi.renderCallByParent(i,ZCe({x1:re,y1:z,x2:ie,y2:de})))}var $2=function(i){function n(){return gAe(this,n),yAe(this,n,arguments)}return bAe(n,i),vAe(n,[{key:"render",value:function(){return ue.createElement(PAe,this.props)}}])}(ue.Component);z2($2,"displayName","ReferenceLine");z2($2,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function AM(){return AM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},AM.apply(this,arguments)}function Yg(i){"@babel/helpers - typeof";return Yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Yg(i)}function Q9(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Z9(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Q9(Object(o),!0).forEach(function(s){QC(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Q9(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function DAe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function xAe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,KQ(s.key),s)}}function kAe(i,n,o){return n&&xAe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function LAe(i,n,o){return n=uC(n),MAe(i,qQ()?Reflect.construct(n,o||[],uC(i).constructor):n.apply(i,o))}function MAe(i,n){if(n&&(Yg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return UAe(i)}function UAe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function qQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qQ=function(){return!!i})()}function uC(i){return uC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},uC(i)}function jAe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&OM(i,n)}function OM(i,n){return OM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},OM(i,n)}function QC(i,n,o){return n=KQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function KQ(i){var n=VAe(i,"string");return Yg(n)=="symbol"?n:n+""}function VAe(i,n){if(Yg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Yg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var FAe=function(n){var o=n.x,s=n.y,u=n.xAxis,f=n.yAxis,_=W2({x:u.scale,y:f.scale}),E=_.apply({x:o,y:s},{bandAware:!0});return ll(n,"discard")&&!_.isInRange(E)?null:E},ZC=function(i){function n(){return DAe(this,n),LAe(this,n,arguments)}return jAe(n,i),kAe(n,[{key:"render",value:function(){var s=this.props,u=s.x,f=s.y,_=s.r,E=s.alwaysShow,T=s.clipPathId,w=Oi(u),I=Oi(f);if(oc(E===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!w||!I)return null;var A=FAe(this.props);if(!A)return null;var P=A.x,j=A.y,W=this.props,F=W.shape,M=W.className,X=ll(this.props,"hidden")?"url(#".concat(T,")"):void 0,Y=Z9(Z9({clipPath:X},Pt(this.props,!0)),{},{cx:P,cy:j});return ue.createElement(Dr,{className:or("recharts-reference-dot",M)},n.renderDot(F,Y),qi.renderCallByParent(this.props,{x:P-_,y:j-_,width:2*_,height:2*_}))}}])}(ue.Component);QC(ZC,"displayName","ReferenceDot");QC(ZC,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});QC(ZC,"renderDot",function(i,n){var o;return ue.isValidElement(i)?o=ue.cloneElement(i,n):zt(i)?o=i(n):o=ue.createElement(GS,AM({},n,{cx:n.cx,cy:n.cy,className:"recharts-reference-dot-dot"})),o});function IM(){return IM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},IM.apply(this,arguments)}function Xg(i){"@babel/helpers - typeof";return Xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Xg(i)}function e7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function t7(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?e7(Object(o),!0).forEach(function(s){eA(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):e7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function BAe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function WAe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,$Q(s.key),s)}}function GAe(i,n,o){return n&&WAe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function HAe(i,n,o){return n=dC(n),qAe(i,zQ()?Reflect.construct(n,o||[],dC(i).constructor):n.apply(i,o))}function qAe(i,n){if(n&&(Xg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KAe(i)}function KAe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function zQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zQ=function(){return!!i})()}function dC(i){return dC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},dC(i)}function zAe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&NM(i,n)}function NM(i,n){return NM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},NM(i,n)}function eA(i,n,o){return n=$Q(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function $Q(i){var n=$Ae(i,"string");return Xg(n)=="symbol"?n:n+""}function $Ae(i,n){if(Xg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Xg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var YAe=function(n,o,s,u,f){var _=f.x1,E=f.x2,T=f.y1,w=f.y2,I=f.xAxis,A=f.yAxis;if(!I||!A)return null;var P=W2({x:I.scale,y:A.scale}),j={x:n?P.x.apply(_,{position:"start"}):P.x.rangeMin,y:s?P.y.apply(T,{position:"start"}):P.y.rangeMin},W={x:o?P.x.apply(E,{position:"end"}):P.x.rangeMax,y:u?P.y.apply(w,{position:"end"}):P.y.rangeMax};return ll(f,"discard")&&(!P.isInRange(j)||!P.isInRange(W))?null:kQ(j,W)},tA=function(i){function n(){return BAe(this,n),HAe(this,n,arguments)}return zAe(n,i),GAe(n,[{key:"render",value:function(){var s=this.props,u=s.x1,f=s.x2,_=s.y1,E=s.y2,T=s.className,w=s.alwaysShow,I=s.clipPathId;oc(w===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var A=Oi(u),P=Oi(f),j=Oi(_),W=Oi(E),F=this.props.shape;if(!A&&!P&&!j&&!W&&!F)return null;var M=YAe(A,P,j,W,this.props);if(!M&&!F)return null;var X=ll(this.props,"hidden")?"url(#".concat(I,")"):void 0;return ue.createElement(Dr,{className:or("recharts-reference-area",T)},n.renderRect(F,t7(t7({clipPath:X},Pt(this.props,!0)),M)),qi.renderCallByParent(this.props,M))}}])}(ue.Component);eA(tA,"displayName","ReferenceArea");eA(tA,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});eA(tA,"renderRect",function(i,n){var o;return ue.isValidElement(i)?o=ue.cloneElement(i,n):zt(i)?o=i(n):o=ue.createElement(B2,IM({},n,{className:"recharts-reference-area-rect"})),o});function YQ(i,n,o){if(n<1)return[];if(n===1&&o===void 0)return i;for(var s=[],u=0;u<i.length;u+=n)s.push(i[u]);return s}function XAe(i,n,o){var s={width:i.width+n.width,height:i.height+n.height};return tAe(s,o)}function JAe(i,n,o){var s=o==="width",u=i.x,f=i.y,_=i.width,E=i.height;return n===1?{start:s?u:f,end:s?u+_:f+E}:{start:s?u+_:f+E,end:s?u:f}}function hC(i,n,o,s,u){if(i*n<i*s||i*n>i*u)return!1;var f=o();return i*(n-i*f/2-s)>=0&&i*(n+i*f/2-u)<=0}function QAe(i,n){return YQ(i,n+1)}function ZAe(i,n,o,s,u){for(var f=(s||[]).slice(),_=n.start,E=n.end,T=0,w=1,I=_,A=function(){var W=s==null?void 0:s[T];if(W===void 0)return{v:YQ(s,w)};var F=T,M,X=function(){return M===void 0&&(M=o(W,F)),M},Y=W.coordinate,J=T===0||hC(i,Y,X,I,E);J||(T=0,I=_,w+=1),J&&(I=Y+i*(X()/2+u),T+=w)},P;w<=f.length;)if(P=A(),P)return P.v;return[]}function NS(i){"@babel/helpers - typeof";return NS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},NS(i)}function r7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function va(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?r7(Object(o),!0).forEach(function(s){eOe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):r7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function eOe(i,n,o){return n=tOe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function tOe(i){var n=rOe(i,"string");return NS(n)=="symbol"?n:n+""}function rOe(i,n){if(NS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(NS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function nOe(i,n,o,s,u){for(var f=(s||[]).slice(),_=f.length,E=n.start,T=n.end,w=function(P){var j=f[P],W,F=function(){return W===void 0&&(W=o(j,P)),W};if(P===_-1){var M=i*(j.coordinate+i*F()/2-T);f[P]=j=va(va({},j),{},{tickCoord:M>0?j.coordinate-M*i:j.coordinate})}else f[P]=j=va(va({},j),{},{tickCoord:j.coordinate});var X=hC(i,j.tickCoord,F,E,T);X&&(T=j.tickCoord-i*(F()/2+u),f[P]=va(va({},j),{},{isShow:!0}))},I=_-1;I>=0;I--)w(I);return f}function iOe(i,n,o,s,u,f){var _=(s||[]).slice(),E=_.length,T=n.start,w=n.end;if(f){var I=s[E-1],A=o(I,E-1),P=i*(I.coordinate+i*A/2-w);_[E-1]=I=va(va({},I),{},{tickCoord:P>0?I.coordinate-P*i:I.coordinate});var j=hC(i,I.tickCoord,function(){return A},T,w);j&&(w=I.tickCoord-i*(A/2+u),_[E-1]=va(va({},I),{},{isShow:!0}))}for(var W=f?E-1:E,F=function(Y){var J=_[Y],re,z=function(){return re===void 0&&(re=o(J,Y)),re};if(Y===0){var Z=i*(J.coordinate-i*z()/2-T);_[Y]=J=va(va({},J),{},{tickCoord:Z<0?J.coordinate-Z*i:J.coordinate})}else _[Y]=J=va(va({},J),{},{tickCoord:J.coordinate});var ie=hC(i,J.tickCoord,z,T,w);ie&&(T=J.tickCoord+i*(z()/2+u),_[Y]=va(va({},J),{},{isShow:!0}))},M=0;M<W;M++)F(M);return _}function Y2(i,n,o){var s=i.tick,u=i.ticks,f=i.viewBox,_=i.minTickGap,E=i.orientation,T=i.interval,w=i.tickFormatter,I=i.unit,A=i.angle;if(!u||!u.length||!s)return[];if(dt(T)||qd.isSsr)return QAe(u,typeof T=="number"&&dt(T)?T:0);var P=[],j=E==="top"||E==="bottom"?"width":"height",W=I&&j==="width"?BE(I,{fontSize:n,letterSpacing:o}):{width:0,height:0},F=function(J,re){var z=zt(w)?w(J.value,re):J.value;return j==="width"?XAe(BE(z,{fontSize:n,letterSpacing:o}),W,A):BE(z,{fontSize:n,letterSpacing:o})[j]},M=u.length>=2?La(u[1].coordinate-u[0].coordinate):1,X=JAe(f,M,j);return T==="equidistantPreserveStart"?ZAe(M,X,F,u,_):(T==="preserveStart"||T==="preserveStartEnd"?P=iOe(M,X,F,u,_,T==="preserveStartEnd"):P=nOe(M,X,F,u,_),P.filter(function(Y){return Y.isShow}))}var aOe=["viewBox"],oOe=["viewBox"],sOe=["ticks"];function Jg(i){"@babel/helpers - typeof";return Jg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Jg(i)}function bg(){return bg=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},bg.apply(this,arguments)}function n7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function xa(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?n7(Object(o),!0).forEach(function(s){X2(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):n7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function cL(i,n){if(i==null)return{};var o=cOe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function cOe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function lOe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function i7(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,JQ(s.key),s)}}function uOe(i,n,o){return n&&i7(i.prototype,n),o&&i7(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function dOe(i,n,o){return n=pC(n),hOe(i,XQ()?Reflect.construct(n,o||[],pC(i).constructor):n.apply(i,o))}function hOe(i,n){if(n&&(Jg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pOe(i)}function pOe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function XQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XQ=function(){return!!i})()}function pC(i){return pC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},pC(i)}function fOe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&PM(i,n)}function PM(i,n){return PM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},PM(i,n)}function X2(i,n,o){return n=JQ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function JQ(i){var n=mOe(i,"string");return Jg(n)=="symbol"?n:n+""}function mOe(i,n){if(Jg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Jg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var g_=function(i){function n(o){var s;return lOe(this,n),s=dOe(this,n,[o]),s.state={fontSize:"",letterSpacing:""},s}return fOe(n,i),uOe(n,[{key:"shouldComponentUpdate",value:function(s,u){var f=s.viewBox,_=cL(s,aOe),E=this.props,T=E.viewBox,w=cL(E,oOe);return!wg(f,T)||!wg(_,w)||!wg(u,this.state)}},{key:"componentDidMount",value:function(){var s=this.layerReference;if(s){var u=s.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];u&&this.setState({fontSize:window.getComputedStyle(u).fontSize,letterSpacing:window.getComputedStyle(u).letterSpacing})}}},{key:"getTickLineCoord",value:function(s){var u=this.props,f=u.x,_=u.y,E=u.width,T=u.height,w=u.orientation,I=u.tickSize,A=u.mirror,P=u.tickMargin,j,W,F,M,X,Y,J=A?-1:1,re=s.tickSize||I,z=dt(s.tickCoord)?s.tickCoord:s.coordinate;switch(w){case"top":j=W=s.coordinate,M=_+ +!A*T,F=M-J*re,Y=F-J*P,X=z;break;case"left":F=M=s.coordinate,W=f+ +!A*E,j=W-J*re,X=j-J*P,Y=z;break;case"right":F=M=s.coordinate,W=f+ +A*E,j=W+J*re,X=j+J*P,Y=z;break;default:j=W=s.coordinate,M=_+ +A*T,F=M+J*re,Y=F+J*P,X=z;break}return{line:{x1:j,y1:F,x2:W,y2:M},tick:{x:X,y:Y}}}},{key:"getTickTextAnchor",value:function(){var s=this.props,u=s.orientation,f=s.mirror,_;switch(u){case"left":_=f?"start":"end";break;case"right":_=f?"end":"start";break;default:_="middle";break}return _}},{key:"getTickVerticalAnchor",value:function(){var s=this.props,u=s.orientation,f=s.mirror,_="end";switch(u){case"left":case"right":_="middle";break;case"top":_=f?"start":"end";break;default:_=f?"end":"start";break}return _}},{key:"renderAxisLine",value:function(){var s=this.props,u=s.x,f=s.y,_=s.width,E=s.height,T=s.orientation,w=s.mirror,I=s.axisLine,A=xa(xa(xa({},Pt(this.props,!1)),Pt(I,!1)),{},{fill:"none"});if(T==="top"||T==="bottom"){var P=+(T==="top"&&!w||T==="bottom"&&w);A=xa(xa({},A),{},{x1:u,y1:f+P*E,x2:u+_,y2:f+P*E})}else{var j=+(T==="left"&&!w||T==="right"&&w);A=xa(xa({},A),{},{x1:u+j*_,y1:f,x2:u+j*_,y2:f+E})}return ue.createElement("line",bg({},A,{className:or("recharts-cartesian-axis-line",Lo(I,"className"))}))}},{key:"renderTicks",value:function(s,u,f){var _=this,E=this.props,T=E.tickLine,w=E.stroke,I=E.tick,A=E.tickFormatter,P=E.unit,j=Y2(xa(xa({},this.props),{},{ticks:s}),u,f),W=this.getTickTextAnchor(),F=this.getTickVerticalAnchor(),M=Pt(this.props,!1),X=Pt(I,!1),Y=xa(xa({},M),{},{fill:"none"},Pt(T,!1)),J=j.map(function(re,z){var Z=_.getTickLineCoord(re),ie=Z.line,de=Z.tick,ge=xa(xa(xa(xa({textAnchor:W,verticalAnchor:F},M),{},{stroke:"none",fill:w},X),de),{},{index:z,payload:re,visibleTicksCount:j.length,tickFormatter:A});return ue.createElement(Dr,bg({className:"recharts-cartesian-axis-tick",key:"tick-".concat(re.value,"-").concat(re.coordinate,"-").concat(re.tickCoord)},Gp(_.props,re,z)),T&&ue.createElement("line",bg({},Y,ie,{className:or("recharts-cartesian-axis-tick-line",Lo(T,"className"))})),I&&n.renderTickItem(I,ge,"".concat(zt(A)?A(re.value,z):re.value).concat(P||"")))});return ue.createElement("g",{className:"recharts-cartesian-axis-ticks"},J)}},{key:"render",value:function(){var s=this,u=this.props,f=u.axisLine,_=u.width,E=u.height,T=u.ticksGenerator,w=u.className,I=u.hide;if(I)return null;var A=this.props,P=A.ticks,j=cL(A,sOe),W=P;return zt(T)&&(W=P&&P.length>0?T(this.props):T(j)),_<=0||E<=0||!W||!W.length?null:ue.createElement(Dr,{className:or("recharts-cartesian-axis",w),ref:function(M){s.layerReference=M}},f&&this.renderAxisLine(),this.renderTicks(W,this.state.fontSize,this.state.letterSpacing),qi.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(s,u,f){var _;return ue.isValidElement(s)?_=ue.cloneElement(s,u):zt(s)?_=s(u):_=ue.createElement(Hp,bg({},u,{className:"recharts-cartesian-axis-tick-value"}),f),_}}])}(Ee.Component);X2(g_,"displayName","CartesianAxis");X2(g_,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var gOe=["x1","y1","x2","y2","key"],_Oe=["offset"];function zp(i){"@babel/helpers - typeof";return zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zp(i)}function a7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function ya(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?a7(Object(o),!0).forEach(function(s){vOe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):a7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function vOe(i,n,o){return n=yOe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function yOe(i){var n=EOe(i,"string");return zp(n)=="symbol"?n:n+""}function EOe(i,n){if(zp(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(zp(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function Vp(){return Vp=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},Vp.apply(this,arguments)}function o7(i,n){if(i==null)return{};var o=SOe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function SOe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}var bOe=function(n){var o=n.fill;if(!o||o==="none")return null;var s=n.fillOpacity,u=n.x,f=n.y,_=n.width,E=n.height,T=n.ry;return ue.createElement("rect",{x:u,y:f,ry:T,width:_,height:E,stroke:"none",fill:o,fillOpacity:s,className:"recharts-cartesian-grid-bg"})};function QQ(i,n){var o;if(ue.isValidElement(i))o=ue.cloneElement(i,n);else if(zt(i))o=i(n);else{var s=n.x1,u=n.y1,f=n.x2,_=n.y2,E=n.key,T=o7(n,gOe),w=Pt(T,!1);w.offset;var I=o7(w,_Oe);o=ue.createElement("line",Vp({},I,{x1:s,y1:u,x2:f,y2:_,fill:"none",key:E}))}return o}function TOe(i){var n=i.x,o=i.width,s=i.horizontal,u=s===void 0?!0:s,f=i.horizontalPoints;if(!u||!f||!f.length)return null;var _=f.map(function(E,T){var w=ya(ya({},i),{},{x1:n,y1:E,x2:n+o,y2:E,key:"line-".concat(T),index:T});return QQ(u,w)});return ue.createElement("g",{className:"recharts-cartesian-grid-horizontal"},_)}function wOe(i){var n=i.y,o=i.height,s=i.vertical,u=s===void 0?!0:s,f=i.verticalPoints;if(!u||!f||!f.length)return null;var _=f.map(function(E,T){var w=ya(ya({},i),{},{x1:E,y1:n,x2:E,y2:n+o,key:"line-".concat(T),index:T});return QQ(u,w)});return ue.createElement("g",{className:"recharts-cartesian-grid-vertical"},_)}function ROe(i){var n=i.horizontalFill,o=i.fillOpacity,s=i.x,u=i.y,f=i.width,_=i.height,E=i.horizontalPoints,T=i.horizontal,w=T===void 0?!0:T;if(!w||!n||!n.length)return null;var I=E.map(function(P){return Math.round(P+u-u)}).sort(function(P,j){return P-j});u!==I[0]&&I.unshift(0);var A=I.map(function(P,j){var W=!I[j+1],F=W?u+_-P:I[j+1]-P;if(F<=0)return null;var M=j%n.length;return ue.createElement("rect",{key:"react-".concat(j),y:P,x:s,height:F,width:f,stroke:"none",fill:n[M],fillOpacity:o,className:"recharts-cartesian-grid-bg"})});return ue.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},A)}function COe(i){var n=i.vertical,o=n===void 0?!0:n,s=i.verticalFill,u=i.fillOpacity,f=i.x,_=i.y,E=i.width,T=i.height,w=i.verticalPoints;if(!o||!s||!s.length)return null;var I=w.map(function(P){return Math.round(P+f-f)}).sort(function(P,j){return P-j});f!==I[0]&&I.unshift(0);var A=I.map(function(P,j){var W=!I[j+1],F=W?f+E-P:I[j+1]-P;if(F<=0)return null;var M=j%s.length;return ue.createElement("rect",{key:"react-".concat(j),x:P,y:_,width:F,height:T,stroke:"none",fill:s[M],fillOpacity:u,className:"recharts-cartesian-grid-bg"})});return ue.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},A)}var AOe=function(n,o){var s=n.xAxis,u=n.width,f=n.height,_=n.offset;return KJ(Y2(ya(ya(ya({},g_.defaultProps),s),{},{ticks:ou(s,!0),viewBox:{x:0,y:0,width:u,height:f}})),_.left,_.left+_.width,o)},OOe=function(n,o){var s=n.yAxis,u=n.width,f=n.height,_=n.offset;return KJ(Y2(ya(ya(ya({},g_.defaultProps),s),{},{ticks:ou(s,!0),viewBox:{x:0,y:0,width:u,height:f}})),_.top,_.top+_.height,o)},gg={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function PS(i){var n,o,s,u,f,_,E=q2(),T=K2(),w=mAe(),I=ya(ya({},i),{},{stroke:(n=i.stroke)!==null&&n!==void 0?n:gg.stroke,fill:(o=i.fill)!==null&&o!==void 0?o:gg.fill,horizontal:(s=i.horizontal)!==null&&s!==void 0?s:gg.horizontal,horizontalFill:(u=i.horizontalFill)!==null&&u!==void 0?u:gg.horizontalFill,vertical:(f=i.vertical)!==null&&f!==void 0?f:gg.vertical,verticalFill:(_=i.verticalFill)!==null&&_!==void 0?_:gg.verticalFill,x:dt(i.x)?i.x:w.left,y:dt(i.y)?i.y:w.top,width:dt(i.width)?i.width:w.width,height:dt(i.height)?i.height:w.height}),A=I.x,P=I.y,j=I.width,W=I.height,F=I.syncWithTicks,M=I.horizontalValues,X=I.verticalValues,Y=hAe(),J=pAe();if(!dt(j)||j<=0||!dt(W)||W<=0||!dt(A)||A!==+A||!dt(P)||P!==+P)return null;var re=I.verticalCoordinatesGenerator||AOe,z=I.horizontalCoordinatesGenerator||OOe,Z=I.horizontalPoints,ie=I.verticalPoints;if((!Z||!Z.length)&&zt(z)){var de=M&&M.length,ge=z({yAxis:J?ya(ya({},J),{},{ticks:de?M:J.ticks}):void 0,width:E,height:T,offset:w},de?!0:F);oc(Array.isArray(ge),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(zp(ge),"]")),Array.isArray(ge)&&(Z=ge)}if((!ie||!ie.length)&&zt(re)){var Oe=X&&X.length,me=re({xAxis:Y?ya(ya({},Y),{},{ticks:Oe?X:Y.ticks}):void 0,width:E,height:T,offset:w},Oe?!0:F);oc(Array.isArray(me),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(zp(me),"]")),Array.isArray(me)&&(ie=me)}return ue.createElement("g",{className:"recharts-cartesian-grid"},ue.createElement(bOe,{fill:I.fill,fillOpacity:I.fillOpacity,x:I.x,y:I.y,width:I.width,height:I.height,ry:I.ry}),ue.createElement(TOe,Vp({},I,{offset:w,horizontalPoints:Z,xAxis:Y,yAxis:J})),ue.createElement(wOe,Vp({},I,{offset:w,verticalPoints:ie,xAxis:Y,yAxis:J})),ue.createElement(ROe,Vp({},I,{horizontalPoints:Z})),ue.createElement(COe,Vp({},I,{verticalPoints:ie})))}PS.displayName="CartesianGrid";var IOe=["type","layout","connectNulls","ref"],NOe=["key"];function Qg(i){"@babel/helpers - typeof";return Qg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qg(i)}function s7(i,n){if(i==null)return{};var o=POe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function POe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function zE(){return zE=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},zE.apply(this,arguments)}function c7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Po(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?c7(Object(o),!0).forEach(function(s){ic(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):c7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function _g(i){return LOe(i)||kOe(i)||xOe(i)||DOe()}function DOe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xOe(i,n){if(i){if(typeof i=="string")return DM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return DM(i,n)}}function kOe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function LOe(i){if(Array.isArray(i))return DM(i)}function DM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function MOe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function l7(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,eZ(s.key),s)}}function UOe(i,n,o){return n&&l7(i.prototype,n),o&&l7(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function jOe(i,n,o){return n=fC(n),VOe(i,ZQ()?Reflect.construct(n,o||[],fC(i).constructor):n.apply(i,o))}function VOe(i,n){if(n&&(Qg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FOe(i)}function FOe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function ZQ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ZQ=function(){return!!i})()}function fC(i){return fC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},fC(i)}function BOe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&xM(i,n)}function xM(i,n){return xM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},xM(i,n)}function ic(i,n,o){return n=eZ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function eZ(i){var n=WOe(i,"string");return Qg(n)=="symbol"?n:n+""}function WOe(i,n){if(Qg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Qg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var ul=function(i){function n(){var o;MOe(this,n);for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];return o=jOe(this,n,[].concat(u)),ic(o,"state",{isAnimationFinished:!0,totalLength:0}),ic(o,"generateSimpleStrokeDasharray",function(_,E){return"".concat(E,"px ").concat(_-E,"px")}),ic(o,"getStrokeDasharray",function(_,E,T){var w=T.reduce(function(X,Y){return X+Y});if(!w)return o.generateSimpleStrokeDasharray(E,_);for(var I=Math.floor(_/w),A=_%w,P=E-_,j=[],W=0,F=0;W<T.length;F+=T[W],++W)if(F+T[W]>A){j=[].concat(_g(T.slice(0,W)),[A-F]);break}var M=j.length%2===0?[0,P]:[P];return[].concat(_g(n.repeat(T,I)),_g(j),M).map(function(X){return"".concat(X,"px")}).join(", ")}),ic(o,"id",c_("recharts-line-")),ic(o,"pathRef",function(_){o.mainCurve=_}),ic(o,"handleAnimationEnd",function(){o.setState({isAnimationFinished:!0}),o.props.onAnimationEnd&&o.props.onAnimationEnd()}),ic(o,"handleAnimationStart",function(){o.setState({isAnimationFinished:!1}),o.props.onAnimationStart&&o.props.onAnimationStart()}),o}return BOe(n,i),UOe(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();this.setState({totalLength:s})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();s!==this.state.totalLength&&this.setState({totalLength:s})}}},{key:"getTotalLength",value:function(){var s=this.mainCurve;try{return s&&s.getTotalLength&&s.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(s,u){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var f=this.props,_=f.points,E=f.xAxis,T=f.yAxis,w=f.layout,I=f.children,A=Mo(I,WS);if(!A)return null;var P=function(F,M){return{x:F.x,y:F.y,value:F.value,errorVal:hi(F.payload,M)}},j={clipPath:s?"url(#clipPath-".concat(u,")"):null};return ue.createElement(Dr,j,A.map(function(W){return ue.cloneElement(W,{key:"bar-".concat(W.props.dataKey),data:_,xAxis:E,yAxis:T,layout:w,dataPointFormatter:P})}))}},{key:"renderDots",value:function(s,u,f){var _=this.props.isAnimationActive;if(_&&!this.state.isAnimationFinished)return null;var E=this.props,T=E.dot,w=E.points,I=E.dataKey,A=Pt(this.props,!1),P=Pt(T,!0),j=w.map(function(F,M){var X=Po(Po(Po({key:"dot-".concat(M),r:3},A),P),{},{index:M,cx:F.x,cy:F.y,value:F.value,dataKey:I,payload:F.payload,points:w});return n.renderDotItem(T,X)}),W={clipPath:s?"url(#clipPath-".concat(u?"":"dots-").concat(f,")"):null};return ue.createElement(Dr,zE({className:"recharts-line-dots",key:"dots"},W),j)}},{key:"renderCurveStatically",value:function(s,u,f,_){var E=this.props,T=E.type,w=E.layout,I=E.connectNulls;E.ref;var A=s7(E,IOe),P=Po(Po(Po({},Pt(A,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:u?"url(#clipPath-".concat(f,")"):null,points:s},_),{},{type:T,layout:w,connectNulls:I});return ue.createElement(KR,zE({},P,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(s,u){var f=this,_=this.props,E=_.points,T=_.strokeDasharray,w=_.isAnimationActive,I=_.animationBegin,A=_.animationDuration,P=_.animationEasing,j=_.animationId,W=_.animateNewValues,F=_.width,M=_.height,X=this.state,Y=X.prevPoints,J=X.totalLength;return ue.createElement(sc,{begin:I,duration:A,isActive:w,easing:P,from:{t:0},to:{t:1},key:"line-".concat(j),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(re){var z=re.t;if(Y){var Z=Y.length/E.length,ie=E.map(function(ye,Ae){var be=Math.floor(Ae*Z);if(Y[be]){var ke=Y[be],Me=ia(ke.x,ye.x),Ue=ia(ke.y,ye.y);return Po(Po({},ye),{},{x:Me(z),y:Ue(z)})}if(W){var Pe=ia(F*2,ye.x),We=ia(M/2,ye.y);return Po(Po({},ye),{},{x:Pe(z),y:We(z)})}return Po(Po({},ye),{},{x:ye.x,y:ye.y})});return f.renderCurveStatically(ie,s,u)}var de=ia(0,J),ge=de(z),Oe;if(T){var me="".concat(T).split(/[,\s]+/gim).map(function(ye){return parseFloat(ye)});Oe=f.getStrokeDasharray(ge,J,me)}else Oe=f.generateSimpleStrokeDasharray(J,ge);return f.renderCurveStatically(E,s,u,{strokeDasharray:Oe})})}},{key:"renderCurve",value:function(s,u){var f=this.props,_=f.points,E=f.isAnimationActive,T=this.state,w=T.prevPoints,I=T.totalLength;return E&&_&&_.length&&(!w&&I>0||!d_(w,_))?this.renderCurveWithAnimation(s,u):this.renderCurveStatically(_,s,u)}},{key:"render",value:function(){var s,u=this.props,f=u.hide,_=u.dot,E=u.points,T=u.className,w=u.xAxis,I=u.yAxis,A=u.top,P=u.left,j=u.width,W=u.height,F=u.isAnimationActive,M=u.id;if(f||!E||!E.length)return null;var X=this.state.isAnimationFinished,Y=E.length===1,J=or("recharts-line",T),re=w&&w.allowDataOverflow,z=I&&I.allowDataOverflow,Z=re||z,ie=ir(M)?this.id:M,de=(s=Pt(_,!1))!==null&&s!==void 0?s:{r:3,strokeWidth:2},ge=de.r,Oe=ge===void 0?3:ge,me=de.strokeWidth,ye=me===void 0?2:me,Ae=Qpe(_)?_:{},be=Ae.clipDot,ke=be===void 0?!0:be,Me=Oe*2+ye;return ue.createElement(Dr,{className:J},re||z?ue.createElement("defs",null,ue.createElement("clipPath",{id:"clipPath-".concat(ie)},ue.createElement("rect",{x:re?P:P-j/2,y:z?A:A-W/2,width:re?j:j*2,height:z?W:W*2})),!ke&&ue.createElement("clipPath",{id:"clipPath-dots-".concat(ie)},ue.createElement("rect",{x:P-Me/2,y:A-Me/2,width:j+Me,height:W+Me}))):null,!Y&&this.renderCurve(Z,ie),this.renderErrorBar(Z,ie),(Y||_)&&this.renderDots(Z,ke,ie),(!F||X)&&cl.renderCallByParent(this.props,E))}}],[{key:"getDerivedStateFromProps",value:function(s,u){return s.animationId!==u.prevAnimationId?{prevAnimationId:s.animationId,curPoints:s.points,prevPoints:u.curPoints}:s.points!==u.curPoints?{curPoints:s.points}:null}},{key:"repeat",value:function(s,u){for(var f=s.length%2!==0?[].concat(_g(s),[0]):s,_=[],E=0;E<u;++E)_=[].concat(_g(_),_g(f));return _}},{key:"renderDotItem",value:function(s,u){var f;if(ue.isValidElement(s))f=ue.cloneElement(s,u);else if(zt(s))f=s(u);else{var _=u.key,E=s7(u,NOe),T=or("recharts-line-dot",typeof s!="boolean"?s.className:"");f=ue.createElement(GS,zE({key:_},E,{className:T}))}return f}}])}(Ee.PureComponent);ic(ul,"displayName","Line");ic(ul,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!qd.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});ic(ul,"getComposedData",function(i){var n=i.props,o=i.xAxis,s=i.yAxis,u=i.xAxisTicks,f=i.yAxisTicks,_=i.dataKey,E=i.bandSize,T=i.displayedData,w=i.offset,I=n.layout,A=T.map(function(P,j){var W=hi(P,_);return I==="horizontal"?{x:sY({axis:o,ticks:u,bandSize:E,entry:P,index:j}),y:ir(W)?null:s.scale(W),value:W,payload:P}:{x:ir(W)?null:o.scale(W),y:sY({axis:s,ticks:f,bandSize:E,entry:P,index:j}),value:W,payload:P}});return Po({points:A,layout:I},w)});function Zg(i){"@babel/helpers - typeof";return Zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zg(i)}function GOe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function HOe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,nZ(s.key),s)}}function qOe(i,n,o){return n&&HOe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function KOe(i,n,o){return n=mC(n),zOe(i,tZ()?Reflect.construct(n,o||[],mC(i).constructor):n.apply(i,o))}function zOe(i,n){if(n&&(Zg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $Oe(i)}function $Oe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function tZ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tZ=function(){return!!i})()}function mC(i){return mC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},mC(i)}function YOe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&kM(i,n)}function kM(i,n){return kM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},kM(i,n)}function rZ(i,n,o){return n=nZ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function nZ(i){var n=XOe(i,"string");return Zg(n)=="symbol"?n:n+""}function XOe(i,n){if(Zg(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(Zg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function LM(){return LM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},LM.apply(this,arguments)}function JOe(i){var n=i.xAxisId,o=q2(),s=K2(),u=BQ(n);return u==null?null:ue.createElement(g_,LM({},u,{className:or("recharts-".concat(u.axisType," ").concat(u.axisType),u.className),viewBox:{x:0,y:0,width:o,height:s},ticksGenerator:function(_){return ou(_,!0)}}))}var Bd=function(i){function n(){return GOe(this,n),KOe(this,n,arguments)}return YOe(n,i),qOe(n,[{key:"render",value:function(){return ue.createElement(JOe,this.props)}}])}(ue.Component);rZ(Bd,"displayName","XAxis");rZ(Bd,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function e_(i){"@babel/helpers - typeof";return e_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e_(i)}function QOe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function ZOe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,oZ(s.key),s)}}function eIe(i,n,o){return n&&ZOe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function tIe(i,n,o){return n=gC(n),rIe(i,iZ()?Reflect.construct(n,o||[],gC(i).constructor):n.apply(i,o))}function rIe(i,n){if(n&&(e_(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nIe(i)}function nIe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function iZ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iZ=function(){return!!i})()}function gC(i){return gC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},gC(i)}function iIe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&MM(i,n)}function MM(i,n){return MM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},MM(i,n)}function aZ(i,n,o){return n=oZ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function oZ(i){var n=aIe(i,"string");return e_(n)=="symbol"?n:n+""}function aIe(i,n){if(e_(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(e_(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function UM(){return UM=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},UM.apply(this,arguments)}var oIe=function(n){var o=n.yAxisId,s=q2(),u=K2(),f=WQ(o);return f==null?null:ue.createElement(g_,UM({},f,{className:or("recharts-".concat(f.axisType," ").concat(f.axisType),f.className),viewBox:{x:0,y:0,width:s,height:u},ticksGenerator:function(E){return ou(E,!0)}}))},Wd=function(i){function n(){return QOe(this,n),tIe(this,n,arguments)}return iIe(n,i),eIe(n,[{key:"render",value:function(){return ue.createElement(oIe,this.props)}}])}(ue.Component);aZ(Wd,"displayName","YAxis");aZ(Wd,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function u7(i){return uIe(i)||lIe(i)||cIe(i)||sIe()}function sIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cIe(i,n){if(i){if(typeof i=="string")return jM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return jM(i,n)}}function lIe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function uIe(i){if(Array.isArray(i))return jM(i)}function jM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}var VM=function(n,o,s,u,f){var _=Mo(n,$2),E=Mo(n,ZC),T=[].concat(u7(_),u7(E)),w=Mo(n,tA),I="".concat(u,"Id"),A=u[0],P=o;if(T.length&&(P=T.reduce(function(F,M){if(M.props[I]===s&&ll(M.props,"extendDomain")&&dt(M.props[A])){var X=M.props[A];return[Math.min(F[0],X),Math.max(F[1],X)]}return F},P)),w.length){var j="".concat(A,"1"),W="".concat(A,"2");P=w.reduce(function(F,M){if(M.props[I]===s&&ll(M.props,"extendDomain")&&dt(M.props[j])&&dt(M.props[W])){var X=M.props[j],Y=M.props[W];return[Math.min(F[0],X,Y),Math.max(F[1],X,Y)]}return F},P)}return f&&f.length&&(P=f.reduce(function(F,M){return dt(M)?[Math.min(F[0],M),Math.max(F[1],M)]:F},P)),P},lL={exports:{}},d7;function dIe(){return d7||(d7=1,function(i){var n=Object.prototype.hasOwnProperty,o="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(o=!1));function u(T,w,I){this.fn=T,this.context=w,this.once=I||!1}function f(T,w,I,A,P){if(typeof I!="function")throw new TypeError("The listener must be a function");var j=new u(I,A||T,P),W=o?o+w:w;return T._events[W]?T._events[W].fn?T._events[W]=[T._events[W],j]:T._events[W].push(j):(T._events[W]=j,T._eventsCount++),T}function _(T,w){--T._eventsCount===0?T._events=new s:delete T._events[w]}function E(){this._events=new s,this._eventsCount=0}E.prototype.eventNames=function(){var w=[],I,A;if(this._eventsCount===0)return w;for(A in I=this._events)n.call(I,A)&&w.push(o?A.slice(1):A);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(I)):w},E.prototype.listeners=function(w){var I=o?o+w:w,A=this._events[I];if(!A)return[];if(A.fn)return[A.fn];for(var P=0,j=A.length,W=new Array(j);P<j;P++)W[P]=A[P].fn;return W},E.prototype.listenerCount=function(w){var I=o?o+w:w,A=this._events[I];return A?A.fn?1:A.length:0},E.prototype.emit=function(w,I,A,P,j,W){var F=o?o+w:w;if(!this._events[F])return!1;var M=this._events[F],X=arguments.length,Y,J;if(M.fn){switch(M.once&&this.removeListener(w,M.fn,void 0,!0),X){case 1:return M.fn.call(M.context),!0;case 2:return M.fn.call(M.context,I),!0;case 3:return M.fn.call(M.context,I,A),!0;case 4:return M.fn.call(M.context,I,A,P),!0;case 5:return M.fn.call(M.context,I,A,P,j),!0;case 6:return M.fn.call(M.context,I,A,P,j,W),!0}for(J=1,Y=new Array(X-1);J<X;J++)Y[J-1]=arguments[J];M.fn.apply(M.context,Y)}else{var re=M.length,z;for(J=0;J<re;J++)switch(M[J].once&&this.removeListener(w,M[J].fn,void 0,!0),X){case 1:M[J].fn.call(M[J].context);break;case 2:M[J].fn.call(M[J].context,I);break;case 3:M[J].fn.call(M[J].context,I,A);break;case 4:M[J].fn.call(M[J].context,I,A,P);break;default:if(!Y)for(z=1,Y=new Array(X-1);z<X;z++)Y[z-1]=arguments[z];M[J].fn.apply(M[J].context,Y)}}return!0},E.prototype.on=function(w,I,A){return f(this,w,I,A,!1)},E.prototype.once=function(w,I,A){return f(this,w,I,A,!0)},E.prototype.removeListener=function(w,I,A,P){var j=o?o+w:w;if(!this._events[j])return this;if(!I)return _(this,j),this;var W=this._events[j];if(W.fn)W.fn===I&&(!P||W.once)&&(!A||W.context===A)&&_(this,j);else{for(var F=0,M=[],X=W.length;F<X;F++)(W[F].fn!==I||P&&!W[F].once||A&&W[F].context!==A)&&M.push(W[F]);M.length?this._events[j]=M.length===1?M[0]:M:_(this,j)}return this},E.prototype.removeAllListeners=function(w){var I;return w?(I=o?o+w:w,this._events[I]&&_(this,I)):(this._events=new s,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=o,E.EventEmitter=E,i.exports=E}(lL)),lL.exports}var hIe=dIe();const pIe=Yr(hIe);var uL=new pIe,dL="recharts.syncMouseEvents";function DS(i){"@babel/helpers - typeof";return DS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},DS(i)}function fIe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function mIe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,sZ(s.key),s)}}function gIe(i,n,o){return n&&mIe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function hL(i,n,o){return n=sZ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function sZ(i){var n=_Ie(i,"string");return DS(n)=="symbol"?n:n+""}function _Ie(i,n){if(DS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(DS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}var vIe=function(){function i(){fIe(this,i),hL(this,"activeIndex",0),hL(this,"coordinateList",[]),hL(this,"layout","horizontal")}return gIe(i,[{key:"setDetails",value:function(o){var s,u=o.coordinateList,f=u===void 0?null:u,_=o.container,E=_===void 0?null:_,T=o.layout,w=T===void 0?null:T,I=o.offset,A=I===void 0?null:I,P=o.mouseHandlerCallback,j=P===void 0?null:P;this.coordinateList=(s=f??this.coordinateList)!==null&&s!==void 0?s:[],this.container=E??this.container,this.layout=w??this.layout,this.offset=A??this.offset,this.mouseHandlerCallback=j??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(o){if(this.coordinateList.length!==0)switch(o.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(o){this.activeIndex=o}},{key:"spoofMouse",value:function(){var o,s;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var u=this.container.getBoundingClientRect(),f=u.x,_=u.y,E=u.height,T=this.coordinateList[this.activeIndex].coordinate,w=((o=window)===null||o===void 0?void 0:o.scrollX)||0,I=((s=window)===null||s===void 0?void 0:s.scrollY)||0,A=f+T+w,P=_+this.offset.top+E/2+I;this.mouseHandlerCallback({pageX:A,pageY:P})}}}])}();function yIe(i,n,o){if(o==="number"&&n===!0&&Array.isArray(i)){var s=i==null?void 0:i[0],u=i==null?void 0:i[1];if(s&&u&&dt(s)&&dt(u))return!0}return!1}function EIe(i,n,o,s){var u=s/2;return{stroke:"none",fill:"#ccc",x:i==="horizontal"?n.x-u:o.left+.5,y:i==="horizontal"?o.top+.5:n.y-u,width:i==="horizontal"?s:o.width-1,height:i==="horizontal"?o.height-1:s}}function cZ(i){var n=i.cx,o=i.cy,s=i.radius,u=i.startAngle,f=i.endAngle,_=$r(n,o,s,u),E=$r(n,o,s,f);return{points:[_,E],cx:n,cy:o,radius:s,startAngle:u,endAngle:f}}function SIe(i,n,o){var s,u,f,_;if(i==="horizontal")s=n.x,f=s,u=o.top,_=o.top+o.height;else if(i==="vertical")u=n.y,_=u,s=o.left,f=o.left+o.width;else if(n.cx!=null&&n.cy!=null)if(i==="centric"){var E=n.cx,T=n.cy,w=n.innerRadius,I=n.outerRadius,A=n.angle,P=$r(E,T,w,A),j=$r(E,T,I,A);s=P.x,u=P.y,f=j.x,_=j.y}else return cZ(n);return[{x:s,y:u},{x:f,y:_}]}function xS(i){"@babel/helpers - typeof";return xS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xS(i)}function h7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function dR(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?h7(Object(o),!0).forEach(function(s){bIe(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):h7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function bIe(i,n,o){return n=TIe(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function TIe(i){var n=wIe(i,"string");return xS(n)=="symbol"?n:n+""}function wIe(i,n){if(xS(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(xS(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function RIe(i){var n,o,s=i.element,u=i.tooltipEventType,f=i.isActive,_=i.activeCoordinate,E=i.activePayload,T=i.offset,w=i.activeTooltipIndex,I=i.tooltipAxisBandSize,A=i.layout,P=i.chartName,j=(n=s.props.cursor)!==null&&n!==void 0?n:(o=s.type.defaultProps)===null||o===void 0?void 0:o.cursor;if(!s||!j||!f||!_||P!=="ScatterChart"&&u!=="axis")return null;var W,F=KR;if(P==="ScatterChart")W=_,F=Swe;else if(P==="BarChart")W=EIe(A,_,T,I),F=B2;else if(A==="radial"){var M=cZ(_),X=M.cx,Y=M.cy,J=M.radius,re=M.startAngle,z=M.endAngle;W={cx:X,cy:Y,startAngle:re,endAngle:z,innerRadius:J,outerRadius:J},F=aQ}else W={points:SIe(A,_,T)},F=KR;var Z=dR(dR(dR(dR({stroke:"#ccc",pointerEvents:"none"},T),W),Pt(j,!1)),{},{payload:E,payloadIndex:w,className:or("recharts-tooltip-cursor",j.className)});return Ee.isValidElement(j)?Ee.cloneElement(j,Z):Ee.createElement(F,Z)}var CIe=["item"],AIe=["children","className","width","height","style","compact","title","desc"];function t_(i){"@babel/helpers - typeof";return t_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t_(i)}function Tg(){return Tg=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},Tg.apply(this,arguments)}function p7(i,n){return NIe(i)||IIe(i,n)||uZ(i,n)||OIe()}function OIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IIe(i,n){var o=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s,u,f,_,E=[],T=!0,w=!1;try{if(f=(o=o.call(i)).next,n!==0)for(;!(T=(s=f.call(o)).done)&&(E.push(s.value),E.length!==n);T=!0);}catch(I){w=!0,u=I}finally{try{if(!T&&o.return!=null&&(_=o.return(),Object(_)!==_))return}finally{if(w)throw u}}return E}}function NIe(i){if(Array.isArray(i))return i}function f7(i,n){if(i==null)return{};var o=PIe(i,n),s,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);for(u=0;u<f.length;u++)s=f[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}function PIe(i,n){if(i==null)return{};var o={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(n.indexOf(s)>=0)continue;o[s]=i[s]}return o}function DIe(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function xIe(i,n){for(var o=0;o<n.length;o++){var s=n[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,dZ(s.key),s)}}function kIe(i,n,o){return n&&xIe(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function LIe(i,n,o){return n=_C(n),MIe(i,lZ()?Reflect.construct(n,o||[],_C(i).constructor):n.apply(i,o))}function MIe(i,n){if(n&&(t_(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return UIe(i)}function UIe(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function lZ(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lZ=function(){return!!i})()}function _C(i){return _C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},_C(i)}function jIe(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&FM(i,n)}function FM(i,n){return FM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},FM(i,n)}function r_(i){return BIe(i)||FIe(i)||uZ(i)||VIe()}function VIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uZ(i,n){if(i){if(typeof i=="string")return BM(i,n);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return BM(i,n)}}function FIe(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function BIe(i){if(Array.isArray(i))return BM(i)}function BM(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,s=new Array(n);o<n;o++)s[o]=i[o];return s}function m7(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function Ke(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?m7(Object(o),!0).forEach(function(s){$t(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):m7(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function $t(i,n,o){return n=dZ(n),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function dZ(i){var n=WIe(i,"string");return t_(n)=="symbol"?n:n+""}function WIe(i,n){if(t_(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var s=o.call(i,n);if(t_(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}var GIe={xAxis:["bottom","top"],yAxis:["left","right"]},HIe={width:"100%",height:"100%"},hZ={x:0,y:0};function hR(i){return i}var qIe=function(n,o){return o==="horizontal"?n.x:o==="vertical"?n.y:o==="centric"?n.angle:n.radius},KIe=function(n,o,s,u){var f=o.find(function(I){return I&&I.index===s});if(f){if(n==="horizontal")return{x:f.coordinate,y:u.y};if(n==="vertical")return{x:u.x,y:f.coordinate};if(n==="centric"){var _=f.coordinate,E=u.radius;return Ke(Ke(Ke({},u),$r(u.cx,u.cy,E,_)),{},{angle:_,radius:E})}var T=f.coordinate,w=u.angle;return Ke(Ke(Ke({},u),$r(u.cx,u.cy,T,w)),{},{angle:w,radius:T})}return hZ},rA=function(n,o){var s=o.graphicalItems,u=o.dataStartIndex,f=o.dataEndIndex,_=(s??[]).reduce(function(E,T){var w=T.props.data;return w&&w.length?[].concat(r_(E),r_(w)):E},[]);return _.length>0?_:n&&n.length&&dt(u)&&dt(f)?n.slice(u,f+1):[]};function pZ(i){return i==="number"?[0,"auto"]:void 0}var WM=function(n,o,s,u){var f=n.graphicalItems,_=n.tooltipAxis,E=rA(o,n);return s<0||!f||!f.length||s>=E.length?null:f.reduce(function(T,w){var I,A=(I=w.props.data)!==null&&I!==void 0?I:o;A&&n.dataStartIndex+n.dataEndIndex!==0&&n.dataEndIndex-n.dataStartIndex>=s&&(A=A.slice(n.dataStartIndex,n.dataEndIndex+1));var P;if(_.dataKey&&!_.allowDuplicatedCategory){var j=A===void 0?E:A;P=vR(j,_.dataKey,u)}else P=A&&A[s]||E[s];return P?[].concat(r_(T),[JJ(w,P)]):T},[])},g7=function(n,o,s,u){var f=u||{x:n.chartX,y:n.chartY},_=qIe(f,s),E=n.orderedTooltipTicks,T=n.tooltipAxis,w=n.tooltipTicks,I=YSe(_,E,w,T);if(I>=0&&w){var A=w[I]&&w[I].value,P=WM(n,o,I,A),j=KIe(s,E,I,f);return{activeTooltipIndex:I,activeLabel:A,activePayload:P,activeCoordinate:j}}return null},zIe=function(n,o){var s=o.axes,u=o.graphicalItems,f=o.axisType,_=o.axisIdKey,E=o.stackGroups,T=o.dataStartIndex,w=o.dataEndIndex,I=n.layout,A=n.children,P=n.stackOffset,j=qJ(I,f);return s.reduce(function(W,F){var M,X=F.type.defaultProps!==void 0?Ke(Ke({},F.type.defaultProps),F.props):F.props,Y=X.type,J=X.dataKey,re=X.allowDataOverflow,z=X.allowDuplicatedCategory,Z=X.scale,ie=X.ticks,de=X.includeHidden,ge=X[_];if(W[ge])return W;var Oe=rA(n.data,{graphicalItems:u.filter(function(Ce){var ot,_t=_ in Ce.props?Ce.props[_]:(ot=Ce.type.defaultProps)===null||ot===void 0?void 0:ot[_];return _t===ge}),dataStartIndex:T,dataEndIndex:w}),me=Oe.length,ye,Ae,be;yIe(X.domain,re,Y)&&(ye=tM(X.domain,null,re),j&&(Y==="number"||Z!=="auto")&&(be=GE(Oe,J,"category")));var ke=pZ(Y);if(!ye||ye.length===0){var Me,Ue=(Me=X.domain)!==null&&Me!==void 0?Me:ke;if(J){if(ye=GE(Oe,J,Y),Y==="category"&&j){var Pe=Gpe(ye);z&&Pe?(Ae=ye,ye=iC(0,me)):z||(ye=dY(Ue,ye,F).reduce(function(Ce,ot){return Ce.indexOf(ot)>=0?Ce:[].concat(r_(Ce),[ot])},[]))}else if(Y==="category")z?ye=ye.filter(function(Ce){return Ce!==""&&!ir(Ce)}):ye=dY(Ue,ye,F).reduce(function(Ce,ot){return Ce.indexOf(ot)>=0||ot===""||ir(ot)?Ce:[].concat(r_(Ce),[ot])},[]);else if(Y==="number"){var We=e0e(Oe,u.filter(function(Ce){var ot,_t,Lt=_ in Ce.props?Ce.props[_]:(ot=Ce.type.defaultProps)===null||ot===void 0?void 0:ot[_],Yt="hide"in Ce.props?Ce.props.hide:(_t=Ce.type.defaultProps)===null||_t===void 0?void 0:_t.hide;return Lt===ge&&(de||!Yt)}),J,f,I);We&&(ye=We)}j&&(Y==="number"||Z!=="auto")&&(be=GE(Oe,J,"category"))}else j?ye=iC(0,me):E&&E[ge]&&E[ge].hasStack&&Y==="number"?ye=P==="expand"?[0,1]:XJ(E[ge].stackGroups,T,w):ye=HJ(Oe,u.filter(function(Ce){var ot=_ in Ce.props?Ce.props[_]:Ce.type.defaultProps[_],_t="hide"in Ce.props?Ce.props.hide:Ce.type.defaultProps.hide;return ot===ge&&(de||!_t)}),Y,I,!0);if(Y==="number")ye=VM(A,ye,ge,f,ie),Ue&&(ye=tM(Ue,ye,re));else if(Y==="category"&&Ue){var He=Ue,fe=ye.every(function(Ce){return He.indexOf(Ce)>=0});fe&&(ye=He)}}return Ke(Ke({},W),{},$t({},ge,Ke(Ke({},X),{},{axisType:f,domain:ye,categoricalDomain:be,duplicateDomain:Ae,originalDomain:(M=X.domain)!==null&&M!==void 0?M:ke,isCategorical:j,layout:I})))},{})},$Ie=function(n,o){var s=o.graphicalItems,u=o.Axis,f=o.axisType,_=o.axisIdKey,E=o.stackGroups,T=o.dataStartIndex,w=o.dataEndIndex,I=n.layout,A=n.children,P=rA(n.data,{graphicalItems:s,dataStartIndex:T,dataEndIndex:w}),j=P.length,W=qJ(I,f),F=-1;return s.reduce(function(M,X){var Y=X.type.defaultProps!==void 0?Ke(Ke({},X.type.defaultProps),X.props):X.props,J=Y[_],re=pZ("number");if(!M[J]){F++;var z;return W?z=iC(0,j):E&&E[J]&&E[J].hasStack?(z=XJ(E[J].stackGroups,T,w),z=VM(A,z,J,f)):(z=tM(re,HJ(P,s.filter(function(Z){var ie,de,ge=_ in Z.props?Z.props[_]:(ie=Z.type.defaultProps)===null||ie===void 0?void 0:ie[_],Oe="hide"in Z.props?Z.props.hide:(de=Z.type.defaultProps)===null||de===void 0?void 0:de.hide;return ge===J&&!Oe}),"number",I),u.defaultProps.allowDataOverflow),z=VM(A,z,J,f)),Ke(Ke({},M),{},$t({},J,Ke(Ke({axisType:f},u.defaultProps),{},{hide:!0,orientation:Lo(GIe,"".concat(f,".").concat(F%2),null),domain:z,originalDomain:re,isCategorical:W,layout:I})))}return M},{})},YIe=function(n,o){var s=o.axisType,u=s===void 0?"xAxis":s,f=o.AxisComp,_=o.graphicalItems,E=o.stackGroups,T=o.dataStartIndex,w=o.dataEndIndex,I=n.children,A="".concat(u,"Id"),P=Mo(I,f),j={};return P&&P.length?j=zIe(n,{axes:P,graphicalItems:_,axisType:u,axisIdKey:A,stackGroups:E,dataStartIndex:T,dataEndIndex:w}):_&&_.length&&(j=$Ie(n,{Axis:f,graphicalItems:_,axisType:u,axisIdKey:A,stackGroups:E,dataStartIndex:T,dataEndIndex:w})),j},XIe=function(n){var o=Md(n),s=ou(o,!1,!0);return{tooltipTicks:s,orderedTooltipTicks:f2(s,function(u){return u.coordinate}),tooltipAxis:o,tooltipAxisBandSize:GR(o,s)}},_7=function(n){var o=n.children,s=n.defaultShowTooltip,u=xo(o,Kg),f=0,_=0;return n.data&&n.data.length!==0&&(_=n.data.length-1),u&&u.props&&(u.props.startIndex>=0&&(f=u.props.startIndex),u.props.endIndex>=0&&(_=u.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:f,dataEndIndex:_,activeTooltipIndex:-1,isTooltipActive:!!s}},JIe=function(n){return!n||!n.length?!1:n.some(function(o){var s=su(o&&o.type);return s&&s.indexOf("Bar")>=0})},v7=function(n){return n==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:n==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:n==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},QIe=function(n,o){var s=n.props,u=n.graphicalItems,f=n.xAxisMap,_=f===void 0?{}:f,E=n.yAxisMap,T=E===void 0?{}:E,w=s.width,I=s.height,A=s.children,P=s.margin||{},j=xo(A,Kg),W=xo(A,Rg),F=Object.keys(T).reduce(function(z,Z){var ie=T[Z],de=ie.orientation;return!ie.mirror&&!ie.hide?Ke(Ke({},z),{},$t({},de,z[de]+ie.width)):z},{left:P.left||0,right:P.right||0}),M=Object.keys(_).reduce(function(z,Z){var ie=_[Z],de=ie.orientation;return!ie.mirror&&!ie.hide?Ke(Ke({},z),{},$t({},de,Lo(z,"".concat(de))+ie.height)):z},{top:P.top||0,bottom:P.bottom||0}),X=Ke(Ke({},M),F),Y=X.bottom;j&&(X.bottom+=j.props.height||Kg.defaultProps.height),W&&o&&(X=QSe(X,u,s,o));var J=w-X.left-X.right,re=I-X.top-X.bottom;return Ke(Ke({brushBottom:Y},X),{},{width:Math.max(J,0),height:Math.max(re,0)})},ZIe=function(n,o){if(o==="xAxis")return n[o].width;if(o==="yAxis")return n[o].height},nA=function(n){var o=n.chartName,s=n.GraphicalChild,u=n.defaultTooltipEventType,f=u===void 0?"axis":u,_=n.validateTooltipEventTypes,E=_===void 0?["axis"]:_,T=n.axisComponents,w=n.legendContent,I=n.formatAxisMap,A=n.defaultProps,P=function(X,Y){var J=Y.graphicalItems,re=Y.stackGroups,z=Y.offset,Z=Y.updateId,ie=Y.dataStartIndex,de=Y.dataEndIndex,ge=X.barSize,Oe=X.layout,me=X.barGap,ye=X.barCategoryGap,Ae=X.maxBarSize,be=v7(Oe),ke=be.numericAxisName,Me=be.cateAxisName,Ue=JIe(J),Pe=[];return J.forEach(function(We,He){var fe=rA(X.data,{graphicalItems:[We],dataStartIndex:ie,dataEndIndex:de}),Ce=We.type.defaultProps!==void 0?Ke(Ke({},We.type.defaultProps),We.props):We.props,ot=Ce.dataKey,_t=Ce.maxBarSize,Lt=Ce["".concat(ke,"Id")],Yt=Ce["".concat(Me,"Id")],br={},Qt=T.reduce(function(Ni,co){var ml=Y["".concat(co.axisType,"Map")],Fn=Ce["".concat(co.axisType,"Id")];ml&&ml[Fn]||co.axisType==="zAxis"||Kp();var Eu=ml[Fn];return Ke(Ke({},Ni),{},$t($t({},co.axisType,Eu),"".concat(co.axisType,"Ticks"),ou(Eu)))},br),nt=Qt[Me],It=Qt["".concat(Me,"Ticks")],Zt=re&&re[Lt]&&re[Lt].hasStack&&l0e(We,re[Lt].stackGroups),rt=su(We.type).indexOf("Bar")>=0,Or=GR(nt,It),vr=[],Dn=Ue&&XSe({barSize:ge,stackGroups:re,totalSize:ZIe(Qt,Me)});if(rt){var qr,pi,en=ir(_t)?Ae:_t,xn=(qr=(pi=GR(nt,It,!0))!==null&&pi!==void 0?pi:en)!==null&&qr!==void 0?qr:0;vr=JSe({barGap:me,barCategoryGap:ye,bandSize:xn!==Or?xn:Or,sizeList:Dn[Yt],maxBarSize:en}),xn!==Or&&(vr=vr.map(function(Ni){return Ke(Ke({},Ni),{},{position:Ke(Ke({},Ni.position),{},{offset:Ni.position.offset-xn/2})})}))}var ja=We&&We.type&&We.type.getComposedData;ja&&Pe.push({props:Ke(Ke({},ja(Ke(Ke({},Qt),{},{displayedData:fe,props:X,dataKey:ot,item:We,bandSize:Or,barPosition:vr,offset:z,stackedData:Zt,layout:Oe,dataStartIndex:ie,dataEndIndex:de}))),{},$t($t($t({key:We.key||"item-".concat(He)},ke,Qt[ke]),Me,Qt[Me]),"animationId",Z)),childIndex:tfe(We,X.children),item:We})}),Pe},j=function(X,Y){var J=X.props,re=X.dataStartIndex,z=X.dataEndIndex,Z=X.updateId;if(!Rq({props:J}))return null;var ie=J.children,de=J.layout,ge=J.stackOffset,Oe=J.data,me=J.reverseStackOrder,ye=v7(de),Ae=ye.numericAxisName,be=ye.cateAxisName,ke=Mo(ie,s),Me=s0e(Oe,ke,"".concat(Ae,"Id"),"".concat(be,"Id"),ge,me),Ue=T.reduce(function(Ce,ot){var _t="".concat(ot.axisType,"Map");return Ke(Ke({},Ce),{},$t({},_t,YIe(J,Ke(Ke({},ot),{},{graphicalItems:ke,stackGroups:ot.axisType===Ae&&Me,dataStartIndex:re,dataEndIndex:z}))))},{}),Pe=QIe(Ke(Ke({},Ue),{},{props:J,graphicalItems:ke}),Y==null?void 0:Y.legendBBox);Object.keys(Ue).forEach(function(Ce){Ue[Ce]=I(J,Ue[Ce],Pe,Ce.replace("Map",""),o)});var We=Ue["".concat(be,"Map")],He=XIe(We),fe=P(J,Ke(Ke({},Ue),{},{dataStartIndex:re,dataEndIndex:z,updateId:Z,graphicalItems:ke,stackGroups:Me,offset:Pe}));return Ke(Ke({formattedGraphicalItems:fe,graphicalItems:ke,offset:Pe,stackGroups:Me},He),Ue)},W=function(M){function X(Y){var J,re,z;return DIe(this,X),z=LIe(this,X,[Y]),$t(z,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),$t(z,"accessibilityManager",new vIe),$t(z,"handleLegendBBoxUpdate",function(Z){if(Z){var ie=z.state,de=ie.dataStartIndex,ge=ie.dataEndIndex,Oe=ie.updateId;z.setState(Ke({legendBBox:Z},j({props:z.props,dataStartIndex:de,dataEndIndex:ge,updateId:Oe},Ke(Ke({},z.state),{},{legendBBox:Z}))))}}),$t(z,"handleReceiveSyncEvent",function(Z,ie,de){if(z.props.syncId===Z){if(de===z.eventEmitterSymbol&&typeof z.props.syncMethod!="function")return;z.applySyncEvent(ie)}}),$t(z,"handleBrushChange",function(Z){var ie=Z.startIndex,de=Z.endIndex;if(ie!==z.state.dataStartIndex||de!==z.state.dataEndIndex){var ge=z.state.updateId;z.setState(function(){return Ke({dataStartIndex:ie,dataEndIndex:de},j({props:z.props,dataStartIndex:ie,dataEndIndex:de,updateId:ge},z.state))}),z.triggerSyncEvent({dataStartIndex:ie,dataEndIndex:de})}}),$t(z,"handleMouseEnter",function(Z){var ie=z.getMouseInfo(Z);if(ie){var de=Ke(Ke({},ie),{},{isTooltipActive:!0});z.setState(de),z.triggerSyncEvent(de);var ge=z.props.onMouseEnter;zt(ge)&&ge(de,Z)}}),$t(z,"triggeredAfterMouseMove",function(Z){var ie=z.getMouseInfo(Z),de=ie?Ke(Ke({},ie),{},{isTooltipActive:!0}):{isTooltipActive:!1};z.setState(de),z.triggerSyncEvent(de);var ge=z.props.onMouseMove;zt(ge)&&ge(de,Z)}),$t(z,"handleItemMouseEnter",function(Z){z.setState(function(){return{isTooltipActive:!0,activeItem:Z,activePayload:Z.tooltipPayload,activeCoordinate:Z.tooltipPosition||{x:Z.cx,y:Z.cy}}})}),$t(z,"handleItemMouseLeave",function(){z.setState(function(){return{isTooltipActive:!1}})}),$t(z,"handleMouseMove",function(Z){Z.persist(),z.throttleTriggeredAfterMouseMove(Z)}),$t(z,"handleMouseLeave",function(Z){z.throttleTriggeredAfterMouseMove.cancel();var ie={isTooltipActive:!1};z.setState(ie),z.triggerSyncEvent(ie);var de=z.props.onMouseLeave;zt(de)&&de(ie,Z)}),$t(z,"handleOuterEvent",function(Z){var ie=efe(Z),de=Lo(z.props,"".concat(ie));if(ie&&zt(de)){var ge,Oe;/.*touch.*/i.test(ie)?Oe=z.getMouseInfo(Z.changedTouches[0]):Oe=z.getMouseInfo(Z),de((ge=Oe)!==null&&ge!==void 0?ge:{},Z)}}),$t(z,"handleClick",function(Z){var ie=z.getMouseInfo(Z);if(ie){var de=Ke(Ke({},ie),{},{isTooltipActive:!0});z.setState(de),z.triggerSyncEvent(de);var ge=z.props.onClick;zt(ge)&&ge(de,Z)}}),$t(z,"handleMouseDown",function(Z){var ie=z.props.onMouseDown;if(zt(ie)){var de=z.getMouseInfo(Z);ie(de,Z)}}),$t(z,"handleMouseUp",function(Z){var ie=z.props.onMouseUp;if(zt(ie)){var de=z.getMouseInfo(Z);ie(de,Z)}}),$t(z,"handleTouchMove",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&z.throttleTriggeredAfterMouseMove(Z.changedTouches[0])}),$t(z,"handleTouchStart",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&z.handleMouseDown(Z.changedTouches[0])}),$t(z,"handleTouchEnd",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&z.handleMouseUp(Z.changedTouches[0])}),$t(z,"handleDoubleClick",function(Z){var ie=z.props.onDoubleClick;if(zt(ie)){var de=z.getMouseInfo(Z);ie(de,Z)}}),$t(z,"handleContextMenu",function(Z){var ie=z.props.onContextMenu;if(zt(ie)){var de=z.getMouseInfo(Z);ie(de,Z)}}),$t(z,"triggerSyncEvent",function(Z){z.props.syncId!==void 0&&uL.emit(dL,z.props.syncId,Z,z.eventEmitterSymbol)}),$t(z,"applySyncEvent",function(Z){var ie=z.props,de=ie.layout,ge=ie.syncMethod,Oe=z.state.updateId,me=Z.dataStartIndex,ye=Z.dataEndIndex;if(Z.dataStartIndex!==void 0||Z.dataEndIndex!==void 0)z.setState(Ke({dataStartIndex:me,dataEndIndex:ye},j({props:z.props,dataStartIndex:me,dataEndIndex:ye,updateId:Oe},z.state)));else if(Z.activeTooltipIndex!==void 0){var Ae=Z.chartX,be=Z.chartY,ke=Z.activeTooltipIndex,Me=z.state,Ue=Me.offset,Pe=Me.tooltipTicks;if(!Ue)return;if(typeof ge=="function")ke=ge(Pe,Z);else if(ge==="value"){ke=-1;for(var We=0;We<Pe.length;We++)if(Pe[We].value===Z.activeLabel){ke=We;break}}var He=Ke(Ke({},Ue),{},{x:Ue.left,y:Ue.top}),fe=Math.min(Ae,He.x+He.width),Ce=Math.min(be,He.y+He.height),ot=Pe[ke]&&Pe[ke].value,_t=WM(z.state,z.props.data,ke),Lt=Pe[ke]?{x:de==="horizontal"?Pe[ke].coordinate:fe,y:de==="horizontal"?Ce:Pe[ke].coordinate}:hZ;z.setState(Ke(Ke({},Z),{},{activeLabel:ot,activeCoordinate:Lt,activePayload:_t,activeTooltipIndex:ke}))}else z.setState(Z)}),$t(z,"renderCursor",function(Z){var ie,de=z.state,ge=de.isTooltipActive,Oe=de.activeCoordinate,me=de.activePayload,ye=de.offset,Ae=de.activeTooltipIndex,be=de.tooltipAxisBandSize,ke=z.getTooltipEventType(),Me=(ie=Z.props.active)!==null&&ie!==void 0?ie:ge,Ue=z.props.layout,Pe=Z.key||"_recharts-cursor";return ue.createElement(RIe,{key:Pe,activeCoordinate:Oe,activePayload:me,activeTooltipIndex:Ae,chartName:o,element:Z,isActive:Me,layout:Ue,offset:ye,tooltipAxisBandSize:be,tooltipEventType:ke})}),$t(z,"renderPolarAxis",function(Z,ie,de){var ge=Lo(Z,"type.axisType"),Oe=Lo(z.state,"".concat(ge,"Map")),me=Z.type.defaultProps,ye=me!==void 0?Ke(Ke({},me),Z.props):Z.props,Ae=Oe&&Oe[ye["".concat(ge,"Id")]];return Ee.cloneElement(Z,Ke(Ke({},Ae),{},{className:or(ge,Ae.className),key:Z.key||"".concat(ie,"-").concat(de),ticks:ou(Ae,!0)}))}),$t(z,"renderPolarGrid",function(Z){var ie=Z.props,de=ie.radialLines,ge=ie.polarAngles,Oe=ie.polarRadius,me=z.state,ye=me.radiusAxisMap,Ae=me.angleAxisMap,be=Md(ye),ke=Md(Ae),Me=ke.cx,Ue=ke.cy,Pe=ke.innerRadius,We=ke.outerRadius;return Ee.cloneElement(Z,{polarAngles:Array.isArray(ge)?ge:ou(ke,!0).map(function(He){return He.coordinate}),polarRadius:Array.isArray(Oe)?Oe:ou(be,!0).map(function(He){return He.coordinate}),cx:Me,cy:Ue,innerRadius:Pe,outerRadius:We,key:Z.key||"polar-grid",radialLines:de})}),$t(z,"renderLegend",function(){var Z=z.state.formattedGraphicalItems,ie=z.props,de=ie.children,ge=ie.width,Oe=ie.height,me=z.props.margin||{},ye=ge-(me.left||0)-(me.right||0),Ae=WJ({children:de,formattedGraphicalItems:Z,legendWidth:ye,legendContent:w});if(!Ae)return null;var be=Ae.item,ke=f7(Ae,CIe);return Ee.cloneElement(be,Ke(Ke({},ke),{},{chartWidth:ge,chartHeight:Oe,margin:me,onBBoxUpdate:z.handleLegendBBoxUpdate}))}),$t(z,"renderTooltip",function(){var Z,ie=z.props,de=ie.children,ge=ie.accessibilityLayer,Oe=xo(de,ao);if(!Oe)return null;var me=z.state,ye=me.isTooltipActive,Ae=me.activeCoordinate,be=me.activePayload,ke=me.activeLabel,Me=me.offset,Ue=(Z=Oe.props.active)!==null&&Z!==void 0?Z:ye;return Ee.cloneElement(Oe,{viewBox:Ke(Ke({},Me),{},{x:Me.left,y:Me.top}),active:Ue,label:ke,payload:Ue?be:[],coordinate:Ae,accessibilityLayer:ge})}),$t(z,"renderBrush",function(Z){var ie=z.props,de=ie.margin,ge=ie.data,Oe=z.state,me=Oe.offset,ye=Oe.dataStartIndex,Ae=Oe.dataEndIndex,be=Oe.updateId;return Ee.cloneElement(Z,{key:Z.key||"_recharts-brush",onChange:sR(z.handleBrushChange,Z.props.onChange),data:ge,x:dt(Z.props.x)?Z.props.x:me.left,y:dt(Z.props.y)?Z.props.y:me.top+me.height+me.brushBottom-(de.bottom||0),width:dt(Z.props.width)?Z.props.width:me.width,startIndex:ye,endIndex:Ae,updateId:"brush-".concat(be)})}),$t(z,"renderReferenceElement",function(Z,ie,de){if(!Z)return null;var ge=z,Oe=ge.clipPathId,me=z.state,ye=me.xAxisMap,Ae=me.yAxisMap,be=me.offset,ke=Z.type.defaultProps||{},Me=Z.props,Ue=Me.xAxisId,Pe=Ue===void 0?ke.xAxisId:Ue,We=Me.yAxisId,He=We===void 0?ke.yAxisId:We;return Ee.cloneElement(Z,{key:Z.key||"".concat(ie,"-").concat(de),xAxis:ye[Pe],yAxis:Ae[He],viewBox:{x:be.left,y:be.top,width:be.width,height:be.height},clipPathId:Oe})}),$t(z,"renderActivePoints",function(Z){var ie=Z.item,de=Z.activePoint,ge=Z.basePoint,Oe=Z.childIndex,me=Z.isRange,ye=[],Ae=ie.props.key,be=ie.item.type.defaultProps!==void 0?Ke(Ke({},ie.item.type.defaultProps),ie.item.props):ie.item.props,ke=be.activeDot,Me=be.dataKey,Ue=Ke(Ke({index:Oe,dataKey:Me,cx:de.x,cy:de.y,r:4,fill:F2(ie.item),strokeWidth:2,stroke:"#fff",payload:de.payload,value:de.value},Pt(ke,!1)),yR(ke));return ye.push(X.renderActiveDot(ke,Ue,"".concat(Ae,"-activePoint-").concat(Oe))),ge?ye.push(X.renderActiveDot(ke,Ke(Ke({},Ue),{},{cx:ge.x,cy:ge.y}),"".concat(Ae,"-basePoint-").concat(Oe))):me&&ye.push(null),ye}),$t(z,"renderGraphicChild",function(Z,ie,de){var ge=z.filterFormatItem(Z,ie,de);if(!ge)return null;var Oe=z.getTooltipEventType(),me=z.state,ye=me.isTooltipActive,Ae=me.tooltipAxis,be=me.activeTooltipIndex,ke=me.activeLabel,Me=z.props.children,Ue=xo(Me,ao),Pe=ge.props,We=Pe.points,He=Pe.isRange,fe=Pe.baseLine,Ce=ge.item.type.defaultProps!==void 0?Ke(Ke({},ge.item.type.defaultProps),ge.item.props):ge.item.props,ot=Ce.activeDot,_t=Ce.hide,Lt=Ce.activeBar,Yt=Ce.activeShape,br=!!(!_t&&ye&&Ue&&(ot||Lt||Yt)),Qt={};Oe!=="axis"&&Ue&&Ue.props.trigger==="click"?Qt={onClick:sR(z.handleItemMouseEnter,Z.props.onClick)}:Oe!=="axis"&&(Qt={onMouseLeave:sR(z.handleItemMouseLeave,Z.props.onMouseLeave),onMouseEnter:sR(z.handleItemMouseEnter,Z.props.onMouseEnter)});var nt=Ee.cloneElement(Z,Ke(Ke({},ge.props),Qt));function It(co){return typeof Ae.dataKey=="function"?Ae.dataKey(co.payload):null}if(br)if(be>=0){var Zt,rt;if(Ae.dataKey&&!Ae.allowDuplicatedCategory){var Or=typeof Ae.dataKey=="function"?It:"payload.".concat(Ae.dataKey.toString());Zt=vR(We,Or,ke),rt=He&&fe&&vR(fe,Or,ke)}else Zt=We==null?void 0:We[be],rt=He&&fe&&fe[be];if(Yt||Lt){var vr=Z.props.activeIndex!==void 0?Z.props.activeIndex:be;return[Ee.cloneElement(Z,Ke(Ke(Ke({},ge.props),Qt),{},{activeIndex:vr})),null,null]}if(!ir(Zt))return[nt].concat(r_(z.renderActivePoints({item:ge,activePoint:Zt,basePoint:rt,childIndex:be,isRange:He})))}else{var Dn,qr=(Dn=z.getItemByXY(z.state.activeCoordinate))!==null&&Dn!==void 0?Dn:{graphicalItem:nt},pi=qr.graphicalItem,en=pi.item,xn=en===void 0?Z:en,ja=pi.childIndex,Ni=Ke(Ke(Ke({},ge.props),Qt),{},{activeIndex:ja});return[Ee.cloneElement(xn,Ni),null,null]}return He?[nt,null,null]:[nt,null]}),$t(z,"renderCustomized",function(Z,ie,de){return Ee.cloneElement(Z,Ke(Ke({key:"recharts-customized-".concat(de)},z.props),z.state))}),$t(z,"renderMap",{CartesianGrid:{handler:hR,once:!0},ReferenceArea:{handler:z.renderReferenceElement},ReferenceLine:{handler:hR},ReferenceDot:{handler:z.renderReferenceElement},XAxis:{handler:hR},YAxis:{handler:hR},Brush:{handler:z.renderBrush,once:!0},Bar:{handler:z.renderGraphicChild},Line:{handler:z.renderGraphicChild},Area:{handler:z.renderGraphicChild},Radar:{handler:z.renderGraphicChild},RadialBar:{handler:z.renderGraphicChild},Scatter:{handler:z.renderGraphicChild},Pie:{handler:z.renderGraphicChild},Funnel:{handler:z.renderGraphicChild},Tooltip:{handler:z.renderCursor,once:!0},PolarGrid:{handler:z.renderPolarGrid,once:!0},PolarAngleAxis:{handler:z.renderPolarAxis},PolarRadiusAxis:{handler:z.renderPolarAxis},Customized:{handler:z.renderCustomized}}),z.clipPathId="".concat((J=Y.id)!==null&&J!==void 0?J:c_("recharts"),"-clip"),z.throttleTriggeredAfterMouseMove=BX(z.triggeredAfterMouseMove,(re=Y.throttleDelay)!==null&&re!==void 0?re:1e3/60),z.state={},z}return jIe(X,M),kIe(X,[{key:"componentDidMount",value:function(){var J,re;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(J=this.props.margin.left)!==null&&J!==void 0?J:0,top:(re=this.props.margin.top)!==null&&re!==void 0?re:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var J=this.props,re=J.children,z=J.data,Z=J.height,ie=J.layout,de=xo(re,ao);if(de){var ge=de.props.defaultIndex;if(!(typeof ge!="number"||ge<0||ge>this.state.tooltipTicks.length-1)){var Oe=this.state.tooltipTicks[ge]&&this.state.tooltipTicks[ge].value,me=WM(this.state,z,ge,Oe),ye=this.state.tooltipTicks[ge].coordinate,Ae=(this.state.offset.top+Z)/2,be=ie==="horizontal",ke=be?{x:ye,y:Ae}:{y:ye,x:Ae},Me=this.state.formattedGraphicalItems.find(function(Pe){var We=Pe.item;return We.type.name==="Scatter"});Me&&(ke=Ke(Ke({},ke),Me.props.points[ge].tooltipPosition),me=Me.props.points[ge].tooltipPayload);var Ue={activeTooltipIndex:ge,isTooltipActive:!0,activeLabel:Oe,activePayload:me,activeCoordinate:ke};this.setState(Ue),this.renderCursor(de),this.accessibilityManager.setIndex(ge)}}}},{key:"getSnapshotBeforeUpdate",value:function(J,re){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==re.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==J.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==J.margin){var z,Z;this.accessibilityManager.setDetails({offset:{left:(z=this.props.margin.left)!==null&&z!==void 0?z:0,top:(Z=this.props.margin.top)!==null&&Z!==void 0?Z:0}})}return null}},{key:"componentDidUpdate",value:function(J){TL([xo(J.children,ao)],[xo(this.props.children,ao)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var J=xo(this.props.children,ao);if(J&&typeof J.props.shared=="boolean"){var re=J.props.shared?"axis":"item";return E.indexOf(re)>=0?re:f}return f}},{key:"getMouseInfo",value:function(J){if(!this.container)return null;var re=this.container,z=re.getBoundingClientRect(),Z=B_e(z),ie={chartX:Math.round(J.pageX-Z.left),chartY:Math.round(J.pageY-Z.top)},de=z.width/re.offsetWidth||1,ge=this.inRange(ie.chartX,ie.chartY,de);if(!ge)return null;var Oe=this.state,me=Oe.xAxisMap,ye=Oe.yAxisMap,Ae=this.getTooltipEventType(),be=g7(this.state,this.props.data,this.props.layout,ge);if(Ae!=="axis"&&me&&ye){var ke=Md(me).scale,Me=Md(ye).scale,Ue=ke&&ke.invert?ke.invert(ie.chartX):null,Pe=Me&&Me.invert?Me.invert(ie.chartY):null;return Ke(Ke({},ie),{},{xValue:Ue,yValue:Pe},be)}return be?Ke(Ke({},ie),be):null}},{key:"inRange",value:function(J,re){var z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Z=this.props.layout,ie=J/z,de=re/z;if(Z==="horizontal"||Z==="vertical"){var ge=this.state.offset,Oe=ie>=ge.left&&ie<=ge.left+ge.width&&de>=ge.top&&de<=ge.top+ge.height;return Oe?{x:ie,y:de}:null}var me=this.state,ye=me.angleAxisMap,Ae=me.radiusAxisMap;if(ye&&Ae){var be=Md(ye);return fY({x:ie,y:de},be)}return null}},{key:"parseEventsOfWrapper",value:function(){var J=this.props.children,re=this.getTooltipEventType(),z=xo(J,ao),Z={};z&&re==="axis"&&(z.props.trigger==="click"?Z={onClick:this.handleClick}:Z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ie=yR(this.props,this.handleOuterEvent);return Ke(Ke({},ie),Z)}},{key:"addListener",value:function(){uL.on(dL,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){uL.removeListener(dL,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(J,re,z){for(var Z=this.state.formattedGraphicalItems,ie=0,de=Z.length;ie<de;ie++){var ge=Z[ie];if(ge.item===J||ge.props.key===J.key||re===su(ge.item.type)&&z===ge.childIndex)return ge}return null}},{key:"renderClipPath",value:function(){var J=this.clipPathId,re=this.state.offset,z=re.left,Z=re.top,ie=re.height,de=re.width;return ue.createElement("defs",null,ue.createElement("clipPath",{id:J},ue.createElement("rect",{x:z,y:Z,height:ie,width:de})))}},{key:"getXScales",value:function(){var J=this.state.xAxisMap;return J?Object.entries(J).reduce(function(re,z){var Z=p7(z,2),ie=Z[0],de=Z[1];return Ke(Ke({},re),{},$t({},ie,de.scale))},{}):null}},{key:"getYScales",value:function(){var J=this.state.yAxisMap;return J?Object.entries(J).reduce(function(re,z){var Z=p7(z,2),ie=Z[0],de=Z[1];return Ke(Ke({},re),{},$t({},ie,de.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(J){var re;return(re=this.state.xAxisMap)===null||re===void 0||(re=re[J])===null||re===void 0?void 0:re.scale}},{key:"getYScaleByAxisId",value:function(J){var re;return(re=this.state.yAxisMap)===null||re===void 0||(re=re[J])===null||re===void 0?void 0:re.scale}},{key:"getItemByXY",value:function(J){var re=this.state,z=re.formattedGraphicalItems,Z=re.activeItem;if(z&&z.length)for(var ie=0,de=z.length;ie<de;ie++){var ge=z[ie],Oe=ge.props,me=ge.item,ye=me.type.defaultProps!==void 0?Ke(Ke({},me.type.defaultProps),me.props):me.props,Ae=su(me.type);if(Ae==="Bar"){var be=(Oe.data||[]).find(function(Pe){return rwe(J,Pe)});if(be)return{graphicalItem:ge,payload:be}}else if(Ae==="RadialBar"){var ke=(Oe.data||[]).find(function(Pe){return fY(J,Pe)});if(ke)return{graphicalItem:ge,payload:ke}}else if(YC(ge,Z)||XC(ge,Z)||CS(ge,Z)){var Me=MRe({graphicalItem:ge,activeTooltipItem:Z,itemData:ye.data}),Ue=ye.activeIndex===void 0?Me:ye.activeIndex;return{graphicalItem:Ke(Ke({},ge),{},{childIndex:Ue}),payload:CS(ge,Z)?ye.data[Me]:ge.props.data[Me]}}}return null}},{key:"render",value:function(){var J=this;if(!Rq(this))return null;var re=this.props,z=re.children,Z=re.className,ie=re.width,de=re.height,ge=re.style,Oe=re.compact,me=re.title,ye=re.desc,Ae=f7(re,AIe),be=Pt(Ae,!1);if(Oe)return ue.createElement($9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ue.createElement(RL,Tg({},be,{width:ie,height:de,title:me,desc:ye}),this.renderClipPath(),Aq(z,this.renderMap)));if(this.props.accessibilityLayer){var ke,Me;be.tabIndex=(ke=this.props.tabIndex)!==null&&ke!==void 0?ke:0,be.role=(Me=this.props.role)!==null&&Me!==void 0?Me:"application",be.onKeyDown=function(Pe){J.accessibilityManager.keyboardEvent(Pe)},be.onFocus=function(){J.accessibilityManager.focus()}}var Ue=this.parseEventsOfWrapper();return ue.createElement($9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ue.createElement("div",Tg({className:or("recharts-wrapper",Z),style:Ke({position:"relative",cursor:"default",width:ie,height:de},ge)},Ue,{ref:function(We){J.container=We}}),ue.createElement(RL,Tg({},be,{width:ie,height:de,title:me,desc:ye,style:HIe}),this.renderClipPath(),Aq(z,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Ee.Component);$t(W,"displayName",o),$t(W,"defaultProps",Ke({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},A)),$t(W,"getDerivedStateFromProps",function(M,X){var Y=M.dataKey,J=M.data,re=M.children,z=M.width,Z=M.height,ie=M.layout,de=M.stackOffset,ge=M.margin,Oe=X.dataStartIndex,me=X.dataEndIndex;if(X.updateId===void 0){var ye=_7(M);return Ke(Ke(Ke({},ye),{},{updateId:0},j(Ke(Ke({props:M},ye),{},{updateId:0}),X)),{},{prevDataKey:Y,prevData:J,prevWidth:z,prevHeight:Z,prevLayout:ie,prevStackOffset:de,prevMargin:ge,prevChildren:re})}if(Y!==X.prevDataKey||J!==X.prevData||z!==X.prevWidth||Z!==X.prevHeight||ie!==X.prevLayout||de!==X.prevStackOffset||!wg(ge,X.prevMargin)){var Ae=_7(M),be={chartX:X.chartX,chartY:X.chartY,isTooltipActive:X.isTooltipActive},ke=Ke(Ke({},g7(X,J,ie)),{},{updateId:X.updateId+1}),Me=Ke(Ke(Ke({},Ae),be),ke);return Ke(Ke(Ke({},Me),j(Ke({props:M},Me),X)),{},{prevDataKey:Y,prevData:J,prevWidth:z,prevHeight:Z,prevLayout:ie,prevStackOffset:de,prevMargin:ge,prevChildren:re})}if(!TL(re,X.prevChildren)){var Ue,Pe,We,He,fe=xo(re,Kg),Ce=fe&&(Ue=(Pe=fe.props)===null||Pe===void 0?void 0:Pe.startIndex)!==null&&Ue!==void 0?Ue:Oe,ot=fe&&(We=(He=fe.props)===null||He===void 0?void 0:He.endIndex)!==null&&We!==void 0?We:me,_t=Ce!==Oe||ot!==me,Lt=!ir(J),Yt=Lt&&!_t?X.updateId:X.updateId+1;return Ke(Ke({updateId:Yt},j(Ke(Ke({props:M},X),{},{updateId:Yt,dataStartIndex:Ce,dataEndIndex:ot}),X)),{},{prevChildren:re,dataStartIndex:Ce,dataEndIndex:ot})}return null}),$t(W,"renderActiveDot",function(M,X,Y){var J;return Ee.isValidElement(M)?J=Ee.cloneElement(M,X):zt(M)?J=M(X):J=ue.createElement(GS,X),ue.createElement(Dr,{className:"recharts-active-dot",key:Y},J)});var F=Ee.forwardRef(function(X,Y){return ue.createElement(W,Tg({},X,{ref:Y}))});return F.displayName=W.displayName,F},fZ=nA({chartName:"LineChart",GraphicalChild:ul,axisComponents:[{axisType:"xAxis",AxisComp:Bd},{axisType:"yAxis",AxisComp:Wd}],formatAxisMap:xQ}),mZ=nA({chartName:"BarChart",GraphicalChild:fu,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Bd},{axisType:"yAxis",AxisComp:Wd}],formatAxisMap:xQ}),eNe=nA({chartName:"PieChart",GraphicalChild:yu,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:m_},{axisType:"radiusAxis",AxisComp:f_}],formatAxisMap:eQ,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}}),tNe=nA({chartName:"RadarChart",GraphicalChild:HS,axisComponents:[{axisType:"angleAxis",AxisComp:m_},{axisType:"radiusAxis",AxisComp:f_}],formatAxisMap:eQ,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const rNe=()=>{const{user:i,healthScore:n}=Gd(),o=[{day:"周一",cognitive:85,emotional:90,social:75},{day:"周二",cognitive:82,emotional:88,social:78},{day:"周三",cognitive:78,emotional:85,social:80},{day:"周四",cognitive:80,emotional:92,social:82},{day:"周五",cognitive:83,emotional:89,social:85},{day:"周六",cognitive:87,emotional:95,social:88},{day:"周日",cognitive:89,emotional:93,social:90}],s=[{name:"积极",value:65,color:"#22c55e"},{name:"中性",value:25,color:"#eab308"},{name:"消极",value:10,color:"#ef4444"}],u=[{activity:"AI对话",count:24,target:30},{activity:"认知训练",count:18,target:20},{activity:"社交互动",count:12,target:15},{activity:"音乐疗法",count:8,target:10}],f=[{type:"positive",icon:L7,title:"认知能力稳定",description:"近一周认知评分保持在 80-89 分范围，表现稳定。",color:"text-green-600 bg-green-100"},{type:"warning",icon:KM,title:"社交活动需加强",description:"社交互动频率低于目标，建议增加家庭活动时间。",color:"text-yellow-600 bg-yellow-100"},{type:"positive",icon:lu,title:"情绪状态良好",description:"情绪评分进步明显，周末达到 95 分的高水平。",color:"text-blue-600 bg-blue-100"}],_=()=>{console.log("正在生成家属简报..."),alert("报告正在生成，请稍后...")};return U.jsxs("div",{className:"space-y-8",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"家属简报"}),U.jsxs("p",{className:"text-gray-600 mt-2",children:[i==null?void 0:i.name," 的健康状态报告 - 近七天数据"]})]}),U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[U.jsx(Ng,{className:"w-5 h-5"}),U.jsx("span",{children:new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})})]}),U.jsxs("button",{onClick:_,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors",children:[U.jsx(M7,{className:"w-5 h-5"}),U.jsx("span",{children:"下载报告"})]})]})]}),U.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("div",{className:"flex items-center justify-between mb-4",children:[U.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:U.jsx(bC,{className:"w-6 h-6 text-green-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-3xl font-bold text-green-600",children:(n==null?void 0:n.overall)||85}),U.jsx("p",{className:"text-sm text-gray-500",children:"/100"})]})]}),U.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"综合健康评分"}),U.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"本周平均分数，较上周上升 3 分"}),U.jsx("div",{className:"mt-4",children:U.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:U.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-500",style:{width:`${(n==null?void 0:n.overall)||85}%`}})})})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("div",{className:"flex items-center justify-between mb-4",children:[U.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:U.jsx(Wp,{className:"w-6 h-6 text-blue-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-3xl font-bold text-blue-600",children:(n==null?void 0:n.cognitive)||84}),U.jsx("p",{className:"text-sm text-gray-500",children:"/100"})]})]}),U.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"认知能力"}),U.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"记忆、注意力和理解能力评估"}),U.jsx("div",{className:"mt-4",children:U.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:U.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-500",style:{width:`${(n==null?void 0:n.cognitive)||84}%`}})})})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsxs("div",{className:"flex items-center justify-between mb-4",children:[U.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:U.jsx(lu,{className:"w-6 h-6 text-purple-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-3xl font-bold text-purple-600",children:(n==null?void 0:n.emotional)||91}),U.jsx("p",{className:"text-sm text-gray-500",children:"/100"})]})]}),U.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"情绪状态"}),U.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"心理健康和情绪稳定性评估"}),U.jsx("div",{className:"mt-4",children:U.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:U.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-500",style:{width:`${(n==null?void 0:n.emotional)||91}%`}})})})]})]}),U.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"健康趋势分析"}),U.jsx("div",{className:"h-80",children:U.jsx(Cg,{width:"100%",height:"100%",children:U.jsxs(fZ,{data:o,children:[U.jsx(PS,{strokeDasharray:"3 3",className:"opacity-30"}),U.jsx(Bd,{dataKey:"day",tick:{fontSize:12},axisLine:{stroke:"#e5e7eb"}}),U.jsx(Wd,{domain:[0,100],tick:{fontSize:12},axisLine:{stroke:"#e5e7eb"}}),U.jsx(ao,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px"}}),U.jsx(ul,{type:"monotone",dataKey:"cognitive",stroke:"#3b82f6",strokeWidth:3,name:"认知能力",dot:{fill:"#3b82f6",strokeWidth:2,r:4}}),U.jsx(ul,{type:"monotone",dataKey:"emotional",stroke:"#8b5cf6",strokeWidth:3,name:"情绪状态",dot:{fill:"#8b5cf6",strokeWidth:2,r:4}}),U.jsx(ul,{type:"monotone",dataKey:"social",stroke:"#10b981",strokeWidth:3,name:"社交能力",dot:{fill:"#10b981",strokeWidth:2,r:4}})]})})})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"情绪状态分布"}),U.jsxs("div",{className:"h-80 flex items-center",children:[U.jsx("div",{className:"w-2/3",children:U.jsx(Cg,{width:"100%",height:"100%",children:U.jsxs(eNe,{children:[U.jsx(yu,{data:s,cx:"50%",cy:"50%",outerRadius:80,innerRadius:40,paddingAngle:5,dataKey:"value",children:s.map((E,T)=>U.jsx(LC,{fill:E.color},`cell-${T}`))}),U.jsx(ao,{formatter:E=>[`${E}%`,"比例"]})]})})}),U.jsx("div",{className:"w-1/3 space-y-4",children:s.map((E,T)=>U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:E.color}}),U.jsxs("div",{children:[U.jsx("p",{className:"font-medium text-gray-900",children:E.name}),U.jsxs("p",{className:"text-sm text-gray-500",children:[E.value,"%"]})]})]},T))})]})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"每周活动统计"}),U.jsx("div",{className:"h-80",children:U.jsx(Cg,{width:"100%",height:"100%",children:U.jsxs(mZ,{data:u,children:[U.jsx(PS,{strokeDasharray:"3 3",className:"opacity-30"}),U.jsx(Bd,{dataKey:"activity",tick:{fontSize:12},axisLine:{stroke:"#e5e7eb"}}),U.jsx(Wd,{tick:{fontSize:12},axisLine:{stroke:"#e5e7eb"}}),U.jsx(ao,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px"}}),U.jsx(fu,{dataKey:"count",fill:"#3b82f6",name:"实际次数"}),U.jsx(fu,{dataKey:"target",fill:"#e5e7eb",name:"目标次数"})]})})})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"智能洞察与建议"}),U.jsx("div",{className:"space-y-4",children:f.map((E,T)=>{const w=E.icon;return U.jsxs("div",{className:"flex items-start space-x-4 p-4 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[U.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${E.color}`,children:U.jsx(w,{className:"w-6 h-6"})}),U.jsxs("div",{className:"flex-1",children:[U.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:E.title}),U.jsx("p",{className:"text-gray-600",children:E.description})]}),U.jsx(k7,{className:"w-5 h-5 text-gray-400"})]},T)})})]})]})},nNe=()=>{const[i,n]=Ee.useState(""),[o,s]=Ee.useState("all"),[u,f]=Ee.useState("all"),_=[{id:"session_001",patientName:"王太太",patientId:"P001",sessionDate:"2025-07-25",duration:45,healthScore:{overall:82,cognitive:78,emotional:88},status:"completed",riskLevel:"medium",keyInsights:["记忆力下降","情绪稳定","社交意愿较强"]},{id:"session_002",patientName:"李爷爷",patientId:"P002",sessionDate:"2025-07-25",duration:38,healthScore:{overall:91,cognitive:89,emotional:95},status:"completed",riskLevel:"low",keyInsights:["认知能力保持稳定","积极乐观","家庭支持良好"]},{id:"session_003",patientName:"张奶奶",patientId:"P003",sessionDate:"2025-07-24",duration:52,healthScore:{overall:65,cognitive:58,emotional:72},status:"completed",riskLevel:"high",keyInsights:["语言能力下降明显","焦虑情绪增加","需要密切关注"]},{id:"session_004",patientName:"陈大爷",patientId:"P004",sessionDate:"2025-07-24",duration:0,healthScore:{overall:0,cognitive:0,emotional:0},status:"in-progress",riskLevel:"medium",keyInsights:[]},{id:"session_005",patientName:"刘奶奶",patientId:"P005",sessionDate:"2025-07-26",duration:0,healthScore:{overall:0,cognitive:0,emotional:0},status:"scheduled",riskLevel:"low",keyInsights:[]}],E=_.filter(j=>{const W=j.patientName.toLowerCase().includes(i.toLowerCase())||j.patientId.toLowerCase().includes(i.toLowerCase()),F=o==="all"||j.status===o,M=u==="all"||j.riskLevel===u;return W&&F&&M}),T={total:_.length,completed:_.filter(j=>j.status==="completed").length,inProgress:_.filter(j=>j.status==="in-progress").length,scheduled:_.filter(j=>j.status==="scheduled").length,highRisk:_.filter(j=>j.riskLevel==="high").length},w=j=>{switch(j){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},I=j=>{switch(j){case"high":return"高风险";case"medium":return"中风险";case"low":return"低风险";default:return"未知"}},A=j=>{switch(j){case"completed":return"text-green-600 bg-green-100";case"in-progress":return"text-blue-600 bg-blue-100";case"scheduled":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},P=j=>{switch(j){case"completed":return"已完成";case"in-progress":return"进行中";case"scheduled":return"已预约";default:return"未知"}};return U.jsxs("div",{className:"space-y-8",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{children:[U.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"医生仪表板"}),U.jsx("p",{className:"text-gray-600 mt-2",children:"患者会话管理和健康状态监测"})]}),U.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[U.jsx(Ng,{className:"w-5 h-5"}),U.jsx("span",{children:new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})})]})]}),U.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:U.jsx(zM,{className:"w-6 h-6 text-blue-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.total}),U.jsx("p",{className:"text-sm text-gray-500",children:"总会话"})]})]})}),U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:U.jsx(L7,{className:"w-6 h-6 text-green-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.completed}),U.jsx("p",{className:"text-sm text-gray-500",children:"已完成"})]})]})}),U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:U.jsx(_R,{className:"w-6 h-6 text-blue-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.inProgress}),U.jsx("p",{className:"text-sm text-gray-500",children:"进行中"})]})]})}),U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center",children:U.jsx(Ng,{className:"w-6 h-6 text-gray-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.scheduled}),U.jsx("p",{className:"text-sm text-gray-500",children:"已预约"})]})]})}),U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:U.jsx(Bhe,{className:"w-6 h-6 text-red-600"})}),U.jsxs("div",{className:"text-right",children:[U.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.highRisk}),U.jsx("p",{className:"text-sm text-gray-500",children:"高风险"})]})]})})]}),U.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:U.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 lg:space-x-4",children:[U.jsxs("div",{className:"relative flex-1 max-w-md",children:[U.jsx(Vhe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),U.jsx("input",{type:"text",placeholder:"搜索患者姓名或ID...",value:i,onChange:j=>n(j.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),U.jsxs("div",{className:"flex space-x-4",children:[U.jsxs("select",{value:o,onChange:j=>s(j.target.value),className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[U.jsx("option",{value:"all",children:"所有状态"}),U.jsx("option",{value:"completed",children:"已完成"}),U.jsx("option",{value:"in-progress",children:"进行中"}),U.jsx("option",{value:"scheduled",children:"已预约"})]}),U.jsxs("select",{value:u,onChange:j=>f(j.target.value),className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[U.jsx("option",{value:"all",children:"所有风险级别"}),U.jsx("option",{value:"high",children:"高风险"}),U.jsx("option",{value:"medium",children:"中风险"}),U.jsx("option",{value:"low",children:"低风险"})]})]})]})}),U.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[U.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"患者会话列表"}),U.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["共找到 ",E.length," 条记录"]})]}),U.jsx("div",{className:"divide-y divide-gray-200",children:E.map(j=>U.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:j.patientName.charAt(0)}),U.jsxs("div",{children:[U.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:j.patientName}),U.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: ",j.patientId]})]})]}),U.jsxs("div",{className:"flex items-center space-x-6",children:[U.jsxs("div",{className:"text-center",children:[U.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${A(j.status)}`,children:P(j.status)}),U.jsx("p",{className:"text-gray-500 text-xs mt-1",children:j.sessionDate})]}),U.jsxs("div",{className:"text-center",children:[U.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${w(j.riskLevel)}`,children:I(j.riskLevel)}),j.duration>0&&U.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:[j.duration," 分钟"]})]}),j.status==="completed"&&U.jsxs("div",{className:"flex space-x-4",children:[U.jsxs("div",{className:"text-center",children:[U.jsxs("div",{className:"flex items-center space-x-1",children:[U.jsx(Wp,{className:"w-4 h-4 text-blue-500"}),U.jsx("span",{className:"text-lg font-bold text-blue-600",children:j.healthScore.cognitive})]}),U.jsx("p",{className:"text-gray-500 text-xs",children:"认知"})]}),U.jsxs("div",{className:"text-center",children:[U.jsxs("div",{className:"flex items-center space-x-1",children:[U.jsx(lu,{className:"w-4 h-4 text-red-500"}),U.jsx("span",{className:"text-lg font-bold text-red-600",children:j.healthScore.emotional})]}),U.jsx("p",{className:"text-gray-500 text-xs",children:"情绪"})]}),U.jsxs("div",{className:"text-center",children:[U.jsxs("div",{className:"flex items-center space-x-1",children:[U.jsx(bC,{className:"w-4 h-4 text-green-500"}),U.jsx("span",{className:"text-lg font-bold text-green-600",children:j.healthScore.overall})]}),U.jsx("p",{className:"text-gray-500 text-xs",children:"综合"})]})]}),U.jsxs(SC,{to:`/doctor/report/${j.id}`,className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[U.jsx("span",{children:"查看详情"}),U.jsx(k7,{className:"w-4 h-4"})]})]})]}),j.keyInsights.length>0&&U.jsxs("div",{className:"mt-4 pl-16",children:[U.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"关键洞察："}),U.jsx("div",{className:"flex flex-wrap gap-2",children:j.keyInsights.map((W,F)=>U.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full",children:W},F))})]})]},j.id))})]})]})},iNe=()=>{const{sid:i}=Ude(),n={patientName:"王太太",patientId:"P001",sessionDate:"2025-07-25",duration:45,healthScore:{overall:82,cognitive:78,emotional:88,social:85},symptoms:{memory:75,attention:80,language:85,orientation:90,mood:88},conversationMetrics:{totalMessages:24,avgResponseTime:3.2,emotionalTone:"积极",topicCoherence:85},aiInsights:["患者对近期事件的记忆显示出轻度困难，但对远期记忆保持较好","在交流中表现出较强的社交意愿和情绪稳定性","对新技术表现出一定的适应能力，能够跟随AI对话流程","建议增加认知训练活动，特别是记忆力相关的练习"],recommendations:["每日进行 15-20 分钟的记忆力训练游戏","增加与家人的交流频率，保持社交活跃度","定期使用 AI 陪伴系统进行对话练习","关注睡眠质量，保证充足的休息时间","考虑增加辅助药物治疗，具体请咨询主治医生"]},o=[{subject:"记忆力",A:n.symptoms.memory,fullMark:100},{subject:"注意力",A:n.symptoms.attention,fullMark:100},{subject:"语言能力",A:n.symptoms.language,fullMark:100},{subject:"定向力",A:n.symptoms.orientation,fullMark:100},{subject:"情绪状态",A:n.symptoms.mood,fullMark:100}],s=[{day:"Day 1",cognitive:75,emotional:82,overall:78},{day:"Day 2",cognitive:76,emotional:85,overall:80},{day:"Day 3",cognitive:74,emotional:83,overall:78},{day:"Day 4",cognitive:77,emotional:86,overall:81},{day:"Day 5",cognitive:78,emotional:87,overall:82},{day:"Day 6",cognitive:79,emotional:89,overall:83},{day:"Day 7",cognitive:78,emotional:88,overall:82}],u=[{symptom:"记忆困难",frequency:8},{symptom:"注意力不集中",frequency:5},{symptom:"焦虑情绪",frequency:3},{symptom:"睡眠问题",frequency:4},{symptom:"沟通障碍",frequency:2}],f=()=>{console.log("下载详细报告..."),alert("报告正在生成，请稍后...")};return U.jsxs("div",{className:"space-y-8",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsxs(SC,{to:"/doctor",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[U.jsx(Ihe,{className:"w-5 h-5"}),U.jsx("span",{children:"返回列表"})]}),U.jsx("div",{className:"h-6 w-px bg-gray-300"}),U.jsxs("div",{children:[U.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"详细报告"}),U.jsxs("p",{className:"text-gray-600",children:[n.patientName," - ",n.sessionDate]})]})]}),U.jsxs("button",{onClick:f,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors",children:[U.jsx(M7,{className:"w-5 h-5"}),U.jsx("span",{children:"下载 PDF"})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"患者信息及会话概况"}),U.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[U.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[U.jsx(j7,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"患者姓名"}),U.jsx("p",{className:"text-gray-600",children:n.patientName}),U.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",n.patientId]})]}),U.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[U.jsx(Ng,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"会话日期"}),U.jsx("p",{className:"text-gray-600",children:n.sessionDate})]}),U.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[U.jsx(_R,{className:"w-8 h-8 text-purple-500 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"会话时长"}),U.jsxs("p",{className:"text-gray-600",children:[n.duration," 分钟"]})]}),U.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[U.jsx(dH,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"对话次数"}),U.jsxs("p",{className:"text-gray-600",children:[n.conversationMetrics.totalMessages," 次"]})]})]})]}),U.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"健康评分细分"}),U.jsxs("div",{className:"space-y-6",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx(bC,{className:"w-6 h-6 text-green-500"}),U.jsx("span",{className:"font-medium text-gray-900",children:"综合评分"})]}),U.jsxs("div",{className:"text-right",children:[U.jsx("span",{className:"text-2xl font-bold text-green-600",children:n.healthScore.overall}),U.jsx("span",{className:"text-gray-500",children:"/100"})]})]}),U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx(Wp,{className:"w-6 h-6 text-blue-500"}),U.jsx("span",{className:"font-medium text-gray-900",children:"认知能力"})]}),U.jsxs("div",{className:"text-right",children:[U.jsx("span",{className:"text-2xl font-bold text-blue-600",children:n.healthScore.cognitive}),U.jsx("span",{className:"text-gray-500",children:"/100"})]})]}),U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx(lu,{className:"w-6 h-6 text-red-500"}),U.jsx("span",{className:"font-medium text-gray-900",children:"情绪状态"})]}),U.jsxs("div",{className:"text-right",children:[U.jsx("span",{className:"text-2xl font-bold text-red-600",children:n.healthScore.emotional}),U.jsx("span",{className:"text-gray-500",children:"/100"})]})]}),U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx(Ohe,{className:"w-6 h-6 text-purple-500"}),U.jsx("span",{className:"font-medium text-gray-900",children:"社交能力"})]}),U.jsxs("div",{className:"text-right",children:[U.jsx("span",{className:"text-2xl font-bold text-purple-600",children:n.healthScore.social}),U.jsx("span",{className:"text-gray-500",children:"/100"})]})]})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"认知能力分析"}),U.jsx("div",{className:"h-80",children:U.jsx(Cg,{width:"100%",height:"100%",children:U.jsxs(tNe,{data:o,children:[U.jsx(fQ,{}),U.jsx(m_,{dataKey:"subject",tick:{fontSize:12}}),U.jsx(f_,{angle:90,domain:[0,100],tick:{fontSize:10}}),U.jsx(HS,{name:"评分",dataKey:"A",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3,strokeWidth:2})]})})})]})]}),U.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"七日健康趋势"}),U.jsx("div",{className:"h-80",children:U.jsx(Cg,{width:"100%",height:"100%",children:U.jsxs(fZ,{data:s,children:[U.jsx(PS,{strokeDasharray:"3 3",className:"opacity-30"}),U.jsx(Bd,{dataKey:"day",tick:{fontSize:12}}),U.jsx(Wd,{domain:[60,100],tick:{fontSize:12}}),U.jsx(ao,{}),U.jsx(ul,{type:"monotone",dataKey:"cognitive",stroke:"#3b82f6",strokeWidth:3,name:"认知能力",dot:{fill:"#3b82f6",strokeWidth:2,r:4}}),U.jsx(ul,{type:"monotone",dataKey:"emotional",stroke:"#ef4444",strokeWidth:3,name:"情绪状态",dot:{fill:"#ef4444",strokeWidth:2,r:4}}),U.jsx(ul,{type:"monotone",dataKey:"overall",stroke:"#10b981",strokeWidth:3,name:"综合评分",dot:{fill:"#10b981",strokeWidth:2,r:4}})]})})})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"症状频率统计"}),U.jsx("div",{className:"h-80",children:U.jsx(Cg,{width:"100%",height:"100%",children:U.jsxs(mZ,{data:u,layout:"horizontal",children:[U.jsx(PS,{strokeDasharray:"3 3",className:"opacity-30"}),U.jsx(Bd,{type:"number",tick:{fontSize:12}}),U.jsx(Wd,{dataKey:"symptom",type:"category",width:100,tick:{fontSize:12}}),U.jsx(ao,{}),U.jsx(fu,{dataKey:"frequency",fill:"#f59e0b",name:"频率"})]})})})]})]}),U.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"AI 洞察分析"}),U.jsx("div",{className:"space-y-4",children:n.aiInsights.map((_,E)=>U.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-blue-50 rounded-lg",children:[U.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0 mt-0.5",children:E+1}),U.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:_})]},E))})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"治疗建议"}),U.jsx("div",{className:"space-y-4",children:n.recommendations.map((_,E)=>U.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-green-50 rounded-lg",children:[U.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0 mt-0.5",children:E+1}),U.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:_})]},E))})]})]}),U.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[U.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"对话质量指标"}),U.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[U.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg",children:[U.jsx(dH,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"对话次数"}),U.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.conversationMetrics.totalMessages}),U.jsxs("p",{className:"text-sm text-gray-600",children:["在 ",n.duration," 分钟内"]})]}),U.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg",children:[U.jsx(_R,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"平均响应时间"}),U.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.conversationMetrics.avgResponseTime}),U.jsx("p",{className:"text-sm text-gray-600",children:"秒"})]}),U.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg",children:[U.jsx(lu,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"情绪色彩"}),U.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n.conversationMetrics.emotionalTone}),U.jsx("p",{className:"text-sm text-gray-600",children:"主导情绪"})]}),U.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg",children:[U.jsx(Phe,{className:"w-8 h-8 text-orange-600 mx-auto mb-2"}),U.jsx("h3",{className:"font-semibold text-gray-900",children:"话题连贯性"}),U.jsx("p",{className:"text-2xl font-bold text-orange-600",children:n.conversationMetrics.topicCoherence}),U.jsx("p",{className:"text-sm text-gray-600",children:"%"})]})]})]})]})},aNe=()=>{var u;const{user:i,setUser:n}=Gd(),o=[{name:"主页",href:_s.HOME,icon:xhe,color:"text-blue-600"},{name:"病史导入",href:_s.HISTORY,icon:vL,color:"text-green-600"},{name:"AI陪伴对话",href:_s.CHAT,icon:EL,color:"text-purple-600"},{name:"家属简报",href:_s.FAMILY_SUMMARY,icon:zM,color:"text-orange-600"},{name:"医生仪表板",href:_s.DOCTOR,icon:U7,color:"text-red-600"}],s=()=>{n(null)};return U.jsxs("div",{className:"bg-white shadow-xl w-64 min-h-screen flex flex-col",children:[U.jsx("div",{className:"p-6 border-b border-gray-200",children:U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-green-500 rounded-lg flex items-center justify-center",children:U.jsx(lu,{className:"w-6 h-6 text-white"})}),U.jsxs("div",{children:[U.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"MedJourney"}),U.jsx("p",{className:"text-sm text-gray-500",children:"智能伴侣"})]})]})}),U.jsx("div",{className:"p-6 border-b border-gray-200",children:U.jsxs("div",{className:"flex items-center space-x-3",children:[U.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold text-lg",children:((u=i==null?void 0:i.name)==null?void 0:u.charAt(0))||"U"}),U.jsxs("div",{children:[U.jsx("p",{className:"font-medium text-gray-900",children:(i==null?void 0:i.name)||"未知用户"}),U.jsx("p",{className:"text-sm text-gray-500",children:"患者"})]})]})}),U.jsx("nav",{className:"flex-1 p-4 space-y-2",children:o.map(f=>{const _=f.icon;return U.jsxs(dhe,{to:f.href,className:({isActive:E})=>`flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-200 ${E?"bg-blue-50 text-blue-700 border-r-4 border-blue-500":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[U.jsx(_,{className:`w-5 h-5 ${f.color}`}),U.jsx("span",{className:"font-medium text-lg",children:f.name})]},f.name)})}),U.jsx("div",{className:"p-4 border-t border-gray-200",children:U.jsxs("button",{onClick:s,className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-600 hover:bg-red-50 hover:text-red-700 rounded-lg transition-all duration-200",children:[U.jsx(Lhe,{className:"w-5 h-5"}),U.jsx("span",{className:"font-medium text-lg",children:"退出"})]})})]})},oNe=()=>{var s;const{user:i,healthScore:n}=Gd(),o=()=>{const u=new Date().getHours();return u<12?"早上好":u<18?"下午好":"晚上好"};return U.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsxs("div",{children:[U.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[o(),"，",(i==null?void 0:i.name)||"您好","！"]}),U.jsx("p",{className:"text-gray-600",children:"今天您感觉怎么样？"})]}),n&&U.jsxs("div",{className:"bg-gradient-to-r from-green-100 to-blue-100 px-4 py-2 rounded-lg",children:[U.jsx("p",{className:"text-sm text-gray-600",children:"今日健康评分"}),U.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[n.overall,"/100"]})]})]}),U.jsxs("div",{className:"flex items-center space-x-4",children:[U.jsxs("button",{className:"relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors",children:[U.jsx(Dhe,{className:"w-6 h-6"}),U.jsx("span",{className:"absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full"})]}),U.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors",children:U.jsx(Fhe,{className:"w-6 h-6"})}),U.jsx("button",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:U.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold",children:((s=i==null?void 0:i.name)==null?void 0:s.charAt(0))||"U"})})]})]})})},sNe=()=>U.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-blue-50 via-white to-green-50",children:[U.jsx(aNe,{}),U.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[U.jsx(oNe,{}),U.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-50/50 p-6",children:U.jsx("div",{className:"max-w-7xl mx-auto",children:U.jsx(Qde,{})})})]})]});function cNe(){const{user:i}=Gd();return U.jsx(E7,{children:U.jsx(che,{children:U.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50",children:U.jsxs(ehe,{children:[U.jsx(al,{path:_s.LOGIN,element:U.jsx(Hhe,{})}),i?U.jsxs(al,{path:"/*",element:U.jsx(sNe,{}),children:[U.jsx(al,{index:!0,element:U.jsx(qhe,{})}),U.jsx(al,{path:"history",element:U.jsx(Khe,{})}),U.jsx(al,{path:"chat",element:U.jsx(tpe,{})}),U.jsx(al,{path:"family-summary",element:U.jsx(rNe,{})}),U.jsx(al,{path:"doctor",element:U.jsx(nNe,{})}),U.jsx(al,{path:"doctor/report/:sid",element:U.jsx(iNe,{})})]}):U.jsx(al,{path:"*",element:U.jsx(D7,{to:_s.LOGIN,replace:!0})})]})})})})}ode.createRoot(document.getElementById("root")).render(U.jsx(Ee.StrictMode,{children:U.jsx(E7,{children:U.jsx(cNe,{})})}));
